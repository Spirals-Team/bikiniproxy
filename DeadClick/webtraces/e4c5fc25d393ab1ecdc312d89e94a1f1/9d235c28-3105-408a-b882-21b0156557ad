/*! updated; 02-13-2018 04:14 PM **/


Modulr.define("core.auth:models/middleware",["require","jquery","config","helper","models/fnnauth.broker"],function(require,$,config,Helper){var Authentication=require("models/fnnauth.broker"),Auth=new Authentication(config.hostname);return new function(){var Proto=this,_props=null,_events=null,spotim_notifier=null;Proto.getProps=function(){return _props},Proto.getEvents=function(){return _events},Proto.onLogin=function(cb){if(!cb&&"function"!=typeof cb)return!1;spotim_notifier=cb},Proto.set=function(callback){"function"==typeof callback&&Auth.initialize(function(events){Proto.isAuthenticated(function(props){Helper.log("is authenticated?",props.authenticated),_props=props,_events=events,spotim_notifier&&"function"==typeof spotim_notifier&&spotim_notifier(props,events),callback({authenticated:props.authenticated,userInfo:props.userInfo,token:props.token,events:events})})})},Proto.isAuthenticated=function(callback){Auth.MODE_silentLogin(function(props){callback(props)})},Proto.gotoPage=function(page){var url=null;switch(page){case"profile":url=config.profilePage}url&&window.open(url,"_self")},Proto.logout=function(){alert("todo: logout")}}});