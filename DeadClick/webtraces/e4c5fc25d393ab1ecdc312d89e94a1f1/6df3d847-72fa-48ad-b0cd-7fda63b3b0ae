/*! updated; 02-13-2018 04:14 PM **/


Modulr.define("core.plugins:EventMessageHandler",function(){function log(){if(!!(window.location.search&&window.location.search.indexOf("_log=y")>-1)&&window.console)try{return console.log.apply(console,arguments)}catch(err){console.log(arguments)}}var CONST={};CONST.stringify=function(){var ver=!1;if(navigator&&"Microsoft Internet Explorer"===navigator.appName){var ua=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(ua)&&(ver=parseFloat(RegExp.$1)),ver&&ver<=9&&(ver=!0)}return ver}();var App=function(){(this.__v={})._handlers={},this.init()};return App.prototype.init=function(){var vars=this.__v;vars._messageHandler=function(event){var message=event.data,hasErr=!1;if(CONST.stringify){if(!window.JSON)return log("[EventMessageHandler.send] Requires JSON"),!1;try{message=JSON.parse(message)}catch(err){log("[EventMessageHandler.send] error:"),log(err),hasErr=!0}}if(!hasErr){log("[EventMessageHandler.receive]",message);var type=!(!message||!message.type)&&message.type,data=!(!message||!message.data)&&message.data;type&&data&&vars._handlers[type]&&"function"==typeof vars._handlers[type]&&vars._handlers[type](data)}};try{window.addEventListener("message",vars._messageHandler,!1)}catch(error){window.attachEvent("onmessage",vars._messageHandler)}this.init=function(){}},App.prototype.addHandler=function(type,callback){var self=this,vars=self.__v,prefix=vars.config&&"string"==typeof vars.config.prefix?vars.config.prefix:"";if("string"!=typeof type)return!1;type=prefix+type,vars._handlers[type]=callback},App.prototype.sendMessage=function(element,type,data){var self=this,vars=self.__v,prefix=vars.config&&"string"==typeof vars.config.prefix?vars.config.prefix:"";if("string"!=typeof type)return!1;type=prefix+type;var info={type:type,data:data};if(CONST.stringify){if(!window.JSON)return log("[EventMessageHandler.send] Requires JSON"),!1;info=JSON.stringify(info)}if(element&&"string"==typeof element&&"parent"===element)try{window.parent.postMessage(info,"*"),log("[EventMessageHandler] send to parent:",info)}catch(err){log("[EventMessageHandler.send] ERROR:",err)}else if(element&&"string"==typeof element&&"self"===element)try{window.postMessage(info,"*"),log("[EventMessageHandler] send to iframe",info)}catch(err){log("[EventMessageHandler] ERROR:",err)}else if(element&&element.contentWindow)try{element.contentWindow.postMessage(info,"*"),log("[EventMessageHandler] send to iframe",info)}catch(err){log("[EventMessageHandler] ERROR:",err)}},App});