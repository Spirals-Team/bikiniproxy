(function(){(function(){var e=this,t=e._,n={},i=Array.prototype,r=Object.prototype,s=Function.prototype,o=i.push,a=i.slice,c=i.concat,u=r.toString,l=r.hasOwnProperty,d=i.forEach,h=i.map,p=i.reduce,f=i.reduceRight,m=i.filter,g=i.every,v=i.some,b=i.indexOf,y=i.lastIndexOf,w=Array.isArray,_=Object.keys,x=s.bind,k=function(e){return e instanceof k?e:this instanceof k?(this._wrapped=e,void 0):new k(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=k),exports._=k):e._=k,k.VERSION="1.4.4";var S=k.each=k.forEach=function(e,t,i){if(null!=e)if(d&&e.forEach===d)e.forEach(t,i);else if(e.length===+e.length){for(var r=0,s=e.length;s>r;r++)if(t.call(i,e[r],r,e)===n)return}else for(var o in e)if(k.has(e,o)&&t.call(i,e[o],o,e)===n)return};k.map=k.collect=function(e,t,n){var i=[];return null==e?i:h&&e.map===h?e.map(t,n):(S(e,function(e,r,s){i[i.length]=t.call(n,e,r,s)}),i)};var M="Reduce of empty array with no initial value";k.reduce=k.foldl=k.inject=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return i&&(t=k.bind(t,i)),r?e.reduce(t,n):e.reduce(t);if(S(e,function(e,s,o){r?n=t.call(i,n,e,s,o):(n=e,r=!0)}),!r)throw new TypeError(M);return n},k.reduceRight=k.foldr=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return i&&(t=k.bind(t,i)),r?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=k.keys(e);s=o.length}if(S(e,function(a,c,u){c=o?o[--s]:--s,r?n=t.call(i,n,e[c],c,u):(n=e[c],r=!0)}),!r)throw new TypeError(M);return n},k.find=k.detect=function(e,t,n){var i;return O(e,function(e,r,s){return t.call(n,e,r,s)?(i=e,!0):void 0}),i},k.filter=k.select=function(e,t,n){var i=[];return null==e?i:m&&e.filter===m?e.filter(t,n):(S(e,function(e,r,s){t.call(n,e,r,s)&&(i[i.length]=e)}),i)},k.reject=function(e,t,n){return k.filter(e,function(e,i,r){return!t.call(n,e,i,r)},n)},k.every=k.all=function(e,t,i){t||(t=k.identity);var r=!0;return null==e?r:g&&e.every===g?e.every(t,i):(S(e,function(e,s,o){return(r=r&&t.call(i,e,s,o))?void 0:n}),!!r)};var O=k.some=k.any=function(e,t,i){t||(t=k.identity);var r=!1;return null==e?r:v&&e.some===v?e.some(t,i):(S(e,function(e,s,o){return r||(r=t.call(i,e,s,o))?n:void 0}),!!r)};k.contains=k.include=function(e,t){return null==e?!1:b&&e.indexOf===b?-1!=e.indexOf(t):O(e,function(e){return e===t})},k.invoke=function(e,t){var n=a.call(arguments,2),i=k.isFunction(t);return k.map(e,function(e){return(i?t:e[t]).apply(e,n)})},k.pluck=function(e,t){return k.map(e,function(e){return e[t]})},k.where=function(e,t,n){return k.isEmpty(t)?n?null:[]:k[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},k.findWhere=function(e,t){return k.where(e,t,!0)},k.max=function(e,t,n){if(!t&&k.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&k.isEmpty(e))return-1/0;var i={computed:-1/0,value:-1/0};return S(e,function(e,r,s){var o=t?t.call(n,e,r,s):e;o>=i.computed&&(i={value:e,computed:o})}),i.value},k.min=function(e,t,n){if(!t&&k.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&k.isEmpty(e))return 1/0;var i={computed:1/0,value:1/0};return S(e,function(e,r,s){var o=t?t.call(n,e,r,s):e;i.computed>o&&(i={value:e,computed:o})}),i.value},k.shuffle=function(e){var t,n=0,i=[];return S(e,function(e){t=k.random(n++),i[n-1]=i[t],i[t]=e}),i};var E=function(e){return k.isFunction(e)?e:function(t){return t[e]}};k.sortBy=function(e,t,n){var i=E(t);return k.pluck(k.map(e,function(e,t,r){return{value:e,index:t,criteria:i.call(n,e,t,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index<t.index?-1:1}),"value")};var $=function(e,t,n,i){var r={},s=E(t||k.identity);return S(e,function(t,o){var a=s.call(n,t,o,e);i(r,a,t)}),r};k.groupBy=function(e,t,n){return $(e,t,n,function(e,t,n){(k.has(e,t)?e[t]:e[t]=[]).push(n)})},k.countBy=function(e,t,n){return $(e,t,n,function(e,t){k.has(e,t)||(e[t]=0),e[t]++})},k.sortedIndex=function(e,t,n,i){n=null==n?k.identity:E(n);for(var r=n.call(i,t),s=0,o=e.length;o>s;){var a=s+o>>>1;r>n.call(i,e[a])?s=a+1:o=a}return s},k.toArray=function(e){return e?k.isArray(e)?a.call(e):e.length===+e.length?k.map(e,k.identity):k.values(e):[]},k.size=function(e){return null==e?0:e.length===+e.length?e.length:k.keys(e).length},k.first=k.head=k.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:a.call(e,0,t)},k.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},k.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},k.rest=k.tail=k.drop=function(e,t,n){return a.call(e,null==t||n?1:t)},k.compact=function(e){return k.filter(e,k.identity)};var T=function(e,t,n){return S(e,function(e){k.isArray(e)?t?o.apply(n,e):T(e,t,n):n.push(e)}),n};k.flatten=function(e,t){return T(e,t,[])},k.without=function(e){return k.difference(e,a.call(arguments,1))},k.uniq=k.unique=function(e,t,n,i){k.isFunction(t)&&(i=n,n=t,t=!1);var r=n?k.map(e,n,i):e,s=[],o=[];return S(r,function(n,i){(t?i&&o[o.length-1]===n:k.contains(o,n))||(o.push(n),s.push(e[i]))}),s},k.union=function(){return k.uniq(c.apply(i,arguments))},k.intersection=function(e){var t=a.call(arguments,1);return k.filter(k.uniq(e),function(e){return k.every(t,function(t){return k.indexOf(t,e)>=0})})},k.difference=function(e){var t=c.apply(i,a.call(arguments,1));return k.filter(e,function(e){return!k.contains(t,e)})},k.zip=function(){for(var e=a.call(arguments),t=k.max(k.pluck(e,"length")),n=Array(t),i=0;t>i;i++)n[i]=k.pluck(e,""+i);return n},k.object=function(e,t){if(null==e)return{};for(var n={},i=0,r=e.length;r>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},k.indexOf=function(e,t,n){if(null==e)return-1;var i=0,r=e.length;if(n){if("number"!=typeof n)return i=k.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,r+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;r>i;i++)if(e[i]===t)return i;return-1},k.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(y&&e.lastIndexOf===y)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var r=i?n:e.length;r--;)if(e[r]===t)return r;return-1},k.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=0,s=Array(i);i>r;)s[r++]=e,e+=n;return s},k.bind=function(e,t){if(e.bind===x&&x)return x.apply(e,a.call(arguments,1));var n=a.call(arguments,2);return function(){return e.apply(t,n.concat(a.call(arguments)))}},k.partial=function(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}},k.bindAll=function(e){var t=a.call(arguments,1);return 0===t.length&&(t=k.functions(e)),S(t,function(t){e[t]=k.bind(e[t],e)}),e},k.memoize=function(e,t){var n={};return t||(t=k.identity),function(){var i=t.apply(this,arguments);return k.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},k.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},k.defer=function(e){return k.delay.apply(k,[e,1].concat(a.call(arguments,1)))},k.throttle=function(e,t){var n,i,r,s,o=0,a=function(){o=new Date,r=null,s=e.apply(n,i)};return function(){var c=new Date,u=t-(c-o);return n=this,i=arguments,0>=u?(clearTimeout(r),r=null,o=c,s=e.apply(n,i)):r||(r=setTimeout(a,u)),s}},k.debounce=function(e,t,n){var i,r;return function(){var s=this,o=arguments,a=function(){i=null,n||(r=e.apply(s,o))},c=n&&!i;return clearTimeout(i),i=setTimeout(a,t),c&&(r=e.apply(s,o)),r}},k.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},k.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},k.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},k.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},k.keys=_||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)k.has(e,n)&&(t[t.length]=n);return t},k.values=function(e){var t=[];for(var n in e)k.has(e,n)&&t.push(e[n]);return t},k.pairs=function(e){var t=[];for(var n in e)k.has(e,n)&&t.push([n,e[n]]);return t},k.invert=function(e){var t={};for(var n in e)k.has(e,n)&&(t[e[n]]=n);return t},k.functions=k.methods=function(e){var t=[];for(var n in e)k.isFunction(e[n])&&t.push(n);return t.sort()},k.extend=function(e){return S(a.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},k.pick=function(e){var t={},n=c.apply(i,a.call(arguments,1));return S(n,function(n){n in e&&(t[n]=e[n])}),t},k.omit=function(e){var t={},n=c.apply(i,a.call(arguments,1));for(var r in e)k.contains(n,r)||(t[r]=e[r]);return t},k.defaults=function(e){return S(a.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},k.clone=function(e){return k.isObject(e)?k.isArray(e)?e.slice():k.extend({},e):e},k.tap=function(e,t){return t(e),e};var j=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof k&&(e=e._wrapped),t instanceof k&&(t=t._wrapped);var r=u.call(e);if(r!=u.call(t))return!1;switch(r){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return i[s]==t;n.push(e),i.push(t);var o=0,a=!0;if("[object Array]"==r){if(o=e.length,a=o==t.length)for(;o--&&(a=j(e[o],t[o],n,i)););}else{var c=e.constructor,l=t.constructor;if(c!==l&&!(k.isFunction(c)&&c instanceof c&&k.isFunction(l)&&l instanceof l))return!1;for(var d in e)if(k.has(e,d)&&(o++,!(a=k.has(t,d)&&j(e[d],t[d],n,i))))break;if(a){for(d in t)if(k.has(t,d)&&!o--)break;a=!o}}return n.pop(),i.pop(),a};k.isEqual=function(e,t){return j(e,t,[],[])},k.isEmpty=function(e){if(null==e)return!0;if(k.isArray(e)||k.isString(e))return 0===e.length;for(var t in e)if(k.has(e,t))return!1;return!0},k.isElement=function(e){return!(!e||1!==e.nodeType)},k.isArray=w||function(e){return"[object Array]"==u.call(e)},k.isObject=function(e){return e===Object(e)},S(["Arguments","Function","String","Number","Date","RegExp"],function(e){k["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),k.isArguments(arguments)||(k.isArguments=function(e){return!(!e||!k.has(e,"callee"))}),k.isFunction=function(e){return"function"==typeof e},k.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},k.isNaN=function(e){return k.isNumber(e)&&e!=+e},k.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==u.call(e)},k.isNull=function(e){return null===e},k.isUndefined=function(e){return void 0===e},k.has=function(e,t){return l.call(e,t)},k.noConflict=function(){return e._=t,this},k.identity=function(e){return e},k.times=function(e,t,n){for(var i=Array(e),r=0;e>r;r++)i[r]=t.call(n,r);return i},k.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var A={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};A.unescape=k.invert(A.escape);var R={escape:RegExp("["+k.keys(A.escape).join("")+"]","g"),unescape:RegExp("("+k.keys(A.unescape).join("|")+")","g")};k.each(["escape","unescape"],function(e){k[e]=function(t){return null==t?"":(""+t).replace(R[e],function(t){return A[e][t]})}}),k.result=function(e,t){if(null==e)return null;var n=e[t];return k.isFunction(n)?n.call(e):n},k.mixin=function(e){S(k.functions(e),function(t){var n=k[t]=e[t];k.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),L.call(this,n.apply(k,e))}})};var C=0;k.uniqueId=function(e){var t=++C+"";return e?e+t:t},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\t|\u2028|\u2029/g;k.template=function(e,t,n){var i;n=k.defaults({},n,k.templateSettings);var r=RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(r,function(t,n,i,r,a){return o+=e.slice(s,a).replace(I,function(e){return"\\"+N[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(o+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(o+="';\n"+r+"\n__p+='"),s=a+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{i=Function(n.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(t)return i(t,k);var c=function(e){return i.call(this,e,k)};return c.source="function("+(n.variable||"obj")+"){\n"+o+"}",c},k.chain=function(e){return k(e).chain()};var L=function(e){return this._chain?k(e).chain():e};k.mixin(k),S(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];k.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],L.call(this,n)}}),S(["concat","join","slice"],function(e){var t=i[e];k.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),k.extend(k.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return k})}).call(this),function(e,t){"undefined"!=typeof exports?t(e,exports,require("underscore")):"function"==typeof define&&define.amd?define("backbone",["underscore","jquery/1/jquery","exports"],function(n,i,r){e.Backbone=t(e,r,n,i)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,i){var r=e.Backbone,s=[],o=s.push,a=s.slice,c=s.splice;t.VERSION="0.9.10",t.$=i,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var u=/\s+/,l=function(e,t,n,i){if(!n)return!0;if("object"==typeof n)for(var r in n)e[t].apply(e,[r,n[r]].concat(i));else{if(!u.test(n))return!0;for(var s=n.split(u),o=0,a=s.length;a>o;o++)e[t].apply(e,[s[o]].concat(i))}},d=function(e,t){var n,i=-1,r=e.length;switch(t.length){case 0:for(;r>++i;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;r>++i;)(n=e[i]).callback.call(n.ctx,t[0]);return;case 2:for(;r>++i;)(n=e[i]).callback.call(n.ctx,t[0],t[1]);return;case 3:for(;r>++i;)(n=e[i]).callback.call(n.ctx,t[0],t[1],t[2]);return;default:for(;r>++i;)(n=e[i]).callback.apply(n.ctx,t)}},h=t.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,i){if(!l(this,"once",e,[t,i])||!t)return this;var r=this,s=n.once(function(){r.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,i),this},off:function(e,t,i){var r,s,o,a,c,u,d,h;if(!this._events||!l(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events={},this;for(a=e?[e]:n.keys(this._events),c=0,u=a.length;u>c;c++)if(e=a[c],r=this._events[e]){if(o=[],t||i)for(d=0,h=r.length;h>d;d++)s=r[d],(t&&t!==s.callback&&t!==s.callback._callback||i&&i!==s.context)&&o.push(s);this._events[e]=o}return this},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&d(n,t),i&&d(i,arguments),this},listenTo:function(e,t,i){var r=this._listeners||(this._listeners={}),s=e._listenerId||(e._listenerId=n.uniqueId("l"));return r[s]=e,e.on(t,"object"==typeof t?this:i,this),this},stopListening:function(e,t,n){var i=this._listeners;if(i){if(e)e.off(t,"object"==typeof t?this:n,this),t||n||delete i[e._listenerId];else{"object"==typeof t&&(n=this);for(var r in i)i[r].off(t,n,this);this._listeners={}}return this}}};h.bind=h.on,h.unbind=h.off,n.extend(t,h);var p=t.Model=function(e,t){var i,r=e||{};this.cid=n.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r,t)||{}),(i=n.result(this,"defaults"))&&(r=n.defaults({},r,i)),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(p.prototype,h,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var r,s,o,a,c,u,l,d;if(null==e)return this;if("object"==typeof e?(s=e,i=t):(s={})[e]=t,i||(i={}),!this._validate(s,i))return!1;o=i.unset,c=i.silent,a=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=n.clone(this.attributes),this.changed={}),d=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(r in s)t=s[r],n.isEqual(d[r],t)||a.push(r),n.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,o?delete d[r]:d[r]=t;if(!c){a.length&&(this._pending=!0);for(var h=0,p=a.length;p>h;h++)this.trigger("change:"+a[h],this,d[a[h]],i)}if(u)return this;if(!c)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,i=!1,r=this._changing?this._previousAttributes:this.attributes;for(var s in e)n.isEqual(r[s],t=e[s])||((i||(i={}))[s]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,n,i){return e.set(e.parse(n,i),i)?(t&&t(e,n,i),void 0):!1},this.sync("read",this,e)},save:function(e,t,i){var r,s,o,a,c=this.attributes;return null==e||"object"==typeof e?(r=e,i=t):(r={})[e]=t,!r||i&&i.wait||this.set(r,i)?(i=n.extend({validate:!0},i),this._validate(r,i)?(r&&i.wait&&(this.attributes=n.extend({},c,r)),void 0===i.parse&&(i.parse=!0),s=i.success,i.success=function(e,t,i){e.attributes=c;var o=e.parse(t,i);return i.wait&&(o=n.extend(r||{},o)),n.isObject(o)&&!e.set(o,i)?!1:(s&&s(e,t,i),void 0)},o=this.isNew()?"create":i.patch?"patch":"update","patch"===o&&(i.attrs=r),a=this.sync(o,this,i),r&&i.wait&&(this.attributes=c),a):!1):!1},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(e,t,n){(n.wait||e.isNew())&&r(),i&&i(e,t,n)},this.isNew())return e.success(this,null,e),!1;var s=this.sync("delete",this,e);return e.wait||r(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||R();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return i?(this.trigger("invalid",this,i,t||{}),!1):!0}});var f=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))};n.extend(f.prototype,h,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){e=n.isArray(e)?e.slice():[e],t||(t={});var i,r,s,a,u,l,d,h,p,f;for(d=[],h=t.at,p=this.comparator&&null==h&&0!=t.sort,f=n.isString(this.comparator)?this.comparator:null,i=0,r=e.length;r>i;i++)(s=this._prepareModel(a=e[i],t))?(u=this.get(s))?t.merge&&(u.set(a===s?s.attributes:a,t),p&&!l&&u.hasChanged(f)&&(l=!0)):(d.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,null!=s.id&&(this._byId[s.id]=s)):this.trigger("invalid",this,a,t);if(d.length&&(p&&(l=!0),this.length+=d.length,null!=h?c.apply(this.models,[h,0].concat(d)):o.apply(this.models,d)),l&&this.sort({silent:!0}),t.silent)return this;for(i=0,r=d.length;r>i;i++)(s=d[i]).trigger("add",s,this,t);return l&&this.trigger("sort",this,t),this},remove:function(e,t){e=n.isArray(e)?e.slice():[e],t||(t={});var i,r,s,o;for(i=0,r=e.length;r>i;i++)o=this.get(e[i]),o&&(delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o));return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:(this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e])},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},update:function(e,t){t=n.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var i,r,s,o,a=[],c=[],u={};if(n.isArray(e)||(e=e?[e]:[]),t.add&&!t.remove)return this.add(e,t);for(r=0,s=e.length;s>r;r++)i=e[r],o=this.get(i),t.remove&&o&&(u[o.cid]=!0),(t.add&&!o||t.merge&&o)&&a.push(i);if(t.remove)for(r=0,s=this.models.length;s>r;r++)i=this.models[r],u[i.cid]||c.push(i);return c.length&&this.remove(c,t),a.length&&this.add(a,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var i=0,r=this.models.length;r>i;i++)this._removeReference(this.models[i]);return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,n,i){var r=i.update?"update":"reset";e[r](n,i),t&&t(e,n,i)},this.sync("read",this,e)},create:function(e,t){if(t=t?n.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,r=t.success;return t.success=function(e,t,n){n.wait&&i.add(e,n),r&&r(e,t,n)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))},sortedIndex:function(e,t,i){t||(t=this.comparator);var r=n.isFunction(t)?t:function(e){return e.get(t)};return n.sortedIndex(this.models,e,r,i)}});var m=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];n.each(m,function(e){f.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var g=["groupBy","countBy","sortBy"];n.each(g,function(e){f.prototype[e]=function(t,i){var r=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,r,i)}});var v=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},b=/\((.*?)\)/g,y=/(\(\?)?:\w+/g,w=/\*\w+/g,_=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(v.prototype,h,{initialize:function(){},route:function(e,i,r){return n.isRegExp(e)||(e=this._routeToRegExp(e)),r||(r=this[i]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);r&&r.apply(this,s),this.trigger.apply(this,["route:"+i].concat(s)),this.trigger("route",i,s),t.history.trigger("route",this,i,s)},this)),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes)for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(_,"\\$&").replace(b,"(?:$1)?").replace(y,function(e,t){return t?e:"([^/]+)"}).replace(w,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var x=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},k=/^[#\/]|\s+$/g,S=/^\/+|\/+$/g,M=/msie [\w.]+/,O=/\/$/;x.started=!1,n.extend(x.prototype,h,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(O,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(k,"")},start:function(e){if(x.started)throw Error("Backbone.history has already been started");x.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),r=document.documentMode,s=M.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);this.root=("/"+this.root+"/").replace(S,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(i)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(k,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),x.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),i=n.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return i},navigate:function(e,t){if(!x.started)return!1;if(t&&t!==!0||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new x;var E=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},$=/^(\S+)\s*(.*)$/,T=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,h,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=n.result(this,"events"))){this.undelegateEvents();for(var t in e){var i=e[t];if(n.isFunction(i)||(i=this[e[t]]),!i)throw Error('Method "'+e[t]+'" does not exist');var r=t.match($),s=r[1],o=r[2];i=n.bind(i,this),s+=".delegateEvents"+this.cid,""===o?this.$el.on(s,i):this.$el.on(s,o,i)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},n.result(this,"options"),e)),n.extend(this,n.pick(e,T)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var i=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}});var j={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.sync=function(e,i,r){var s=j[e];n.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};if(r.url||(o.url=n.result(i,"url")||R()),null!=r.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(r.attrs||i.toJSON(r))),r.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),r.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",r.emulateJSON&&(o.data._method=s);var a=r.beforeSend;r.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",s),a?a.apply(this,arguments):void 0}}"GET"===o.type||r.emulateJSON||(o.processData=!1);var c=r.success;r.success=function(e){c&&c(i,e,r),i.trigger("sync",i,e,r)};var u=r.error;r.error=function(e){u&&u(i,e,r),i.trigger("error",i,e,r)};var l=r.xhr=t.ajax(n.extend(o,r));return i.trigger("request",i,l,r),l},t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var A=function(e,t){var i,r=this;i=e&&n.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};p.extend=f.extend=v.extend=E.extend=x.extend=A;var R=function(){throw Error('A "url" property or function must be specified')};return t}),define("lib/util",["newsletter/1/service"],function(e){var t=webmd.url.getEnv(),n=webmd.url.getLifecycle(),i="https://www"+n+t+".webmd.com/interaction-checker",r="https://www"+n+t+".webmd.com/my-medicine",s="https://member"+n+t+".webmd.com/profile.aspx",o="https://member.webmd.com/register",a="https://member.webmd.com/signin",c="https://member.webmd.com/additional-info",u="https://www.webmd.com/api/reg/regapi.svc/json2",l="https://www.webmd.com/api/reg/regapi.svc/json2/user",d="https://www.webmd.com/api/reg/regapi.svc/json2/dependant";
return{appid:37,myToolsApps:{myMedicine:11},AUTH_COOKIE:"WBMD_AUTH",APP_EMS:[{id:"MyMedDrugAlertWMD",name:"My Medicine Drug Alert"}],APP_SESSION:["pillsafevisit"],userId:null,baseTemplateCleanup:function(){var e=["#headerLinks_email","#headerLinks_pages","#headerLinks_print"];_.each(e,function(e){$(e).remove()})},deferred:function(){return new $.Deferred},destroyView:function(e){e.length>0&&_.each(e,function(e){e.undelegateEvents(),e.$el.removeData().off(),e.remove()})},generateRandom:function(){return(new Date).getTime()},generateUrlWithParameters:function(e,t){return"webmd.com"===webmd.url.getHostname(e).split(".").slice(-2).join(".")&&(e=webmd.url.addLifecycleAndEnv(e)),_.each(t,function(t,n){"returl"===t&&(value=encodeURIComponent(value)),e=webmd.url.setParam(n,t,e)}),e},getFormattedDrugName:function(e){var e=e.replace(/#/g,"").replace(/\s/g,"+");return e},getEnv:function(){var e=webmd.url.getHostname().split(".").slice(-2).join(".");return"webmd.com"===e?webmd.url.getEnv():webmd.url.getEnv(this.image_server_url)},getLifecycle:function(){var e=webmd.url.getHostname().split(".").slice(-2).join(".");return"webmd.com"===e?webmd.url.getLifecycle():webmd.url.getLifecycle(this.image_server_url)},getICUrl:function(){return i},getMCUrl:function(){return r},getProfileUrl:function(){return s},getDrugDetailUrl:function(e,t){var t=this.getFormattedDrugName(t),n=webmd.substitute("/drugs/drug-{drugId}-{drugName}.aspx?drugid={drugId}&drugname={drugName}&source=2",{drugId:e,drugName:t});return n},getUserId:function(){return this.userId},getRegApiDependentUrl:function(){var e={r:this.generateRandom()},t=$.extend(e,t||{}),n=d;return n=this.generateUrlWithParameters(n,t)},getRegApiUserUrl:function(){var e={r:this.generateRandom()},t=$.extend(e,t||{}),n=l;return n=this.generateUrlWithParameters(n,t)},getRegApiRootUrl:function(e){var e=e||{},t=u;return t=this.generateUrlWithParameters(t,e)},getAdditionalInfoUrl:function(e){var t={appid:this.appid,returl:window.location.href},e=$.extend(t,e||{}),n=c;return n=this.generateUrlWithParameters(n,e)},getRegisterUrl:function(e){var t={appid:this.appid,returl:window.location.href},e=$.extend(t,e||{}),n=o;return n=this.generateUrlWithParameters(n,e)},getSignInUrl:function(e){var t={appid:this.appid,returl:window.location.href},e=$.extend(t,e||{}),n=a;return n=this.generateUrlWithParameters(n,e)},getDaysInMonth:function(e,t){var t=t||!1,e=t?e:e-1,n=moment().month(e).daysInMonth();return n},hasSessionStorage:function(){return window.sessionStorage?!0:!1},isLoggedIn:function(){return webmd.cookie.exists(this.AUTH_COOKIE)},sendSubscriptions:function(t){var n=[302,304],i=Backbone.Mediator.models.appuser.get("userNameField");if(t.length&&i&&""!==i){t=_.union(n,t);var r=_.chain(t).map(function(e){return isFinite(e)?parseInt(e):void 0}).uniq().value();e.subscribe({id:r,email:i,privacy:!1}).done(function(){webmd.debug("util.sendSubscription : subscribe","Success!",r,i)}).fail(function(){webmd.debug("util.sendSubscription : subscribe","FAILURE!",r,i)})}},signIn:function(e){if(Backbone.Mediator.publish("signin:open"),webmd.p.registration&&webmd.p.registration.loginOverlay){var t={appid:this.appid,onClosed:function(){$("#webmdHoverLoadedContent").removeClass("pillsafe"),Backbone.Mediator.publish("signin:close")},promo:"",prepopulate:{firstname:"",lastname:"",emailaddr:"",emailaddr2:"",birthdate:"",gender:"",zipcode:""},productIdentifier:"drugs",returl:window.location.href},n=$.extend({},t,e||{});webmd.overlay.close(),$("#webmdHoverLoadedContent").addClass("pillsafe"),webmd.p.registration.loginOverlay.show(n)}else webmd.overlay.open({html:"<p>We're sorry, user sign in is currently unavailable. Please try again later.</p>",onClosed:function(){Backbone.Mediator.publish("signin:close")}})},signUp:function(e){var t={appid:this.appid,returl:window.location.href+Backbone.history.getHash()},n=$.extend({},t,e||{}),i=this.getRegisterUrl(n);window.location.href=i},updateGlobalRegRetUrl:function(){var e=window.location.href,t=$("#globalreg").attr("action");t=webmd.url.setParam("returl",e,t),$("#login_dropdown_col_2>.webmd-btn").attr("href",t),$("#globalreg").attr("action",t)}}}),define("collections/session-psdrugs",["require","backbone","lib/util"],function(e){var t=e("backbone"),n=e("lib/util");return t.Collection.extend({subscriptions:{"search:focus":"onDrugSearch","search:selected-ps":"onSearchSelected","addMedicine:open":"createBindings"},isActive:n.hasSessionStorage(),name:"pillsafedrugs",add:function(e,n){webmd.debug("collections/ps/session-psdrugs : add",e,n);var i=this;n===void 0&&(n={silent:!0}),n&&!n.hasOwnProperty("silent")&&(n.silent=!0),e&&((e.models||void 0!==e.attributes)&&(e=e.toJSON()),!e[0]&&e.drug_id?i.where({drug_id:e.drug_id}).length||i.where({generic_name:e.generic_name}).length||t.Collection.prototype.add.call(i,e,n):_.each(e,function(e){i.where({drug_id:e.drug_id}).length||i.where({generic_name:e.generic_name}).length||(webmd.debug("views/ps/session-psdrugs : add",e),t.Collection.prototype.add.call(i,e,n))}),i.setSession())},destroy:function(){window.sessionStorage.removeItem(this.name)},getSession:function(){return JSON.parse(window.sessionStorage.getItem(this.name))},change:function(){window.sessionStorage.setItem(this.name,JSON.stringify(this.toJSON()))},initialize:function(){if(webmd.debug("collections/ps/session-psdrugs | init",this,t.Mediator.collections.drugs,this.getSession()),this.isActive){var e=this.getSession();e&&this.add(e),n.isLoggedIn()||(void 0!==t.Mediator.collections.drugs&&(this.listenTo(t.Mediator.collections.drugs,"add",this.add,this),this.listenTo(t.Mediator.collections.drugs,"remove",this.remove,this),this.listenTo(t.Mediator.collections.drugs,"reset",this.reset,this),this.listenTo(t.Mediator.collections.drugs,"change",this.change,this)),this.on("remove reset",this.setSession,this))}},remove:function(e,n){e.length>0&&t.Collection.prototype.remove.call(this,e,n)},reset:function(e,n){e.length>0&&t.Collection.prototype.reset.call(this,e,n)},setSession:function(){window.sessionStorage.setItem(this.name,JSON.stringify(this.toJSON()))}})}),function(e,t,n,i,r,s){function o(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function a(e,t){return!("object"!=typeof e[t]||!e[t])}function c(e){return"[object Array]"===Object.prototype.toString.call(e)}function u(){var e="Shockwave Flash",t="application/x-shockwave-flash";if(!y(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var n=navigator.plugins[e].description;n&&!y(navigator.mimeTypes)&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&($=n.match(/\d+/g))}if(!$){var i;try{i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),$=Array.prototype.slice.call(i.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),i=null}catch(r){}}if(!$)return!1;var s=parseInt($[0],10),o=parseInt($[1],10);return T=s>9&&o>0,!0}function l(){if(!z){z=!0;for(var e=0;W.length>e;e++)W[e]();W.length=0}}function d(e,t){return z?(e.call(t),void 0):(W.push(function(){e.call(t)}),void 0)}function h(){var e=parent;if(""!==D)for(var t=0,n=D.split(".");n.length>t;t++)e=e[n[t]];return e.easyXDM}function p(t){return e.easyXDM=U,D=t,D&&(H="easyXDM_"+D.replace(".","_")+"_"),F}function f(e){return e.match(N)[3]}function m(e){return e.match(N)[4]||""}function g(e){var t=e.toLowerCase().match(N),n=t[2],i=t[3],r=t[4]||"";return("http:"==n&&":80"==r||"https:"==n&&":443"==r)&&(r=""),n+"//"+i+r}function v(e){if(e=e.replace(L,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":n.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=n.protocol+"//"+n.host+t+e}for(;I.test(e);)e=e.replace(I,"");return e}function b(e,t){var n="",i=e.indexOf("#");-1!==i&&(n=e.substring(i),e=e.substring(0,i));var r=[];for(var o in t)t.hasOwnProperty(o)&&r.push(o+"="+s(t[o]));return e+(B?"#":-1==e.indexOf("?")?"?":"&")+r.join("&")+n}function y(e){return void 0===e}function w(e,t,n){var i;for(var r in t)t.hasOwnProperty(r)&&(r in e?(i=t[r],"object"==typeof i?w(e[r],i,n):n||(e[r]=t[r])):e[r]=t[r]);return e}function _(){var e=t.body.appendChild(t.createElement("form")),n=e.appendChild(t.createElement("input"));n.name=H+"TEST"+C,E=n!==e.elements[n.name],t.body.removeChild(e)}function x(e){y(E)&&_();var n;E?n=t.createElement('<iframe name="'+e.props.name+'"/>'):(n=t.createElement("IFRAME"),n.name=e.props.name),n.id=n.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(w(n.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var i=e.props.src;if(e.props.src="javascript:false",w(n,e.props),n.border=n.frameBorder=0,n.allowTransparency=!0,e.container.appendChild(n),e.onLoad&&j(n,"load",e.onLoad),e.usePost){var r,s=e.container.appendChild(t.createElement("form"));if(s.target=n.name,s.action=i,s.method="POST","object"==typeof e.usePost)for(var o in e.usePost)e.usePost.hasOwnProperty(o)&&(E?r=t.createElement('<input name="'+o+'"/>'):(r=t.createElement("INPUT"),r.name=o),r.value=e.usePost[o],s.appendChild(r));s.submit(),s.parentNode.removeChild(s)}else n.src=i;return e.props.src=i,n}function k(e,t){"string"==typeof e&&(e=[e]);for(var n,i=e.length;i--;)if(n=e[i],n=RegExp("^"==n.substr(0,1)?n:"^"+n.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),n.test(t))return!0;return!1}function S(i){var r,s=i.protocol;if(i.isHost=i.isHost||y(J.xdm_p),B=i.hash||!1,i.props||(i.props={}),i.isHost)i.remote=v(i.remote),i.channel=i.channel||"default"+C++,i.secret=Math.random().toString(16).substring(2),y(s)&&(s=g(n.href)==g(i.remote)?"4":o(e,"postMessage")||o(t,"postMessage")?"1":i.swf&&o(e,"ActiveXObject")&&u()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":i.remoteHelper?"2":"0");else if(i.channel=J.xdm_c.replace(/["'<>\\]/g,""),i.secret=J.xdm_s,i.remote=J.xdm_e.replace(/["'<>\\]/g,""),s=J.xdm_p,i.acl&&!k(i.acl,i.remote))throw Error("Access denied for "+i.remote);switch(i.protocol=s,s){case"0":if(w(i,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),i.isHost){if(!i.local){for(var a,c=n.protocol+"//"+n.host,l=t.body.getElementsByTagName("img"),d=l.length;d--;)if(a=l[d],a.src.substring(0,c.length)===c){i.local=a.src;break}i.local||(i.local=e)}var h={xdm_c:i.channel,xdm_p:0};i.local===e?(i.usePolling=!0,i.useParent=!0,i.local=n.protocol+"//"+n.host+n.pathname+n.search,h.xdm_e=i.local,h.xdm_pa=1):h.xdm_e=v(i.local),i.container&&(i.useResize=!1,h.xdm_po=1),i.remote=b(i.remote,h)}else w(i,{channel:J.xdm_c,remote:J.xdm_e,useParent:!y(J.xdm_pa),usePolling:!y(J.xdm_po),useResize:i.useParent?!1:i.useResize});r=[new F.stack.HashTransport(i),new F.stack.ReliableBehavior({}),new F.stack.QueueBehavior({encode:!0,maxLength:4e3-i.remote.length}),new F.stack.VerifyBehavior({initiate:i.isHost})];break;case"1":r=[new F.stack.PostMessageTransport(i)];break;case"2":i.remoteHelper=v(i.remoteHelper),r=[new F.stack.NameTransport(i),new F.stack.QueueBehavior,new F.stack.VerifyBehavior({initiate:i.isHost})];break;case"3":r=[new F.stack.NixTransport(i)];break;case"4":r=[new F.stack.SameOriginTransport(i)];break;case"5":r=[new F.stack.FrameElementTransport(i)];break;case"6":$||u(),r=[new F.stack.FlashTransport(i)]}return r.push(new F.stack.QueueBehavior({lazy:i.lazy,remove:!0})),r}function M(e){for(var t,n={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},i=0,r=e.length;r>i;i++)t=e[i],w(t,n,!0),0!==i&&(t.down=e[i-1]),i!==r-1&&(t.up=e[i+1]);return t}function O(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var E,$,T,j,A,R=this,C=Math.floor(1e4*Math.random()),P=Function.prototype,N=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,I=/[\-\w]+\/\.\.\//,L=/([^:])\/\//g,D="",F={},U=e.easyXDM,H="easyXDM_",B=!1;if(o(e,"addEventListener"))j=function(e,t,n){e.addEventListener(t,n,!1)},A=function(e,t,n){e.removeEventListener(t,n,!1)};else{if(!o(e,"attachEvent"))throw Error("Browser not supported");j=function(e,t,n){e.attachEvent("on"+t,n)},A=function(e,t,n){e.detachEvent("on"+t,n)}}var q,z=!1,W=[];if("readyState"in t?(q=t.readyState,z="complete"==q||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==q||"interactive"==q)):z=!!t.body,!z){if(o(e,"addEventListener"))j(t,"DOMContentLoaded",l);else if(j(t,"readystatechange",function(){"complete"==t.readyState&&l()}),t.documentElement.doScroll&&e===top){var V=function(){if(!z){try{t.documentElement.doScroll("left")}catch(e){return i(V,1),void 0}l()}};V()}j(e,"load",l)}var J=function(e){e=e.substring(1).split("&");for(var t,n={},i=e.length;i--;)t=e[i].split("="),n[t[0]]=r(t[1]);return n}(/xdm_e=/.test(n.search)?n.search:n.hash),X=function(){var e={},t={a:[1,2,3]},n='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===n?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===n&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=n.evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(X=function(){return e},e):null)};w(F,{version:"2.4.17.1",query:J,stack:{},apply:w,getJSONObject:X,whenReady:d,noConflict:p}),F.DomHelper={on:j,un:A,requiresJSON:function(n){a(e,"JSON")||t.write('<script type="text/javascript" src="'+n+'"><'+"/script>")}},function(){var e={};F.Fn={set:function(t,n){e[t]=n},get:function(t,n){var i=e[t];return n&&delete e[t],i}}}(),F.Socket=function(e){var t=M(S(e).concat([{incoming:function(t,n){e.onMessage(t,n)},callback:function(t){e.onReady&&e.onReady(t)}}])),n=g(e.remote);this.origin=g(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,n)},t.init()},F.Rpc=function(e,t){if(t.local)for(var n in t.local)if(t.local.hasOwnProperty(n)){var i=t.local[n];"function"==typeof i&&(t.local[n]={method:i})}var r=M(S(e).concat([new F.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=g(e.remote),this.destroy=function(){r.destroy()},r.init()},F.stack.SameOriginTransport=function(e){var t,r,s,o;return t={outgoing:function(e,t,n){s(e),n&&n()},destroy:function(){r&&(r.parentNode.removeChild(r),r=null)},onDOMReady:function(){o=g(e.remote),e.isHost?(w(e.props,{src:b(e.remote,{xdm_e:n.protocol+"//"+n.host+n.pathname,xdm_c:e.channel,xdm_p:4}),name:H+e.channel+"_provider"}),r=x(e),F.Fn.set(e.channel,function(e){return s=e,i(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,o)}})):(s=h().Fn.get(e.channel,!0)(function(e){t.up.incoming(e,o)}),i(function(){t.up.callback(!0)},0))},init:function(){d(t.onDOMReady,t)}}},F.stack.FlashTransport=function(e){function r(e){i(function(){o.up.incoming(e,c)},0)}function s(n){var i=e.swf+"?host="+e.isHost,r="easyXDM_swf_"+Math.floor(1e4*Math.random());F.Fn.set("flash_loaded"+n.replace(/[\-.]/g,"_"),function(){F.stack.FlashTransport[n].swf=u=l.firstChild;for(var e=F.stack.FlashTransport[n].queue,t=0;e.length>t;t++)e[t]();e.length=0}),e.swfContainer?l="string"==typeof e.swfContainer?t.getElementById(e.swfContainer):e.swfContainer:(l=t.createElement("div"),w(l.style,T&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(l));var s="callback=flash_loaded"+n.replace(/[\-.]/g,"_")+"&proto="+R.location.protocol+"&domain="+f(R.location.href)+"&port="+m(R.location.href)+"&ns="+D;l.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+r+"' data='"+i+"'>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='wmode' value='transparent'>"+"<param name='movie' value='"+i+"'></param>"+"<param name='flashvars' value='"+s+"'></param>"+"<embed type='application/x-shockwave-flash' FlashVars='"+s+"' allowScriptAccess='always' wmode='transparent' src='"+i+"' height='1' width='1'></embed>"+"</object>"}var o,a,c,u,l;return o={outgoing:function(t,n,i){u.postMessage(e.channel,""+t),i&&i()},destroy:function(){try{u.destroyChannel(e.channel)}catch(t){}u=null,a&&(a.parentNode.removeChild(a),a=null)},onDOMReady:function(){c=e.remote,F.Fn.set("flash_"+e.channel+"_init",function(){i(function(){o.up.callback(!0)})}),F.Fn.set("flash_"+e.channel+"_onMessage",r),e.swf=v(e.swf);var t=f(e.swf),l=function(){F.stack.FlashTransport[t].init=!0,u=F.stack.FlashTransport[t].swf,u.createChannel(e.channel,e.secret,g(e.remote),e.isHost),e.isHost&&(T&&e.swfNoThrottle&&w(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),w(e.props,{src:b(e.remote,{xdm_e:g(n.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:H+e.channel+"_provider"}),a=x(e))};F.stack.FlashTransport[t]&&F.stack.FlashTransport[t].init?l():F.stack.FlashTransport[t]?F.stack.FlashTransport[t].queue.push(l):(F.stack.FlashTransport[t]={queue:[l]},s(t))},init:function(){d(o.onDOMReady,o)}}},F.stack.PostMessageTransport=function(t){function r(e){if(e.origin)return g(e.origin);if(e.uri)return g(e.uri);if(e.domain)return n.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function s(e){var n=r(e);n==u&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&o.up.incoming(e.data.substring(t.channel.length+1),n)}var o,a,c,u;return o={outgoing:function(e,n,i){c.postMessage(t.channel+" "+e,n||u),i&&i()},destroy:function(){A(e,"message",s),a&&(c=null,a.parentNode.removeChild(a),a=null)},onDOMReady:function(){if(u=g(t.remote),t.isHost){var r=function(n){n.data==t.channel+"-ready"&&(c="postMessage"in a.contentWindow?a.contentWindow:a.contentWindow.document,A(e,"message",r),j(e,"message",s),i(function(){o.up.callback(!0)},0))};j(e,"message",r),w(t.props,{src:b(t.remote,{xdm_e:g(n.href),xdm_c:t.channel,xdm_p:1}),name:H+t.channel+"_provider"}),a=x(t)}else j(e,"message",s),c="postMessage"in e.parent?e.parent:e.parent.document,c.postMessage(t.channel+"-ready",u),i(function(){o.up.callback(!0)},0)},init:function(){d(o.onDOMReady,o)}}},F.stack.FrameElementTransport=function(r){var s,o,a,c;return s={outgoing:function(e,t,n){a.call(this,e),n&&n()},destroy:function(){o&&(o.parentNode.removeChild(o),o=null)},onDOMReady:function(){c=g(r.remote),r.isHost?(w(r.props,{src:b(r.remote,{xdm_e:g(n.href),xdm_c:r.channel,xdm_p:5}),name:H+r.channel+"_provider"}),o=x(r),o.fn=function(e){return delete o.fn,a=e,i(function(){s.up.callback(!0)},0),function(e){s.up.incoming(e,c)}}):(t.referrer&&g(t.referrer)!=J.xdm_e&&(e.top.location=J.xdm_e),a=e.frameElement.fn(function(e){s.up.incoming(e,c)}),s.up.callback(!0))},init:function(){d(s.onDOMReady,s)}}},F.stack.NameTransport=function(e){function t(t){var n=e.remoteHelper+(a?"#_3":"#_2")+e.channel;c.contentWindow.sendMessage(t,n)}function n(){a?2!==++l&&a||o.up.callback(!0):(t("ready"),o.up.callback(!0))}function r(e){o.up.incoming(e,p)}function s(){h&&i(function(){h(!0)},0)}var o,a,c,u,l,h,p,f;return o={outgoing:function(e,n,i){h=i,t(e)},destroy:function(){c.parentNode.removeChild(c),c=null,a&&(u.parentNode.removeChild(u),u=null)},onDOMReady:function(){a=e.isHost,l=0,p=g(e.remote),e.local=v(e.local),a?(F.Fn.set(e.channel,function(t){a&&"ready"===t&&(F.Fn.set(e.channel,r),n())}),f=b(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),w(e.props,{src:f+"#"+e.channel,name:H+e.channel+"_provider"}),u=x(e)):(e.remoteHelper=e.remote,F.Fn.set(e.channel,r));var t=function(){var r=c||this;A(r,"load",t),F.Fn.set(e.channel+"_load",s),function o(){"function"==typeof r.contentWindow.sendMessage?n():i(o,50)}()};c=x({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){d(o.onDOMReady,o)}}},F.stack.HashTransport=function(t){function n(e){if(m){var n=t.remote+"#"+p++ +"_"+e;(c||!v?m.contentWindow:m).location=n}}function r(e){h=e,a.up.incoming(h.substring(h.indexOf("_")+1),b)}function s(){if(f){var e=f.location.href,t="",n=e.indexOf("#");-1!=n&&(t=e.substring(n)),t&&t!=h&&r(t)}}function o(){u=setInterval(s,l)}var a,c,u,l,h,p,f,m,v,b;return a={outgoing:function(e){n(e)},destroy:function(){e.clearInterval(u),(c||!v)&&m.parentNode.removeChild(m),m=null},onDOMReady:function(){if(c=t.isHost,l=t.interval,h="#"+t.channel,p=0,v=t.useParent,b=g(t.remote),c){if(w(t.props,{src:t.remote,name:H+t.channel+"_provider"}),v)t.onLoad=function(){f=e,o(),a.up.callback(!0)};else{var n=0,r=t.delay/50;(function s(){if(++n>r)throw Error("Unable to reference listenerwindow");try{f=m.contentWindow.frames[H+t.channel+"_consumer"]}catch(e){}f?(o(),a.up.callback(!0)):i(s,50)})()}m=x(t)}else f=e,o(),v?(m=parent,a.up.callback(!0)):(w(t,{props:{src:t.remote+"#"+t.channel+new Date,name:H+t.channel+"_consumer"},onLoad:function(){a.up.callback(!0)}}),m=x(t))},init:function(){d(a.onDOMReady,a)}}},F.stack.ReliableBehavior=function(){var e,t,n=0,i=0,r="";return e={incoming:function(s,o){var a=s.indexOf("_"),c=s.substring(0,a).split(",");s=s.substring(a+1),c[0]==n&&(r="",t&&(t(!0),t=null)),s.length>0&&(e.down.outgoing(c[1]+","+n+"_"+r,o),i!=c[1]&&(i=c[1],e.up.incoming(s,o)))},outgoing:function(s,o,a){r=s,t=a,e.down.outgoing(i+","+ ++n+"_"+s,o)}}},F.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===a.length)return O(n),void 0;if(!c&&0!==a.length&&!o){c=!0;var r=a.shift();n.down.outgoing(r.data,r.origin,function(e){c=!1,r.callback&&i(function(){r.callback(e)},0),t()})}}var n,o,a=[],c=!0,u="",l=0,d=!1,h=!1;return n={init:function(){y(e)&&(e={}),e.maxLength&&(l=e.maxLength,h=!0),e.lazy?d=!0:n.down.init()},callback:function(e){c=!1;var i=n.up;t(),i.callback(e)},incoming:function(t,i){if(h){var s=t.indexOf("_"),o=parseInt(t.substring(0,s),10);u+=t.substring(s+1),0===o&&(e.encode&&(u=r(u)),n.up.incoming(u,i),u="")}else n.up.incoming(t,i)},outgoing:function(i,r,o){e.encode&&(i=s(i));var c,u=[];if(h){for(;0!==i.length;)c=i.substring(0,l),i=i.substring(c.length),u.push(c);for(;c=u.shift();)a.push({data:u.length+"_"+c,origin:r,callback:0===u.length?o:null})}else a.push({data:i,origin:r,callback:o});d?n.down.init():t()},destroy:function(){o=!0,n.down.destroy()}}},F.stack.VerifyBehavior=function(e){function t(){i=Math.random().toString(16).substring(2),n.down.outgoing(i)}var n,i,r;return n={incoming:function(s,o){var a=s.indexOf("_");-1===a?s===i?n.up.callback(!0):r||(r=s,e.initiate||t(),n.down.outgoing(s)):s.substring(0,a)===r&&n.up.incoming(s.substring(a+1),o)},outgoing:function(e,t,r){n.down.outgoing(i+"_"+e,t,r)},callback:function(){e.initiate&&t()}}},F.stack.RpcBehavior=function(e,t){function n(e){e.jsonrpc="2.0",s.down.outgoing(o.stringify(e))}function i(e,t){var i=Array.prototype.slice;return function(){var r,s=arguments.length,o={method:t};s>0&&"function"==typeof arguments[s-1]?(s>1&&"function"==typeof arguments[s-2]?(r={success:arguments[s-2],error:arguments[s-1]},o.params=i.call(arguments,0,s-2)):(r={success:arguments[s-1]},o.params=i.call(arguments,0,s-1)),u[""+ ++a]=r,o.id=a):o.params=i.call(arguments,0),e.namedParams&&1===o.params.length&&(o.params=o.params[0]),n(o)}}function r(e,t,i,r){if(!i)return t&&n({id:t,error:{code:-32601,message:"Procedure not found."}}),void 0;var s,o;t?(s=function(e){s=P,n({id:t,result:e})},o=function(e,i){o=P;var r={id:t,error:{code:-32099,message:e}};i&&(r.error.data=i),n(r)}):s=o=P,c(r)||(r=[r]);try{var a=i.method.apply(i.scope,r.concat([s,o]));y(a)||s(a)}catch(u){o(u.message)}}var s,o=t.serializer||X(),a=0,u={};return s={incoming:function(e){var i=o.parse(e);if(i.method)t.handle?t.handle(i,n):r(i.method,i.id,t.local[i.method],i.params);else{var s=u[i.id];i.error?s.error&&s.error(i.error):s.success&&s.success(i.result),delete u[i.id]}},init:function(){if(t.remote)for(var n in t.remote)t.remote.hasOwnProperty(n)&&(e[n]=i(t.remote[n],n));s.down.init()},destroy:function(){for(var n in t.remote)t.remote.hasOwnProperty(n)&&e.hasOwnProperty(n)&&delete e[n];s.down.destroy()}}},R.easyXDM=F}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),define("lib/easyXDM",function(){}),define("lib/backbone.xdm",["underscore","backbone","lib/util","lib/easyXDM"],function(e,t,n){var i,r,s,o=t.sync;i={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},r=function(){throw Error('A "url" property or function must be specified')},s=function(e){var t=document.createElement("a");return t.href=e,t.host!==document.location.host||t.protocol!==document.location.protocol},t.sync=function(t,a,c){var u,l,d,h,p=webmd.substitute("https://www{lifecycle}{environment}.webmd.com/xdm",{lifecycle:n.getLifecycle(),environment:n.getEnv()});return c.url||(c.url=e.result(a,"url")||r()),s(c.url)?(h=new $.Deferred,c.method=c.type||i[t],c.contentType&&(c.headers={"Content-Type":c.contentType}),webmd.debug("-------> backbone.xdm sync : liefcycle",n.getLifecycle()," | environment: ",n.getEnv()," | xdmUrl: ",p),u=new easyXDM.Rpc({remote:p},{remote:{request:{}}}),l=c.success,c.success=function(e){var t;t=c.dataType&&"text"===c.dataType?e.data+"":/^text\/xml/.test(e.headers["Content-Type"])?$.parseXML(e.data):$.parseJSON(e.data),l&&l(a,t,c),a.trigger("sync",a,t,c),h.resolve()},d=c.error,c.error=function(){d&&d(a,u,c),a.trigger("error",a,u,c),h.reject()},u.request(c,c.success,c.error),a.trigger("request",a,u,c),h):o(t,a,c)}}),define("models/appuser",["backbone","lib/util","lib/backbone.xdm"],function(e,t){return e.Model.extend({defaults:{registeredApps:[]},requiredFields:["firstNameField","lastNameField"],url:t.getRegApiUserUrl(),getRegisteredApps:function(){var e=this;webmd.debug("appuser : getRegisteredApps"),$.ajax({url:"/api/reg/myappsapi.svc/json/myapps",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(t){return webmd.debug("Success! Registered apps were returned.",t),t&&t.data&&t.data.UserApps.UsedApps?(e.set("registeredApps",t.data.UserApps.UsedApps),e.get("registeredApps")):void 0}).fail(function(){return webmd.debug("the ajax call has failed."),e.get("registeredApps")})},isAppRegistered:function(e){var e=e||t.myToolsApps.myMedicine;return _.some(this.get("registeredApps"),function(t){return""+t.AppId==""+e})?!0:!1},registerApp:function(e){var e=e||t.myToolsApps.myMedicine;webmd.debug("registering the app for the authenticated user",e),$.ajax({url:"/api/reg/myappsapi.svc/json/registerapp",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({appId:e})}).done(function(t){return webmd.debug("Success! App was registered.",e),{status:!0,message:t}}).fail(function(e){return webmd.debug("registering the app has failed."),{staus:!1,message:e}})},fetch:function(t){var n={contentType:"application/json",type:"GET",dataType:"json",cache:!1,timeout:1e4,url:this.url};return n=_.extend(n,t),e.Model.prototype.fetch.call(this,n)},parse:function(e,n){return e&&e.data&&e.data.userinfo&&(e=e.data.userinfo[0],t.userId=e.userIdField,this.getRegisteredApps(),n.isWidget||_.each(this.requiredFields,function(n){webmd.debug(t.getAdditionalInfoUrl({returl:t.getMCUrl()})),_.isEmpty(e.personField[n])&&(webmd.debug("appuser : required field is blank",e,n),window.location.href=t.getAdditionalInfoUrl({appid:t.appid,returl:t.getMCUrl()}))})),e}})}),function(e){"function"==typeof define&&define.amd?define("mediator",["underscore","backbone"],e):e(_,Backbone)}(function(e,t){var n,i={},r=t.View.prototype.delegateEvents,s=t.View.prototype.undelegateEvents;return t.Mediator={subscribe:function(e,t,n,r){i[e]||(i[e]=[]),i[e].push({fn:t,context:n||this,once:r})},publish:function(e){if(i[e])for(var n,r=[].slice.call(arguments,1),s=0;i[e].length>s;s++)n=i[e][s],n.fn.apply(n.context,r),n.once&&(t.Mediator.unsubscribe(e,n.fn,n.context),s--)},unsubscribe:function(e,t,n){if(i[e])for(var r,s=0;i[e].length>s;s++)r=i[e][s],r.fn===t&&r.context===n&&(i[e].splice(s,1),s--)},subscribeOnce:function(e,n,i){t.Mediator.subscribe(e,n,i,!0)}},n={delegateEvents:function(){r.apply(this,arguments),this.setSubscriptions()},undelegateEvents:function(){s.apply(this,arguments),this.unsetSubscriptions()},subscriptions:{},setSubscriptions:function(n){n&&e.extend(this.subscriptions||{},n),n=n||this.subscriptions,n&&!e.isEmpty(n)&&(this.unsetSubscriptions(n),e.each(n,function(n,i){var r;n.$once&&(n=n.$once,r=!0),e.isString(n)&&(n=this[n]),t.Mediator.subscribe(i,n,this,r)},this))},unsetSubscriptions:function(n){n=n||this.subscriptions,n&&!e.isEmpty(n)&&e.each(n,function(n,i){e.isString(n)&&(n=this[n]),t.Mediator.unsubscribe(i,n.$once||n,this)},this)}},e.extend(t.View.prototype,n),e.extend(t.Mediator,{pub:t.Mediator.publish,sub:t.Mediator.subscribe}),t}),define("collections/reasons",["require","backbone","lib/util"],function(e){var t=e("backbone");return e("lib/util"),t.Collection.extend({url:"/drugs/api/DrugService.svc/reviewconditions/{drug_id}/{drug_type}",fetch:function(e){var n=e.drug_id?e.drug_id:e.id,i=e.med_type?e.med_type:e.type,r={contentType:"application/json; charset=utf-8",type:"GET",url:webmd.substitute(this.url,{drug_id:n,drug_type:i})};return t.Collection.prototype.fetch.call(this,r)},parse:function(e){return e&&e.data&&e.data.length>0?e.data:e}})}),define("collections/base/search",["require","backbone"],function(e){var t=e("backbone");return t.Collection.extend({count:0,namespace:"srch",noresults:null,requiredLength:3,size:10,xhrPool:[],abortDeprecated:function(){var e=this;_.each(e.xhrPool,function(t){t.id<e.xhrPool.length&&t.abort()})},abortAll:function(){var e=this;_.each(e.xhrPool,function(e){e.abort()})},getCachedResult:function(e){var t=this.getMatches(e);return t?(this.cache[e]=t,t):[]},getMatches:function(e){var t=[],n=[];return e=$.trim(e.toLowerCase()),_.each(this.cache,function(i){_.each(i,function(i){i.drug_name&&(i.drug_name.toLowerCase(),i.drug_name.toLowerCase()===e&&-1==_.indexOf(t,i.drug_id)&&(webmd.debug("pushing the id to array"),t.push(i.drug_id),n.push(i)))})}),n.length>0?n[0]:null},getNoResults:function(e){return[{drug_id:0,drug_name:'No match was found for drug "'+e+'," please try again'}]},getNoService:function(){return[{drug_id:0,drug_name:"We're sorry.  This tool can not be used right now.  Please check back later."}]},initialize:function(e){_.extend(this,e),this.cache={}},stop:function(){this.abortAll()}})}),define("collections/search-qrl",["require","collections/base/search"],function(e){var t=e("collections/base/search");return t.extend({source:1,url:"/api/qrl/LookupService.ashx?jsonp=?",fetch:function(e,t){var n=this;if(e&&e.length>=this.requiredLength)if(this.cache[e])this.reset(this.cache[e]),n.trigger("reset-"+n.namespace,n);else{var i={format:"json",metadata:"rxotc,generic_name,mnid",q:e,s:this.source,sz:this.size},r={contentType:"application/json; charset=utf-8",dataType:"json",data:i,beforeSend:function(t){t.id=++n.count,t.string=e,n.xhrPool.push(t)},complete:function(e){var t=_.indexOf(n.xhrPool,e);t>-1&&(n.xhrPool.splice(t,1),n.count--)},error:function(e){n.reset(n.parse(null,e)),n.trigger("reset-"+n.namespace,n)},success:function(e,t,i){n.reset(n.parse(e,i)),n.trigger("reset-"+n.namespace,n)},timeout:1e4,type:"GET",url:this.url};_.extend(r,t),r.data.afr||this.abortDeprecated(),$.ajax(r)}else n.reset(),n.trigger("reset-"+n.namespace,n)},parse:function(e,t){var n,i=t.status;return 200===i?e&&e.hasOwnProperty("types")&&e.types.length>0&&e.types[0].hasOwnProperty("references")?(e=e.types[0].references,_.each(e,function(e){e.id&&(e.drug_id=e.id,delete e.id),e.rxotc&&(e.med_type=e.rxotc,delete e.rxotc),e.text&&(e.drug_name=e.text,delete e.text),delete e.type,delete e.val}),this.cache[t.string]=e):(n=this.getCachedResult(t.string),e=n&&n.length>0?n:this.getNoResults(t.string)):e=this.getNoService(),e}})}),define("views/base/search-result",["backbone"],function(e){return e.View.extend({initialize:function(e){_.bindAll(this),_.extend(this,e),this.render()},render:function(){var e,t,n,i=this.wrapSearchTerms(),r=this;i&&(t=i.indexOf("This tool"),n=i.indexOf("No match"),-1===n&&-1===t?e=$('<a href="javascript://">'+i+"</a>").on("click",function(e){e.preventDefault(),r.selectDrug()}):(-1===t&&(e=$('<span class="error no-match-error">'+i+"</span>")),-1===n&&(e=$('<span class="error service-down-error">'+i+"</span>"))),this.$el.append(e))
},selectDrug:function(){e.Mediator.publish("search:selected-"+this.namespace,this.model)},wrapSearchTerms:function(){var e=this.model;if(e){var t=e.drug_name;if(t&&t.length>0&&" "!=t){var n=this.current.replace(/[^A-z0-9]/g,""),i=RegExp("(>)?"+n,"gi");return t=t.replace(i,function(e,t){return t?e:"<span>"+e+"</span>"})}return null}return null}})}),define("views/base/search",["require","backbone","lib/util","views/base/search-result"],function(e){var t=e("backbone"),n=(e("lib/util"),e("views/base/search-result"));return t.View.extend({current:"",delay:200,displayed:10,index:0,isOpen:!1,placeholder:"Enter at least 3 characters",previous:"",resultViews:[],buildResultViews:function(e){var t=this;_.each(e,function(e,i){var r=$("<li></li>");t.resultViews[i]=new n({$container:t.$resultsList,current:t.current,el:r,model:e,namespace:t.namespace}),t.$resultsList.append(r)})},destroyResultViews:function(){this.$resultsList.children().remove()},doSearch:function(e){this.previous=this.current,this.current=e,this.collection.fetch(e)},hide:function(){this.$results.hide(),this.$resultsList[0].className="auto",this.destroyResultViews(),this.index=0,this.isOpen=!1},initialize:function(e){var n=this;_.bindAll(this),_.extend(this,e),this.$input=this.$el.find('input[type!="checkbox"]'),this.placeholder=this.$input.attr("placeholder"),this.$input.keydown(this.onKeydown).keyup(this.onKeyup).on("focus",function(){n.isOpen||(n.$input.attr("placeholder",""),t.Mediator.publish("search:focus",{namespace:n.namespace}))}).on("paste",function(e){n.onPaste(e)})},isPlaceholderSupported:function(){var e=document.createElement("input");return"placeholder"in e},isAutofocusSupported:function(){var e=document.createElement("input");return"autofocus"in e},keyUp:function(e){return 38==e.which},keyDown:function(e){return 40==e.which},keyLeft:function(e){return 37==e.which},keyRight:function(e){return 39==e.which},keyEnter:function(e){return 13==e.which},keyEsc:function(e){return 27==e.which},move:function(e){var t=this.$resultsList.children(".active"),n=this.$resultsList.children(),i=t.index()+e;this.index=i,0>i&&(i=n.length-1),i>=n.length&&(i=0),n.eq(i).length&&(this.$resultsList.stop().scrollTo(n.eq(i),{axis:"y",duration:500}),n.removeClass("active").eq(i).addClass("active"))},onDrugSearch:function(e){e&&e.hasOwnProperty("namespace")&&this.namespace!=e.namespace&&this.hide()},onEnter:function(){if(this.isOpen)if(this.resultViews&&this.index>=0&&this.resultViews[this.index])this.resultViews[this.index].selectDrug();else{var e=this.$resultsList.children(".active").index(),n=null;e>=0&&(n=this.collection.at(e),n=n.attributes),!n&&this.current&&this.current.length>0&&(n=this.collection.getMatches(this.current)),n&&t.Mediator.publish("search:selected-"+this.namespace,{drug_id:n.drug_id,drug_name:n.drug_name})}else this.render(this.collection)},onKeydown:function(e){this.keyUp(e)&&(e.preventDefault(),this.move(-1)),this.keyDown(e)&&(e.preventDefault(),this.move(1)),this.keyEnter(e)&&(e.preventDefault(),this.onEnter()),this.keyEsc(e)&&(e.preventDefault(),this.hide())},onKeyup:function(e){this.keyEnter(e)||this.keyUp(e)||this.keyDown(e)||this.keyEsc(e)||this.doSearch(this.$input.val())},onPaste:function(){this.doSearch(this.$input.val())},render:function(e){e&&(e=e.toJSON(),0==e.length?this.hide():(this.show(),this.$resultsList[0].className=10>e.length?"auto":"fixed",this.destroyResultViews(),this.buildResultViews(e)))},setupResults:function(){return $('<div id="'+this.namespace+'-search-results" class="search-results"></div>').css({display:"none",opacity:1})},setupResultsList:function(){return $('<ul id="'+this.namespace+'-search-results-list" class="auto"></ul>')},show:function(){this.destroyResultViews(),this.$results.show(),this.isOpen=!0}})}),define("text",["module"],function(e){var t,n,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o="undefined"!=typeof location&&location.href,a=o&&location.protocol&&location.protocol.replace(/\:/,""),c=o&&location.hostname,u=o&&(location.port||void 0),l=[],d=e.config&&e.config()||{};return t={version:"2.0.5",strip:function(e){if(e){e=e.replace(r,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(r){}if(e){i=[n];break}}return e},parseName:function(e){var t,n,i,r=!1,s=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==s&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,i=n||t,s=i.indexOf("!"),-1!==s&&(r="strip"===i.substring(s+1),i=i.substring(0,s),n?n=i:t=i),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var s,o,a,c=t.xdRegExp.exec(e);return c?(s=c[2],o=c[3],o=o.split(":"),a=o[1],o=o[0],!(s&&s!==n||o&&o.toLowerCase()!==i.toLowerCase()||(a||o)&&a!==r)):!0},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,d.isBuild&&(l[e]=i),r(i)},load:function(e,n,i,r){if(r.isBuild&&!r.inlineText)return i(),void 0;d.isBuild=r.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=d.useXhr||t.useXhr;!o||p(h,a,c,u)?t.get(h,function(n){t.finishLoad(e,s.strip,n,i)},function(e){i.error&&i.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,i)})},write:function(e,n,i){if(l.hasOwnProperty(n)){var r=t.jsEscape(l[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,r,s){var o=t.parseName(n),a=o.ext?"."+o.ext:"",c=o.moduleName+a,u=i.toUrl(o.moduleName+a)+".js";t.load(c,i,function(){var n=function(e){return r(u,e)};n.asModule=function(e,t){return r.asModule(e,u,t)},t.write(e,c,n,s)},s)}},"node"===d.env||!d.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var i=n.readFileSync(e,"utf8");0===i.indexOf("")&&(i=i.substring(1)),t(i)}):"xhr"===d.env||!d.env&&t.createXhr()?t.get=function(e,n,i,r){var s,o=t.createXhr();if(o.open("GET",e,!0),r)for(s in r)r.hasOwnProperty(s)&&o.setRequestHeader(s.toLowerCase(),r[s]);d.onXhr&&d.onXhr(o,e),o.onreadystatechange=function(){var t,r;4===o.readyState&&(t=o.status,t>399&&600>t?(r=Error(e+" HTTP status: "+t),r.xhr=o,i(r)):n(o.responseText))},o.send(null)}:("rhino"===d.env||!d.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(t.get=function(e,t){var n,i,r="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),r)),c="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),n.append(i);null!==(i=a.readLine());)n.append(o),n.append(i);c=""+n+""}finally{a.close()}t(c)}),t}),define("jst",["underscore","text"],function(e,t){var n={},i={};return i.load=function(i,r,s){var o;t.get(r.toUrl(i),function(t){o=e.template(t),n[i]=o,s(o)})},i.write=function(e,t,i){var r=n[t];i("define('"+e+"!"+t+"', "+"['underscore'],"+"function (_) { return "+r.source+"; }"+");\n")},i}),define("jst!templates/ps/drug-reasons.jst",["underscore"],function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){if(__p+="",data.reasons&&data.reasons.length>0){__p+="\r\n    ";var reasonsLength=data.reasons.length;__p+='\r\n    <select id="'+(null==(__t=data.namespace)?"":__t)+'-reason-for">\r\n        ';for(var i=0;reasonsLength>i;i++){__p+="\r\n            ";var tReason=data.reasons[i];__p+='\r\n            <option data-newsletter-id="'+(null==(__t=tReason.NewsLetterID)?"":__t)+'" value="'+(null==(__t=tReason.SecondaryId)?"":__t)+'" ',data.drug&&data.drug.condition_id&&data.drug.condition_id.id&&tReason.SecondaryId==data.drug.condition_id.id&&print('selected="selected"'),__p+=">"+(null==(__t=tReason.Value)?"":__t)+"</option>\r\n        "}__p+="\r\n    </select>\r\n"}else __p+='\r\n    <select id="'+(null==(__t=data.namespace)?"":__t)+'-reason-for" class="disabled" disabled="true">\r\n        <option>-----</option>\r\n        <option>Loading...</option>\r\n    </select>\r\n';__p+=""}return __p}}),define("views/ps/search",["require","backbone","lib/util","collections/reasons","collections/search-qrl","views/base/search","jst!templates/ps/drug-reasons.jst"],function(e){var t=e("backbone"),n=e("lib/util"),i=e("collections/reasons"),r=e("collections/search-qrl"),s=e("views/base/search"),o=e("jst!templates/ps/drug-reasons.jst");return s.extend({subscriptions:{"search:focus":"onDrugSearch","search:selected-ps":"onSearchSelected","addMedicine:open":"createBindings"},events:{"change .reason select":"onReasonChange","change .state select":"onStateChange","click button":"onClickButton"},sessionStorageWidget:"pillsafewidget",bindEl:function(){var e=this;this.$el.on("click."+this.namespace,function(){e.hide()})},createBindings:function(){var e=this;$("#webmdHoverClose").on("click",function(t){e.onClickClose(t)})},convertModel:function(e){var n=t.Mediator.collections.dependants?t.Mediator.collections.dependants.current.personIdField:"0";return{condition_id:e.condition_id,drug_id:e.drug_id,drug_mnid:e.mnid,drug_name:e.drug_name,med_state:this.medState||e.med_state,med_type:e.med_type,targetobjid:n,targetobjtype:"person",generic_name:e.generic_name.toUpperCase()}},hide:function(){s.prototype.hide.call(this),this.unbindEl()},initialize:function(e){var t=this;_.bindAll(this),_.extend(this,e),s.prototype.initialize.call(this),this.medState=this.drugType,this.$medState=$("#"+this.namespace+"-med-state"),this.$medState.val(this.medState),this.$results=this.setupResults(),this.$resultsList=this.setupResultsList(),this.$results.append(this.$resultsList),this.$target=$("#ps-add-medicine .search"),this.$target.append(this.$results),this.reasons=new i,this.reasonSelector="#"+this.namespace+"-reason-for",this.$newsletterSubscribe=$("#ps-add-medicine #addmed-newsletter"),this.$input.on("focusout",function(){t.model&&t.model.drug_name?t.$input.val(t.model.drug_name):t.placeholder&&t.$input.attr("placeholder",t.placeholder)}).on("focusin",function(){t.$el.find(".error").hide()}),this.collection=new r({namespace:this.namespace,size:125,source:this.source}),this.collection.fetch=_.debounce(this.collection.fetch,this.delay),this.listenTo(this.collection,"reset",this.render)},onClickButton:function(e){e.preventDefault(),this.validateForm()},onClickClose:function(e){e.preventDefault(),wmdPageLink("mdcbaddovly-cls"),webmd.overlay.close()},onReasonChange:function(){var e=$(this.reasonSelector);this.reasonFor={id:e.val(),text:e.find(":selected").text(),newsletterId:e.find(":selected").attr("data-newsletter-id")}},onSearchSelected:function(e){this.reasonsView=o({data:{namespace:this.namespace}}),$("#ps-add-medicine button").attr("disabled","disabled"),$(this.reasonSelector).replaceWith(this.reasonsView),$("#ps-reason-for option").eq(1).prop("selected",!0);var t=this;if(this.searchTerm=this.$input.val(),e){this.model=e,this.$input.val(this.model.drug_name),this.hide();var n=this.reasons.fetch(this.model);n.done(function(){t.updateReasons(),$("#ps-add-medicine button").removeAttr("disabled")})}},onStateChange:function(){this.medState=this.$medState.val()},setupResults:function(){return $('<div id="'+this.namespace+'-search-results" class="search-results"></div>').css({display:"none",opacity:1,top:this.$target.innerHeight()})},show:function(){s.prototype.show.call(this),this.bindEl()},unbindEl:function(){this.$el.off("click."+this.namespace)},updateReasons:function(){this.reasonsView=o({data:{namespace:this.namespace,reasons:this.reasons.toJSON()}}),$(this.reasonSelector).replaceWith(this.reasonsView),$(this.reasonSelector).val($(this.reasonSelector).find("option:first").val()),this.onReasonChange()},validateForm:function(){var e=this,i=$("#ps-add-medicine").hasClass("widget");if(this.reasonFor&&this.model){if(this.model.condition_id=this.reasonFor,this.model.med_state=this.medState||this.model.med_state,this.sendMetrics(),t.Mediator.collections.drugs.add(this.convertModel(this.model)),webmd.debug("views/ps/search | validateForm",this.collection,t.Mediator.collections.drugs),this.$newsletterSubscribe.is(":checked")&&(wmdPageLink("mdcb-email-yes"),n.sendSubscriptions(this.model.condition_id.newsletterId)),this.model=null,this.reasons.remove(),this.remove(),webmd.overlay.close(),i){if(n.hasSessionStorage()){var r={isFromWidget:!0,isLoggedIn:n.isLoggedIn()};window.sessionStorage.setItem(e.sessionStorageWidget,JSON.stringify(r))}window.location=n.getMCUrl()}}else if(""!=this.$input.val()&&this.model){this.$input.val(this.model.drug_name);var s=this.reasons.fetch(this.model);s.done(function(){e.updateReasonsUI()})}else this.hasError=!0,this.model?this.reasonFor||this.$el.find(".error").show().text("Please select a reason for taking this medication."):this.$el.find(".error").show().text("You must select a medicine.")},sendMetrics:function(){var e=$("#ps-reason-for")[0].selectedIndex+1,t="mdcbaddovly-cond_{cond}",n="",i="mdcbaddovly-stat_{shelf}",r=(this.searchTerm.replace(" ",""),webmd.substitute("mc_{term}",{term:this.searchTerm}));switch(this.medState){case"researching":n="resch";break;case"previous":n="prev";break;default:n="current"}wmdPageLink("mdcbaddovly-add"),wmdPageLink(webmd.substitute(t,{cond:e})),wmdPageLink(webmd.substitute(i,{shelf:n})),s_md.prop10=r,s_md.prop11="fdb_mc",wmdTrack(r),wmdPageview(document.location.href.slice(0,document.location.href.lastIndexOf("/"))+"/drugadded"),s_md.prop10="",s_md.prop11=""}})}),define("jst!templates/ps/add-medicine.jst",["underscore"],function(_){return function(obj){var __t,__p="";with(Array.prototype.join,obj||{})__p+='<div id="ps-add-medicine" class="drugs-overlay '+(null==(__t=data.classNames)?"":__t)+'">\r\n    ',__p+=data.isWidget?'\r\n        <div class="header">\r\n            <h3>Add to <span class="logo"><span class="jawsonly">WebMD MyMedicine</span></span></h3>\r\n            <p>Save your medicine, check interactions, sign up for FDA alerts, create family profiles and more.</p>\r\n        </div>\r\n    ':"\r\n        <h3>Add Medication or Supplement</h3>\r\n        <p>Add a medication or supplement to keep track of your medicines and check interactions.</p>\r\n    ",__p+='\r\n\r\n    <form>\r\n        <fieldset class="search">\r\n            ',__p+=data.isWidget?'\r\n            <label for="ps-add-medicine-search">My Medicine:</label>\r\n            ':'\r\n            <label for="ps-add-medicine-search">Find Your Medicine:</label>\r\n            ',__p+='\r\n            <input autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" id="ps-add-medicine-search" placeholder="Enter at least 3 letters" />\r\n        </fieldset>\r\n        <fieldset class="reason">\r\n            <label for="ps-reason-for">Condition Treating:</label>\r\n            <select id="ps-reason-for" class="disabled" disabled="true">\r\n                <option>-----</option>\r\n                <option>Loading...</option>\r\n            </select>\r\n        </fieldset>\r\n        <fieldset class="state">\r\n            <label for="ps-med-state">I (am):</label>\r\n            <select id="ps-med-state">\r\n                <option value="current">Currently Taking</option>\r\n                <option value="researching">Researching</option>\r\n                <option value="previous">Previously Taken</option>\r\n            </select>\r\n        </fieldset>\r\n        <div class="actionBar">\r\n            <p class="error"></p>\r\n            ',data.isLoggedIn&&(__p+='\r\n            <fieldset class="newsletter-signup">\r\n                <div class="column">\r\n                    <label for="addmed-newsletter" class="checkbox">\r\n                        <input name="addmed-newsletter" id="addmed-newsletter" type="checkbox">Sign me up for my medicine alerts, related newsletters and occasional safety updates.\r\n                    </label>\r\n                </div>\r\n            </fieldset>\r\n            '),__p+='\r\n            <fieldset class="actions">\r\n                <div class="column">\r\n                    <button class="webmd-btn webmd-btn-pr webmd-btn-l" type="submit">Add to My Medicine</button>\r\n                </div>\r\n            </fieldset>\r\n        </div>\r\n    </form>\r\n\r\n</div>';return __p}}),define("views/ps/add-medicine",["require","backbone","mediator","lib/util","views/ps/search","jst!templates/ps/add-medicine.jst"],function(e){var t=e("backbone"),n=(e("mediator"),e("lib/util")),i=e("views/ps/search"),r=e("jst!templates/ps/add-medicine.jst");return t.View.extend({initialize:function(e){_.bindAll(this);var s=this,o="",a=s.isWidget();this.drugType=this.options.drugType,a&&(o="widget"),webmd.debug("views/ps/add-medicine | init | options",this.options,e,s.options);var c=r({data:{classNames:o,isLoggedIn:n.isLoggedIn(),isWidget:a}});webmd.overlay.close();var u=a?!1:!0;setTimeout(function(){webmd.overlay.open({html:c,width:495,speed:200,reposition:u,onComplete:function(){if($("#webmdHoverLoadedContent").css({overflow:"visible"}),s.searchOverlay=new i({$target:$("#ps-add-medicine .search"),el:$("#colorbox"),drugType:s.drugType,namespace:"ps",source:3}),a&&drug_name&&""!==drug_name&&drug_id&&""!==drug_id){s.queue=new $.Deferred,s.queue.resolve();var e={format:"json",metadata:"rxotc,generic_name,mnid",q:drug_name,s:3,sz:1},n={data:e,error:function(e){webmd.debug("addMedicine widget error",e)},success:function(e,n,i){if(webmd.debug("addMedicine widget complete",e),e){var r=s.searchOverlay.collection.parse(e,i);s.searchOverlay.$target.children("input").val(drug_name).attr("disabled",!0).addClass("disabled"),t.Mediator.publish("search:selected-"+s.searchOverlay.namespace,r[0]),s.searchOverlay.$target.children("input").attr("disabled",!0).addClass("disabled")}}};s.queue=s.queue.pipe(function(){s.searchOverlay.collection.fetch(drug_name,n)})}t.Mediator.publish("addMedicine:open")},onClosed:function(){t.Mediator.publish("addMedicine:close",s.drugType),webmd.overlay.remove(),n.destroyView([s.searchOverlay])}})},50)},isWidget:function(){var e=window.location.pathname.slice(0,window.location.pathname.lastIndexOf("/"));return"/my-medicine"===e?!1:!0}})}),define("jst!templates/amd/monograph-overlay.jst",["underscore"],function(_){return function(obj){var __t,__p="";with(Array.prototype.join,obj||{}){__p+="";var tempHrefString="/my-medicine/default.htm#add/{drug_id}/{drug_name}/current/0",drugName=encodeURIComponent(drug_name),drugId=drug_id,hrefString=webmd.substitute(tempHrefString,{drug_id:drugId,drug_name:drugName});__p+='\r\n\r\n<div id="ps-monograph-overlay" class="drugs-overlay widget">\r\n	<h3><span class="logo"><span class="jawsonly">WebMD MyMedicine</span></span></h3>\r\n	<div class="content">\r\n		'+(null==(__t=data.message)?"":__t)+'\r\n		<div class="actionBar">\r\n			<a href="'+(null==(__t=hrefString)?"":__t)+'" class="webmd-btn webmd-btn-pr webmd-btn-l addPillSafe" onclick="return sl(this, \'\', \''+(null==(__t=data.scope)?"":__t)+'-mdcbovlypromo-add\');">Add to My Medicine</a>\r\n			<a id="CancelBtnMO" class="btn-cancel">Cancel</a>\r\n		</div>\r\n	</div>\r\n</div>'}return __p}}),define("views/amd/monograph-overlay",["require","backbone","mediator","lib/util","views/ps/search","jst!templates/amd/monograph-overlay.jst"],function(e){var t=e("backbone"),n=(e("mediator"),e("lib/util")),i=(e("views/ps/search"),e("jst!templates/amd/monograph-overlay.jst")),r=t.View.extend({hasSessionStorage:!1,sessionStorageName:"pillsafepromo",sBusRefVit:"vitamin monograph",omnitureScope:"dr",templateMessage:{dr:"<p>Did you know that some prescription medicines should not be taken with some over-the-counter medicines and supplements?</p><p>Save this medicine to find out about drug interactions and be informed of FDA warnings.</p>",vit:"<p>Did you know that some vitamins and supplements should not be taken with some prescription and over-the-counter medicines?</p><p>Save this medicine to learn more about drug interactions and be informed of FDA warnings.</p>"},initialize:function(){var e=this;e.hasSessionStorage=n.hasSessionStorage(),e.setOverlayConfig()},setOverlayConfig:function(){var e=this;s_business_reference===e.sBusRefVit&&(e.omnitureScope="vit")},open:function(e){var t=this,n=i({data:{scope:t.omnitureScope,message:t.templateMessage[t.omnitureScope]}});webmd.overlay.open({html:n,overlayClose:!1,width:e.width||450,onComplete:function(){document.location.href.slice(0,document.location.href.lastIndexOf("/"))+"/",wmdPageLink(t.omnitureScope+"-mdcbovlypromo"),$("#webmdHoverClose").on("click",function(e){e.preventDefault(),wmdPageLink(t.omnitureScope+"-mdcbovlypromo-cls"),webmd.overlay.close()}),$("#CancelBtnMO").on("click",function(e){e.preventDefault(),wmdPageLink(t.omnitureScope+"-mdcbovlypromo-cnl"),webmd.overlay.close()}),t.setSession()}})},delayedDisplay:function(){var e=this;timeoutID=window.setTimeout(function(){e.open({width:450})},8e3)},clearOverlayTimer:function(){window.clearTimeout(timeoutID)},setSession:function(){var e=this;webmd.debug("views/monograph-overlay : setSession"),e.hasSessionStorage&&window.sessionStorage.setItem(e.sessionStorageName,"true")},checkDisplay:function(){var e=this;webmd.debug("views/monograph-overlay : checkSession"),e.hasSessionStorage&&!window.sessionStorage.getItem(e.sessionStorageName)&&e.delayedDisplay()}});return r}),require(["collections/session-psdrugs","models/appuser","views/ps/add-medicine","views/amd/monograph-overlay"],function(e,t,n,i){var r={initialize:function(){var n=new i,r=0;Backbone.Mediator.collections=Backbone.Mediator.collections||{},Backbone.Mediator.models=Backbone.Mediator.models||{},Backbone.Mediator.collections.drugs=new e({isWidget:!0}),webmd.cookie.exists("WBMD_SESN")&&(Backbone.Mediator.models.appuser=new t,Backbone.Mediator.models.appuser.deferred=Backbone.Mediator.models.appuser.fetch({isWidget:!0}),Backbone.Mediator.models.appuser.deferred.done(function(){})),$(".tbAddMC,.addPillSafe").css("display","block"),$(".tab").on("click",function(){r++,1===r&&n.checkDisplay()})}};$(function(){$(".tbAddMC.widget,.addPillSafe.widget").length&&(webmd.debug("initializing the overlay since the buttons exist"),r.initialize())})}),define("amd-add-medicine-overlay",function(){})})();