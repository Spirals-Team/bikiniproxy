(function(){var isHTTPS,App;var ieVersion=function(){var div=document.createElement("div"),all=div.getElementsByTagName("i"),version=3;do div.innerHTML="\x3c!--[if gt IE "+ ++version+"]\x3e\x3ci\x3e\x3c/i\x3e\x3c![endif]--\x3e";while(all[0]);return version>4?version:undefined}();if(ieVersion<9){window.postPlatform={init:function(){},createWidget:function(){},virtualReload:function(){},updateWidget:function(){},resetWidget:function(){},createCounter:function(){}};return}if(window.postPlatformApp)return;
isHTTPS=document.querySelectorAll('script[src*\x3d"post-widget.js"]')[0].src.split("/")[0]==="https:";function State($){this.state={};this.get=function(propertyPath){if(!propertyPath)return this.state;else return propertyPath.indexOf(".")>0?$._.prop(this.state,propertyPath):this.state[propertyPath]}.bind(this);this.set=function(ob){this.state=$._.extend(this.state,ob)}.bind(this)}function SandBox(core,moduleId){this.Core=core;this.moduleId=moduleId;this._=this.Core._library;this.ext=this.Core._extensions;
this.config=this.Core._config;this.subscribe=this.Core.subscribe.bind(this.Core);this.unsubscribe=this.Core.unsubscribe.bind(this.Core);this.publish=this.Core.publish.bind(this.Core);this.useModule=this.Core.useModule.bind(this.Core);this.state=new State({_:this.Core._library})}function Core(config){this._config=config;this._state={pendingTopics:{},loadingModules:[],useModuleStack:{}};this._modules={};this._library={};this._topics={};this._extensions={}}Core.prototype={constructor:Core,init:function(cb){cb({_:this._library,
publish:this.publish.bind(this),subscribe:this.subscribe.bind(this),ext:this._extensions,loadPlugin:this.loadPlugin.bind(this),loadModules:this.loadModules.bind(this),config:this._config})},publish:function(topic,options){var moduleID=topic.split(".")[0];if(this.isModuleInitiated(moduleID)||this._topics[topic])(this._topics[topic]||[]).forEach(function(caller){caller.apply(null,[options])},this);else{this._state.pendingTopics[moduleID]=this._state.pendingTopics[moduleID]||[];this._state.pendingTopics[moduleID].push({name:topic,
options:options})}},subscribe:function(topic,cb){if(this._library.isObject(topic))this._library.each(topic,function(tKey){this._topics[tKey]=this._topics[tKey]||[];this._topics[tKey].push(topic[tKey])},this);else{this._topics[topic]=this._topics[topic]||[];this._topics[topic].push(cb)}},unsubscribe:function(topic,cb){this._topics[topic]=this._library.filter(this._topics[topic],function(registeredCallback){return registeredCallback!==cb})},library:function(creator){var mergeWith=creator(this._library),
attrname;for(attrname in mergeWith)this._library[attrname]=mergeWith[attrname]},register:function(moduleId,creator){this._modules[moduleId]={instance:null,creator:creator}},extend:function(cb){cb({publish:this.publish.bind(this),_:this._library,config:this._config},this._extensions)},hasModule:function(name){return!!this._modules[name]},loadPlugin:function(name,cb){if(this.isModuleInitiated(name))return;if(this._state.loadingModules.indexOf(name)>-1)return;this._state.loadingModules.push(name);this._library.loadJSFile({src:this._config.env.cdnSecureURL+
this._config.plugins.path+name+".js"},function(){this.startModule(name);this._state.loadingModules.splice(this._state.loadingModules.indexOf(name),1);if(cb)cb()}.bind(this))},useModule:function(name,cb){if(this.isModuleInitiated(name)){if(cb)cb()}else{this._state.useModuleStack[name]=this._state.useModuleStack[name]||[];this._state.useModuleStack[name].push(cb);this.loadPlugin(name,function(){this._library.each(this._state.useModuleStack[name],function(_cb){if(_cb)_cb()})}.bind(this))}},loadModules:function(rules){var _=
this._library,cfg=this._config,ext=this._extensions,pluginsCfg=rules||cfg.plugins.rules,_this=this;function loadPlugin(name,options){_this.loadPlugin(name,function(){var publishOptions={};if(options.initOptions)_.each(options.initOptions,function(optionName){publishOptions[optionName]=ext.pwConfig.val(options.initOptions[optionName])});_this.publish(name+".init",publishOptions);if(options.childPlugins)_this.loadModules(options.childPlugins)})}_.each(pluginsCfg,function(pluginName){var options=pluginsCfg[pluginName];
if(!this.hasModule(pluginName))if(options.alwaysLoad&&!options.deps)loadPlugin(pluginName,options);else if(options.loadWhenDefined&&!_.isFalsy(ext.pwConfig.val(options.loadWhenDefined)))loadPlugin(pluginName,options)}.bind(this))},startModule:function(moduleId,withOptions){this._modules[moduleId].instance=this._modules[moduleId].creator.apply(null,[new SandBox(this,moduleId)]);this._modules[moduleId].instance.init(withOptions||{});if(this._state.pendingTopics[moduleId]){this._library.each(this._state.pendingTopics[moduleId],
function(topic){this.publish(topic.name,topic.options)},this);this._state.pendingTopics[moduleId]=[]}},isModuleInitiated:function(moduleID){return this._modules.hasOwnProperty(moduleID)&&this._modules[moduleID].instance},startModules:function(){var moduleId;for(moduleId in this._modules)if(this._modules.hasOwnProperty(moduleId))this.startModule(moduleId)},api:function(cb){window[this._config.windowProperty]=cb({_:this._library,publish:this.publish.bind(this),ext:this._extensions})}};App=window.postPlatformApp=
new Core({windowProperty:"postPlatform",env:{scriptProtocol:isHTTPS?"https:":"http:",buildNumber:"4_37_4_pch_1160",widgetBuildNumber:"4.37.4-pch-1160",shareServer:isHTTPS?"https://po.st":"http://po.st",cdnURL:"http://i.po.st"+"/static/v4",cdnSecureURL:(isHTTPS?"https://s.po.st":"http://i.po.st")+"/static/v4",loggerSecureURL:isHTTPS?"https://p.po.st":"http://p.po.st"},plugins:{path:"/js/plugins/",rules:{shareImages:{loadWhenDefined:"shareImages",initOptions:{options:"shareImages"}},copypaste:{loadWhenDefined:"copypaste",
initOptions:{options:"copypasteOptions"},childPlugins:{shareQuote:{loadWhenDefined:"shareQuote",initOptions:{options:"shareQuoteOptions"}}}},sticky:{loadWhenDefined:"sticky",initOptions:{options:"sticky"}},responsive:{loadWhenDefined:"responsive",initOptions:{options:"responsive"}},googleAnalytics:{loadWhenDefined:"googleAnalytics",initOptions:{options:"googleAnalyticsOptions"}}}}});App.library(function(){var notDefinedValue;function s4(){return((1+Math.random())*65536|0).toString(16).substring(1)}
return{each:function(list,cb,context){if(this.isObject(list))list=Object.keys(list);return[].map.call(list,cb,context)},filter:function(list,cb,context){if(this.isObject(list))list=Object.keys(list);return[].filter.call(list,cb,context)},getGUID:function(separator){var guid="",i;separator=separator?"-":"";for(i=0;i<8;i++)if(i<7)guid+=s4()+separator;else guid+=s4();return guid},sGUID:function(){var s="abcdefghijklmopqrstuvwxyzABCDEFGHIJKLMOPQRSTUVWXYZ0123456789",sGUID="",i=1;for(i;i<=16;i++)sGUID+=
s.charAt(Math.round(Math.random()*(s.length-1)));return sGUID},extend:function(destination,source){var property;for(property in source)if(source[property]&&source[property].constructor&&source[property].constructor===Object){destination[property]=destination[property]||{};this.extend(destination[property],source[property])}else destination[property]=source[property];return destination},cloneObject:function(obj){return JSON.parse(JSON.stringify(obj))},isEmptyObject:function(obj){return Object.keys(obj).length===
0},isRegexp:function(r){return r instanceof RegExp},isCollection:function(collection){var collectionResult=Object.prototype.toString.call(collection),_return=false;if(collectionResult==="[object HTMLCollection]"||collectionResult==="[object NodeList]")_return=true;return _return},isArray:function(input){return Object.prototype.toString.call(input)==="[object Array]"},isObject:function(input){return Object.prototype.toString.call(input).toLowerCase()==="[object object]"},isString:function(str){return typeof str===
"string"},isFunction:function(fn){return typeof fn==="function"},match:function(str,regex){return str.match(regex)},replace:function(str,search,value){return str.replace(new RegExp("{"+search+"}","g"),value)},t:function(str,o){var _string=str;this.each(o,function(key){_string=this.replace(_string,key,o[key])},this);return _string},isRGBColor:function(input){return this.match(input,/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/)},isHEXColor:function(input){return this.match(input,/^#([0-9a-fA-F]{3}){1,2}$/)},
isColor:function(input){return this.isRGBColor(input)||this.isHEXColor(input)},print:function(){window.print()},notify:function(text){alert(text)},addToFavorites:function(title,url,fnFavNotSupported){if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(url,title,"");else if(window.external&&window.external.AddFavorite)window.external.AddFavorite(url,title);else if(fnFavNotSupported)fnFavNotSupported()},isUndefined:function(input){return input===notDefinedValue},prop:function(obj,path){var parts,
parent=obj;if(path){parts=path.split(".");this.each(parts,function(item){parent=!this.isUndefined(parent)?parent[item]:notDefinedValue},this)}return parent},bindAll:function(context,fnList){this.each(fnList,function(fn){if(context[fn])context[fn]=context[fn].bind(context)})},objectAsQueryParams:function(ob){var queryParams=[];this.each(ob,function(key){var value=ob[key];if(this.isArray(value))this.each(value,function(arrayValue){if(!this.isUndefined(arrayValue))queryParams.push(encodeURIComponent(key)+
"\x3d"+encodeURIComponent(arrayValue))},this);else if(!this.isUndefined(value))queryParams.push(encodeURIComponent(key)+"\x3d"+encodeURIComponent(value))},this);return"?"+queryParams.join("\x26")},stringToArray:function(str,divider){return this.isString(str)?str.trim().split(divider||","):str},removeTrackingParameter:function(input){return input.replace(/[\?&#]{1}([a-z\d]{16})\.([\d]{2})(?:|$)/i,"")},isMatch:function(rule,value){return(new RegExp(rule)).test(value)},getTimeStamp:function(){return Date.now()},
isFalse:function(input){return input==="false"||input===false},isFalsy:function(input){return this.isFalse(input)||input===notDefinedValue},isDigit:function(input){return/^\d+$/.test(input)},doFunction:function(fn,options){if(fn&&this.isFunction(fn))fn(options)},jsonStringify:function(input){return JSON.stringify(input)},isTrue:function(input){return input==="true"||input===true},openWindow:function(url,options){return window.open(url,"",options)},isMobile:function(){return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())},
iosDevice:function(devices){var isIOS=navigator.userAgent.toLowerCase().match(/(iphone|ipad|ipod)/);return isIOS?devices.indexOf(isIOS[0])>-1:false},getBrowser:function(property){var ua=navigator.userAgent,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],tem;if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return property==="name"?"msie":tem[1]||""}if(M[1]==="Chrome"){tem=ua.match(/\b(OPR|Edge)\/(\d+)/);if(tem!==null)return tem.slice(1).join(" ").replace("OPR",
"Opera")}M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"];if((tem=ua.match(/version\/(\d+)/i))!==null)M.splice(1,1,tem[1]);return property==="name"?M[0].toLowerCase():M[1]},getSystemLanguage:function(){return(navigator.userLanguage||navigator.language||navigator.systemLanguage).toLowerCase()},redirectTo:function(url){window.location.replace(url)},ask:function(title,defaultText){return window.prompt(title||"",defaultText||"")},toInt:function(input){return parseInt(input,10)},toRGB:function(input){var shorthandRegex=
/^#?([a-f\d])([a-f\d])([a-f\d])$/i,result;if(this.isRGBColor(input)){result=this.isRGBColor(input);return{r:result[1],g:result[2],b:result[3]}}input=input.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(input);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},warn:function(msg){console.warn(msg)},difference:function(source,target){var _return=(target||[]).slice();this.each(source,function(item){var targetIndex=
_return.indexOf(item);if(targetIndex>-1)_return.splice(targetIndex,1)});return _return},ignoreUrl:function(options){var rules=options.rules||{};return rules.hideOnUrls&&this.filter(rules.hideOnUrls,function(excludedUrl){var location=window.location,matchedUrl=location.protocol+"//"+location.host+location.pathname;if(!rules.clearUrlParameters)matchedUrl=location.href;if(excludedUrl instanceof RegExp)return this.isMatch(excludedUrl,matchedUrl);return(new RegExp("^"+excludedUrl+"$","i")).test(matchedUrl)}.bind(this)).length}}});
App.library(function(_){var DOC=window.document,notDefinedValue;function removeEvent(element,eventName,fn){if(element.removeEventListener)element.removeEventListener(eventName,fn,false);else if(element.detachEvent)element.detachEvent("on"+eventName,fn);else element["on"+eventName]=null}function addEvent(element,eventName,fn,removeAfterFired){var addEventCallback;addEventCallback=function(e){fn(e,element);e.stopPropagation();if(removeAfterFired)removeEvent(element,eventName,addEventCallback)};if(element.addEventListener)element.addEventListener(eventName,
addEventCallback,false);else if(element.attachEvent)element.attachEvent("on"+eventName,addEventCallback);else element["on"+eventName]=addEventCallback;return addEventCallback}return{on:function(element,eventName,fn,removeAfterFired){var handlerFunction;if(Object.prototype.toString.call(element)==="[object Array]")_.each(element,function(node){handlerFunction=addEvent(node,eventName,fn,removeAfterFired)});else handlerFunction=addEvent(element,eventName,fn,removeAfterFired);return handlerFunction},
off:function(element,eventName,fn){removeEvent(element,eventName,fn)},get:function(query,parentNode){var nodes=query||[];if(typeof nodes==="string")nodes=Array.prototype.slice.call((parentNode||DOC).querySelectorAll(query));else if(!(_.isCollection(query)||_.isArray(query)))nodes=[query];return nodes},getDataAttributes:function(node,list){var _return={};this.each(list||[],function(attributeName){var value=this.dataAttr(node,attributeName);if(value)_return[attributeName]=value},this);return _return},
dataAttr:function(node,attr,value){var result;attr="data-"+attr.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();if(value)node.setAttribute(attr,value);else{result=node.getAttribute&&node.getAttribute(attr)||null;return typeof result==="boolean"?result.toString():result}},attr:function(node,name){return node?node.getAttribute(name):node},createNode:function(name,attributes){var node;attributes=attributes||{};if(name.indexOf(".")>-1){attributes["class"]=name.split(".")[1];name=name.split(".")[0]}if(name.indexOf("#")>
-1){attributes.id=name.split("#")[1];name=name.split("#")[0]}node=DOC.createElement(name);_.each(Object.keys(attributes)||[],function(attributeName){var value=attributes[attributeName];if(attributeName==="innerHTML")node.innerHTML=value;else if(attributeName==="style")this.setStyle(node,value);else node.setAttribute(attributeName,value)},this);return node},loadScript:function(src,fn){var script,done,head;script=this.createNode("script",{src:src,async:true});script.onload=script.onreadystatechange=
function(){if(!done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){done=true;script.onload=script.onreadystatechange=null;if(fn)fn();if(script&&script.parentNode)script.parentNode.removeChild(script)}};if(!head)head=this.get("head")[0];this.appendTo(head,script)},loadCSS:function(path){this.appendTo("head",this.createNode("link",{rel:"stylesheet",type:"text/css",href:path,media:"all"}))},appendTo:function(parent,child){return this.get(parent)[0].appendChild(child)},
getWindowProperty:function(path){return path?_.prop(window,path):window},getDocumentProperty:function(path){return _.prop(document,path)},setClass:function(node,className){this.get(node)[0].className=className},removeClassName:function(node,className){if(node)this.get(node)[0].className=_.filter(this.getClassList(node),function(cs){return cs!==className}).join(" ")},getClassList:function(node){return(this.get(node)[0].className||"").split(" ")},html:function(node,html){this.get(node)[0].innerHTML=
html},createStyleSheet:function(id,rules){var head=DOC.head||DOC.getElementsByTagName("head")[0],style=this.createNode("style#"+id);style.type="text/css";if(style.styleSheet)style.styleSheet.cssText=rules;else style.appendChild(document.createTextNode(rules));head.appendChild(style)},getScriptParameter:function(name){var scriptName="post-widget.js",_return;_.each(_.get("script"),function(tag){var src=tag.src,paramsList;if(src&&src.indexOf(scriptName)>-1){paramsList=src.split("#")[1];_return=paramsList?
(paramsList.split(name+"\x3d")[1]||"").split("\x26")[0]:notDefinedValue}});return _return},domReady:function(cb){var called=false;function ready(){if(called)return;called=true;cb()}if(document.readyState==="complete")ready();if(document.addEventListener)document.addEventListener("DOMContentLoaded",ready,false);if(window.addEventListener)window.addEventListener("load",ready,false)},parseURL:function(url){return!url?url:this.createNode("a",{href:url})},getTagBaseValue:function(){var tag,value,href;
tag=this.get("base")[0];if(tag){href=tag.getAttribute("href");if(href.length)if(this.getTypeUrl(href)==="absolute")value=href.charAt(href.length-1)==="/"?href.slice(0,-1):href}return value},getTypeUrl:function(url){var match=url.match(/^(?:(https?:\/\/|\/\/|\s)|(..|\/|\?|#)|[^;:@=\.\s])/i),type=null;if(match)type=match[1]?"absolute":"relative";return type},extractParamFromUri:function(uri,paramName){var regex,params;if(!uri)return;regex=new RegExp("[\\?\x26#]"+paramName+"\x3d([^\x26#]*)");params=
regex.exec(uri);if(params!==null)return unescape(params[1])},getCanonicalUrl:function(){var canonicalURL=this.attr(this.get('link[rel\x3d"canonical"]')[0],"href"),documentLocation=_.prop(document,"location"),rootUrl=documentLocation.origin,baseURL,firstSymbol;if(canonicalURL)if(!/^https?:\/\//i.test(canonicalURL)){firstSymbol=canonicalURL.charAt(0);baseURL=this.getTagBaseValue();if(["/","."].indexOf(firstSymbol)>-1){canonicalURL=canonicalURL.substr(1);if(baseURL){baseURL=this.parseURL(baseURL);canonicalURL=
baseURL.protocol+"//"+baseURL.host+"/"+canonicalURL}else canonicalURL=documentLocation.protocol+"//"+documentLocation.host+"/"+canonicalURL}else if(baseURL){baseURL=this.parseURL(baseURL);canonicalURL=baseURL.href+canonicalURL}else if(!documentLocation.pathname)canonicalURL=rootUrl+"/"+canonicalURL;else if(documentLocation.pathname.charAt(documentLocation.pathname.length-1)==="/")canonicalURL=rootUrl+documentLocation.pathname.slice(0,-1)+"/"+canonicalURL;else canonicalURL=rootUrl+documentLocation.pathname.split("/").slice(0,
-1).join("/")+"/"+canonicalURL}return canonicalURL},setStyle:function(node,props){node=this.get(node)[0];_.each(props,function(propertyName){node.style[propertyName]=props[propertyName]})},addClass:function(element,className){this.get(element)[0].className+=" "+className},hasClass:function(element,className){return element.className.indexOf(className)>-1},hasSVG:function(){return DOC.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")},destroyNode:function(node){node.parentNode.removeChild(node)},
getClientOffset:function(){var size={};if(document.compatMode==="CSS1Compat"){size.w=document.documentElement.clientWidth;size.h=document.documentElement.clientHeight}else{size.w=document.body.clientWidth;size.h=document.body.clientHeight}return size},getScreenWidth:function(){var screenWidth=screen.width,screenHeight=screen.height,innerWidth=window.innerWidth,innerHeight=window.innerHeight,isLandscape=innerWidth>innerHeight,_return;if(this.isMobile())_return=isLandscape&&screenWidth<screenHeight?
screenHeight:screenWidth;else _return=innerWidth;return _return},getScrollPosition:function(){return{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}},loadJSFile:function(attributes,cb){var script=this.createNode("script");script.type="text/javascript";if(script.readyState)script.onreadystatechange=function(){if(script.readyState==="loaded"||script.readyState==="complete"){script.onreadystatechange=null;_.doFunction(cb)}};else script.onload=
cb;_.each(attributes,function(name){script[name]=attributes[name]});this.appendTo("head",script)},getOffsetRect:function(element){var box=element.getBoundingClientRect(),body=document.body,docElem=document.documentElement,scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop,scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-
clientLeft;return{left:Math.round(left),top:Math.round(top)}},getElementSize:function(element){return{height:element.offsetHeight,width:element.offsetWidth}},parent:function(node,selector){var _return;while(node.parentNode&&node.localName!=="body")if(this.determineIfElementMatches(node,selector)){_return=node;break}else node=node.parentNode;return _return},isParentNodeMatch:function(node,className){return node.parentNode.className.indexOf(className)>-1},determineIfElementMatches:function(node,selector){var p=
Element.prototype,f;f=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.msMatchesSelector||function(s){return[].indexOf.call(document.querySelectorAll(s),this)!==-1};return f.call(node,selector)},insertBefore:function(before,newNode){before.parentNode.insertBefore(newNode,before)},show:function(node){this.setStyle(node,{display:"block"})},hide:function(node){this.setStyle(node,{display:"none"})},getFirstChild:function(node){return node.childNodes[0]},replaceNode:function(node,newNode){if(node&&
node.parentNode)node.parentNode.replaceChild(newNode,node);return newNode},cssReady:function(callback){var query=".pw-test-uploadcss",query2=".pw-test-uploadcss-themedefault",cssElement=_.get(query)[0],cssElement2=_.get(query2)[0];function isReady(){function checkOffset(){if((cssElement.offsetHeight===12||cssElement.offsetWidth===14)&&(cssElement2.offsetHeight===12||cssElement2.offsetWidth===14)){if(_.isFunction(callback))callback({})}else setTimeout(checkOffset,200)}if(_.get("pw-icon"))checkOffset();
else setTimeout(isReady,200)}if(!cssElement){cssElement=_.createNode("div",{"class":query.substr(1),style:{fontSize:"1px",lineHeight:"1px",width:"1px",height:"1px"}});_.appendTo("body",cssElement)}if(!cssElement2){cssElement2=_.createNode("div",{"class":query2.substr(1),style:{fontSize:"1px",lineHeight:"1px",width:"1px",height:"1px"}});_.appendTo("body",cssElement2)}isReady()},getMetaData:function(name){var node=document&&document.head,metas=this.get("meta",node),content=notDefinedValue;_.each(metas,
function(tag){if(tag.getAttribute("name")===name)content=tag.getAttribute("content")});return content}}});App.library(function(_){var CONFIG={cbPrefix:"pwNeuCallback"};return{getJSON:function(url,options){var callbackName=options.callbackName||CONFIG.cbPrefix+_.getGUID().substr(0,5),cb=options.done,chachePrefix=options.cachePrefix||(new Date).getTime(),params;if(options.data)params=_.objectAsQueryParams(options.data);window[callbackName]=function(data){if(cb)cb(data);window[callbackName]=null};_.loadScript(url+
(params?params+"\x26":"?")+"_\x3d"+chachePrefix+"\x26callback\x3d"+callbackName);return _}}});App.extend(function($,ext){var _=$._,CONFIG;CONFIG={requestURL:$.config.env.shareServer+"/v2/status"};ext.status={state:{status:{}},val:function(prop){return _.prop(this.state.status,prop)},insertAdditionalPixels:function(onload){var className="r1-additional-pixel",element,d;if(onload){d=document.write;element=_.createNode("div."+className,{innerHTML:onload,width:0,height:0});_.appendTo("body",element);document.write=
function(html){_.appendTo(element,_.createNode("div",{innerHTML:html}))};_.each(_.get("script",element),function(scriptNode){eval(scriptNode.innerHTML)});document.write=d}},insertPixel:function(params){_.appendTo("body",_.createNode(params.elementName,{style:{position:"absolute",top:"-99999px"},width:0,height:0,src:params.url+(params.random||"")}))},insertScript:function(url){_.loadScript(url)},matchingPixel:function(pixel){var type=pixel.type;if(type==="iframe"||type==="img")this.insertPixel({url:pixel.url,
elementName:type,random:type==="iframe"?"r"+Math.round(1E9*Math.random()):""});else if(type==="js")this.insertScript(pixel.url)},fetch:function(params,onComplete){_.getJSON(CONFIG.requestURL,{data:params,done:function(response){var status=response;status.optout=!!response.optout;if(response.shortener){status.shortener=(response.shortener||"").toLowerCase();status.shortenerKey=response.shortenerKey}this.state.status=status;_.each(status.pixels||[],this.matchingPixel,this);this.insertAdditionalPixels(response.onLoad);
_.doFunction(onComplete,this.state.status)}.bind(this)})}}});App.extend(function($,ext){var _=$._,CONFIG;ext.backend={state:{widgets:{}},searchForWidgets:function(){var widgets={};_.each(_.get(".pw-server-widget"),function(widgetNode){var id=_.dataAttr(widgetNode,"id");if(id)widgets[id]=(widgets[id]?widgets[id]:[]).concat([widgetNode])});this.state.widgets=widgets},searchForWidgetsByTargets:function(targets){var widgets={};_.each(targets,function(parentNode){_.each(_.get(".pw-server-widget",parentNode),
function(widgetNode){var id=_.dataAttr(widgetNode,"id");if(id)widgets[id]=(widgets[id]?widgets[id]:[]).concat([widgetNode])})});this.state.widgets=widgets},getWidgetNodes:function(id){return this.state.widgets[id]||[]},getWidgetIds:function(){return _.each(this.state.widgets,function(widgetId){return widgetId})}}});App.extend(function($,ext){var _=$._,CONFIG,extension;CONFIG=Object.freeze({mainCSSURL:$.config.env.cdnSecureURL+"/css/post-widget.css?"+$.config.env.buildNumber,defaultThemeURL:$.config.env.cdnSecureURL+
"/css/theme-default.css?"+$.config.env.buildNumber,fontsPath:$.config.env.cdnSecureURL+"/fonts/"});extension={store:{coreCSSLoaded:false,defaultThemeLoaded:false,fontsLoaded:[]},loadFont:function(fontSize){var fontURL=CONFIG.fontsPath+"post-icons-"+fontSize;_.createStyleSheet(_.sGUID(),"@font-face {"+'font-family: "post-icons-'+fontSize+'";'+'src: url("'+fontURL+'.woff") format("woff"),'+'url("'+fontURL+".svg#post-icons-"+fontSize+'") format("svg");'+"font-weight: normal;"+"font-style: normal;"+"}")}};
ext.assets={loadCoreCSS:function(){if(!extension.store.coreCSSLoaded){extension.store.coreCSSLoaded=true;_.loadCSS(CONFIG.mainCSSURL)}},loadTheme:function(){if(!extension.store.defaultThemeLoaded){_.loadCSS(CONFIG.defaultThemeURL);extension.store.defaultThemeLoaded=true}},loadFont:function(size){size=+size;if(extension.store.fontsLoaded.indexOf(size)<0){extension.store.fontsLoaded.push(size);extension.loadFont(size)}}}});App.extend(function($,ext){var _=$._,notDefinedValue,CONFIG,CONSTANTS;CONSTANTS=
{COLORS:[/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/,"^#[0-9a-fA-F]{3,6}$"],BOOL:"^(true|false)$"};CONFIG=Object.freeze({validationRules:{label:{defaultValue:"false",values:[/^.+$/]},layout:{defaultValue:"horizontal",values:["^(horizontal|vertical)$"]},radius:{defaultValue:"square",values:["^(square|rounded|circle)$","^(0?[0-9]{1,2}|1[0-7][0-9]|99999)$"]},size:{defaultValue:"32",values:["(20|32|48|64)"]},counter:{defaultValue:"false",values:["^(true|false|vertical|horizontal)$"]},
padding:{defaultValue:"false",values:["^(true|false)$","^[0-9]+$"]},view:{defaultValue:"auto",values:["^(auto|full)$"]},buttonColor:{defaultValue:"default",values:["default"].concat(CONSTANTS.COLORS)},buttonBackground:{defaultValue:"default",values:["default","none"].concat(CONSTANTS.COLORS)},hover:{defaultValue:"false",values:[CONSTANTS.BOOL]},jumbo:{defaultValue:"false",values:[CONSTANTS.BOOL]},jumboPosition:{defaultValue:"first",values:["^(first|last)$"]},shareNewWindow:{defaultValue:"true",values:[CONSTANTS.BOOL]},
vguid:{defaultValue:function(){return _.getGUID(true)},values:[/^\{?[a-fA-F0-9]|\-\}?$/]}}});function Properties(inputProperties,propsConfig){this.classNameMapping=propsConfig.classNameMapping||{};this.validationRules=propsConfig.validationRules;this.props=this.validateInputProps(inputProperties,this.validationRules)}Properties.prototype={constructor:Properties,validate:function(value,rules){var _return=_.isFunction(rules.defaultValue)?rules.defaultValue():rules.defaultValue;_.each(rules.values||
[],function(rule){if(_.isMatch(rule,value))_return=value});return _return},update:function(newProperties){this.props=this.validateInputProps(_.extend(this.all(),newProperties),this.validationRules)},validateInputProps:function(inputProperties,validationRules){var _return=_.extend({},inputProperties);_.each(validationRules,function(key){var rules=validationRules[key];if(_.isUndefined(_return[key]))_return[key]=_.isFunction(rules.defaultValue)?rules.defaultValue():rules.defaultValue;else _return[key]=
this.validate(_return[key],rules)},this);return _return},all:function(){return _.extend({},this.props)},val:function(propertyPath){return _.prop(this.props,propertyPath)},asClassList:function(){var _return=[];_.each(this.classNameMapping,function(key){var pattern=this.classNameMapping[key];if(!_.isUndefined(this.props[key]))if(_.isString(pattern))_return.push(_.replace(pattern,"value",this.props[key]));else _.each(pattern,function(nestedPattern){if(_.isMatch(nestedPattern.value,this.props[key]))_return.push(_.replace(nestedPattern.className,
"value",this.props[key]))},this)},this);return _return}};ext.createProperties=function(inputProperties,config){if(_.isObject(inputProperties))return new Properties(inputProperties,{classNameMapping:config.classNameMapping,validationRules:CONFIG.validationRules});else return notDefinedValue}});App.extend(function($,ext){var _=$._,extension,CONFIG;CONFIG={locales:{en:["us","gb"],fr:["fr","ch"],it:["it","ch"],pt:["pt","br"],de:["de","ch"],cs:["cs"],da:["da"],es:["la"],fi:["fi"],nl:["nl"],no:["no"],sv:["sv"],
pl:["pl"],ru:["ru"],zh:["cn"],ja:["jp"],ar:["ar"]},defaultLocale:["en-us","en-gb"],servicesByRegionUS:{"en-us":["facebook","twitter","print","email","pinterest","whatsapp","gmail","stumbleupon","favorites","reddit","tumblr","googlebookmarks","blogger","linkedin","yahoomail","digg","googleplus"],"en-gb":["facebook","twitter","print","email","stumbleupon","favorites","whatsapp","gmail","reddit","blogger","googlebookmarks","linkedin","tumblr","googleplus","pinterest","digg","delicious"]},localePattern:"^[a-zA-Z]{2}-[a-zA-Z]{2}$",
localePath:$.config.env.cdnSecureURL+"/locale/",callbackName:"postPlatformLocaleDict"};extension={store:{locale:CONFIG.defaultLocale[0],dictionary:{share:"Share",shareTitle:"Share with friends",privacy:"Privacy",powered:"Powered by Po.st",more:"More",moreServices:"More services",email:"Email",favorites:"Favorites",print:"Print",sharingSuccessful:"Sharing Successful!",successfullyShared:"You've successfully shared using Po.st!",shareAgain:"Share again!",readMore:"Read more at {link}",enterWordpressURL:"Please enter your WordPress Blog URL",
pressToBookmark:"Please press Ctrl+D to bookmark this page.",close:"Close",jumboCounter:"shares"},servicesByRegion:CONFIG.servicesByRegionUS["en-us"],listeners:[]},validate:function(userLanguage){var country,region;if(!_.isUndefined(userLanguage)&&userLanguage!==""){userLanguage=userLanguage.toLowerCase();if(userLanguage==="auto")userLanguage=_.getSystemLanguage();country=userLanguage.split("-")[0];region=userLanguage.split("-")[1];if(CONFIG.locales[country])if(region&&CONFIG.locales[country].indexOf(region)>
-1)this.store.locale=userLanguage;else this.store.locale=country+"-"+CONFIG.locales[country][0]}if(CONFIG.defaultLocale.indexOf(this.store.locale)===-1)this.loadDictionary(this.store.locale);else if(this.store.locale==="en-gb")this.store.servicesByRegion=CONFIG.servicesByRegionUS["en-gb"]},t:function(key){return!key?key:_.prop(this.store.dictionary,key)||key},loadDictionary:function(locale){_.getJSON(CONFIG.localePath+this.getBCP47tag(locale)+".js",{callbackName:CONFIG.callbackName,cachePrefix:$.config.env.buildNumber,
done:function(r){this.store.dictionary=r.dictionary;this.store.servicesByRegion=r.servicesByRegion;this.doListeners()}.bind(this)})},getServicesByRegion:function(){return this.store.servicesByRegion},doListeners:function(){_.each(this.store.listeners,function(listener){_.html(listener.node,this.store.dictionary[listener.dictionaryKey])},this)},bind:function(node,dictionaryKey){this.store.listeners.push({node:node,dictionaryKey:dictionaryKey})},unbind:function(node){this.store.listeners=_.filter(this.store.listeners,
function(listener){return listener.node!==node})},getLocale:function(){return this.store.locale},isDictionaryKey:function(input){return!!this.store.dictionary[input]},getRegion:function(locale){var _return;_.each(CONFIG.supported,function(lc){if(lc.split("-")[0]===locale)_return=lc.split("-")[1]});return _return},getBCP47tag:function(locale){var lc=(locale||this.store.locale).split("-");return lc[0]+"_"+lc[1].toUpperCase()}};ext.i18n=extension});App.extend(function($,ext){var notDefinedValue,_=$._,
CONFIG;CONFIG=Object.freeze({services:{twitter:{id:"02",label:"Twitter",entryURL:"https://twitter.com/intent/tweet?url\x3d{url}\x26text\x3d{title}\x26via\x3d{via}",counter:true,shorten:true,syncCounter:false},facebook:{id:"01",label:"Facebook",entryURL:"https://www.facebook.com/sharer/sharer.php?u\x3d{url}",counter:true,syncCounter:true},facebooksend:{id:"46",label:"Facebook Send",notInList:true},linkedin:{id:"07",label:"LinkedIn",entryURL:"http://www.linkedin.com/shareArticle?mini\x3dtrue\x26url\x3d{url}\x26title\x3d{title}\x26summary\x3d{description}",
shorten:true,counter:true,customWindowSize:[600,420],syncCounter:true},googlebookmarks:{id:"08",label:"Google Bookmarks",entryURL:"http://www.google.com/bookmarks/mark?op\x3dedit\x26bkmk\x3d{url}\x26title\x3d{title}\x26annotation\x3d{description}"},yahoomail:{id:"17",label:"Yahoo Mail",entryURL:"https://us-mg5.mail.yahoo.com/neo/launch?action\x3dcompose\x26amp;Subject\x3d{title}\x26amp;"+"Body\x3d{description}+{url}"},aollifestream:{id:"23",label:"AOL LifeStream",entryURL:"http://lifestream.aol.com/share/?url\x3d{url}\x26title\x3d{title}\x26description\x3d{description}",
shorten:true},googleplus:{id:"30",label:"Google+",entryURL:"https://plus.google.com/share?url\x3d{url}\x26t\x3d{title}",counter:true,syncCounter:true},pinterest:{id:"32",label:"Pin It",entryURL:"http://pinterest.com/pin/create/button/?url\x3d{url}\x26description\x3d{title}\x26media\x3d{image}",counter:true,customWindowSize:[680,500],syncCounter:true},stumbleupon:{id:"05",label:"StumbleUpon",entryURL:"http://www.stumbleupon.com/submit?url\x3d{url}\x26title\x3d{title}",shorten:false},delicious:{id:"11",
label:"Delicious",entryURL:"http://delicious.com/save?url\x3d{url}\x26title\x3d{title}"},digg:{id:"12",label:"Digg",entryURL:"http://digg.com/submit?phase\x3d2\x26url\x3d{url}\x26title\x3d{title}"},gmail:{id:"14",label:"GMail",entryURL:"http://mail.google.com/mail/?view\x3dcm\x26fs\x3d1\x26to\x26su\x3d{title}\x26body\x3d{description}+{url}\x26ui\x3d2\x26tf\x3d1"},blogger:{id:"15",label:"Blogger",entryURL:"http://www.blogger.com/blog_this.pyra?t\x26u\x3d{url}\x26n\x3d{title}\x26pli\x3d1"},reddit:{id:"16",
label:"Reddit",entryURL:"http://reddit.com/submit?resubmit\x3dtrue\x26url\x3d{url}\x26title\x3d{title}",shorten:false},tumblr:{id:"18",label:"Tumblr",entryURL:"http://www.tumblr.com/share?v\x3d3\x26u\x3d{url}\x26t\x3d{title}\x26s\x3d{description}"},outlook:{id:"19",label:"Outlook",entryURL:"https://bay179.mail.live.com/default.aspx?id\x3d64855\x26action\x3dcompose\x26to\x3d\x26subject\x3d{title}\x26body\x3d{description}+{url}"},aolmail:{id:"20",label:"AOL Mail",entryURL:"https://mail.aol.com/webmail-std/en-us/composemessage?to\x3d\x26subject\x3d{title}\x26body\x3d{description}+{url}"},
livejournal:{id:"21",label:"LiveJournal",entryURL:"http://www.livejournal.com/update.bml?subject\x3d{title}\x26event\x3d{description}+{url}"},vkontakte:{id:"26",label:"VKontakte",entryURL:"http://vkontakte.ru/share.php?url\x3d{url}\x26title\x3d{title}\x26description\x3d{description}"},baidu:{id:"27",label:"Baidu",entryURL:"http://cang.baidu.com/do/add?it\x3d{title}\x26iu\x3d{url}\x26fr\x3dien\x26dc\x3d{description}"},mailru:{id:"28",label:"Mail.ru",entryURL:"http://connect.mail.ru/share?url\x3d{url}\x26title\x3d{title}\x26description\x3d{description}"},
xing:{id:"33",label:"XING",entryURL:"https://www.xing.com/spi/shares/new?cb\x3d0\x26url\x3d{url}"},meinvz:{id:"34",label:"MeinVZ",entryURL:"http://www.meinvz.net/Link/Share/?url\x3d{url}\x26title\x3d{title}\x26description\x3d{description}"},skyrock:{id:"35",label:"Skyrock",entryURL:"http://www.skyrock.com/m/blog/share.php?url\x3d{url}\x26desc\x3d{description} {url}"},viadeo:{id:"36",label:"Viadeo",entryURL:"http://fr.viadeo.com/en/widgets/share/preview?urlToBeShared\x3d{url}",shorten:false,forcedValues:{shorten:false}},
odnoklassniki:{id:"37",label:"Odnoklassniki",entryURL:"http://www.odnoklassniki.ru/dk?st.cmd\x3daddShare\x26st.s\x3d1\x26st._surl\x3d{url}"},weibo:{id:"38",label:"Sina Weibo",entryURL:"http://service.weibo.com/share/share.php?url\x3d{url}\x26title\x3d{title}"},qzone:{id:"39",label:"QZone",entryURL:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url\x3d{url}\x26title\x3d{title}"},kaixin:{id:"40",label:"Kaixin Repaste",entryURL:"http://www.kaixin001.com/rest/records.php?url\x3d{url}\x26content\x3d{title}\x26style\x3d11",
shorten:true},whatsapp:{id:"41",label:"WhatsApp",entryURL:"whatsapp://send?text\x3d{title} {url}"},mixi:{id:"42",label:"Mixi",entryURL:"http://mixi.jp/share.pl?u\x3d{url}\x26t\x3d{description}",shorten:false},line:{id:"43",label:"Line",entryURL:"line://msg/text/{title} {url}"},pocket:{id:"44",label:"Pocket",entryURL:"https://getpocket.com/save?url\x3d{url}",shorten:true},yummly:{id:"45",label:"Yummly",entryURL:"http://www.yummly.com/urb/verify?url\x3d{url}\x26title\x3d{title}\x26image\x3d{image}",
disableTracking:true},flipboard:{id:"47",label:"Flipboard",entryURL:"https://share.flipboard.com/bookmarklet/popout?v\x3d2\x26title\x3d{title}\x26url\x3d{url}\x26t\x3d{timestamp}\x26utm_source\x3d{domain}\x26utm_medium\x3darticle-share\x26utm_campaign\x3dpost"},email:{id:"03",label:"email"},print:{id:"04",label:"print"},more:{label:"more",counter:true,notInList:true},post:{label:"share",counter:true,notInList:true},sms:{id:"96",label:"SMS",entryURL:"sms:?body\x3d{title} {url}"},favorites:{id:"06",
label:"favorites"},wordpress:{id:"24",label:"WordPress",entryURL:"https://wordpress.com/post/?title\x3d{title}\x26url\x3d{url}\x26text\x3d{description}"},addressbar:{id:"97",notInList:true,virtual:true},clipboard:{id:"99",notInList:true,virtual:true}}});ext.services={getById:function(id){var _return,serviceName;for(serviceName in CONFIG.services)if(CONFIG.services.hasOwnProperty(serviceName)&&CONFIG.services[serviceName].id===id){_return=CONFIG.services[serviceName];_return.name=serviceName;break}return _return},
getShareList:function(){var list=[];_.each(CONFIG.services,function(service){if(!CONFIG.services[service].notInList)list.push(service)});return list},get:function(serviceName){var service=_.extend({},CONFIG.services[serviceName]);service.name=serviceName;return service},getByAction:function(serviceName,action){var newService=serviceName+action;if(action&&this.has(newService))return this.get(newService);return this.get(serviceName)},has:function(serviceName){return CONFIG.services[serviceName]!==notDefinedValue}}});
App.extend(function($,ext){var CONFIG,notDefinedValue=undefined,_=$._;CONFIG={windowProperty:"pwidget_config",possibleMetaProps:["title"],defaultPwidgetConfig:{publisherKey:_.getScriptParameter("publisherKey"),requestConfig:true,sticky:false,shareImages:false,clean:false,copypaste:true,copypasteOptions:{minWords:7,readMoreText:notDefinedValue,readMoreUrl:notDefinedValue,imageSize:[100,100]},shareQuote:true,shareQuoteOptions:{buttons:notDefinedValue,morePopupExclude:notDefinedValue,trigger:"copy"},
onload:notDefinedValue,track:true,trackAddressBar:false,mode:"classic",version:notDefinedValue,googleAnalytics:false,googleAnalyticsOptions:{gaTrackingId:notDefinedValue,trackEvents:true,trackSocialInteractions:false,trackOptions:{nonInteraction:false,pagePath:notDefinedValue}},theme:"default",defaults:{viewType:notDefinedValue,vguid:notDefinedValue,title:notDefinedValue,url:_.removeTrackingParameter(_.getCanonicalUrl()||_.getWindowProperty("location.href")),jumbo:false,jumboPosition:"first",transformations:{tracking:true,
shorten:notDefinedValue},afterShareOptions:{text:true,shareAgain:true,baseElement:notDefinedValue,center:false,offset:[0,0]},handlers:{onshare:notDefinedValue,onshowaftershare:notDefinedValue,onhideaftershare:notDefinedValue,onbuttonclick:notDefinedValue},stickyPopup:false,popup:{click:true,center:false,overlay:notDefinedValue,openDelay:200,hideDelay:1500,services:{display:notDefinedValue,exclude:notDefinedValue}},shareNewWindow:true,referrer:notDefinedValue,services:{twitter:{via:"po_st"}},rules:{clearUrlParameters:true},
buttons:["facebook","twitter","linkedin"]}}};ext.pwConfig={state:{pwidgetConfig:_.extend({},CONFIG.defaultPwidgetConfig),specificProps:{defaults:{title:_.getMetaData("og:title")||_.getDocumentProperty("title")},twitter:{title:_.getMetaData("twitter:title")||_.getMetaData("og:title")||_.getDocumentProperty("title")}}},update:function(input){this.state.pwidgetConfig=_.extend(this.state.pwidgetConfig,input||{})},sync:function(){this.state.pwidgetConfig=_.extend(this.state.pwidgetConfig,_.getWindowProperty("pwidget_config"))},
val:function(path){return _.prop(this.state.pwidgetConfig||{},path)},specific:function(serviceName){var props=this.state.specificProps,defaultName="defaults";if(serviceName)return props[serviceName]||props[defaultName];return props[defaultName]}}});App.extend(function($,ext){var _=$._;ext.getSharingURL=function(options){var pageURL=_.removeTrackingParameter(options.pageURL),shorten=options.service.shorten,doNotTrack=options.service.disableTracking,trackingParameter;pageURL=_.parseURL(pageURL);if(options.hasCustomShortener)shorten=
false;else if(!_.isUndefined(options.transformations.shorten))shorten=options.transformations.shorten;if(!_.isTrue(shorten)&&!doNotTrack&&options.track)if(_.isTrue(options.transformations.tracking)){trackingParameter=options.sGUID+"."+options.service.id;if(options.track===true)pageURL.hash=pageURL.hash+"#"+trackingParameter;else if(pageURL.search.length)pageURL.search=pageURL.search+"\x26"+trackingParameter;else pageURL.search=trackingParameter}return pageURL.href}});App.register("datalogger",function($){var _=
$._,CONFIG;CONFIG={pixelPath:$.config.env.loggerSecureURL+"/p",optOuted:["pt","ru","vGUID","mGUID","sGUID","bGUID","label"],additionalParams:{"advertiser_id":"adv","entity_id":"eid","country_code":"cc","category":"cat"},shareEventIntervalSec:.5};return{init:function(){_.bindAll(this,["clearQueue","onLog"]);$.state.set({eventsQueue:[]});$.subscribe({"status.updated":this.clearQueue,"datalogger.log":this.onLog})},destroy:function(){},onLog:function(options){var __lastShareEvent,lastShareEvent;if(options.eventName===
"share"){__lastShareEvent=$.state.get("LAST_SHARE_EVENT");if(__lastShareEvent)lastShareEvent=_.cloneObject(__lastShareEvent);$.state.set({LAST_SHARE_EVENT:{sc1:options.options.sc1,random:options.options.random}});if(lastShareEvent)if(options.options.sc1===lastShareEvent.sc1)if((options.options.random-lastShareEvent.random)/1E3<CONFIG.shareEventIntervalSec)return}if(!_.isUndefined($.ext.status.val("optout")))this.log(options.eventName,options.options);else this.addToQueue(options.eventName,options.options)},
filterShareEvents:function(options){var __lastShareEvent,lastShareEvent;if(options.eventName==="share"){__lastShareEvent=$.state.get("LAST_SHARE_EVENT");if(__lastShareEvent)lastShareEvent=_.cloneObject(__lastShareEvent);$.state.set({LAST_SHARE_EVENT:{sc1:options.options.sc1,random:options.options.random}});if(lastShareEvent)if(options.options.sc1===lastShareEvent.sc1)if((options.options.random-lastShareEvent.random)/1E3<CONFIG.shareEventDelaySec)return true}return false},addToQueue:function(name,
parameters){$.state.set({eventsQueue:$.state.get("eventsQueue").concat([{name:name,parameters:parameters}])})},clearQueue:function(){_.each($.state.get("eventsQueue"),function(event){this.log(event.name,event.parameters)},this);$.state.set({eventsQueue:[]})},getAdditionalParams:function(){var params={};_.each(CONFIG.additionalParams,function(key){if($.ext.status.val(key))params[CONFIG.additionalParams[key]]=$.ext.status.val(key)});return params},log:function(eventName,parameters){var optOutedParams=
{},params=_.extend({vw:4,t:eventName,v:$.ext.pwConfig.val("version")||$.config.env.widgetBuildNumber,random:_.getTimeStamp(),ru:_.getDocumentProperty("referrer")},parameters);if(_.getScriptParameter("partner"))params["int"]=_.getScriptParameter("partner");params=_.extend(params,this.getAdditionalParams());if($.ext.status.val("optout")===true){_.each(params,function(key){if(CONFIG.optOuted.indexOf(key)<0)optOutedParams[key]=params[key]});params=optOutedParams}(new Image).src=CONFIG.pixelPath+_.objectAsQueryParams(params)}}});
App.register("counter",function($){var _=$._,CONFIG;CONFIG={requestURL:$.config.env.shareServer+"/v1/counter",CSSSelectors:{boxCounter:".pw-box-counter",label:".pw-jumbo-counter__label"},templates:{jumboCounter:'\x3cspan class\x3d"pw-jumbo-counter__outer"\x3e'+'\x3cspan class\x3d"pw-jumbo-counter__inner"\x3e'+'\x3cspan class\x3d"pw-jumbo-counter__value"\x3e{value}\x3c/span\x3e'+'\x3cspan class\x3d"pw-jumbo-counter__label"\x3e{label}\x3c/span\x3e'+"\x3c/span\x3e"+"\x3c/span\x3e"}};function formatNumber(num,
postfix,delimeter){num=Math.round(num/delimeter*10)/10;if(num.toString().length>4)num=Math.round(num);return num+postfix}function beautifyNumber(num){var numLength=num.toString().length;if(numLength>3)if(numLength<7)return formatNumber(num,"K",1E3);else if(numLength<10)return formatNumber(num,"M",1E6);else return formatNumber(num,"B",1E9);return num}function Counter(node,properties){this.node=node;this.props=this.getProperties(_.cloneObject(properties));this.service=$.ext.services.get(this.props.service);
this.node.ready=true;if(!(this.service.counter||this.service.name==="total")){_.warn("Box counter doesn't support service ["+this.service.name+"]");return}_.bindAll(this,["updateValue"]);$.subscribe("counter.fetched",this.updateValue);$.publish("counter.get",{serviceID:this.service.id||0,url:this.props.url})}Counter.prototype={constructor:Counter,getProperties:function(properties){return _.extend(properties,_.getDataAttributes(this.node,["url","service"]))},getWidgetId:function(){return this.props.widgetId},
updateValue:function(data){var service=["more","post"].indexOf(this.props.service)>-1?"total":this.props.service;if(data.url===this.props.url)_.html(this.node,data.values[service]||"0")},destroy:function(){$.unsubscribe("counter.fetched",this.updateValue);this.node=null}};function JumboCounter(parentNode,options){this.parentNode=parentNode;this.options=_.cloneObject(options);_.bindAll(this,["updateValue"]);this.subscribe();this.init()}JumboCounter.prototype={constructor:JumboCounter,init:function(){var firstChild=
_.getFirstChild(this.parentNode);this.node=_.createNode("span."+this.getClassList(),{style:this.getCustomStyle(),innerHTML:_.t(CONFIG.templates.jumboCounter,{value:"",label:$.ext.i18n.t("jumboCounter")})});$.ext.i18n.bind(_.get(CONFIG.CSSSelectors.label,this.node)[0],"jumboCounter");$.publish("counter.get",{serviceID:0,url:this.options.url});if(this.options.position==="last"||!firstChild)_.appendTo(this.parentNode,this.node);else _.insertBefore(firstChild,this.node)},getCustomStyle:function(){var position=
this.options.position,widgetPadding=this.options.widgetPadding,widgetLayout=this.options.widgetLayout,marginValue=0,style={};if(_.isDigit(widgetPadding)){widgetPadding=_.toInt(widgetPadding);if(position==="first"){marginValue=widgetPadding<=10?10:widgetPadding;style["margin-"+(widgetLayout==="horizontal"?"right":"bottom")]=marginValue+"px"}else if(position==="last")if(widgetPadding<=10)style["margin-"+(widgetLayout==="horizontal"?"left":"top")]=10-widgetPadding+"px"}return style},update:function(options){this.options.url=
options.url||this.options.url},subscribe:function(){$.subscribe("counter.fetched",this.updateValue)},getWidgetId:function(){return this.options.widgetId},updateValue:function(data){if(data.url===this.options.url)_.html(_.get(".pw-jumbo-counter__value",this.node)[0],data.values.total||"0")},getClassList:function(){return["pw-jumbo-counter","__pw-size-"+this.options.size,"__pw-jumbo-counter-"+this.options.position+"-child"].join(" ")},destroy:function(){_.destroyNode(this.node);$.unsubscribe("counter.fetched",
this.updateValue);this.node=null}};return{state:{requestsQueue:{},values:{}},init:function(){$.state.set({jumboCounters:[],boxCounters:[]});_.bindAll(this,["getCounterValue","incrementCounter","createJumboCounter","searchBoxCounters","createBoxCounters","destroyJumboCounters","destroyBoxCounters","clearQueue"]);$.subscribe({"counter.search.box":this.searchBoxCounters,"counter.get":this.getCounterValue,"counter.increment":this.incrementCounter,"counter.create.jumbo":this.createJumboCounter,"counter.create.box":this.createBoxCounters,
"counter.destroy.jumbo":this.destroyJumboCounters,"counter.destroy.box":this.destroyBoxCounters})},destroy:function(){},query:function(url,requestOptions){requestOptions.publisherKey=$.ext.pwConfig.val("publisherKey");requestOptions.url=url;_.getJSON(CONFIG.requestURL,{data:requestOptions,done:function(data){var values={};_.each(data,function(serviceName){values[serviceName]=beautifyNumber(data[serviceName])});this.state.values[url]=values;$.publish("counter.fetched",{url:url,values:values})}.bind(this)})},
prepareData:function(urlParams){var params={cancelFetch:false,sc:[]};_.each(urlParams.services,function(id){var service=$.ext.services.getById(id)||{};if(service.syncCounter&&params.sc.indexOf(id)<0)params.sc.push(id)});if(urlParams.hasTotal)params.esc=_.difference(params.sc,urlParams.esc);else if(!urlParams.services.length)params.cancelFetch=true;return params},clearQueue:function(){_.each(this.state.requestsQueue,function(url){var urlData=this.prepareData(this.state.requestsQueue[url]);if(urlData.cancelFetch)return;
this.query(url,{increment:false,sc:urlData.sc,esc:urlData.esc})},this);this.state.requestsQueue={}},fetch:function(url,serviceID,isExtraSync){this.state.requestsQueue[url]=this.state.requestsQueue[url]||{services:[],esc:[]};if(serviceID===0)this.state.requestsQueue[url].hasTotal=true;else if(isExtraSync){if(isExtraSync&&this.state.requestsQueue[url].esc.indexOf(serviceID)<0)this.state.requestsQueue[url].esc.push(serviceID)}else if(this.state.requestsQueue[url].services.indexOf(serviceID)<0)this.state.requestsQueue[url].services.push(serviceID);
if(this.fetchTimeout)clearTimeout(this.fetchTimeout);this.fetchTimeout=setTimeout(this.clearQueue,100)},getCounterValue:function(options){var state=this.state;if(state.values[options.url])$.publish("counter.fetched",{url:options.url,values:state.values[options.url]});else this.fetch(options.url,options.serviceID,options.extraSync)},incrementCounter:function(options){this.query(options.url,{channel:options.channel,increment:true})},createJumboCounter:function(options){$.state.set({jumboCounters:($.state.get("jumboCounters")||
[]).concat([new JumboCounter(options.parentNode,{widgetId:options.widgetId,position:options.position,url:options.url,size:options.size,widgetLayout:options.widgetLayout,widgetPadding:options.widgetPadding})])})},createBoxCounters:function(options){_.each(options.targets,function(targetNode){var hasParentWidget=_.isParentNodeMatch(targetNode,"pw-widget");if(!targetNode.ready)if((hasParentWidget&&options.properties.widgetId||!hasParentWidget)&&!_.ignoreUrl(options.properties))$.state.set({boxCounters:($.state.get("boxCounters")||
[]).concat([new Counter(targetNode,options.properties)])})})},searchBoxCounters:function(options){_.each(options.targets||[document.body],function(targetNode){this.createBoxCounters({targets:_.get(CONFIG.CSSSelectors.boxCounter,targetNode),properties:options.properties})},this)},destroyJumboCounters:function(options){var jumboCounters=[];_.each($.state.get("jumboCounters"),function(JumboCounterInstance){if(JumboCounterInstance.getWidgetId()===options.widgetId){JumboCounterInstance.destroy();JumboCounterInstance=
null}else jumboCounters.push(JumboCounterInstance)});$.state.set({jumboCounters:jumboCounters})},destroyBoxCounters:function(options){var boxCounters=[];_.each($.state.get("boxCounters"),function(boxCounterInstance){if(boxCounterInstance.getWidgetId()===options.widgetId){boxCounterInstance.destroy();boxCounterInstance=null}else boxCounters.push(boxCounterInstance)});$.state.set({boxCounters:boxCounters})}}});App.register("buttons",function($){var _=$._,CONFIG,notDefinedValue;CONFIG=Object.freeze({dataAttributes:["url",
"image","title","via","radius","size","counter","label","buttonColor","buttonBackground","shareNewWindow","openDelay"],properties:{classNameMapping:{size:"__pw-size-{value}",hover:"__pw-hover-{value}",label:[{value:/^(true|false)$/,className:"__pw-label-{value}"},{value:/^((true|false(?!$)).+|(?!true|false).+)$/,className:"__pw-label-true __pw-label-custom"}],counter:[{value:"false",className:"__pw-counter-none"},{value:"true",className:"__pw-counter-{value}",dependOn:"layout"},{value:/^(vertical|horizontal)$/,
className:"__pw-counter-{value}"}],radius:[{value:/^(square|rounded|circle)$/,className:"__pw-radius-{value}"},{value:/^(0?[0-9]{1,2}|1[0-7][0-9]|99999)$/,className:"__pw-radius-variable"}],buttonColor:[{value:"default",className:"__pw-button-st-color-def"},{value:/^#([0-9a-f]{3}){1,2}$/i,className:"__pw-button-st-custom"}],buttonBackground:[{value:"default",className:"__pw-button-st-bg-def"},{value:"none",className:"__pw-button-st-bg-none"},{value:/^#([0-9a-f]{3}){1,2}$/i,className:"__pw-button-st-custom"}]}},
CSSSelectors:{button:"a",label:".pw-button-text",counterNode:".pw-button-counter__inner",jumbo:".pw-jumbo-counter"},regExps:{button:/pw-button-(\S+)/,"native":/pw-native-(\S+)/},classNames:{buttonScratch:"pw-button-{name}",buttonNativeScratch:"pw-native-{name}",node:"pw-button pw-button-{serviceName} {classList} {userClasses}"},templates:{defaultButton:'\x3ca class\x3d"pw-button-{serviceName}"\x3e\x3c/a\x3e',button:'\x3cspan class\x3d"pw-button__outer"\x3e'+'\x3cspan class\x3d"pw-button__inner"\x3e'+
'\x3cspan class\x3d"pw-button-icon pw-button-{serviceName}-icon {sizeClassName}"\x3e\x3c/span\x3e'+'\x3cspan class\x3d"pw-button-text"\x3e{label}\x3c/span\x3e{counter}'+"\x3c/span\x3e"+"\x3c/span\x3e",counter:'\x3cspan class\x3d"pw-button-counter"\x3e'+'\x3cspan class\x3d"pw-button-counter__inner"\x3e\x3c/span\x3e'+"\x3c/span\x3e"}});function getButtonSnapshot(serviceName,properties,isNative){var props={id:serviceName};if(isNative)props.isNative=true;_.each(CONFIG.dataAttributes,function(attribute){props[attribute]=
properties[attribute]});return props}function filterButtons(selector,options){var nodes=!options.targets?_.get(selector,options.parentNode||document.body):[];if(options.targets)_.each(options.targets,function(targetNode){nodes=nodes.concat(_.get(selector,targetNode))});return options.parentNode?nodes:_.filter(nodes,function(node){return!(_.isParentNodeMatch(node,"pw-widget")||_.isParentNodeMatch(node,"pw-server-widget"))})}function createNativeButtons(parameters){$.publish("buttons.button.ready",
{widgetId:parameters.widgetId,serviceName:parameters.serviceName,props:null,node:parameters.node,buttonSnapshot:getButtonSnapshot(parameters.serviceName,parameters.properties,true)});$.useModule("nativeButtons",function(){$.publish("nativeButtons.create",parameters)})}function Button(node,options){var dataAttributes=_.getDataAttributes(node,CONFIG.dataAttributes);this.node=node;this.labelNode=notDefinedValue;this.outerlNode=notDefinedValue;this.iconNode=notDefinedValue;this.widgetId=options.widgetId;
this.service=$.ext.services.get(options.serviceName);if(!this.service.counter)dataAttributes.counter=false;if(options.serviceName==="twitter"){if(options.properties.via)options.properties.services.twitter=_.extend({},{via:options.properties.via});dataAttributes.services={twitter:{}};if(dataAttributes.via){dataAttributes.services.twitter.via=dataAttributes.via;dataAttributes.via=null}}this.props=$.ext.createProperties(_.extend(_.extend({},options.properties),dataAttributes),CONFIG.properties);if(_.isTrue(this.props.val("counter")))this.props.update({counter:this.props.val("layout")});
if(!this.props.val("title"))this.props.update({title:$.ext.pwConfig.specific(options.serviceName).title});_.bindAll(this,["shareURL","showPopup","updateCounter","onClick","onMouseEnter","onMouseLeave","doMoreAction"]);this.init()}Button.prototype={constructor:Button,init:function(){this.setClassList();this.build();this.bindEvents();this.setStyles();$.publish("buttons.button.ready",{widgetId:this.widgetId,serviceName:this.service.name,props:this.props,node:this.node,buttonSnapshot:getButtonSnapshot(this.service.name,
this.props.all())})},setStyles:function(){var buttonColor=this.props.val("buttonColor"),buttonBackground=this.props.val("buttonBackground"),padding=this.props.val("padding"),radius=this.props.val("radius"),styles={};if(_.isColor(buttonColor))styles.color=buttonColor;if(_.isColor(buttonBackground))styles.background=buttonBackground;if(_.isDigit(radius))styles["border-radius"]=radius+"px";_.setStyle(this.outerNode,styles);if(styles.color)_.setStyle(this.iconNode,{color:styles.color});if(_.isDigit(padding))if(this.props.val("layout")===
"horizontal")_.setStyle(this.node,{"padding-right":padding+"px"});else if(this.props.val("layout")==="vertical")_.setStyle(this.node,{"padding-bottom":padding+"px"})},clearDelayTimeout:function(msDelay){var last=(new Date).getTime();if(last-this.now<msDelay&&this.timer){this.now=null;clearTimeout(this.timer)}},applyCustomHoverColor:function(){var buttonBackground=this.props.val("buttonBackground"),buttonColor=this.props.val("buttonColor");if(_.isTrue(this.props.val("hover")))if(_.isColor(buttonBackground)){buttonBackground=
_.toRGB(buttonBackground);_.setStyle(this.outerNode,{background:"rgba("+buttonBackground.r+", "+buttonBackground.g+", "+buttonBackground.b+", 0.7)"})}else if(_.isColor(buttonColor)){buttonColor=_.toRGB(buttonColor);_.setStyle(this.iconNode,{color:"rgba("+buttonColor.r+", "+buttonColor.g+", "+buttonColor.b+", 0.7)"})}return this},resetCustomHoverColor:function(){var buttonBackground=this.props.val("buttonBackground"),buttonColor=this.props.val("buttonColor");if(_.isTrue(this.props.val("hover")))if(_.isColor(buttonBackground))_.setStyle(this.outerNode,
{background:buttonBackground});else if(_.isColor(buttonColor))_.setStyle(this.iconNode,{color:buttonColor})},bindEvents:function(){_.on(this.node,"mouseleave",this.onMouseLeave);_.on(this.node,"mouseenter",this.onMouseEnter);_.on(this.node,"click",this.onClick);if($.ext.i18n.isDictionaryKey(this.getLabel()))$.ext.i18n.bind(this.labelNode,this.getLabel())},onClick:function(e){e.preventDefault();e.stopPropagation();if(this.isMore()&&!this.isShowPopupOnHover())this.doMoreAction();else if(!this.isMore())this.shareURL()},
onMouseLeave:function(){if(this.isMore()&&this.isShowPopupOnHover())this.clearDelayTimeout(_.toInt(this.props.val("popup.openDelay")));this.resetCustomHoverColor()},onMouseEnter:function(){if(this.isMore()&&this.isShowPopupOnHover()){this.now=(new Date).getTime();this.timer=setTimeout(this.doMoreAction,this.props.val("popup.openDelay"))}this.applyCustomHoverColor()},doMoreAction:function(){_.doFunction(this.props.val("handlers.onbuttonclick"),{service:this.service.name,node:this.node});this.logDLEvent("more");
this.showPopup()},isMore:function(){return["post","more"].indexOf(this.service.name)>-1},isShowPopupOnHover:function(){return!_.isMobile()&&!this.props.val("popup.click")},logDLEvent:function(name,options){$.publish("datalogger.log",{eventName:name,options:_.extend({vGUID:this.props.val("vguid"),pu:this.props.val("url"),pt:this.props.val("title"),pub:$.ext.pwConfig.val("publisherKey"),label:$.ext.i18n.t(this.service.name==="post"?"Post":this.service.name),mGUID:_.getGUID(true)},options)})},update:function(properties){this.props.update(properties);
this.setStyles()},showPopup:function(){$.useModule("popup");$.publish("popup.show",{type:"list",hideDelay:this.props.val("popup.hideDelay"),buttonNode:this.node,buttonProps:this.props,overlay:this.props.val("popup.overlay"),center:this.props.val("popup.center")})},shareURL:function(){$.publish("share.shareURL",{service:this.service,props:this.props,node:this.node})},build:function(){var counterMarkup="";if(!_.isFalse(this.props.val("counter"))&&this.service.counter)counterMarkup=CONFIG.templates.counter;
_.html(this.node,_.t(CONFIG.templates.button,{serviceName:this.service.name,counter:counterMarkup,label:!_.isFalsy(this.getLabel())?$.ext.i18n.t(this.getLabel()):"",sizeClassName:"__pw-size-"+this.props.val("size")}));if(counterMarkup)$.publish("counter.create.box",{targets:_.get(CONFIG.CSSSelectors.counterNode,this.node),properties:{widgetId:this.getWidgetId(),service:this.service.name,url:this.props.val("url")}});else if(this.service.syncCounter)$.publish("counter.get",{serviceID:this.service.id,
url:this.props.val("url"),extraSync:true});this.labelNode=_.get(CONFIG.CSSSelectors.label,this.node)[0];this.outerNode=_.get(".pw-button__outer",this.node)[0];this.iconNode=_.get(".pw-button-icon",this.outerNode)[0]},getLabel:function(){var label=this.props.val("label");if(_.isTrue(label))label=this.service.label;return label||""},setClassList:function(){_.setClass(this.node,_.t(CONFIG.classNames.node,{serviceName:this.service.name,classList:this.props.asClassList().join(" "),userClasses:this.getUserClasses().join(" ")}))},
getUserClasses:function(){return _.filter(_.getClassList(this.node),function(className){return className.indexOf("pw")===-1})},getWidgetId:function(){return this.widgetId},destroy:function(){if($.ext.i18n.isDictionaryKey(this.getLabel()))$.ext.i18n.unbind(this.labelNode,this.getLabel());_.destroyNode(this.node);this.node=null},getNode:function(){return this.node}};function isButtonInitialized(node){return _.filter($.state.get("buttons"),function(ButtonInstance){if(ButtonInstance.getNode()===node)return ButtonInstance}).length}
return{init:function(){$.state.set({buttons:[]});_.bindAll(this,["initButtons","destroyButtons","updateButtons"]);$.subscribe({"buttons.init":this.initButtons,"buttons.update":this.updateButtons,"buttons.destroy":this.destroyButtons})},destroy:function(){},createButton:function(node,options){if($.ext.services.has(options.serviceName)&&!$.ext.services.get(options.serviceName).virtual&&!isButtonInitialized(node))$.state.set({buttons:($.state.get("buttons")||[]).concat([new Button(node,{serviceName:options.serviceName,
properties:options.properties,widgetId:options.widgetId})])})},createButtons:function(buttonsNodes,options){_.each(buttonsNodes,function(node){var isNative=_.isMatch(CONFIG.regExps["native"],node.className),parameters,serviceName;parameters={parentNode:options.parentNode,properties:options.properties,widgetId:options.widgetId};if(isNative){parameters.node=node;parameters.serviceName=CONFIG.regExps["native"].exec(node.className)[1];createNativeButtons(parameters)}else{serviceName=CONFIG.regExps.button.exec(node.className);
if(serviceName){parameters.serviceName=serviceName[1];this.createButton(node,parameters)}}},this)},initButtons:function(options){var buttonsNodes=filterButtons(CONFIG.CSSSelectors.button,{parentNode:options.parentNode,targets:options.targets});if(buttonsNodes.length)this.createButtons(buttonsNodes,options);else if(options.ifNoButtons)this.createButtonsFromPreset(options.parentNode,options.ifNoButtons,options)},createButtonsFromPreset:function(parentNode,buttonsList,options){_.each(buttonsList,function(b){var serviceName=
_.isObject(b)?b.id:b,buttonOptions=_.extend({},options),isNative=_.isObject(b)?b.isNative:false,className=_.replace(CONFIG.classNames[isNative?"buttonNativeScratch":"buttonScratch"],"name",serviceName);buttonOptions.serviceName=serviceName;if(_.isObject(b))buttonOptions.properties=_.extend(_.extend({},options.properties),b);if(_.isTrue(isNative)){buttonOptions.node=_.appendTo(parentNode,_.createNode("a."+className));createNativeButtons(buttonOptions)}else this.createButton(_.appendTo(parentNode,_.createNode("a."+
className)),buttonOptions)},this)},updateButtons:function(options){_.each($.state.get("buttons"),function(ButtonInstance){if(ButtonInstance.getWidgetId()===options.widgetID)ButtonInstance.update(options.props)})},destroyButtons:function(options){var newButtons=[];_.each($.state.get("buttons"),function(ButtonInstance){if(ButtonInstance.getWidgetId()===options.widgetId){ButtonInstance.destroy();ButtonInstance=null}else newButtons.push(ButtonInstance)});$.state.set({buttons:[].concat(newButtons)});if(options.onDestroy)options.onDestroy()}}});
App.register("widgets",function($){var _=$._,CONFIG;CONFIG=Object.freeze({dataAttributes:["url","image","title","via","layout","radius","size","counter","label","padding","view","buttonColor","buttonBackground","hover","theme","jumbo","jumboPosition","shareNewWindow"],properties:{classNameMapping:{size:"__pw-size-{value}",hover:"__pw-hover-{value}",layout:"__pw-layout-{value}",padding:[{value:/^(true|false)$/,className:"__pw-padding-{value}"},{value:/^(0?[0-9]{1,2}|1[0-7][0-9]|99)$/,className:"__pw-padding-var"}],
view:"__pw-view-{value}",label:[{value:/^(true|false)$/,className:"__pw-label-{value}"},{value:/^((true|false(?!$)).+|(?!true|false).+)$/,className:"__pw-label-true __pw-label-custom"}],counter:[{value:"false",className:"__pw-counter-none"},{value:"true",className:"__pw-counter-{value}",dependOn:"layout"},{value:/^(vertical|horizontal)$/,className:"__pw-counter-{value}"}]}},CSSSelectors:{widget:".pw-widget"},className:"pw-widget __pw-theme-default pw-widget-{id} {classList} {userClasses}"});function isWidgetInitialized(node){return _.filter($.state.get("widgets"),
function(WidgetInstance){if(WidgetInstance.getNode()===node)return WidgetInstance}).length}function shouldWidgetHide(options){return options.hideOn===(_.isMobile()?"mobile":"desktop")}function Widget(node,options){var dataAttributes;_.bindAll(this,["initButtons","onButtonReady"]);this.id=_.getGUID().substr(0,5);this.node=node;this.initialButtons=[].concat(options.properties.buttons||[]);dataAttributes=_.getDataAttributes(this.node,CONFIG.dataAttributes);dataAttributes.services={twitter:{}};if(dataAttributes.via){dataAttributes.services.twitter.via=
dataAttributes.via;dataAttributes.via=null}this.props=$.ext.createProperties(_.extend(_.extend({},options.properties),dataAttributes),CONFIG.properties);this.counterToLayout();this.initialState=this.props.all();this.initialState.buttons=[];this.subscribe();this.init()}Widget.prototype={constructor:Widget,init:function(){this.setClassList();this.searchForChildrens();$.publish("widgets.widget.ready",{node:this.node,props:this.props});this.logDLEvent("view")},subscribe:function(){$.subscribe({"buttons.button.ready":this.onButtonReady})},
onButtonReady:function(options){if(this.id===options.widgetId)if(!this.doNotSetInitialState)this.initialState.buttons.push(options.buttonSnapshot)},searchForChildrens:function(){this.initButtons();this.initJumbo();$.publish("counter.search.box",{targets:[this.node],properties:{widgetId:this.id,url:this.props.val("url"),service:"total"}})},initJumbo:function(){if(_.isTrue(this.props.val("jumbo")))$.publish("counter.create.jumbo",{parentNode:this.node,widgetId:this.id,position:this.props.val("jumboPosition"),
url:this.props.val("url"),size:this.props.val("size"),widgetPadding:this.props.val("padding"),widgetLayout:this.props.val("layout")})},initButtons:function(){var properties=this.props.all();$.publish("buttons.init",{widgetId:this.id,properties:properties,parentNode:this.node,ifNoButtons:this.props.val("buttons")})},counterToLayout:function(){if(_.isTrue(this.props.val("counter")))this.props.update({counter:this.props.val("layout")})},update:function(properties){this.doNotSetInitialState=true;this.props.update(properties);
this.counterToLayout();this.setClassList();if(properties.buttons||properties.url||properties.counter)this.destroyChildrens(function(){this.clearNode();this.initButtons();this.initJumbo()}.bind(this));else $.publish("buttons.update",{widgetID:this.id,props:this.props.all()})},reset:function(){this.update(this.initialState)},hide:function(){_.removeClassName(this.node,"pw-g-hide");_.addClass(this.node,"pw-g-hide")},setClassList:function(){_.setClass(this.node,_.t(CONFIG.className,{id:this.id,classList:this.props.asClassList().join(" "),
userClasses:this.getUserClasses().join(" ")}))},getUserClasses:function(){return _.filter(_.getClassList(this.node),function(className){return className.indexOf("pw")===-1})},logDLEvent:function(name,options){$.publish("datalogger.log",{eventName:name,options:_.extend({vGUID:this.props.val("vguid"),pu:this.props.val("url"),pt:this.props.val("title")||$.ext.pwConfig.specific().title,pub:$.ext.pwConfig.val("publisherKey")},options)})},destroyChildrens:function(onDestroy){$.publish("buttons.destroy",
{widgetId:this.id,onDestroy:function(){$.publish("counter.destroy.jumbo",{widgetId:this.id});$.publish("counter.destroy.box",{widgetId:this.id});onDestroy()}.bind(this)})},destroy:function(){this.destroyChildrens(function(){_.destroyNode(this.node);this.node=null}.bind(this))},clearNode:function(){_.html(this.node,"")},getNode:function(){return this.node}};return{init:function(){$.state.set({widgets:[]});_.bindAll(this,["initWidgets","resetWidgets","updateWidgets","createWidgets","manageWidgets"]);
$.subscribe({"widgets.init":this.initWidgets,"widgets.reset":this.resetWidgets,"widgets.hide":this.hideWidgets,"widgets.manage":this.manageWidgets,"widgets.update":this.updateWidgets,"widgets.create":this.createWidgets})},manageWidgets:function(options){var props=options.props,action=options.isHidden?"hide":"update";if(_.isUndefined(props))action="reset";this[action+"Widgets"]({targets:_.get(options.query),properties:_.extend({},_.isObject(props)?props.widgetOptions:{})})},destroy:function(){},initWidgets:function(options){if(!options.targets)_.each(_.get(CONFIG.CSSSelectors.widget),
this.addWidget.bind(this,options.properties));else _.each(options.targets,function(targetNode){this.createWidgets({targets:_.get(CONFIG.CSSSelectors.widget,targetNode),properties:options.properties})},this)},addWidget:function(properties,node){if(!(isWidgetInitialized(node)||shouldWidgetHide(properties)||_.ignoreUrl(properties))){$.state.set({widgets:($.state.get("widgets")||[]).concat([new Widget(node,{properties:properties})])});$.publish("responsive.set.rules",{node:node})}},resetWidgets:function(options){_.each($.state.get("widgets"),
function(WidgetInstance){_.each(options.targets,function(targetNode){if(WidgetInstance.getNode()===targetNode)WidgetInstance.reset()})})},hideWidgets:function(options){_.each($.state.get("widgets"),function(WidgetInstance){_.each(options.targets,function(targetNode){if(WidgetInstance.getNode()===targetNode)WidgetInstance.hide()})})},createWidgets:function(options){_.each(options.targets,function(target){this.addWidget(options.properties,target)},this)},updateWidgets:function(options){_.each($.state.get("widgets"),
function(WidgetInstance){_.each(options.targets,function(targetNode){if(WidgetInstance.getNode()===targetNode)WidgetInstance.update(options.properties)})})}}});App.register("share",function($){var _=$._,module,CONFIG;CONFIG={sharePointURL:$.config.env.cdnSecureURL+"/share/share.html",afterShareURL:$.config.env.shareServer+"/v1/aftershare"};module={doShare:function(options){var service=options.service,props=options.props,sGUID=_.sGUID(),url=props.val("url"),entryURL=service.entryURL,status=$.ext.status,
sharingURL;_.doFunction(props.val("handlers.onbuttonclick"),{service:service.name,node:options.node});sharingURL=$.ext.getSharingURL({hasCustomShortener:!!status.val("shortener"),transformations:props.val("transformations"),pageURL:props.val("url"),service:service,sGUID:sGUID,track:$.ext.pwConfig.val("track")});switch(service.name){case "email":this.shareViaEmail({service:service,props:props,url:sharingURL});break;case "print":_.print();break;case "favorites":_.addToFavorites(props.title,sharingURL,
function(){_.notify($.ext.i18n.t("pressToBookmark"))});break;default:if(service.name==="pinterest"&&!props.val("image")){_.loadScript("//assets.pinterest.com/js/pinmarklet.js?r\x3d"+Math.random()*99999999);return}if(entryURL)this.openShareWindow({service:service,props:props,url:sharingURL,sGUID:_.sGUID(),entryURL:entryURL})}_.doFunction(props.val("handlers.onshare"),{service:service.name,node:options.node});$.publish("googleAnalytics.track",{service:service.label,url:url});if(service.name==="email"&&
!_.isMobile())return;if(service.name==="email"&&_.isMobile()||["favorites","print"].indexOf(service.name)>-1)$.publish("datalogger.log",{eventName:"share",options:{sc1:service.name,sGUID:sGUID,sm:$.ext.pwConfig.val("mode"),pub:$.ext.pwConfig.val("publisherKey"),pu:url,pt:props.val("title"),description:props.val("description"),ru:_.getDocumentProperty("referrer"),random:_.getTimeStamp()}});$.publish("counter.increment",{channel:service.name,url:url});if(service.name!=="print")_.getJSON(CONFIG.afterShareURL,
{data:{publisherKey:$.ext.pwConfig.val("publisherKey")},done:function(r){if(r.html)this.showAfterShare({node:options.node,props:props,serviceName:service.name,offer:r.html})}.bind(this)})},showAfterShare:function(options){var props=options.props;$.useModule("popup");$.publish("popup.show",{type:"aftershare",buttonNode:options.node,serviceName:options.serviceName,handlers:props.val("handlers"),buttonProps:props,afterShareOptions:props.val("afterShareOptions"),offer:options.offer,center:props.val("afterShareOptions").center,
sharePopupOptions:{type:"list",hideDelay:props.val("popup.hideDelay"),buttonNode:options.node,buttonProps:props,center:props.val("popup.center"),overlay:props.val("popup.overlay")}})},getShortenParamValue:function(options){var service=options.service,forcedShorten=_.prop(service,"forcedValues.shorten"),configShorten=options.props.val("transformations.shorten"),_return=$.ext.status.val("shortener")?true:_.prop(service,"shorten");if(!_.isUndefined(forcedShorten))_return=forcedShorten;else if(!_.isUndefined(configShorten))_return=
configShorten;return _return},shareViaEmail:function(options){var props=options.props,status=$.ext.status,viaURL="%0A%0A"+encodeURIComponent(options.url);if(_.isMobile())setTimeout(function(){_.redirectTo("mailto:?subject\x3d"+props.val("title")+"\x26body\x3d"+(props.val("description")||"")+viaURL)});else{$.useModule("email");$.publish("email.show",{shortener:status.val("shortener"),adv:status.val("advertiser_id"),eid:status.val("entity_id"),cc:status.val("country_code"),cat:status.val("category"),
shortenerKey:status.val("shortenerKey"),sharerId:options.service.id,referrer:_.getDocumentProperty("referrer"),shorten:status.val("shortener")?true:props.val("transformations.shorten"),pubKey:$.ext.pwConfig.val("publisherKey"),track:!props.val("transformations.tracking")?false:$.ext.pwConfig.val("track"),title:props.val("title"),description:props.val("description"),vGUID:props.val("vguid"),url:options.url,sm:$.ext.pwConfig.val("mode"),lc:$.ext.i18n.getLocale(),afterShare:_.isObject(props.val("afterShare"))?
true:props.val("afterShare"),"int":_.getScriptParameter("partner")})}},openShareWindow:function(options){var props=options.props,status=$.ext.status;_.openWindow(CONFIG.sharePointURL+_.objectAsQueryParams({title:props.val("title"),url:options.url,via:props.val("services.twitter.via"),image:props.val("image")||"",description:props.val("description"),domain:_.parseURL(options.url).hostname,timestamp:(new Date).getTime(),optout:status.val("optout"),shortener:status.val("shortener"),shortenerKey:status.val("shortenerKey"),
adv:status.val("advertiser_id"),eid:status.val("entity_id"),cc:status.val("country_code"),cat:status.val("category"),"int":_.getScriptParameter("partner"),shorten:this.getShortenParamValue(options),sharerUrl:options.entryURL,sc:options.service.name,sharer:options.service.label,sGUID:options.sGUID,pub:$.ext.pwConfig.val("publisherKey"),v:$.ext.pwConfig.val("version")||$.config.env.widgetBuildNumber,lc:$.ext.i18n.getLocale(),ru:_.getDocumentProperty("referrer"),sm:$.ext.pwConfig.val("mode"),vGUID:props.val("vguid"),
track:$.ext.pwConfig.val("track"),t:_.jsonStringify(props.val("transformations"))}),this.getWindowParams(props.all(),options.service))},getWindowParams:function(props,service){var windowSize=service.windowSize,params="",w=640,h=480;if(!_.isFalsy(props.shareNewWindow)){if(!_.isUndefined(windowSize)){w=windowSize[0];h=windowSize[1]}params="location\x3d1, status\x3d1, scrollbars\x3d1, width\x3d"+w+", height\x3d"+h+", left\x3d"+_.toInt(_.prop(window,"screen.width")/2-w/2)+", top\x3d"+_.toInt(_.prop(window,
"screen.height")/2-h/2)}return params}};return{init:function(){$.subscribe({"share.shareURL":function(options){module.doShare(options)}})},destroy:function(){}}});App.register("shortener",function($){var _=$._,CONFIG;CONFIG={shortenUrl:{poSt:$.config.env.shareServer+"/v1/shorten?sc\x3d{service}\x26longUrl\x3d{url}\x26pub\x3d{publisherKey}\x26sGUID\x3d{sGUID}",bitly:"https://api-ssl.bitly.com/v3/shorten?format\x3djson\x26longUrl\x3d{url}\x26access_token\x3d{shortenerKey}\x26",awesm:"http://api.awe.sm/url.json?v\x3d3\x26url\x3d{url}\x26key\x3d{shortenerKey}\x26channel\x3d{service}\x26tool\x3dmKU7uN\x26"},
shortenUrlResponseKey:{poSt:"url",bitly:"data.url",awesm:"awesm_url"}};return{init:function(){_.bindAll(this,["fetchShortenUrl"]);$.subscribe({"url.shorten":this.fetchShortUrl})},fetchShortUrl:function(options){var cb=options.done,shortenerName=$.ext.status.val("shortener")||"poSt";_.getJSON(_.t(CONFIG.shortenUrl[shortenerName],{publisherKey:$.ext.pwConfig.val("publisherKey"),shortenerKey:$.ext.status.val("shortenerKey"),url:encodeURIComponent(options.url),service:options.serviceName,sGUID:options.sGUID}),
{done:function(data){_.doFunction(cb,_.isObject(data)?_.prop(data,CONFIG.shortenUrlResponseKey[shortenerName]):data)}})}}});App.init(function($){var application,_=$._;application={isInitiated:false,buttonsCount:0,init:function(){_.bindAll(this,["initDefaultApplication","onButtonReady","onStatusReady","onBackedStatusReady","virtualPageReload"]);$.ext.pwConfig.sync();this.subscribe();App.startModules()},initDefaultApplication:function(options){if(this.isInitiated){this.initPlatform(options);this.initServerWidgets(options);
return}if(!$.ext.pwConfig.val("publisherKey"))return;if($.ext.pwConfig.val("requestConfig")){$.ext.backend.searchForWidgets();this.fetchStatus({params:{w:$.ext.backend.getWidgetIds(),getConfig:true},cb:this.onBackedStatusReady.bind(this,options)})}else{this.initPlatform(options);this.fetchStatus();this.isInitiated=true}},onBackedStatusReady:function(platformOptions){var status=$.ext.status,globalConfig=status.val("config.global"),widgets=status.val("config.widgets");if(globalConfig)$.ext.pwConfig.update(globalConfig);
this.onStatusReady();this.initPlatform(platformOptions);if(widgets)_.each(widgets,function(widget){if(_.isFalsy(widget.disable))$.publish("widgets.create",{properties:_.extend(_.cloneObject($.ext.pwConfig.val("defaults")),widget.settings),targets:$.ext.backend.getWidgetNodes(widget.id)})});this.isInitiated=true},addHTMLClasses:function(){var htmlNode=_.get("html")[0];_.setClass(htmlNode,_.getClassList(htmlNode).concat(["pw-globals-type-"+(_.isMobile()?"mobile":"desktop"),"pw-globals-lc-"+$.ext.i18n.getLocale(),
"pw-globals-cp-"+_.isTrue($.ext.pwConfig.val("copypaste")),"pw-globals-sq-"+_.isTrue($.ext.pwConfig.val("shareQuote")),"pw-globals-bv-"+_.getBrowser("name"),"pw-globals-bv-"+_.getBrowser("name")+_.getBrowser("version"),"pw-globals-theme-"+$.ext.pwConfig.val("theme")]).join(" "))},initServerWidgets:function(options){var status=$.ext.status,widgets=status.val("config.widgets");$.ext.backend.searchForWidgetsByTargets(options.targets);if(widgets)_.each(widgets,function(widget){if(_.isFalsy(widget.disable))$.publish("widgets.create",
{properties:_.extend(_.cloneObject($.ext.pwConfig.val("defaults")),widget.settings),targets:$.ext.backend.getWidgetNodes(widget.id)})})},initPlatform:function(options){var initProperties;options=options||{};if(!this.isInitiated){$.ext.i18n.validate($.ext.pwConfig.val("locale"));if(!$.ext.pwConfig.val("clean")){this.loadMainCSS();if($.ext.pwConfig.val("theme")==="default")$.ext.assets.loadTheme()}this.addHTMLClasses()}initProperties={targets:options.targets,properties:$.ext.pwConfig.val("defaults")};
$.publish("widgets.init",initProperties);$.publish("buttons.init",initProperties);$.publish("counter.search.box",{targets:options.targets,properties:{url:$.ext.pwConfig.val("defaults.url"),rules:$.ext.pwConfig.val("defaults.rules"),service:"total"}});if(!this.isInitiated)$.loadModules()},afterInit:function(cb){var prevButtonsCount=this.buttonsCount,initType=_.getScriptParameter("init"),interval;interval=setInterval(function(){if(initType==="lazy"||window[$.config.windowProperty]&&prevButtonsCount===
this.buttonsCount&&this.isInitiated){$.ext.pwConfig.sync();_.doFunction($.ext.pwConfig.val("onload"));_.doFunction(cb);this.trackToComScore();this.trackPageViewEvent();clearInterval(interval)}prevButtonsCount=this.buttonsCount}.bind(this),100)},trackPageViewEvent:function(force){if(force||this.buttonsCount===0)this.logDLEvent("view",{pt:$.ext.pwConfig.val("defaults.title")||$.ext.pwConfig.specific().title,pu:$.ext.pwConfig.val("defaults.url"),pub:$.ext.pwConfig.val("publisherKey"),vGUID:_.getGUID(true)})},
fetchStatus:function(options){var params;options=options||{};params=options.params||{};params.pubKey=$.ext.pwConfig.val("publisherKey");$.ext.status.fetch(params,options.cb||this.onStatusReady)},onStatusReady:function(){$.publish("status.updated");this.trackClickBack();this.initAddressBarTracking()},subscribe:function(){$.subscribe({"buttons.button.ready":this.onButtonReady,"platform.init":this.initDefaultApplication,"virtual.reload":this.virtualPageReload})},loadMainCSS:function(){if(!$.ext.pwConfig.val("clean"))$.ext.assets.loadCoreCSS()},
logDLEvent:function(name,options){$.publish("datalogger.log",{eventName:name,options:options})},initAddressBarTracking:function(){if($.ext.pwConfig.val("trackAddressBar")&&$.ext.pwConfig.val("track")===true)window.location.replace(_.removeTrackingParameter(window.location.toString())+"#"+_.sGUID()+".97")},trackClickBack:function(){var clickBackData;if($.ext.pwConfig.val("track")){clickBackData=_.getDocumentProperty("location.href").match(/[\?&#]{1}([a-z\d]{16})\.([\d]{2})(?:|$)/i);if(clickBackData)this.logDLEvent("clickback",
{pt:$.ext.pwConfig.val("defaults.title")||$.ext.pwConfig.specific().title,pu:$.ext.pwConfig.val("defaults.url"),pub:$.ext.pwConfig.val("publisherKey"),sc:$.ext.services.getById(clickBackData[2]).name,sGUID:clickBackData[1],bGUID:_.getGUID(true)})}},trackToComScore:function(){window._comscore=window._comscore||[];window._comscore.push({c1:"7",c2:"8973917",c3:"1"});_.loadScript(($.config.env.scriptProtocol==="https:"?"https://sb":"http://b")+".scorecardresearch.com/beacon.js")},virtualPageReload:function(options){var defaultUrl=
_.removeTrackingParameter(_.getCanonicalUrl()||_.getWindowProperty("location.href")),url=options.url||defaultUrl;if(url===true)url=defaultUrl;$.ext.pwConfig.update({defaults:{url:url}});this.trackPageViewEvent(true);this.initAddressBarTracking();$.publish("copypaste.update")},onButtonReady:function(options){if(!options.props)return;var size=options.props.val("size").toString();if(_.isFalsy($.ext.pwConfig.val("clean"))){if(size==="64")size=48;$.ext.assets.loadFont(size)}this.buttonsCount+=1}};switch(_.getScriptParameter("init")){case "lazy":$.ext.pwConfig.sync();
application.init();application.afterInit();break;default:$.ext.pwConfig.sync();_.domReady(function(){application.init();application.initDefaultApplication();application.afterInit()})}});App.api(function($){var _=$._;return{init:function init(selector){$.publish("platform.init",{targets:_.get(selector||document)})},virtualReload:function virtualReload(properties){$.publish("virtual.reload",_.extend({},properties))},createWidget:function createWidget(selector,properties){if(selector)setTimeout(function(){$.publish("widgets.create",
{properties:_.extend(_.extend({},$.ext.pwConfig.val("defaults")),properties),targets:_.get(selector)})},100)},updateWidget:function updateWidget(selector,properties){if(selector)$.publish("widgets.update",{properties:_.extend({},properties),targets:_.get(selector)})},resetWidget:function(selector){if(selector)$.publish("widgets.reset",{targets:_.get(selector)})},redrawShareImages:function(){$.publish("shareImages.redraw")},createCounter:function createCounter(selector,properties){var props=properties?
_.cloneObject(properties):{};setTimeout(function(){props.url=props.url||$.ext.pwConfig.val("defaults.url");props.service=props.service||"total";$.publish("counter.create.box",{targets:_.get(selector),properties:props})},100)}}})})();