var AdRollLiquidAds=AdRollLiquidAds||{};AdRollLiquidAds.createJS=createjs;AdRollLiquidAds.flashLib={};AdRollLiquidAds.flashImgs={};WebFontConfig={timeout:3e3,classes:false,adroll:false};AdRollLiquidAds.CONSTANTS={VERSION:"1.7.34",P_VERSION:"1.0.24",getVersion:function(){return initvars.type==AdRollLiquidAds.CONSTANTS.TYPE_PERSONALIZED?AdRollLiquidAds.CONSTANTS.P_VERSION:AdRollLiquidAds.CONSTANTS.VERSION},ADD_NAV:"add_nav",ALL_CAPS:"all_caps",ALLOW_VIDEO:"allow_video",ANIMATION_END_INDEX:"animation_end_index",AUTO_SCROLL:"auto_scroll",BASE_REC_TAG:"baseRectag",BASE_TRECS_TAG:"baseTrecstag",BG_TAG:"backgroundTAG",CLICK_TAG:"clickTAG",CLICK_OVERRIDE:"click_override",CHR_TEXT_TWEAK:"chr_text_tweak",CTA_URL:"cta_url",DEFAULT_CLICK:"default_click",DEMO:"demo",DYN_VIDEO:"dynamic_video",DYN_VIDEO_IMG:"dynamic_video_img",ENGAGE_TAG:"engageTAG",EXP_CONFIGS:"experimentConfigs",EXP_PROD_TAG:"experimentProdtag",FIELD_EXTENSION:"field_extension",FF_TEXT_TWEAK:"ff_text_tweak",FLYOVER_IMG:"flyover_image",FLYOVER_COUNT:"flyover_count",FLYOVER_CLICK:"flyover_click",FONT_URL:"font_url",FONT_MAP:"font_map",IMG_TAG:"pimgtag",INIT_LATENCY:"initiation_latency",IS_TRECS:"is_trecs",LOGO_TAG:"logoTAG",MAX_RECS:"max_recs",MAX_TITLE_FIELDS:"max_title_fields",MAX_TITLE_LENGTH:"max_title_length",MIN_RECS:"min_recs",POSTFIX:"postfix",PERCENT_OFF:"percent_off",PREFIX:"prefix",PRELOAD_IMG:"preloader_image",PRELOAD_LATENCY:"preload_latency",PROD_ACT_EXCLUDE:"product_action_exclusion",PROD_ACT_INCLUDE_PURCH:"product_action_include_purchased",PRODUCTS:"prods",PRODUCT_CLICK:"product_click",PRODUCT_DATA:"product_data",PROD_TAG:"prodtag",PROD_TAG_OVERRIDE:"prodtagv2",PROD_GROUP_OVERRIDE:"product_group",RATING_MIN:"rating_min",RATING_SCALE:"rating_scale",REC_TAG:"rectag",RETINA_BG:"retina_bg",SALE_PRICE:"sale_price",SALE_PRICE_OPTION:"sale_price_option",SHARPENING:"sharpening",SHOW_OVERRIDE:"show_",SMOOTHING:"smoothing",STAGE_CLICK:"stage_click",SWIPE_NEXT:"swipe_next",TEXT_COLOR_OVERRIDE:"color_",TEXT_OVERRIDE:"text_",THEME_COLOR_OVERRIDE:"theme_color",TITLE_CASE:"title_case",TRACK_DATA:"track_field_data",TRACKING:"tracking",TRANSITION_TIME:"transition_time",TRECS_FALLBACK_TAG:"trecsFallbackTag",USER_RECS_PROD_TAG:"user_recs_prodtag",VIDEO_LOOP:"video_loop",VIDEO_LOOP_IMG:"video_loop_img",VIDEO_TAG:"videoTAG",B2B_UA_TAG:"attributes_tag",B2B_AD_EID:"advertisable_eid",B2B_KEYS_EID:"user_attributes_key",B2B_KEYS_PARAM:"keys_eid",B2B_UA_ATTS:"user_attributes",B2B_TXT_AREAS:"text_areas",B2B_CLICK_TAGS:"click_tags",B2B_BAD_ATTS:["unknown","undefined","null"],TYPE_DYNAMIC:"dynamic",TYPE_DYNAMIC_TWA:"dynamicAdBuilder",TYPE_DYNAMIC_TESTS:"dynamicUnitTests",TYPE_PERSONALIZED:"personalized",EVENT_INIT:"liquid_init",EVENT_OK:"liquid_ok",EVENT_CLICK:"liquid_click",EVENT_HOVER:"liquid_hover",EVENT_ENGAGEMENT:"liquid_act",EVENT_FAILURE:"liquid_error",EVENT_IMPRESSION:"liquid_impression",EVENT_PERS_IMPRESSION:"personalized_impression",EVENT_PERS_CLICK:"personalized_click",EVENT_PERS_FAILURE:"personalized_error",EVENT_TRECS_FALLBACK:"trecs_fallback",EVENT_TRECS_OK:"trecs_ok",FAIL_LOAD_CREATIVE:"1000",FAIL_LOAD_RECS:"1001",FAIL_LATENCY:"1002",FAIL_LOW_RECS:"1003",FAIL_LOW_PICS:"1004",FAIL_LOAD_CODE:"1005",FAIL_UNSUPPORTED:"1006",FAIL_LOAD_ATTRS:"1007",SALE_PRICE_OPTION_NONE:"0",SALE_PRICE_OPTION_PRICE:"1",SALE_PRICE_OPTION_SALE_PRICE:"2",SALE_PRICE_OPTION_PERCENT_OFF:"3",IDENTITY:"identity",USER_RECS_INCLUDE:["identity","top_products","random"],USER_RECS_SRC_VIEWS:"views",FONT_LOADER_URL:"://ajax.googleapis.com/ajax/libs/webfont/1.5.6/webfont.js",ADROLL_FONT_CSS:"https://s.adroll.com/liquidads/html5/fonts/",SENTRY_IGNORE_ERRS:["dsc.gotoAndPlay is not a function","TypeError: undefined is not a function","TypeError: 'undefined' is not an object","TypeError: Cannot read property 'pause' of null","TypeError: Cannot read property 'resume' of null","Unable to get property 'pause' of undefined or null reference","Unable to get property 'resume' of undefined or null reference","timer.pause is not a function","timer.resume is not a function","Cannot read property 'player' of undefined","undefined: TypeError: 'undefined' is not a function (evaluating 'dsc.gotoAndPlay(0)')","TypeError: Object doesn't support property or method 'gotoAndPlay'","Object [object Object] has no method 'gotoAndPlay'","Error: Not enough storage is available to complete this operation.","Cannot read property 'gotoAndPlay' of undefined","Cannot read property 'button' of undefined","Access is denied","NS_ERROR_FAILURE","この操作を完了するのに十分な記憶域がありません。"]};(function(){var logic=AdRollLiquidAds;var PARAMETERS=logic.CONSTANTS;var prodList=[];var recList=[];var actionMap={};var purchaseActionHashes={purchased:"81c9d26a",purchase:"85dbdb21",Purchased:"ce4ee016"};var hashedActions={"9df3b01c":"access","70cd6fac":"AddToCart","7c7c10f6":"addtocart","0aee0d0c":"add_to_cart",caf9b6b9:"info","54013ba6":"cart","81c9d26a":"purchased","85dbdb21":"purchase",ce4ee016:"Purchased"};var imgsLoaded=false;var minRecs=1;var maxRecs=40;var initLoadStats={img_load_att:0,img_load_suc:0,valid_prods:[],valid_recs:[],invalid_recs:[],start_time:new Date,rec_load_time:null};var cookieBucket;var experiment;var productStreamEid;var sourceOverride;var isUserLevelRecs;var isTrecsTest;var loadCount=0;var loadTarget;function Recommendation(data){this.data=data;this.id=data.idhash;this.clientId=data.id;this.confidence=parseFloat(data.confidence);this.url=data.url;this.source=data.source;this.imageMap={};this.textMap={};this.loading=false;this.action="";this.loadTime=new Date;this.resolveImageKey=function(){var key="a/image";var stage=logic.app.getStage();if(!stage){logic.tracking.sentryMessage("ERROR: Null stage in resolveImageKey().");return key}var stageWidth=stage.canvas.width/stage.scaleX;var stageHeight=stage.canvas.height/stage.scaleY;if(this.data["a/skyscraper"]!==undefined&&stageWidth==160&&stageHeight==600){key="a/skyscraper"}else if(this.data["a/leaderboard"]!==undefined&&stageWidth==728&&stageHeight==90){key="a/leaderboard"}else if(this.data["a/halfpage"]!==undefined&&stageWidth==300&&stageHeight==600){key="a/halfpage"}else if(this.data["a/billboard"]!==undefined&&stageWidth==970&&stageHeight==250){key="a/billboard"}return key};this.imageKey=this.resolveImageKey();this.imageCount=1;for(var i=2;i<10;i++){if(this.data[this.imageKey+i]!=undefined){this.imageCount++}else{break}}Recommendation.prototype.id=this.id;Recommendation.prototype.loading=this.loading;Recommendation.prototype.loadTime=this.loadTime;Recommendation.prototype.confidence=this.confidence;Recommendation.prototype.source=this.source;Recommendation.prototype.imageCount=this.imageCount;Recommendation.prototype.getRawData=function(param){return this.data[param]};Recommendation.prototype.getProductUrl=function(){if(initvars[PARAMETERS.PRODUCT_CLICK]!==undefined){var override=initvars[PARAMETERS.PRODUCT_CLICK];if(override.indexOf("http")==0){return override}if(this.data[override]!==undefined&&this.data[override].indexOf("http")==0){return this.data[override]}}else if(initvars[PARAMETERS.POSTFIX]!==undefined){return this.url+initvars[PARAMETERS.POSTFIX]}return this.url};Recommendation.prototype.getImageUrl=function(idx){var key=this.imageKey;if(idx>1)key+=idx;if(this.data[key]!==undefined){return this.data[key]}else{return initvars[PARAMETERS.IMG_TAG]+"/"+this.id}};Recommendation.prototype.showSalePrice=function(){if(this.data["sale_price"]!==undefined){var price=this.data["price"];var sale_price=this.data["sale_price"];if(this.data["price_normalized"]&&this.data["sale_price_normalized"]){price=this.data["price_normalized"];sale_price=this.data["sale_price_normalized"]}if(!price||!sale_price)return false;if(logic.utils.parse_money(sale_price)<logic.utils.parse_money(price)){return true}}return false};Recommendation.prototype.setImage=function(img,idx){this.imageMap[idx]=img};Recommendation.prototype.getImage=function(idx){return this.imageMap[idx]};Recommendation.prototype.setText=function(fld,props){this.textMap[fld]=props};Recommendation.prototype.getText=function(fld){return this.textMap[fld]};Recommendation.prototype.setAction=function(act){this.action=act};Recommendation.prototype.getAction=function(){return this.action};Recommendation.prototype.readyToLoad=function(){return this.loading==false&&this.areAllImagesLoaded()==false};Recommendation.prototype.areAllImagesLoaded=function(){for(var i=1;i<=this.imageCount;i++){if(this.imageMap[i]===undefined){return false}}return true}}function isRecValid(data){if(data["a/image"]==undefined){initLoadStats.invalid_recs.push(data["idhash"]);return false}if(initvars[PARAMETERS.PRODUCTS]!==undefined){if(initvars[PARAMETERS.PRODUCTS].indexOf(data["idhash"])==-1)return false}var paramName;var filterPattern=new RegExp("(include|exclude)_(.+)$","i");for(paramName in initvars){var matches=filterPattern.exec(paramName);if(matches){var action=matches[1].toLowerCase();var fieldName=matches[2].toLowerCase();var pattern=initvars[paramName];var regExp=new RegExp(pattern,"i");var value=data[fieldName];var filterMatches=regExp.test(value);if(action=="include"&&!filterMatches){logic.utils.log(">> Removing recommendation because "+value+" didn't match "+fieldName+" INCLUDE filter: "+pattern);initLoadStats.invalid_recs.push(data["idhash"]);return false}else if(action=="exclude"&&filterMatches){logic.utils.log(">> Removing recommendation because "+value+" matched "+fieldName+" EXCLUDE filter: "+pattern);initLoadStats.invalid_recs.push(data["idhash"]);return false}}}if(data["expire_at"]!=undefined){var expireDate=logic.utils.parseTimestamp(data["expire_at"]);var currentDate=logic.utils.getUTCDate(new Date);if(expireDate.getTime()<currentDate.getTime()){initLoadStats.invalid_recs.push(data["idhash"]);return false}}initLoadStats.valid_recs.push(data["idhash"]);return true}function normalizeProductData(data){var productData={id:null,group:null,action:null};if(typeof data==="string"){productData.id=data;if(data.indexOf("/")!==-1){productData.id=data.substring(data.indexOf("/")+1);productData.group=data.substring(0,data.indexOf("/"))}}else if(data.product_id!==undefined){productData.id=data.product_id;productData.group=data.product_group!==undefined?data.product_group:null;productData.action=data.product_action!==undefined?data.product_action.toLowerCase():null}if(initvars[PARAMETERS.PROD_GROUP_OVERRIDE]!==undefined){productData.group=initvars[PARAMETERS.PROD_GROUP_OVERRIDE]}return productData}function skipPurchasedProduct(product){return(product.action==purchaseActionHashes["purchased"]||product.action==purchaseActionHashes["purchase"]||product.action==purchaseActionHashes["Purchased"])&&logic.utils.getBool(initvars[PARAMETERS.PROD_ACT_INCLUDE_PURCH])==false}function pickExperiment(cookieBucket){var experiments=initvars[PARAMETERS.EXP_CONFIGS];var eligibleExperiments=[];if(experiments==undefined){return undefined}for(var i=0;i<experiments.length;i++){if(cookieBucket>=experiments[i].bucket_min&&cookieBucket<=experiments[i].bucket_max){eligibleExperiments.push(experiments[i])}}return eligibleExperiments[0]}function overrideInitvars(experiment){if(experiment&&experiment.params){for(var key in experiment.params){if(initvars.hasOwnProperty(key)){initvars[key]=experiment.params[key]}}}}function useTrecs(advertisableEid,productsViewed){var onTrecsSuccess=function(data){logic.tracking.logEvent(logic.CONSTANTS.EVENT_TRECS_OK,{});var metadata=data.meta;if(metadata.hasOwnProperty("valid_prods")){initLoadStats.valid_prods=metadata.valid_prods}if(metadata.hasOwnProperty("invalid_recs")){initLoadStats.invalid_recs=metadata.invalid_recs}var trecsRecs=data.recs;for(var index=0;index<trecsRecs.length;index++){var rec=new Recommendation(trecsRecs[index]);recList.push(rec);initLoadStats.valid_recs.push(rec.id)}var numRecs=recList.length;if(numRecs<minRecs){var itemsToDupe=minRecs-numRecs;for(var i=0;i<itemsToDupe;i++){recList.push(new Recommendation(recList[i%numRecs].data))}}loadProductImages()};var onTrecsFail=function(data){var errorCode;var errorMessage;var response=data.response;if(response){var parsedResponse=JSON.parse(data.response);var meta=parsedResponse.hasOwnProperty("meta")?parsedResponse.meta:null;if(meta){errorCode=parsedResponse.meta.error_code;errorMessage=parsedResponse.meta.error_message}}var params={};if(errorCode&&errorMessage){logic.utils.log(">> ERROR: Trecs failed: "+errorMessage+". Grabbing fallback products from s3.");params={error_code:errorCode,error_message:errorMessage}}logic.tracking.logEvent(logic.CONSTANTS.EVENT_TRECS_FALLBACK,params);var defaultProducts=createTrecsDefaults(productsViewed[0]);loadTarget=Math.min(defaultProducts.length,maxRecs);var loadFallbackRecs=function(prod){var fallbackRecsTag=initvars[PARAMETERS.TRECS_FALLBACK_TAG];var url=prod.group!==null?fallbackRecsTag+"/"+prod.group:fallbackRecsTag;url+="/"+prod.id+(prod.action!==null?"/"+prod.action:"");initLoadStats.valid_prods.push(prod.id);logic.utils.loadJSON(url,onRecsLoaded,onRecsError,false)};defaultProducts.forEach(loadFallbackRecs)};var initvarsJSON=encodeURIComponent(JSON.stringify(initvars));var url=initvars[PARAMETERS.BASE_TRECS_TAG]+"?advertisable_eid="+advertisableEid+"&initvars="+initvarsJSON+"&min_products="+minRecs;logic.utils.loadJSON(url,onTrecsSuccess,onTrecsFail,true)}function createTrecsDefaults(firstProd){var defaultProducts=[];var defaultProd={id:"default",group:firstProd.hasOwnProperty("product_group")?firstProd.product_group:null,action:null};if(initvars[PARAMETERS.PROD_GROUP_OVERRIDE]!==undefined){defaultProd.group=initvars[PARAMETERS.PROD_GROUP_OVERRIDE]}defaultProducts.push(defaultProd);return defaultProducts}function createProductList(products){var recTag=experiment!==undefined?initvars[PARAMETERS.BASE_REC_TAG]+"/"+experiment.test_stream_eid:initvars[PARAMETERS.REC_TAG];productStreamEid=recTag.substring(recTag.lastIndexOf("/")+1);var prodMap={};for(var index=0;index<products.length;index++){var product=normalizeProductData(products[index]);if(product.action!==null){var action=hashedActions[product.action]!==undefined?hashedActions[product.action]:product.action;if(actionMap[action]===undefined)actionMap[action]=[];actionMap[action].push(product.id);actionMap[product.id]=action}if(prodMap[product.id]!==undefined)continue;if(skipPurchasedProduct(product))continue;prodMap[product.id]=true;if(product.id=="default"&&product.group==null&&prodList.length>0&&prodList[0].group!=null){product.group=prodList[0].group}prodList.push(product)}loadTarget=Math.min(prodList.length,maxRecs);var loadRecs=function(prod){var url=prod.group!==null?recTag+"/"+prod.group:recTag;url+="/"+prod.id+(prod.action!==null?"/"+prod.action:"");initLoadStats.valid_prods.push(prod.id);logic.utils.loadJSON(url,onRecsLoaded,onRecsError,false)};initLoadStats.rec_load_time=new Date;prodList.forEach(loadRecs)}function onRecsError(data){logic.utils.log(">> ERROR: Rec load failure!");loadTarget--;checkLoadSuccess()}function onRecsLoaded(data){if(logic.app.isFailed())return;for(var index=0;index<data.length;index++){var recData=data[index];if(isRecValid(recData)){var rec=new Recommendation(recData);if(isUserLevelRecs&&sourceOverride!==PARAMETERS.USER_RECS_SRC_VIEWS){if(PARAMETERS.USER_RECS_INCLUDE.indexOf(rec.source)<0)continue;if(rec.source===PARAMETERS.IDENTITY){rec.source=sourceOverride}}recList.push(rec);if(actionMap[rec.id]!==undefined){rec.setAction(actionMap[rec.id])}}}loadCount++;checkLoadSuccess()}function checkLoadSuccess(){if(logic.app.isFailed())return;if(loadTarget==0){logic.app.onFail(logic.CONSTANTS.FAIL_LOW_RECS,"ERROR: Not enough recs loaded.")}else if(loadCount==loadTarget){recList.sort(function(a,b){return b.confidence-a.confidence});var uniqueIdTable={};var sortedArray=[];var loadTimeArray=[];var dedupe=function(rec){if(uniqueIdTable[rec.id]==undefined&&checkForActionExclusion(rec.id)==false){sortedArray.push(rec);if(initLoadStats.rec_load_time)loadTimeArray.push(rec.loadTime.getTime()-initLoadStats.rec_load_time.getTime());uniqueIdTable[rec.id]=true}};recList.forEach(dedupe);recList=sortedArray;if(loadTimeArray.length>0)initLoadStats.rec_load_time=logic.utils.getMedian(loadTimeArray);var numRecs=recList.length;if(numRecs==0){logic.app.onFail(logic.CONSTANTS.FAIL_LOW_RECS,"ERROR: Not enough recs loaded.");return}else if(numRecs<minRecs){var itemsToDupe=minRecs-numRecs;for(var i=0;i<itemsToDupe;i++){recList.push(new Recommendation(recList[i%numRecs].data))}}loadProductImages()}}function checkForActionExclusion(id){var exclusions=initvars[logic.CONSTANTS.PROD_ACT_EXCLUDE]!==undefined?initvars[logic.CONSTANTS.PROD_ACT_EXCLUDE].split(","):null;if(exclusions==null)return false;for(var x=0;x<exclusions.length;x++){var action=exclusions[x];if(actionMap[action]!==undefined&&actionMap[action].indexOf(id)!==-1){logic.utils.log(">> Removing recommendation "+id+" because product action "+action+" was excluded via param.");return true}}return false}function loadProductImages(){if(imgsLoaded==true){logic.app.startDisplay();return}var loadCount=0;var minBase=Math.max(minRecs,logic.tree.getNumImages());var loadBuffer=Math.min(minBase*2,recList.length);var onTransition=function(evt){var loadBatch=[];var loadIndex=0;for(var i=0;i<recList.length;i++){var rec=recList[i];if(rec.readyToLoad()==true){loadBatch.push(rec);loadIndex++;break}}loadIndex=0;for(i=recList.length-1;i>=0;i--){rec=recList[i];if(rec.readyToLoad()==true){loadBatch.push(rec);loadIndex++;if(loadIndex==loadBuffer)break}}loadBatch.forEach(loadRecImages)};var onImageLoad=function(rec,img,idx){initLoadStats.img_load_suc++;rec.setImage(img,idx);if(rec.areAllImagesLoaded()){rec.loading=false;loadCount++}logic.utils.log(">> Image loaded: "+loadCount+" of "+recList.length);if(loadCount===minRecs){logic.app.startDisplay();if(loadCount<recList.length){onTransition();logic.app.getRoot().addEventListener("onTransitionComplete",onTransition)}else{imgsLoaded=true}}else if(loadCount===recList.length){imgsLoaded=true;logic.app.getRoot().removeEventListener("onTransitionComplete",onTransition)}};var onImageFail=function(rec){recList.splice(recList.indexOf(rec),1);logic.utils.log(">> ERROR: Image load failed: "+rec.id);if(recList.length<minRecs){logic.app.onFail(logic.CONSTANTS.FAIL_LOW_PICS,"ERROR: Not enough images loaded.")}};var loadImage=function(rec,idx){rec.loading=true;logic.utils.loadImage(rec.getImageUrl(idx),function(img){onImageLoad(rec,img,idx)},function(xhr){onImageFail(rec)})};var loadRecImages=function(rec){if(rec.readyToLoad()==false)return;for(var i=1;i<=rec.imageCount;i++){initLoadStats.img_load_att++;loadImage(rec,i)}};recList.slice(0,loadBuffer).concat(recList.slice(-loadBuffer)).forEach(loadRecImages)}return AdRollLiquidAds.datamodel={init:function(){var recTag=initvars[PARAMETERS.REC_TAG];productStreamEid=recTag.substring(recTag.lastIndexOf("/")+1);var minProds=logic.tree.getNumImages()==2?1:logic.tree.getNumImages();minRecs=initvars[logic.CONSTANTS.MIN_RECS]!=undefined?parseInt(initvars[logic.CONSTANTS.MIN_RECS]):minProds;maxRecs=initvars[logic.CONSTANTS.MAX_RECS]!=undefined?parseInt(initvars[logic.CONSTANTS.MAX_RECS]):maxRecs;if(maxRecs<minRecs)minRecs=maxRecs=logic.tree.getNumImages();if(initvars.type==logic.CONSTANTS.TYPE_DYNAMIC_TWA){if(initvars[PARAMETERS.PRODUCT_DATA]!==undefined){logic.datamodel.initWithData(initvars[PARAMETERS.PRODUCT_DATA])}return}if(initvars[logic.CONSTANTS.DYN_VIDEO]&&logic.tree.getAssetByName("image1")===undefined){imgsLoaded=true}var productList;if(initvars[PARAMETERS.PRODUCT_DATA]!==undefined){logic.datamodel.initWithData(initvars[PARAMETERS.PRODUCT_DATA])}else{var tag=initvars[PARAMETERS.PROD_TAG_OVERRIDE]!==undefined?initvars[PARAMETERS.PROD_TAG_OVERRIDE]:initvars[PARAMETERS.PROD_TAG];var expProdTag=initvars[PARAMETERS.EXP_PROD_TAG];var url=expProdTag!==undefined?expProdTag:tag;var onLoadUserRecsSuccess=function(data){sourceOverride=data.src;productList=createProductList(data.products)};var onLoadSuccess=function(data){var products=data.products;cookieBucket=data.cookie_bucket;experiment=pickExperiment(cookieBucket);overrideInitvars(experiment);isUserLevelRecs=experiment&&experiment.params&&experiment.params.hasOwnProperty(PARAMETERS.USER_RECS_PROD_TAG);isTrecsTest=experiment&&experiment.params&&experiment.params.hasOwnProperty(PARAMETERS.IS_TRECS);logic.tracking.logEvent(logic.CONSTANTS.EVENT_INIT,{});if(isUserLevelRecs){var url=experiment.params[PARAMETERS.USER_RECS_PROD_TAG];logic.utils.loadJSON(url,onLoadUserRecsSuccess,function(xhr){logic.utils.log(">> ERROR: call to "+PARAMETERS.USER_RECS_PROD_TAG+" : "+url+" failed");logic.app.onFail(logic.CONSTANTS.FAIL_LOAD_RECS,"ERROR: Could not load products from v4 endpoint.")},true)}else if(isTrecsTest){var advertisableEid=initvars[PARAMETERS.BASE_REC_TAG].split("/")[4];useTrecs(advertisableEid,products)}else{productList=createProductList(products)}};logic.utils.loadJSON(url,onLoadSuccess,function(xhr){logic.utils.log(">> ERROR: call to "+url+" failed. Using getv3.");logic.app.onFail(logic.CONSTANTS.FAIL_LOAD_RECS,"ERROR: Could not load products from v3 endpoint.")},true)}},initWithData:function(data){if(loadCount==0){loadTarget=1;onRecsLoaded(data)}},getProdList:function(){return prodList},getRecList:function(){return recList},getMinRecs:function(){return minRecs},getMaxRecs:function(){return maxRecs},imgLoadComplete:function(){return imgsLoaded},getInitLoadStats:function(){return initLoadStats},getProductStreamEid:function(){return productStreamEid},getExperiment:function(){return experiment},getCookieBucket:function(){return cookieBucket},isTrecs:function(){return isTrecsTest},_test_:{isRecValid:isRecValid}}})();(function(){var logic=AdRollLiquidAds;function Resize(widthOriginal,heightOriginal,targetWidth,targetHeight,resizeCallback){this.widthOriginal=Math.abs(parseInt(widthOriginal)||0);this.heightOriginal=Math.abs(parseInt(heightOriginal)||0);this.targetWidth=Math.abs(parseInt(targetWidth)||0);this.targetHeight=Math.abs(parseInt(targetHeight)||0);this.resizeCallback=typeof resizeCallback=="function"?resizeCallback:function(returnedArray){};this.targetWidthMultipliedByChannels=this.targetWidth*4;this.originalWidthMultipliedByChannels=this.widthOriginal*4;this.originalHeightMultipliedByChannels=this.heightOriginal*4;this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal;this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight;this.initialize()}Resize.prototype.initialize=function(){if(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0){this.configurePasses()}};Resize.prototype.configurePasses=function(){if(this.widthOriginal==this.targetWidth){this.resizeWidth=this.bypassResizer}else{this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth;if(this.ratioWeightWidthPass<1){this.initializeFirstPassBuffers(true);this.resizeWidth=this.resizeWidthInterpolatedRGBA}else{this.initializeFirstPassBuffers(false);this.resizeWidth=this.resizeWidthRGBA}}if(this.heightOriginal==this.targetHeight){this.resizeHeight=this.bypassResizer}else{this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight;if(this.ratioWeightHeightPass<1){this.initializeSecondPassBuffers(true);this.resizeHeight=this.resizeHeightInterpolated}else{this.initializeSecondPassBuffers(false);this.resizeHeight=this.resizeHeightRGBA}}};Resize.prototype.resizeWidthRGBA=function(buffer){var ratioWeight=this.ratioWeightWidthPass;var ratioWeightDivisor=1/ratioWeight;var weight=0;var amountToNext=0;var actualPosition=0;var currentPosition=0;var line=0;var pixelOffset=0;var outputOffset=0;var nextLineOffsetOriginalWidth=this.originalWidthMultipliedByChannels-3;var nextLineOffsetTargetWidth=this.targetWidthMultipliedByChannels-3;var output=this.outputWidthWorkBench;var outputBuffer=this.widthBuffer;do{for(line=0;line<this.originalHeightMultipliedByChannels;){output[line++]=0;output[line++]=0;output[line++]=0;output[line++]=0}weight=ratioWeight;do{amountToNext=1+actualPosition-currentPosition;if(weight>=amountToNext){for(line=0,pixelOffset=actualPosition;line<this.originalHeightMultipliedByChannels;pixelOffset+=nextLineOffsetOriginalWidth){output[line++]+=buffer[pixelOffset++]*amountToNext;output[line++]+=buffer[pixelOffset++]*amountToNext;output[line++]+=buffer[pixelOffset++]*amountToNext;output[line++]+=buffer[pixelOffset]*amountToNext}currentPosition=actualPosition=actualPosition+4;weight-=amountToNext}else{for(line=0,pixelOffset=actualPosition;line<this.originalHeightMultipliedByChannels;pixelOffset+=nextLineOffsetOriginalWidth){output[line++]+=buffer[pixelOffset++]*weight;output[line++]+=buffer[pixelOffset++]*weight;output[line++]+=buffer[pixelOffset++]*weight;output[line++]+=buffer[pixelOffset]*weight}currentPosition+=weight;break}}while(weight>0&&actualPosition<this.originalWidthMultipliedByChannels);for(line=0,pixelOffset=outputOffset;line<this.originalHeightMultipliedByChannels;pixelOffset+=nextLineOffsetTargetWidth){outputBuffer[pixelOffset++]=output[line++]*ratioWeightDivisor;outputBuffer[pixelOffset++]=output[line++]*ratioWeightDivisor;outputBuffer[pixelOffset++]=output[line++]*ratioWeightDivisor;outputBuffer[pixelOffset]=output[line++]*ratioWeightDivisor}outputOffset+=4}while(outputOffset<this.targetWidthMultipliedByChannels);return outputBuffer};Resize.prototype.resizeWidthInterpolatedRGBA=function(buffer){var ratioWeight=this.ratioWeightWidthPass;var weight=0;var finalOffset=0;var pixelOffset=0;var firstWeight=0;var secondWeight=0;var outputBuffer=this.widthBuffer;for(var targetPosition=0;weight<1/3;targetPosition+=4,weight+=ratioWeight){for(finalOffset=targetPosition,pixelOffset=0;finalOffset<this.widthPassResultSize;pixelOffset+=this.originalWidthMultipliedByChannels,finalOffset+=this.targetWidthMultipliedByChannels){outputBuffer[finalOffset]=buffer[pixelOffset];outputBuffer[finalOffset+1]=buffer[pixelOffset+1];outputBuffer[finalOffset+2]=buffer[pixelOffset+2];outputBuffer[finalOffset+3]=buffer[pixelOffset+3]}}weight-=1/3;for(var interpolationWidthSourceReadStop=this.widthOriginal-1;weight<interpolationWidthSourceReadStop;targetPosition+=4,weight+=ratioWeight){secondWeight=weight%1;firstWeight=1-secondWeight;for(finalOffset=targetPosition,pixelOffset=Math.floor(weight)*4;finalOffset<this.widthPassResultSize;pixelOffset+=this.originalWidthMultipliedByChannels,finalOffset+=this.targetWidthMultipliedByChannels){outputBuffer[finalOffset]=buffer[pixelOffset]*firstWeight+buffer[pixelOffset+4]*secondWeight;outputBuffer[finalOffset+1]=buffer[pixelOffset+1]*firstWeight+buffer[pixelOffset+5]*secondWeight;outputBuffer[finalOffset+2]=buffer[pixelOffset+2]*firstWeight+buffer[pixelOffset+6]*secondWeight;outputBuffer[finalOffset+3]=buffer[pixelOffset+3]*firstWeight+buffer[pixelOffset+7]*secondWeight}}for(interpolationWidthSourceReadStop=this.originalWidthMultipliedByChannels-4;targetPosition<this.targetWidthMultipliedByChannels;targetPosition+=4){for(finalOffset=targetPosition,pixelOffset=interpolationWidthSourceReadStop;finalOffset<this.widthPassResultSize;pixelOffset+=this.originalWidthMultipliedByChannels,finalOffset+=this.targetWidthMultipliedByChannels){outputBuffer[finalOffset]=buffer[pixelOffset];outputBuffer[finalOffset+1]=buffer[pixelOffset+1];outputBuffer[finalOffset+2]=buffer[pixelOffset+2];outputBuffer[finalOffset+3]=buffer[pixelOffset+3]}}return outputBuffer};Resize.prototype.resizeHeightInterpolated=function(buffer){var ratioWeight=this.ratioWeightHeightPass;var weight=0;var finalOffset=0;var pixelOffset=0;var pixelOffsetAccumulated=0;var pixelOffsetAccumulated2=0;var firstWeight=0;var secondWeight=0;var outputBuffer=this.heightBuffer;for(;weight<1/3;weight+=ratioWeight){for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;){outputBuffer[finalOffset++]=Math.round(buffer[pixelOffset++])}}weight-=1/3;for(var interpolationHeightSourceReadStop=this.heightOriginal-1;weight<interpolationHeightSourceReadStop;weight+=ratioWeight){secondWeight=weight%1;firstWeight=1-secondWeight;pixelOffsetAccumulated=Math.floor(weight)*this.targetWidthMultipliedByChannels;pixelOffsetAccumulated2=pixelOffsetAccumulated+this.targetWidthMultipliedByChannels;for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;++pixelOffset){outputBuffer[finalOffset++]=Math.round(buffer[pixelOffsetAccumulated++]*firstWeight+buffer[pixelOffsetAccumulated2++]*secondWeight)}}while(finalOffset<this.finalResultSize){for(pixelOffset=0,pixelOffsetAccumulated=interpolationHeightSourceReadStop*this.targetWidthMultipliedByChannels;pixelOffset<this.targetWidthMultipliedByChannels;++pixelOffset){outputBuffer[finalOffset++]=Math.round(buffer[pixelOffsetAccumulated++])}}return outputBuffer};Resize.prototype.resizeHeightRGBA=function(buffer){var ratioWeight=this.ratioWeightHeightPass;var ratioWeightDivisor=1/ratioWeight;var weight=0;var amountToNext=0;var actualPosition=0;var currentPosition=0;var pixelOffset=0;var outputOffset=0;var output=this.outputHeightWorkBench;var outputBuffer=this.heightBuffer;do{for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;){output[pixelOffset++]=0;output[pixelOffset++]=0;output[pixelOffset++]=0;output[pixelOffset++]=0}weight=ratioWeight;do{amountToNext=1+actualPosition-currentPosition;if(weight>=amountToNext){for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;){output[pixelOffset++]+=buffer[actualPosition++]*amountToNext;output[pixelOffset++]+=buffer[actualPosition++]*amountToNext;output[pixelOffset++]+=buffer[actualPosition++]*amountToNext;output[pixelOffset++]+=buffer[actualPosition++]*amountToNext}currentPosition=actualPosition;weight-=amountToNext}else{for(pixelOffset=0,amountToNext=actualPosition;pixelOffset<this.targetWidthMultipliedByChannels;){output[pixelOffset++]+=buffer[amountToNext++]*weight;output[pixelOffset++]+=buffer[amountToNext++]*weight;output[pixelOffset++]+=buffer[amountToNext++]*weight;output[pixelOffset++]+=buffer[amountToNext++]*weight}currentPosition+=weight;break}}while(weight>0&&actualPosition<this.widthPassResultSize);for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;){outputBuffer[outputOffset++]=Math.round(output[pixelOffset++]*ratioWeightDivisor);outputBuffer[outputOffset++]=Math.round(output[pixelOffset++]*ratioWeightDivisor);outputBuffer[outputOffset++]=Math.round(output[pixelOffset++]*ratioWeightDivisor);outputBuffer[outputOffset++]=Math.round(output[pixelOffset++]*ratioWeightDivisor)}}while(outputOffset<this.finalResultSize);return outputBuffer};Resize.prototype.resize=function(buffer){this.resizeCallback(this.resizeHeight(this.resizeWidth(buffer)))};Resize.prototype.bypassResizer=function(buffer){return buffer};Resize.prototype.initializeFirstPassBuffers=function(BILINEARAlgo){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize);if(!BILINEARAlgo){this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels)}};Resize.prototype.initializeSecondPassBuffers=function(BILINEARAlgo){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize);if(!BILINEARAlgo){this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels)}};Resize.prototype.generateFloatBuffer=function(bufferLength){try{return new Float32Array(bufferLength)}catch(error){return[]}};Resize.prototype.generateUint8Buffer=function(bufferLength){try{return new Uint8Array(bufferLength)}catch(error){return[]}};return AdRollLiquidAds.processing={resize_image:function(img,scale){var srcCanvas=document.createElement("canvas"),srcContext=srcCanvas.getContext("2d");srcCanvas.width=img.width;srcCanvas.height=img.height;srcContext.drawImage(img,0,0,img.width,img.height,0,0,img.width,img.height);var dataToScale=srcContext.getImageData(0,0,img.width,img.height).data;var destCanvas=document.createElement("canvas"),destContext=destCanvas.getContext("2d");destCanvas.width=img.width*scale;destCanvas.height=img.height*scale;var updateCanvas=function(ctx,imgBuffer,frameBuffer){var data=imgBuffer.data;var length=data.length;for(var x=0;x<length;++x){data[x]=frameBuffer[x]&255;

}ctx.putImageData(imgBuffer,0,0)};var resizeLogic=new Resize(img.width,img.height,destCanvas.width,destCanvas.height,function(buffer){updateCanvas(destContext,destContext.createImageData(destCanvas.width,destCanvas.height),buffer)});resizeLogic.resize(dataToScale);return destCanvas},sharpen_image:function(cvs,mix){var weights=[0,-1,0,-1,5,-1,0,-1,0],ctx=cvs.getContext("2d"),katet=Math.round(Math.sqrt(weights.length)),half=katet*.5|0,w=cvs.width,h=cvs.height,dstData=ctx.createImageData(w,h),dstBuff=dstData.data,srcBuff=ctx.getImageData(0,0,w,h).data,y=h,x;while(y--){x=w;while(x--){var sy=y,sx=x,dstOff=(y*w+x)*4,r=0,g=0,b=0,a=0;for(var cy=0;cy<katet;cy++){for(var cx=0;cx<katet;cx++){var scy=sy+cy-half;var scx=sx+cx-half;if(scy>=0&&scy<h&&scx>=0&&scx<w){var srcOff=(scy*w+scx)*4;var wt=weights[cy*katet+cx];r+=srcBuff[srcOff]*wt;g+=srcBuff[srcOff+1]*wt;b+=srcBuff[srcOff+2]*wt;a+=srcBuff[srcOff+3]*wt}}}dstBuff[dstOff]=r*mix+srcBuff[dstOff]*(1-mix);dstBuff[dstOff+1]=g*mix+srcBuff[dstOff+1]*(1-mix);dstBuff[dstOff+2]=b*mix+srcBuff[dstOff+2]*(1-mix);dstBuff[dstOff+3]=srcBuff[dstOff+3]}}ctx.putImageData(dstData,0,0)},resolveTextSize:function(field,textValue){var testField=field.clone();var checkResizeText=function(){try{var metrics=field.getMetrics()}catch(err){logic.tracking.sentryException(err,{tags:{field:field.font,action:"get_metrics"}});return}var shrinkPointSize=function(){var pointSize=parseFloat(logic.utils.parse_px(field.font));field.font=field.font.replace(pointSize,pointSize-1);logic.utils.log(">> "+field.name+":: Shrunk point size: "+pointSize+" to "+(pointSize-1));return pointSize-1};var fieldHeight=field["designHeight"]||metrics.height;var hasJapaneseChars=logic.utils.hasJapaneseCharacters(textValue);if(metrics.width>field.lineWidth||hasJapaneseChars&&field.name.indexOf("price")<0){var pointSize=parseFloat(logic.utils.parse_px(field.font));var charsPerRow=Math.floor(100/pointSize)*(metrics.width/100);var numRows=Math.ceil(fieldHeight/(pointSize*1.25));if(!hasJapaneseChars||textValue.length>Math.round(charsPerRow*numRows)){var size=shrinkPointSize();if(size>=10){return checkResizeText()}}if(fieldHeight<pointSize*1.75&&(!hasJapaneseChars||field.name.indexOf("price")>=0)){field.maxWidth=field.lineWidth}else{testField.text="";var fieldPointSize=parseFloat(logic.utils.parse_px(field.font));var testFieldPointSize=parseFloat(logic.utils.parse_px(testField.font));testField.font=testField.font.replace(testFieldPointSize,fieldPointSize-1);if(testField.getMetrics().width<testField.lineWidth){if(hasJapaneseChars){testField.text+=String.fromCharCode(12366)}else{testField.text+="W"}}var lineLength=Math.floor(testField.lineWidth/testField.getMetrics().width);var lineList=[];var cursorIdx=0;while(cursorIdx<textValue.length&&(numRows==1||lineList.length<numRows-1)){var lengthTarget=cursorIdx+lineLength;var breakChars=["-","/","_","+","—"];for(var index=0;index<breakChars.length;index++){var breakChar=breakChars[index];if(textValue.indexOf(breakChar,cursorIdx)!=-1&&logic.utils.is_num_in_range(textValue.indexOf(breakChar,cursorIdx),lengthTarget,2)){lengthTarget=textValue.indexOf(breakChar,cursorIdx);break}}lineList.push(textValue.slice(cursorIdx,lengthTarget));cursorIdx+=lineLength}textValue=lineList.join("\n");if(lineList.length>0&&field.text.length>textValue.length-lineList.length+1){var lastLine=lineList[lineList.length-1];var removeCharCounter=0;while("."===testField.text.substring(testField.text.length-1)){removeCharCounter+=1}lastLine=lastLine.substring(0,lastLine.length-removeCharCounter-3);lastLine=lastLine.trim()+"...";lineList[lineList.length-1]=lastLine;textValue=lineList.join("\n")}field.text=textValue}}var resolveTextHeight=function(){if(field.getMetrics().height>fieldHeight){var size=shrinkPointSize();if(size>=10){resolveTextHeight()}else return}};resolveTextHeight()};checkResizeText()},scanTimeline:function(node,mapAsset){for(var index=0;index<node.getNumChildren();index++){var obj=node.getChildAt(index);var isCustomizable=false;if(!obj.name)continue;if(obj instanceof logic.createJS.MovieClip||obj instanceof logic.createJS.Container){if(obj.name.indexOf("image")!=-1){}else{if(obj["useAsButton"])logic.timeline.customButton(obj);if(logic.utils.stripAssetIndex(obj.name)=="button"||logic.utils.stripAssetIndex(obj.name)=="text"){if(logic.touch)logic.touch.product(obj);obj.tickEnabled=obj.tickChildren=false}else if(obj.hitArea||obj["useAsButton"]){if(logic.touch)logic.touch.nav(obj);if(!obj["useAsButton"])obj.tickEnabled=obj.tickChildren=false}}if(obj.shape&&obj.shape["drawPath"]){logic.utils.log(">> Customizable shape found in: "+obj.name+" "+obj);isCustomizable=true}mapAsset(obj,isCustomizable);logic.processing.scanTimeline(obj,mapAsset)}else if(obj instanceof logic.createJS.Text){var families=logic.utils.getWebFontFamilies();if(families!=null){var setFont=function(fld,wt,fam){if(fld.font.toLowerCase().indexOf("italic")!=-1){wt+=" italic"}fld.font=wt+" "+logic.utils.parse_px(fld.font)+"px "+"'"+fam+"'"};for(var f=0;f<families.length;f++){var family=families[f].split(":");if(!family[1]||obj["designFont"])continue;var raw=obj.font.indexOf("'")!=-1?obj.font.match(/'(.*?)'/)[1]:obj.font;var name=family[0].replace(/\+/g," ");var weights=family[1].split(",");if(initvars[logic.CONSTANTS.FONT_MAP]!==undefined&&initvars[logic.CONSTANTS.FONT_MAP][raw]!==undefined){setFont(obj,initvars[logic.CONSTANTS.FONT_MAP][raw].slice(0,3),name)}else if(obj.font.toLowerCase().indexOf(name.toLowerCase())!=-1){var getWeight=function(wts){var len=wts.length;for(var i=0;i<len;i++){if(logic.utils.array_contains(weights,wts[i]))return wts[i]}return null};var weight=null;if(obj.font.toLowerCase().indexOf("thin")!=-1||obj.font.toLowerCase().indexOf("extra light")!=-1||obj.font.toLowerCase().indexOf("extra-light")!=-1){weight=getWeight(["100","200"])}else if(obj.font.toLowerCase().indexOf("light")!=-1){weight=getWeight(["200","300"])}else if(obj.font.toLowerCase().indexOf("black")!=-1||obj.font.toLowerCase().indexOf("heavy")!=-1){weight=getWeight(["800","900"])}else if(obj.font.toLowerCase().indexOf("semibold")!=-1||obj.font.toLowerCase().indexOf("medium")!=-1){weight=getWeight(["500","600"])}else if(obj.font.toLowerCase().indexOf("bold")!=-1){weight=getWeight(["700","800","900"])}if(!weight)weight="400";setFont(obj,weight,name);obj.set({designFont:obj.font,fieldId:"_"+Math.random()})}}logic.utils.log(">> Set custom font for "+obj.name+obj["fieldId"]+": "+obj.font)}else{obj.set({designFont:obj.font,fieldId:"_"+Math.random()})}var xTweak,yTweak;if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){xTweak=0;yTweak=.3;if(initvars[logic.CONSTANTS.FF_TEXT_TWEAK]!==undefined){if(initvars[logic.CONSTANTS.FF_TEXT_TWEAK].indexOf(",")!=-1){xTweak=parseFloat(initvars[logic.CONSTANTS.FF_TEXT_TWEAK].substring(0,initvars[logic.CONSTANTS.FF_TEXT_TWEAK].indexOf(",")));yTweak=parseFloat(initvars[logic.CONSTANTS.FF_TEXT_TWEAK].substring(initvars[logic.CONSTANTS.FF_TEXT_TWEAK].indexOf(",")+1))}else{yTweak=parseFloat(initvars[logic.CONSTANTS.FF_TEXT_TWEAK])}}}else if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&initvars[logic.CONSTANTS.CHR_TEXT_TWEAK]!==undefined){xTweak=parseFloat(initvars[logic.CONSTANTS.CHR_TEXT_TWEAK].substring(0,initvars[logic.CONSTANTS.CHR_TEXT_TWEAK].indexOf(",")));yTweak=parseFloat(initvars[logic.CONSTANTS.CHR_TEXT_TWEAK].substring(initvars[logic.CONSTANTS.CHR_TEXT_TWEAK].indexOf(",")+1))}if(xTweak!==undefined)obj.x+=obj.lineHeight*xTweak;if(yTweak!==undefined)obj.y+=obj.lineHeight*yTweak;if(initvars[logic.CONSTANTS.TEXT_COLOR_OVERRIDE+logic.utils.stripAssetIndex(obj.name)]){obj.color="#"+initvars[logic.CONSTANTS.TEXT_COLOR_OVERRIDE+logic.utils.stripAssetIndex(obj.name)]}if(!obj["designFont"])obj.set({designFont:obj.font});mapAsset(obj);obj.tickEnabled=obj.tickChildren=false}}}}})();(function(){var logic=AdRollLiquidAds;var assetMap=[];var numImages=0;var customizable=[];function checkForStaticText(obj){return obj instanceof logic.createJS.Text&&initvars[logic.CONSTANTS.TEXT_OVERRIDE+obj.name]!==undefined}function placeImage(cont,rec){var imageIndex=1;if(cont.name.indexOf("_")!=-1){if(rec.imageCount>1){imageIndex=parseFloat(cont.name.substring(cont.name.indexOf("_")+1));cont.visible=true}else{cont.visible=false;return}}var img=rec.getImage(imageIndex);if(!img)return;var bitmap;if(img instanceof HTMLImageElement){bitmap=logic.tree.setImage(img,cont);rec.setImage(bitmap,imageIndex)}else{bitmap=img.clone()}if(cont.getNumChildren()>0)cont.removeChildAt(0);cont.addChild(bitmap)}function placeVideo(cont,rec){var assetIndex=logic.utils.getAssetIndex(cont.name);var onVideoError=function(evt){if(video){video.shutdown();video=null}if(rec.getImage(assetIndex)!==undefined){placeImage(cont,rec);return}var imgUrl=initvars[logic.CONSTANTS.DYN_VIDEO_IMG]?rec.getRawData(initvars[logic.CONSTANTS.DYN_VIDEO_IMG]):rec.getImageUrl(assetIndex);logic.utils.loadImage(imgUrl,function(img){rec.setImage(img,assetIndex);placeImage(cont,rec)},function(xhr){logic.app.onFail(logic.CONSTANTS.FAIL_LOW_PICS,"ERROR: Could not load video or backup image.")})};var onVideoLoaded=function(evt){var source=video.getHtml();var bitmap=new logic.createJS.Bitmap(source.element);var scale=Math.min(cont.nominalBounds.width/source.element.videoWidth,cont.nominalBounds.height/source.element.videoHeight);bitmap.scaleX=bitmap.scaleY=scale;if(assetIndex==1)video.play();var player=cont.getChildByName("player")?cont.getChildByName("player"):cont;player.mouseEnabled=player.mouseChildren=false;player.removeAllChildren();player.addChildAt(bitmap,0);logic.app.pauseAnimation();var event=new logic.createJS.Event("onDynamicVideoStart");event.videoLogic=video;logic.app.getRoot().dispatchEvent(event)};var onVideoComplete=function(evt){var event=new logic.createJS.Event("onDynamicVideoComplete");event.videoLogic=video;logic.app.getRoot().dispatchEvent(event);logic.app.resumeAnimation()};if(logic.app.isMobile()){onVideoError(null);return}var video=logic.utils.createVideoPlacement(rec.getRawData(initvars[logic.CONSTANTS.DYN_VIDEO]),cont.nominalBounds.width,cont.nominalBounds.height,false);video.id="liquidAdVideo"+assetIndex;video.onError=onVideoError;video.onLoaded=onVideoLoaded;video.onComplete=onVideoComplete;video.data=rec;video.init()}function placeText(field,textValue){var fieldName=logic.utils.stripAssetIndex(field.name);if(initvars[logic.CONSTANTS.ALL_CAPS]!==undefined){var capsFieldArray=initvars[logic.CONSTANTS.ALL_CAPS].split(",");if(capsFieldArray.indexOf(fieldName)!=-1){textValue=textValue.toUpperCase()}}else if(initvars[logic.CONSTANTS.TITLE_CASE]!==undefined){var titleCaseFieldArray=initvars[logic.CONSTANTS.TITLE_CASE].split(",");if(titleCaseFieldArray.indexOf(fieldName)!=-1){textValue=logic.utils.toTitleCase(textValue)}}field.font=field["designFont"];field.text=textValue;try{logic.processing.resolveTextSize(field,textValue)}catch(err){logic.tracking.sentryException(err,{tags:{field:field.font,action:"resolve_text_size"}})}}function setText(field,rec){if(!rec)return;var fieldName=logic.utils.stripAssetIndex(field.name);var fieldId=field["fieldId"];var fldProps=rec.getText(fieldName+fieldId);if(fldProps!==undefined){field.font=fldProps.font;field.text=fldProps.text}else{var textValue=checkForStaticText(field)?logic.utils.decode_html(initvars[logic.CONSTANTS.TEXT_OVERRIDE+field.name]):rec.getRawData(fieldName);if(textValue===undefined){if(fieldName==="percent_off"){if(rec.data["sale_price_normalized"]&&rec.data["price_normalized"]&&parseFloat(rec.data["sale_price_normalized"])<parseFloat(rec.data["price_normalized"])){var percentOff=100*(1-parseFloat(rec.data["sale_price_normalized"])/parseFloat(rec.data["price_normalized"]));percentOff=percentOff.toFixed(0);if(initvars[logic.CONSTANTS.PERCENT_OFF]===undefined||initvars[logic.CONSTANTS.PERCENT_OFF].indexOf("[percent_off]")===-1){textValue=percentOff+"%"}else{textValue=initvars[logic.CONSTANTS.PERCENT_OFF].replace("[percent_off]",percentOff)}}else{textValue=""}}else{textValue=""}}if(initvars[logic.CONSTANTS.TEXT_OVERRIDE+fieldName]!==undefined){textValue=initvars[logic.CONSTANTS.TEXT_OVERRIDE+fieldName]}else if(initvars[logic.CONSTANTS.FIELD_EXTENSION]!==undefined&&rec.getRawData(fieldName+initvars[logic.CONSTANTS.FIELD_EXTENSION])!==undefined){textValue=rec.getRawData(fieldName+initvars[logic.CONSTANTS.FIELD_EXTENSION])}if(initvars[logic.CONSTANTS.MAX_TITLE_FIELDS]!==undefined){var fieldMap=initvars[logic.CONSTANTS.MAX_TITLE_FIELDS];var textLength=parseInt(initvars[logic.CONSTANTS.MAX_TITLE_LENGTH]);if(isNaN(textLength))textLength=1e3;for(var i=0;i<fieldMap.length;i++){var entry=fieldMap[i].trim();if(fieldMap[i].indexOf(":")!=-1){entry=fieldMap[i].substring(0,fieldMap[i].indexOf(":")).trim();if(entry==fieldName){textLength=fieldMap[i].substring(fieldMap[i].indexOf(":")+1)}}if(entry==fieldName){logic.utils.log(">> Truncating "+entry+" at "+textLength+" chars.");var words=textValue.split(" ");var newTextValue="";for(var currentWord=0;currentWord<words.length;currentWord++){if(newTextValue.length+words[currentWord].length+1<textLength){newTextValue+=words[currentWord]+" "}else break}if(currentWord<words.length){newTextValue+=words[currentWord].substring(0,textLength-newTextValue.length)}newTextValue=newTextValue.trim();textValue=newTextValue.substr(0,newTextValue.length)+(newTextValue<textValue?"...":"");break}}}placeText(field,logic.utils.decode_html(textValue));rec.setText(fieldName+fieldId,{font:field.font,text:field.text})}field.visible=true;if(fieldName==="percent_off"){var visible=true;if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]){visible=true}else if(initvars[logic.CONSTANTS.PERCENT_OFF]==undefined){visible=false}var percentOffParent=field.parent;if(percentOffParent){percentOffParent.visible=visible;for(var i=0;i<percentOffParent.children.length;i++){percentOffParent.children[i].visible=visible}}}var showSlash=function(show){var slash=field.parent.slash;if(slash!==null&&slash!==undefined){slash.visible=show}};if(fieldName==="price"){if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]){showSlash(true);if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]===logic.CONSTANTS.SALE_PRICE_OPTION_NONE){field.visible=false;showSlash(false)}else if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]===logic.CONSTANTS.SALE_PRICE_OPTION_PRICE){if(rec.showSalePrice()){field.visible=false;showSlash(false)}}}else{if(rec.showSalePrice()==false){showSlash(false)}else if(initvars[logic.CONSTANTS.SALE_PRICE]==="remove_original"){field.visible=false;showSlash(false)}else if(initvars[logic.CONSTANTS.SALE_PRICE]!==undefined){showSlash(logic.utils.getBool(initvars[logic.CONSTANTS.SALE_PRICE]))}}}else if(fieldName==="sale_price"){if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]){if(field.originalXPosition){field.x=field.originalXPosition}if(field.originalYPosition){field.y=field.originalYPosition}if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]===logic.CONSTANTS.SALE_PRICE_OPTION_NONE){field.visible=false;showSlash(false)}else if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]===logic.CONSTANTS.SALE_PRICE_OPTION_PRICE){showSlash(false);if(rec.showSalePrice()){if(!field.originalXPosition){field.originalXPosition=field.x}if(!field.originalYPosition){field.originalYPosition=field.y}if(field.parent&&field.parent.price){var priceObj=field.parent.price;priceObj.visible=false;field.x=priceObj.x;field.y=priceObj.y}}else{field.visible=false}}else{if(!rec.showSalePrice()){field.visible=false;showSlash(false)}}}else{if(logic.utils.getBool(initvars[logic.CONSTANTS.SALE_PRICE])==false||rec.showSalePrice()==false){field.visible=false;showSlash(false)}}}else if(fieldName==="percent_off"){if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]){if(initvars[logic.CONSTANTS.SALE_PRICE_OPTION]!==logic.CONSTANTS.SALE_PRICE_OPTION_PERCENT_OFF||field.text===""){var percentOffParent=field.parent;if(percentOffParent){percentOffParent.visible=false;for(var i=0;i<percentOffParent.children.length;i++){percentOffParent.children[i].visible=false}}field.visible=false}}}field.parent.dispatchEvent(new logic.createJS.Event("onSetDynamicText"))}return AdRollLiquidAds.tree={discover:function(root){logic.utils.nameChildren(root);var imageIndexList=[];var videoIndexList=[];var mapAsset=function(obj,isCustomizable){if(obj.name===null)return;if(isCustomizable)customizable.push(obj);var assetIndex=logic.utils.getAssetIndex(obj.name);var mapId=obj.name;if(assetIndex==-1&&obj.name!="slash"&&checkForStaticText(obj)==false){assetIndex=logic.utils.getParentIndex(obj);if(assetIndex!=-1){mapId=obj.name+assetIndex;if(obj.name.indexOf("image")!=-1&&obj.name.indexOf("_")!=-1){mapId=logic.utils.stripAssetIndex(obj.name)+assetIndex+obj.name.substr(obj.name.indexOf("_"))}}}if(assetIndex!=-1){if(assetMap[assetIndex]===undefined)assetMap[assetIndex]=[];assetMap[assetIndex].push(obj);if(obj.name.indexOf("_")==-1&&imageIndexList.indexOf(assetIndex)==-1){if(obj.name.indexOf("image")!=-1){imageIndexList.push(assetIndex)}else if(obj.name.indexOf("video")!=-1){videoIndexList.push(assetIndex)}}}if(assetMap[mapId]===undefined)assetMap[mapId]=[];assetMap[mapId].push(obj);logic.utils.log(">> MAP ASSET: "+mapId+" "+obj)};if(initvars[logic.CONSTANTS.FONT_MAP]!==undefined){var data=initvars[logic.CONSTANTS.FONT_MAP].split(",");var map=[];for(var i=0;i<data.length;i++){var m=data[i].split(":");map[m[0]]=m[1]}initvars[logic.CONSTANTS.FONT_MAP]=map}logic.processing.scanTimeline(root,mapAsset);numImages=imageIndexList.length>0?imageIndexList.length:videoIndexList.length;if(root.getChildByName("bkgrd")!==undefined){assetMap["bkgrd"]=root.getChildByName("bkgrd")}if(root.getChildByName("video")&&(logic.app.isMobile()==true||!initvars[logic.CONSTANTS.VIDEO_TAG])){root.getChildByName("video").visible=false}if(initvars[logic.CONSTANTS.MAX_TITLE_FIELDS]!==undefined){initvars[logic.CONSTANTS.MAX_TITLE_FIELDS]=initvars[logic.CONSTANTS.MAX_TITLE_FIELDS].split(",")}else if(root["maxTitleFields"]!==undefined){initvars[logic.CONSTANTS.MAX_TITLE_FIELDS]=root["maxTitleFields"]}if(initvars[logic.CONSTANTS.MAX_TITLE_LENGTH]!==undefined){initvars[logic.CONSTANTS.MAX_TITLE_LENGTH]=parseInt(initvars[logic.CONSTANTS.MAX_TITLE_LENGTH])}else if(root["maxTitleLength"]!==undefined){initvars[logic.CONSTANTS.MAX_TITLE_LENGTH]=root["maxTitleLength"]}if(initvars[logic.CONSTANTS.MAX_TITLE_LENGTH]&&!initvars[logic.CONSTANTS.MAX_TITLE_FIELDS])initvars[logic.CONSTANTS.MAX_TITLE_FIELDS]=["title"];var onAnimTimerComplete=function(evt){root.removeEventListener("onAnimationTimerComplete",onAnimTimerComplete);for(var prop in assetMap){var assetArray=assetMap[prop];for(var i=0;i<assetArray.length;i++){if(assetArray[i]instanceof logic.createJS.MovieClip){assetArray[i].stop()}}}};root.addEventListener("onAnimationTimerComplete",onAnimTimerComplete)},populate:function(aindex,rec){if(!rec)return;var assetArray=assetMap[aindex];var textWidth=0,textHeight=0;for(var index=0;index<assetArray.length;index++){var displayObj=assetArray[index];if(displayObj instanceof logic.createJS.Container&&(displayObj.name.indexOf("image")!=-1||initvars[logic.CONSTANTS.DYN_VIDEO]&&displayObj.name.indexOf("video")!=-1)){if(displayObj.name.indexOf("image")!=-1){placeImage(displayObj,rec);displayObj.cache(0,0,displayObj.nominalBounds.width,displayObj.nominalBounds.height)}else{placeVideo(displayObj,rec)}}else if(displayObj instanceof logic.createJS.MovieClip&&displayObj.name.indexOf("rating")!=-1){var rating=parseFloat(rec.getRawData("rating"));var threshold=initvars[logic.CONSTANTS.RATING_MIN]?parseFloat(initvars[logic.CONSTANTS.RATING_MIN]):1;if(isNaN(rating)||rating<threshold){displayObj.visible=false}else if(initvars[logic.CONSTANTS.RATING_SCALE]=="custom"&&displayObj.setRating){displayObj.setRating(rating);displayObj.visible=true}else{if(initvars[logic.CONSTANTS.RATING_SCALE]=="half")rating=rating/.5;displayObj.gotoAndStop(Math.ceil(rating)-1);displayObj.visible=true}}else if(displayObj instanceof logic.createJS.Text){setText(displayObj,rec);try{var textBounds=displayObj.getBounds();if(textBounds!=null){if(textBounds.width>textWidth)textWidth=textBounds.width;if(textBounds.height>textHeight)textHeight=textBounds.height}}catch(e){logic.utils.log("ERROR: Can't test textfields bounds due to: "+e.message)}}displayObj.set({rec:rec});var showOverride=initvars[logic.CONSTANTS.SHOW_OVERRIDE+logic.utils.stripAssetIndex(displayObj.name)];var objName=logic.utils.getAssetIndex(displayObj.name)==-1?displayObj.name+logic.utils.getParentIndex(displayObj):displayObj.name;if(showOverride!==undefined){if(showOverride=="true"||showOverride=="false"||showOverride==true||showOverride==false){displayObj.visible=logic.utils.getBool(showOverride)}else if(logic.utils.getAssetIndex(objName)==aindex&&(rec.getRawData(showOverride)===undefined||rec.getRawData(showOverride)==="")){displayObj.visible=false}else{displayObj.visible=true}}}if(assetMap["text"+aindex]!==undefined){var textContainer=assetMap["text"+aindex];var hotspot=new logic.createJS.Shape;hotspot.graphics.beginFill("#000").drawRect(0,0,textWidth,textHeight);textContainer.hitArea=hotspot}},setImage:function(img,stub){var bitmap,ctrW,ctrH;var scale=stub.nominalBounds?Math.min(stub.nominalBounds.width/img.width,stub.nominalBounds.height/img.height):1;var imgWidth=img.width*scale;var imgHeight=img.height*scale;if(initvars[logic.CONSTANTS.SMOOTHING]!==undefined){var smoothing=initvars[logic.CONSTANTS.SMOOTHING].toLowerCase();smoothing=["high","medium","low"].indexOf(smoothing)!=-1?smoothing:"high";var canvas=document.createElement("canvas");canvas.width=imgWidth;canvas.height=imgHeight;var context=canvas.getContext("2d");context.mozImageSmoothingEnabled=true;context.webkitImageSmoothingEnabled=true;context.msImageSmoothingEnabled=true;context.imageSmoothingEnabled=true;context.imageSmoothingQuality=smoothing;context.drawImage(img,0,0,imgWidth,imgHeight);bitmap=new logic.createJS.Bitmap(canvas);ctrW=imgWidth;ctrH=imgHeight}else if(logic.utils.isIE()==false){try{img=logic.processing.resize_image(img,scale)}catch(err){logic.tracking.sentryException(err,{tags:{action:"resize_image"}})}var sharpness=.1;if(initvars[logic.CONSTANTS.SHARPENING]!==undefined){sharpness=parseFloat(initvars[logic.CONSTANTS.SHARPENING])}try{logic.processing.sharpen_image(img,sharpness)}catch(err){logic.tracking.sentryException(err,{tags:{action:"sharpen_image"}})}bitmap=new logic.createJS.Bitmap(img);ctrW=img.width;ctrH=img.height}else{bitmap=new logic.createJS.Bitmap(img);bitmap.scaleX=bitmap.scaleY=scale;ctrW=imgWidth;ctrH=imgHeight}bitmap.x=Math.round((stub.nominalBounds.width-ctrW)/2);bitmap.y=Math.round((stub.nominalBounds.height-ctrH)/2);return bitmap},setStaticText:function(){for(var prop in assetMap){if(assetMap.hasOwnProperty(prop)){if(initvars[logic.CONSTANTS.TEXT_OVERRIDE+prop]!==undefined){for(var i=0;i<assetMap[prop].length;i++){var obj=assetMap[prop][i];if(obj instanceof logic.createJS.Text){placeText(obj,logic.utils.decode_html(initvars[logic.CONSTANTS.TEXT_OVERRIDE+prop]))}}}}}},setSalePriceOption:function(){for(var i=1;;i++){var priceObj=assetMap["price"+i];var salePriceObj=assetMap["sale_price"+i];var percentObj=assetMap[logic.CONSTANTS.PERCENT_OFF+i];if(priceObj){for(var j=0;j<priceObj.length;j++){if(priceObj[j]instanceof logic.createJS.Text){setText(priceObj[j],priceObj[j].rec)}}}else{break}if(salePriceObj){for(var j=0;j<salePriceObj.length;j++){if(salePriceObj[j]instanceof logic.createJS.Text){setText(salePriceObj[j],salePriceObj[j].rec)}}}if(percentObj){var percentOffMovieClip;var percentOffText;for(var k=0;k<percentObj.length;k++){percentOffMovieClip=percentObj[k];if(percentOffMovieClip.getChildByName){percentOffText=percentOffMovieClip.getChildByName("percent_off");break}}if(percentOffText&&percentOffText instanceof logic.createJS.Text){setText(percentOffText,percentOffText.rec)}}}},setThemeColor:function(hex){for(var x=0;x<customizable.length;x++){var obj=customizable[x];if(obj&&obj.shape){obj.shape.graphics.clear();obj.shape.graphics.f(hex).s().p(obj.shape["drawPath"])}}},getAssetByName:function(name){return assetMap[name]},getNumImages:function(){return numImages}}})();AdRollLiquidAds.utils={isMobile:function(){return(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Opera Mini/i)||navigator.userAgent.match(/Silk/i)||navigator.userAgent.match(/Mobile Safari/i)||navigator.userAgent.match(/IEMobile/i))!=null},isIE:function(){if(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0){return true}return false},isSafari5:function(){return!!navigator.userAgent.match(" Safari/")&&!navigator.userAgent.match(" Chrom")&&!!navigator.userAgent.match(" Version/5.")},getLocProtocol:function(){return"https:"==document.location.protocol?"https":"http"},isDemo:function(){if(initvars.demo===undefined)return false;return AdRollLiquidAds.utils.getBool(initvars.demo)},isDebug:function(){var url=AdRollLiquidAds.utils.getQueryVariable("armature_url");if(!url){return false}return url.indexOf("debug.liquidads.min.js")!=-1},supportedVideoFormat:function(video){if(!video.hasOwnProperty("canPlayType"))return"mp4";var extension="";if(video.canPlayType("video/webm")=="probably"||video.canPlayType("video/webm")=="maybe"){extension="webm"}else if(video.canPlayType("video/mp4")=="probably"||video.canPlayType("video/mp4")=="maybe"){extension="mp4"}return extension},isRetina:function(){if(window.matchMedia){var mq=window.matchMedia("only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen  and (min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx)");return mq&&mq.matches||window.devicePixelRatio>1}},loadJSON:function(path,success,error,withCredentials){var xhr=new XMLHttpRequest;xhr.open("GET",path,true);xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){if(success){try{success(JSON.parse(xhr.responseText))}catch(e){error(xhr)}}}else{if(error)error(xhr)}}};if(withCredentials){xhr.withCredentials=true}xhr.send()},loadImageWithXHR:function(path,success,error){var xhr=new XMLHttpRequest;var rnd=Math.random();var urlObj=window.URL?window.URL:window.webkitURL;xhr.open("GET",path,true);xhr.responseType="blob";xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){var img=new Image;img.onload=function(){urlObj.revokeObjectURL(img.src);success(img,rnd)};img.src=urlObj.createObjectURL(xhr.response)}else{error(xhr)}}};xhr.send();return rnd},loadImageWithDOM:function(path,success,error,noCORS){var rnd=Math.random();var img=new Image;img.onload=function(){success(img,rnd)};img.onerror=error;if(!noCORS){img.crossOrigin="anonymous"}img.src=path;if(img.complete||img.complete===undefined){var crossOriginValue=img.crossOrigin;img.crossOrigin=null;img.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";img.crossOrigin=crossOriginValue;img.src=path}return rnd},loadImage:function(path,success,error,noCORS){if(window.URL||window.webkitURL){return AdRollLiquidAds.utils.loadImageWithXHR(path,success,error)}else{return AdRollLiquidAds.utils.loadImageWithDOM(path,success,error,noCORS)}},loadFonts:function(root,stats){if(root.customFont.constructor!==Array)root.customFont=[root.customFont];for(var index=0;index<root.customFont.length;index++){var fontObj=root.customFont[index];var source=fontObj.source=="adroll"?"custom":fontObj.source;if(WebFontConfig[source]===undefined)WebFontConfig[source]={families:[]};if(fontObj.name.charAt(fontObj.name.length-1)==":")fontObj.name=fontObj.name.slice(0,-1);var split=fontObj.name.split(":");var fontname=split[0].replace(/ /g,"+");if(split[1])fontname+=":"+split[1].replace(/ /g,"");WebFontConfig[source].families.push(fontname);if(fontObj.source=="adroll"){if(WebFontConfig["custom"].urls===undefined)WebFontConfig["custom"].urls=[];fontname=split[0].replace(/ /g,"-").toLowerCase();WebFontConfig["custom"].urls.push(AdRollLiquidAds.CONSTANTS.ADROLL_FONT_CSS+fontname+"/font.css");WebFontConfig.adroll=true}if(fontObj.name.indexOf(":")!=-1){stats.target+=split[1].split(",").length}else{stats.target++}}var fontScript=document.createElement("script");fontScript.src=AdRollLiquidAds.utils.getLocProtocol()+AdRollLiquidAds.CONSTANTS.FONT_LOADER_URL;fontScript.type="text/javascript";fontScript.async="true";var scriptTag=document.getElementsByTagName("script")[0];scriptTag.parentNode.insertBefore(fontScript,scriptTag)},getWebFontFamilies:function(){if(WebFontConfig["google"]!=undefined||WebFontConfig["custom"]!=undefined){var families=[];if(WebFontConfig["google"]!=undefined)families=families.concat(WebFontConfig["google"].families);if(WebFontConfig["custom"]!=undefined)families=families.concat(WebFontConfig["custom"].families);return families}return null},nameChildren:function(node){for(var prop in node){if(node[prop]instanceof AdRollLiquidAds.createJS.DisplayObject){var displayObj=node[prop];if(displayObj.name===null){displayObj.name=prop;if(displayObj instanceof AdRollLiquidAds.createJS.Container&&displayObj.name!="parent"&&displayObj.getNumChildren()>0){AdRollLiquidAds.utils.nameChildren(displayObj)}}}}},getTimer:function(callback,delay){function Timer(cb,d){var timerId,start,dur=d,remaining=d,resets=0,running=true;this.pause=function(){window.clearTimeout(timerId);remaining-=new Date-start;running=false};this.resume=function(){start=new Date;window.clearTimeout(timerId);timerId=window.setTimeout(cb,dur);running=true};this.stop=function(){window.clearTimeout(timerId);running=false};this.reset=function(){resets++;this.stop();this.resume()};this.setDelay=function(d){dur=d};this.getStartTime=function(){return start.getTime()};this.isRunning=function(){return running};this.numResets=function(){return resets};this.resume()}return new Timer(callback,delay)},createVideoPlacement:function(source,width,height,loop){function VideoPlacement(s,w,h,l){var source=s||null,width=w||AdRollLiquidAds.app.getStageDimensions().width,height=h||AdRollLiquidAds.app.getStageDimensions().height,loop=l||false,adDiv=document.getElementById("liquidAdCanvas").parentElement,video;this.onError=null;this.onLoaded=null;this.onComplete=null;this.id=null;this.data=null;this.init=function(){if(initvars[AdRollLiquidAds.CONSTANTS.ALLOW_VIDEO]&&AdRollLiquidAds.utils.getBool(initvars[AdRollLiquidAds.CONSTANTS.ALLOW_VIDEO])==false){this.onError();return}video={div:document.createElement("div"),element:document.createElement("video")};if(document.getElementById(this.id))adDiv.removeChild(document.getElementById(this.id));adDiv.appendChild(video.div).appendChild(video.element);video.div.setAttribute("id",this.id);video.div.setAttribute("style","display:none;");var videoType=AdRollLiquidAds.utils.supportedVideoFormat(video.element);if(videoType==""){AdRollLiquidAds.utils.log("ERROR: No video support in this browser!");this.onError();return}video.src=document.createElement("source");source=source.indexOf(".webm")==-1&&source.indexOf(".mp4")==-1?source+"."+videoType:source;video.src.setAttribute("src",source);video.src.addEventListener("error",this.onError);video.element.appendChild(video.src);video.element.addEventListener("canplaythrough",this.onLoaded,false);video.element.addEventListener("ended",this.onComplete,false);video.element.setAttribute("width",width);video.element.setAttribute("height",height);video.element.setAttribute("muted","true");video.element.setAttribute("controls","false");if(loop)video.element.setAttribute("loop","true")};this.getHtml=function(){return video};this.play=function(){video.element.play()};this.pause=function(){video.element.pause()};this.shutdown=function(){if(video){video.element.removeEventListener("canplaythrough",this.onLoaded,false);video.element.removeEventListener("ended",this.onComplete,false);adDiv.removeChild(document.getElementById(this.id))}this.onError=null;this.onLoaded=null;this.onComplete=null;video=null}}return new VideoPlacement(source,width,height,loop);

},replaceWildcards:function(subject,wildcard,replacement){var out=subject;var matches=subject.match(/\[\w+\]/g);for(var i=0;i<matches.length;i++){if(matches[i]===wildcard){out=out.replace(matches[i],replacement)}}return out},getBool:function(value){if(!value)return false;if(typeof value=="string"){var string=value.toLowerCase();if(string=="true"){return true}else if(string=="false"){return false}}return Boolean(value)},getMedian:function(array){array.sort(function(a,b){return a-b});var half=Math.floor(array.length/2);if(array.length%2){return array[half]}else{return(array[half-1]+array[half])/2}},array_contains:function(arr,obj){var len=arr.length;for(var i=0;i<len;i++){if(arr[i]===obj)return true}return false},parse_money:function(str){if(typeof str!=="string")return str;return parseFloat(str.replace(/[^0-9\.]/g,""))},decode_html:function(str){var txt=document.createElement("textarea");txt.innerHTML=str;return txt.value},parse_px:function(str){return str.match(/[0-9]+(?=px)/)[0]},is_num_in_range:function(num,target,range){if(num>target)return num<=target+range;if(num<target)return num>=target-range;return true},queryAppend:function(url,param){if(!param||typeof param!=="string"){return url}var joiner="?";if(url.indexOf("?")!==-1)joiner="&";if(this.startsWith(param,"?")||this.startsWith(param,"&"))param=param.substr(1);return url+joiner+param},getQueryVariable:function(variable){var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable){return pair[1]}}return null},getDestinationUrl:function(url,pid){var logic=AdRollLiquidAds;var defaultUrl=initvars[logic.CONSTANTS.DEFAULT_CLICK];var result=url;if(initvars[logic.CONSTANTS.CLICK_OVERRIDE]!==undefined){result=initvars[logic.CONSTANTS.CLICK_OVERRIDE]}if(result||defaultUrl&&defaultUrl!=""){result=result||defaultUrl;if(initvars[logic.CONSTANTS.TRACKING]!==undefined){var tracking=initvars[logic.CONSTANTS.TRACKING];if(tracking.indexOf("[product_id]")!==-1){if(pid===undefined)pid="0";tracking=logic.utils.replaceWildcards(tracking,"[product_id]",encodeURIComponent(pid))}result=logic.utils.queryAppend(result,tracking)}if(initvars[logic.CONSTANTS.PREFIX]!==undefined){var prefix=initvars[logic.CONSTANTS.PREFIX];if(prefix.indexOf("?")==-1)prefix=prefix+"?";result=prefix.search(/(doubleclick)/i)!=-1?prefix+result:prefix+encodeURIComponent(result)}result=logic.utils.isDemo()?result:logic.utils.queryAppend(initvars[logic.CONSTANTS.CLICK_TAG],"desturl="+encodeURIComponent(result))}else{result=initvars[logic.CONSTANTS.CLICK_TAG]}return result},getEID:function(){var tag=initvars.failTAG;return tag.substring(tag.lastIndexOf("/")+1,tag.lastIndexOf("."))},getAssetIndex:function(name){var test=name.indexOf("image")!=-1&&name.indexOf("_")!=-1?name.substr(0,name.indexOf("_")):name;var pattern=/\d+$/;var result=pattern.exec(test);return result?parseInt(result[0]):-1},stripAssetIndex:function(name){var test=name.indexOf("image")!=-1&&name.indexOf("_")!=-1?name.substr(0,name.indexOf("_")):name;var pattern=/\d+$/;var index=test.search(pattern);if(index==-1)return test;return test.slice(0,index)},getParentIndex:function(obj){var assetIndex=AdRollLiquidAds.utils.getAssetIndex(obj.name);if(assetIndex!=-1)return assetIndex;if(obj&&obj.parent&&obj.parent.name){var parent=obj.parent;assetIndex=AdRollLiquidAds.utils.getAssetIndex(parent.name);if(assetIndex==-1){return AdRollLiquidAds.utils.getParentIndex(parent)}}return assetIndex},parseTimestamp:function(time){var split=time.split(" ");var splitDate=split[0].split("-");var splitTime=split[1].split(":");if(splitDate[0].length!=4||splitTime[0].length!=2){return null}return new Date(splitDate[0],splitDate[1]-1,splitDate[2],splitTime[0],splitTime[1],splitTime[2])},getUTCDate:function(date){var nd=new Date;var offset=date.getTimezoneOffset()*60*1e3;nd.setTime(date.getTime()+offset);return nd},log:function(message,obj){if(AdRollLiquidAds.utils.isDemo()==true&&initvars.type!=AdRollLiquidAds.CONSTANTS.TYPE_DYNAMIC_TWA){if(obj){console.log(message,obj)}else{console.log(message)}}},startsWith:function(str1,str2){return!str1.indexOf(str2)},REGEX_TITLECASE_SPLIT:new RegExp('[\\"\\s\\!\\&\\/\\.\\,\\-\\_\\\\]'),REGEX_TITLECASE_SPLIT_SINGLE_QUOTE:new RegExp("[\\']"),REGEX_ITERATE_STR:new RegExp(".","g"),toTitleCase:function(str){var previousChar="",previousPreviousChar="";var convertedChar="";var alreadyConvertedChars=[];var regexResult;while((regexResult=AdRollLiquidAds.utils.REGEX_ITERATE_STR.exec(str))!==null){var currentChar=regexResult[0];if(alreadyConvertedChars.length==0||previousChar.match(AdRollLiquidAds.utils.REGEX_TITLECASE_SPLIT)){convertedChar=currentChar.toUpperCase()}else if(previousChar.match(AdRollLiquidAds.utils.REGEX_TITLECASE_SPLIT_SINGLE_QUOTE)){if(previousPreviousChar==""||previousPreviousChar.match(AdRollLiquidAds.utils.REGEX_TITLECASE_SPLIT)){convertedChar=currentChar.toUpperCase()}else{convertedChar=currentChar.toLowerCase()}}else{convertedChar=currentChar.toLowerCase()}previousPreviousChar=previousChar;previousChar=currentChar;alreadyConvertedChars.push(convertedChar)}return alreadyConvertedChars.join("")},hasJapaneseCharacters:function(str){var regex=/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g;if(regex.test(str)){return true}return false}};(function(){var logic=AdRollLiquidAds;var PARAMETERS=logic.CONSTANTS;var productMap=[];var clickCount=0;var sentryErrors=[];var ok=false;return AdRollLiquidAds.tracking={logEvent:function(event,params){var data="version="+PARAMETERS.getVersion();if(logic.datamodel){var latency=(new Date).getTime()-logic.datamodel.getInitLoadStats().start_time.getTime();var recLoadTime=logic.datamodel.getInitLoadStats().rec_load_time;var pseid=logic.datamodel.getProductStreamEid();var experiment=logic.datamodel.getExperiment();var cookieBucket=logic.datamodel.getCookieBucket();var isTrecs=logic.datamodel.isTrecs();var algoData="";for(var key in params.algo_data){if(params.algo_data.hasOwnProperty(key)){algoData+="&"+key+"="+encodeURIComponent(params.algo_data[key])}}data+="&pseid="+pseid;if(experiment!==undefined)data+="&experiment_eid="+experiment.experiment_eid;if(cookieBucket!==undefined)data+="&cookie_bucket="+cookieBucket;if(isTrecs)data+="&is_trecs="+isTrecs}else if(initvars.type==logic.CONSTANTS.TYPE_PERSONALIZED){data+="&adv_eid="+initvars[logic.CONSTANTS.B2B_AD_EID];data+="&keys_eid="+initvars[logic.CONSTANTS.B2B_KEYS_EID]}var appendFieldData=function(data){var output="";for(var field in data){output+="&"+field+"="+encodeURIComponent(data[field])}return output};var fetchIds=function(recList){if(!recList){return""}var ids=[];for(var i in recList){if(recList[i]){ids.push(recList[i].id)}}return ids.join(",")};switch(event){case PARAMETERS.EVENT_INIT:data+="&mobile="+logic.app.isMobile();data+="&retina="+logic.utils.isRetina();break;case PARAMETERS.EVENT_OK:if(ok){logic.tracking.sentryMessage("NOTICE: Attempting to send liquid_ok more than once!",{tags:logic.datamodel.getInitLoadStats()});return}if(latency)data+="&latency="+latency;if(recLoadTime)data+="&rec_load_time="+recLoadTime;data+="&mobile="+logic.app.isMobile();ok=true;break;case PARAMETERS.EVENT_CLICK:if(params.coords)data+="&coords="+params.coords;if(params.pid)data+="&pid="+params.pid;if(params.src)data+="&source="+params.src;if(params.pos)data+="&position="+params.pos;if(initvars.type==logic.CONSTANTS.TYPE_DYNAMIC){clickCount++;data+="&count="+clickCount;data+="&stopped="+logic.app.isStopped()}if(latency)data+="&time="+latency;if(params.click_origin)data+="&click_origin="+params.click_origin;if(params.action)data+="&action="+params.action;if(algoData!=="")data+=algoData;if(params.field_data)data+=appendFieldData(params.field_data);if(params.price_normalized)data+="&price_normalized="+encodeURIComponent(params.price_normalized);if(params.locale)data+="&locale="+encodeURIComponent(params.locale);if(params.product_date)data+="&product_date="+encodeURIComponent(params.product_date);if(params.pghash)data+="&pghash="+encodeURIComponent(params.pghash);break;case PARAMETERS.EVENT_HOVER:var stageSize=logic.app.getStageDimensions();data+="&size="+stageSize.width+":"+stageSize.height;var coordString="";for(var idx=0;idx<params.list.length;idx++){var loc=params.list[idx];coordString+=loc.x+":"+loc.y;if(idx<params.list.length-1)coordString+="|"}data+="&coords="+coordString;break;case PARAMETERS.EVENT_FAILURE:case PARAMETERS.EVENT_PERS_FAILURE:data+="&code="+params.code;if(latency)data+="&latency="+latency;data+="&mobile="+logic.app.isMobile();data+="&reason="+encodeURIComponent(params.reason);if(logic.datamodel){data+="&prodList="+encodeURIComponent(JSON.stringify(logic.datamodel.getProdList()));data+="&recList="+encodeURIComponent(fetchIds(logic.datamodel.getRecList()))}break;case PARAMETERS.EVENT_TRECS_FALLBACK:if(params.error_code)data+="&trecs_error_code="+params.error_code;if(params.error_message)data+="&trecs_error_message="+encodeURIComponent(params.error_message);break;case PARAMETERS.EVENT_ENGAGEMENT:data+="&action="+params.action;break;case PARAMETERS.EVENT_IMPRESSION:if(productMap.indexOf(params.pid)===-1){productMap.push(params.pid);data+="&pid="+params.pid;data+="&source="+params.src;data+="&position="+params.pos;if(params.action)data+="&action="+params.action;if(algoData!=="")data+=algoData;if(params.field_data)data+=appendFieldData(params.field_data);if(params.price_normalized)data+="&price_normalized="+encodeURIComponent(params.price_normalized);if(params.locale)data+="&locale="+encodeURIComponent(params.locale);if(params.product_date)data+="&product_date="+encodeURIComponent(params.product_date);if(params.pghash)data+="&pghash="+encodeURIComponent(params.pghash)}else{return}break;case PARAMETERS.EVENT_PERS_IMPRESSION:for(var p in params){data+="&"+p+"="+params[p]}break;case PARAMETERS.EVENT_PERS_CLICK:data+="&url="+params.url;break}if(initvars.engageTAG===undefined){return}var url=initvars.engageTAG;url=logic.utils.queryAppend(url,"adroll_stat_name="+event);if(data!="")url=logic.utils.queryAppend(url,"adroll_stat_data="+encodeURIComponent(data));logic.utils.log(">> TRACK: "+url);if(logic.utils.isDemo()==false){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.withCredentials=true;xhr.send()}},sentryMessage:function(msg,tags){if(logic.utils.isDemo()==true||sentryErrors.indexOf(msg)!=-1){return}sentryErrors.push(msg);if(!window.Raven){console.log("Raven unavailable! Unable to send message: "+msg);return}try{Raven.captureMessage(msg,tags)}catch(err){console.log("ERROR: Could not send message to Sentry ("+msg+") due to "+err.message)}},sentryException:function(err,tags){if(logic.utils.isDemo()==true||sentryErrors.indexOf(tags.tags.action)!=-1){return}sentryErrors.push(tags.tags.action);if(!window.Raven){console.log("Raven unavailable! Unable to send exception: "+err.message);return}try{Raven.captureException(err,tags)}catch(e){console.log("ERROR: Could not send exception to Sentry ("+err.message+") due to "+e.message)}}}})();(function(){var logic=AdRollLiquidAds;var clickCoords="";var lastClickTime;function handleClick(evt){evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=true;switch(evt.currentTarget.clicktype){case"product":onProductClick(evt);break;case"nav":onNavClick(evt);break;default:onStageClick(evt)}return false}function onProductClick(evt){if(checkClickBufferOk()==false)return;setClickHeatMapCoords(evt.stageX,evt.stageY);var name=logic.utils.getAssetIndex(evt.currentTarget.name)==-1?evt.currentTarget.name+logic.utils.getParentIndex(evt.currentTarget):evt.currentTarget.name;logic.app.onProductSelect(name);lastClickTime=(new Date).getTime()}function onNavClick(evt){logic.app.onNavClick(evt.currentTarget.name)}function onStageClick(evt){if(checkClickBufferOk()==false)return;var x=evt.stageX;var y=evt.stageY;if(x==undefined||y==undefined){var mousePos=getMousePos(evt);x=mousePos.x;y=mousePos.y}setClickHeatMapCoords(x,y);logic.app.onStageSelect(null,evt.currentTarget.name);lastClickTime=(new Date).getTime()}function checkClickBufferOk(){if(!lastClickTime)return true;var now=(new Date).getTime();return now-lastClickTime>1e3}function getMousePos(evt){var canvas=logic.app.getStage().canvas;var offsetX=0,offsetY=0,mx,my;if(canvas.offsetParent!==undefined){do{offsetX+=canvas.offsetLeft;offsetY+=canvas.offsetTop}while(canvas=canvas.offsetParent)}mx=evt.pageX-offsetX;my=evt.pageY-offsetY;return{x:mx,y:my}}function setClickHeatMapCoords(xPos,yPos){var dimensions=logic.app.getStageDimensions();clickCoords=xPos+":"+dimensions.width+"|"+yPos+":"+dimensions.height}function trackHovers(stage){var hoverTrail,timeout,lastPointTime,hoverInterval;var reset=function(){lastPointTime=0,hoverInterval=20;hoverTrail=[]};reset();var capture=function(){logic.tracking.logEvent(logic.CONSTANTS.EVENT_HOVER,{list:hoverTrail});reset()};var onMouseMove=function(evt){window.clearTimeout(timeout);timeout=setTimeout(onTimeout,200);if(Date.now()-lastPointTime<hoverInterval)return;lastPointTime=Date.now();hoverTrail.push(getMousePos(evt));if(hoverTrail.length>=150){capture()}};var onTimeout=function(){if(hoverTrail.length>=10)capture()};stage.addEventListener("mouseenter",function(e){reset();stage.canvas.addEventListener("mousemove",onMouseMove)});stage.addEventListener("mouseleave",function(e){stage.canvas.removeEventListener("mousemove",onMouseMove);window.clearTimeout(timeout);onTimeout()})}return AdRollLiquidAds.touch={init:function(root){var dimensions=logic.app.getStageDimensions();var stage=root.getStage();var bg=new createjs.Shape;bg.name="stageHitArea";bg.graphics.f("rgba(255,255,255,0.01)").dr(0,0,dimensions.width,dimensions.height);stage.name="stage";stage.addChildAt(bg,0);stage.update();logic.touch.stage(stage);if(logic.app.isMobile()==false){stage.cursor="pointer";stage.enableMouseOver(10)}},product:function(cont){cont.addEventListener("click",handleClick);cont.set({clicktype:"product"})},nav:function(btn){btn.addEventListener("click",handleClick);btn.set({clicktype:"nav"})},stage:function(obj){obj.addEventListener("click",handleClick);obj.set({clicktype:"stage"})},getClickPos:function(){return clickCoords}}})();(function(){var logic=AdRollLiquidAds;var autoBlink,dscMenu,pageMenu,videoLoop,imageZoomList,flyoverImg;function InteractiveMenu(root){var params=root["dscMenu"];if(params["numObjects"]!==undefined){var dscList=[];for(var i=1;i<=params["numObjects"];i++){var dsc=logic.tree.getAssetByName("dsc"+i)[0];dsc.tickEnabled=true;dsc.addEventListener("mouseover",root["dscOver"]);dsc.addEventListener("mouseout",root["dscOut"]);dscList.push(dsc)}return}var buttonList=[];var button,index;if(params["objects"]!==undefined){for(index=0;index<params["objects"].length;index++){button=eval("root."+params["objects"][index]);if(button)buttonList.push(button)}}else{for(index=1;index<10;index++){var btns=logic.tree.getAssetByName("button"+index);if(btns)buttonList.push(btns[0])}}var onLeave=function(e){logic.utils.log(">> Mouse left the canvas bounds.");var resetDsc=function(b){b.dispatchEvent(new logic.createJS.Event("mouseout"))};buttonList.forEach(resetDsc);logic.app.getStage().canvas.removeEventListener("mouseout",onLeave)};var onOver=function(e){logic.app.getStage().canvas.addEventListener("mouseout",onLeave);root["dscOver"](e)};var onOut=function(e){root["dscOut"](e)};var initButtons=function(btn){btn.addEventListener("mouseover",onOver);btn.addEventListener("mouseout",onOut);if(params.click==true)btn.addEventListener("click",root["dscPress"])};buttonList.forEach(initButtons)}function AutoBlinkComponent(root){var params=root["autoBlink"];var numObjects=params["numObjects"];var pauseTime=logic.app.getPauseTime()*1e3/(numObjects+1);var order=[];if(params["order"]!==undefined){order=params["order"]}else{for(var i=1;i<=numObjects;i++)order.push(i)}var currentIndex=-1;var blinkTimer=null;var startTimer=function(){blinkTimer=logic.utils.getTimer(onBlinkTimer,pauseTime)};var onBlinkTimer=function(){currentIndex++;if(currentIndex==order.length){currentIndex=-1;return}if(logic.tree.getAssetByName("dsc"+order[currentIndex])!==undefined){var dsc=logic.tree.getAssetByName("dsc"+order[currentIndex])[0];try{root.blink(dsc)}catch(err){logic.utils.log(">> ERROR: Exception thrown from blink() handler: "+err.message)}}startTimer()};var onMainTimerStart=function(evt){startTimer()};var onMainTimerComplete=function(evt){root.reset();currentIndex=-1;if(blinkTimer!==null){blinkTimer.stop();blinkTimer=null}};var onMainAnimComplete=function(evt){root.removeEventListener("onPauseTimerStart",onMainTimerStart);root.removeEventListener("onPauseTimerComplete",onMainTimerComplete);root.removeEventListener("onAnimationComplete",onMainAnimComplete);root.reset();if(blinkTimer!==null){blinkTimer.stop();blinkTimer=null}};root.addEventListener("onPauseTimerStart",onMainTimerStart);root.addEventListener("onPauseTimerComplete",onMainTimerComplete);root.addEventListener("onAnimationComplete",onMainAnimComplete);this.pause=function(){if(blinkTimer&&blinkTimer.isRunning())blinkTimer.pause()};this.resume=function(){if(blinkTimer&&!blinkTimer.isRunning())blinkTimer.resume()};this.stop=function(){if(blinkTimer!==null){blinkTimer.stop();blinkTimer=null}}}function PageMenuComponent(root){var params=root["pageMenu"];var menu=params["object"]?root[params.object]:root["page_menu"];if(!menu)return;var currentRecIndex=0;var catchTransEvent=false;var onMainTimerStart=function(evt){root.removeEventListener("onPauseTimerStart",onMainTimerStart);onTransComplete(null)};var onTransComplete=function(evt){if(catchTransEvent){catchTransEvent=false;return}var timeline=menu["covers"].timeline;var recIndex=logic.app.getFocusedRecIndex();var targetFrame=recIndex>currentRecIndex?timeline.position+1:timeline.position-1;if(targetFrame==timeline.duration||recIndex==0)targetFrame=1;if(targetFrame==0)targetFrame=timeline.duration-1;menu["covers"].gotoAndStop(targetFrame);currentRecIndex=recIndex};root.addEventListener("onPauseTimerStart",onMainTimerStart);root.addEventListener("onTransitionComplete",onTransComplete);var onButtonSelect=function(evt){var index=evt.currentTarget.name.slice(-1);var current=menu["covers"].timeline.position;catchTransEvent=true;logic.app.onPageMenuSelect(index-current);menu["covers"].gotoAndStop(parseInt(index));root.dispatchEvent(new logic.createJS.Event("onPageMenuSelect"))};for(var i=0;i<menu.getNumChildren();i++){var button=menu.getChildByName("product"+i);if(!button)continue;button.addEventListener("click",onButtonSelect)}}function ImageZoomComponent(container,params){var zoomImage,zoomImageBounds,shell;var calcXPos=function(mouseX){var xPos;if(zoomImageBounds.width<container.nominalBounds.width){xPos=container.nominalBounds.width/2-zoomImageBounds.width/2}else{xPos=(zoomImageBounds.width-container.nominalBounds.width)*(mouseX/container.nominalBounds.width);xPos=Math.min(-xPos,0)}return xPos};var calcYPos=function(mouseY){var yPos;if(zoomImageBounds.height<container.nominalBounds.height){yPos=container.nominalBounds.height/2-zoomImageBounds.height/2}else{yPos=(zoomImageBounds.height-container.nominalBounds.height)*(mouseY/container.nominalBounds.height);yPos=Math.min(-yPos,0)}return yPos};var onMouseMove=function(evt){var mouseLoc=container.globalToLocal(container.stage.mouseX,container.stage.mouseY);if(params["axis"]!="y")zoomImage.x=calcXPos(mouseLoc.x);if(params["axis"]!="x")zoomImage.y=calcYPos(mouseLoc.y);if(container.hitTest(mouseLoc.x,mouseLoc.y)==false||logic.app.getStage().mouseInBounds==false){shell.stage.removeEventListener("stagemousemove",onMouseMove);shell.removeAllChildren();container.parent.removeChild(shell);shell=null;container.visible=true;logic.app.resumeAnimation()}};var onImageLoad=function(img){shell=new createjs.Container;shell.regX=container.regX;shell.regY=container.regY;shell.x=container.x;shell.y=container.y;shell.name=logic.utils.getAssetIndex(container.name)!=-1?container.name:container.name+logic.utils.getParentIndex(container);logic.touch.product(shell);var scale=Math.min(container.nominalBounds.width/img.width,container.nominalBounds.height/img.height)*parseFloat(params["scaleFactor"]);if(logic.utils.isIE()==false){try{img=logic.processing.resize_image(img,scale)}catch(err){logic.tracking.sentryException(err,{tags:{action:"resize_image"}})}var sharpness=.1;if(initvars[logic.CONSTANTS.SHARPENING]!==undefined)sharpness=parseFloat(initvars[logic.CONSTANTS.SHARPENING]);try{logic.processing.sharpen_image(img,sharpness)}catch(err){logic.tracking.sentryException(err,{tags:{action:"sharpen_image"}})}zoomImage=new logic.createJS.Bitmap(img)}else{zoomImage=new logic.createJS.Bitmap(img);zoomImage.scaleX=zoomImage.scaleY=scale}zoomImageBounds=zoomImage.getBounds();var mouseLoc=container.globalToLocal(container.stage.mouseX,container.stage.mouseY);if(params["axis"]!="y")zoomImage.x=calcXPos(mouseLoc.x);if(params["axis"]!="x")zoomImage.y=calcYPos(mouseLoc.y);shell.addChild(zoomImage);if(params["drawBorder"]!=false){var border=new logic.createJS.Shape;var color=params["borderColor"]?params["borderColor"]:"#000000";border.graphics.beginStroke(color);var weight=params["borderThickness"]?params["borderThickness"]:1;border.graphics.setStrokeStyle(weight);border.snapToPixel=true;border.graphics.drawRect(0,0,container.nominalBounds.width,container.nominalBounds.height);shell.addChild(border)}var mask=new logic.createJS.Shape;mask.graphics.beginFill("#FF0000").drawRect(container.x-container.regX,container.y-container.regY,container.nominalBounds.width,container.nominalBounds.height);shell.mask=mask;container.parent.addChild(shell);container.visible=false;shell.mouseMoveOutside=true;shell.stage.addEventListener("stagemousemove",onMouseMove)};var onOver=function(){var rec=logic.app.getRecByContainer(container);logic.utils.loadImage(rec.getImageUrl(0),onImageLoad,logic.app.resumeAnimation);logic.app.pauseAnimation()};container.addEventListener("mouseover",onOver)}function VideoLoopComponent(root){var params=root["videoLoop"];var player=eval(params["object"]);if(!player)return;var video,bitmap;var onVideoError=function(evt){if(video){video.shutdown();video=null}var url=initvars[logic.CONSTANTS.VIDEO_LOOP_IMG]?initvars[logic.CONSTANTS.VIDEO_LOOP_IMG]:params["img_url"];logic.utils.loadImage(url,function(img){var scale=Math.min(player.nominalBounds.width/img.width,player.nominalBounds.height/img.height);bitmap=new logic.createJS.Bitmap(img);bitmap.scaleX=bitmap.scaleY=scale;player.addChild(bitmap)},function(xhr){logic.utils.log("Error: Could not load video loop or backup image!")})};var onVideoLoaded=function(evt){var source=video.getHtml();var bitmap=new logic.createJS.Bitmap(source.element);var scale=Math.min(player.nominalBounds.width/source.element.videoWidth,player.nominalBounds.height/source.element.videoHeight);bitmap.scaleX=bitmap.scaleY=scale;player.mouseEnabled=player.mouseChildren=false;player.removeAllChildren();player.addChildAt(bitmap,0);video.play()};if(logic.app.isMobile()){onVideoError();return}var loop=params["loop"]!==undefined&&logic.utils.getBool(params["loop"])==false?false:true;var url=initvars[logic.CONSTANTS.VIDEO_LOOP]?initvars[logic.CONSTANTS.VIDEO_LOOP]:params["vid_url"];video=logic.utils.createVideoPlacement(url,player.nominalBounds.width,player.nominalBounds.height,loop);video.id="liquidAdVideoLoop";video.onError=onVideoError;video.onLoaded=onVideoLoaded;video.onComplete=function(){if(params["showImageOnComplete"]==true){onVideoError()}if(params["onComplete"]!==undefined){params["onComplete"]()}};video.init();var onAnimTimerComplete=function(evt){root.removeEventListener("onAnimationTimerComplete",onAnimTimerComplete);video.pause()};root.addEventListener("onAnimationTimerComplete",onAnimTimerComplete)}function FlyoverImage(root){var stub=logic.tree.getAssetByName("flyover");if(stub){stub=stub[0]}else{stub=new logic.createJS.Container;stub.name="flyover";root.addChild(stub)}stub.alpha=0;logic.touch.nav(stub);var fadeTime=250,displayPause=2500;var onImageLoaded=function(u){var onTimer=function(){stub.alpha=0;logic.createJS.Tween.get(stub).to({alpha:1},fadeTime).wait(displayPause).to({alpha:0},fadeTime).call(function(){if(timer)timer.reset()})};var count=initvars[logic.CONSTANTS.FLYOVER_COUNT]?parseInt(initvars[logic.CONSTANTS.FLYOVER_COUNT]):3;var delay=(3e4-fadeTime*2*count-displayPause*count)/Math.max(2,count);var timer=logic.utils.getTimer(onTimer,delay);var onAnimLimit=function(e){if(stub.alpha==0)stub.visible=false;timer.stop();timer=null;root.removeEventListener("onEngagement",onAnimLimit);root.removeEventListener("onAnimationComplete",onAnimLimit)};root.addEventListener("onEngagement",onAnimLimit);root.addEventListener("onAnimationComplete",onAnimLimit)};var url=initvars[logic.CONSTANTS.FLYOVER_IMG]=="[failover]"?initvars.failTAG:initvars[logic.CONSTANTS.FLYOVER_IMG];root.loadExternalImage(url,stub,onImageLoaded)}return AdRollLiquidAds.timeline={init:function(root){root.reverse=function(mc,func){if(mc.timeline.position==0)return;var onFrame=function(evt){mc.gotoAndStop(mc.timeline.position-1);if(mc.timeline.position==0){mc.removeEventListener("tick",onFrame);if(func)func()}};mc.tickEnabled=true;mc.addEventListener("tick",onFrame)};root.getAssetByName=function(name){return logic.tree.getAssetByName(name)};root.findParentIndex=function(obj){return logic.utils.getParentIndex(obj)};root.pauseAnimation=function(){logic.app.pauseAnimation();if(autoBlink)autoBlink.pause()};root.resumeAnimation=function(){logic.app.resumeAnimation();if(autoBlink)autoBlink.resume()};root.stopAnimation=function(){logic.app.stopAnimation();if(autoBlink)autoBlink.stop()};root.selectProduct=function(idx){logic.app.onProductSelect("image"+idx)};root.loadExternalImage=function(url,stub,func){logic.utils.loadImage(url,function(img){var bitmap=new logic.createJS.Bitmap(img);stub.addChild(bitmap);func(url)},function(xhr){logic.utils.log(">> ERROR: Unable to load external image at: "+url)})};root.trace=function(msg){logic.utils.log(msg)};root.autoBlinkInstance=function(){return autoBlink||null};root.dscMenuInstance=function(){return dscMenu||null}},discover:function(root){if(root["autoBlink"]!==undefined){autoBlink=new AutoBlinkComponent(root)}if(root["pageMenu"]!==undefined){pageMenu=new PageMenuComponent(root)}if(initvars[logic.CONSTANTS.FLYOVER_IMG]!==undefined){flyoverImg=new FlyoverImage(root)}if(logic.app.isMobile()==true)return;if(root["dscMenu"]!==undefined){dscMenu=new InteractiveMenu(root)}if(root["videoLoop"]!==undefined){videoLoop=new VideoLoopComponent(root)}if(root["zoomComponent"]!==undefined){var params=root["zoomComponent"];if(!params["objects"])return;imageZoomList=[];for(var i=0;i<params["objects"].length;i++){imageZoomList.push(new ImageZoomComponent(eval(params["objects"][i]),params))}}},customButton:function(obj){var helper=new logic.createJS.ButtonHelper(obj,"out","over","down",true)}}})();(function(){var logic=AdRollLiquidAds;var SLICES=12;var RADIUS=6;var shell,timer;return AdRollLiquidAds.preloader={init:function(stage){shell=new logic.createJS.Container;shell.name="preloader";if(logic.touch)logic.touch.stage(shell);stage.addChild(shell);if(initvars[logic.CONSTANTS.PRELOAD_IMG]!==undefined){var url=initvars[logic.CONSTANTS.PRELOAD_IMG];if(url=="[failover]"){url=initvars.failTAG}else if(url=="[background]"){url=initvars[logic.CONSTANTS.BG_TAG]}logic.utils.loadImage(url,function(img){var bitmap=new logic.createJS.Bitmap(img);shell.addChild(bitmap);var onTimer=function(){};timer=setInterval(onTimer,999999999)},function(xhr){logic.preloader.activate(stage)})}else{logic.preloader.activate(stage)}},activate:function(stage){var screen=new logic.createJS.Shape;screen.graphics.beginStroke("#DDDDDD");screen.graphics.setStrokeStyle(1);screen.snapToPixel=true;screen.graphics.beginFill("#FFFFFF");screen.graphics.drawRect(0,0,stage.canvas.width,stage.canvas.height);shell.addChild(screen);var spinner=new logic.createJS.Container;shell.addChild(spinner);var getSlice=function(){var slice=new logic.createJS.Shape;slice.graphics.beginFill("666666");slice.graphics.drawRoundRect(-1,0,2,6,1);slice.graphics.endFill();return slice};var index=SLICES;var degrees=360/SLICES;while(index--){var slice=getSlice();slice.alpha=Math.max(.2,1-.1*index);var radianAngle=degrees*index*Math.PI/180;slice.rotation=-degrees*index;slice.x=Math.sin(radianAngle)*RADIUS;slice.y=Math.cos(radianAngle)*RADIUS;spinner.addChild(slice)}spinner.x=stage.canvas.width/2;spinner.y=stage.canvas.height/2;var onTimer=function(){spinner.rotation=(spinner.rotation+360/SLICES)%360;try{stage.update()}catch(e){logic.utils.log("ERROR: Can't update the stage from preloader due to: "+e.message)}};timer=setInterval(onTimer,65)},deactivate:function(){if(timer==null){return}window.clearInterval(timer);timer=null;logic.createJS.Tween.get(shell).to({alpha:0},300).call(logic.preloader.clear)},clear:function(){if(timer){window.clearInterval(timer);timer=null}if(shell){shell.removeAllChildren();shell=null}}}})();window.onload=function(){if(initvars.type!=AdRollLiquidAds.CONSTANTS.TYPE_DYNAMIC_TESTS){return AdRollLiquidAds.app.init()}};(function(){var logic=AdRollLiquidAds;var INIT_TIMEOUT=4;var PAUSE_TIME=5;var ANIM_LIMIT=30;var timer,stageWidth,stageHeight,recList,recIndex,fontLoadStats,productMap,startTime,exportRoot,isMobile,video,status;function attachCreative(){exportRoot=new logic.flashLib.product;logic.timeline.init(exportRoot);var canvas=document.getElementById("liquidAdCanvas");var stage=new logic.createJS.Stage(canvas);stage.addChild(exportRoot);try{stage.update()}catch(e){logic.utils.log("ERROR: Can't update the stage from attachCreative due to: "+e.message)}exportRoot.stop();exportRoot.visible=false;stageWidth=stage.canvas.width/stage.scaleX;stageHeight=stage.canvas.height/stage.scaleY;logic.touch.init(exportRoot);logic.preloader.init(stage);exportRoot.timeline.addEventListener("change",onTimelineChange);logic.createJS.Ticker.framerate=logic.flashLib.properties.fps;logic.createJS.Ticker.addEventListener("tick",onTick);if(window.devicePixelRatio){var canvasHeight=canvas.height;var canvasWidth=canvas.width;canvas.width=Math.round(canvasWidth*window.devicePixelRatio);canvas.height=Math.round(canvasHeight*window.devicePixelRatio);canvas.style.width=canvasWidth+"px";canvas.style.height=canvasHeight+"px";stage.scaleX=stage.scaleY=window.devicePixelRatio}var context=canvas.getContext("2d");context.imageSmoothingQuality="high";context.mozImageSmoothingEnabled=true;context.webkitImageSmoothingEnabled=true;context.msImageSmoothingEnabled=true;context.imageSmoothingEnabled=true;if(exportRoot.customFont!==undefined){WebFontConfig.fontactive=WebFontConfig.fontinactive=onFontLoadResolved;fontLoadStats={count:0,target:0,wait:false};logic.utils.loadFonts(exportRoot,fontLoadStats)}try{logic.tree.discover(exportRoot)}catch(err){logic.tracking.sentryException(err,{tags:{action:"tree_discover"}})}try{logic.timeline.discover(exportRoot)}catch(err){logic.tracking.sentryException(err,{tags:{action:"timeline_discover"}})}}function onTick(){try{logic.app.getStage().update()}catch(e){if(logic.createJS.Ticker.getMeasuredFPS()<logic.createJS.Ticker.framerate){var fps=logic.createJS.Ticker.framerate>10?logic.createJS.Ticker.framerate-1:logic.createJS.Ticker.framerate;logic.createJS.Ticker.framerate=fps}logic.utils.log("ERROR: Can't update the stage from tick handler due to: "+e.message)}}function onFontLoadResolved(fam,fvd){fontLoadStats.count++;logic.utils.log(">> Font resolved: "+fontLoadStats.count+" of "+fontLoadStats.target+" loaded.");if(fontLoadStats.count==fontLoadStats.target&&fontLoadStats.wait==true){start()}}function onBkgrdResolved(){if(logic.tree.getAssetByName("logo")&&initvars[logic.CONSTANTS.LOGO_TAG]!==undefined){logic.utils.loadImage(initvars[logic.CONSTANTS.LOGO_TAG],function(img){var stub=logic.tree.getAssetByName("logo")[0];var bitmap=logic.tree.setImage(img,stub);stub.removeAllChildren();stub.addChild(bitmap);logic.touch.stage(stub);logic.datamodel.init();

},function(xhr){logic.utils.log("ERROR: Could not load the logo image!");logic.datamodel.init()});return}if(initvars.type!=logic.CONSTANTS.TYPE_DYNAMIC_TWA||initvars[logic.CONSTANTS.PRODUCT_DATA]!==undefined){logic.datamodel.init()}}function onVideoLoaded(evt){var container=logic.tree.getAssetByName("video")[0];container.mouseEnabled=container.mouseChildren=false;var bitmap=new logic.createJS.Bitmap(video.getHtml().element);var player=container.getChildByName("player")?container.getChildByName("player"):container;player.addChildAt(bitmap,0);video.play();logic.preloader.deactivate()}function onVideoComplete(evt){status="running";start();var stub=logic.tree.getAssetByName("video")[0];logic.createJS.Tween.get(stub).to({alpha:0},300).call(function(){stub.removeAllChildren();exportRoot.removeChild(stub);video.shutdown();video=null})}function onVideoError(evt){logic.tree.getAssetByName("video")[0].visible=false;video.shutdown();video=null;status="running";start()}function fail(error,msg){if(status=="failed")return;status="failed";if(timer){timer.stop();timer=null}var renderImage=function(img){var scale=1;if(exportRoot){logic.preloader.clear();var stage=exportRoot.getStage();scale=stage.scaleX<1?1:stage.scaleX;logic.createJS.Ticker.removeAllEventListeners();stage.enableDOMEvents(false);stage.removeAllChildren();stage.autoClear=true;stage.clear()}var canvas=document.getElementById("liquidAdCanvas");var context=canvas.getContext("2d");canvas.style.cursor="pointer";var width=img.width*scale;var height=img.height*scale;var left=0+(canvas.width-width)/2;var top=0+(canvas.height-height)/2;context.drawImage(img,left,top,width,height);context.translate(.5,.5);context.strokeStyle="#000";context.lineWidth=2*scale;context.strokeRect(0,0,canvas.width,canvas.height);canvas.addEventListener("click",function(e){logic.app.onStageSelect(null,"failover")})};var loadFailoverImage=function(){logic.utils.loadImage(initvars.failTAG,renderImage,function(xhr){logic.utils.log("ERROR: Could not load failover image!")})};var loadExternalFailoverImage=function(){logic.utils.loadImageWithDOM(initvars.externalFailTAG,function(img){img.width==1&&img.height==1?loadFailoverImage():renderImage(img)},function(xhr){logic.utils.log("ERROR: Could not load external failover image!");loadFailoverImage()},true)};if(initvars.externalFailTAG){loadExternalFailoverImage()}else{loadFailoverImage()}logic.tracking.logEvent(logic.CONSTANTS.EVENT_FAILURE,{code:error,reason:msg});var initStats=logic.datamodel.getInitLoadStats();var message="> FAILURE SUMMARY\n";if(!initStats){message+="• Stats never initialized."}else{message+="• code: "+error+"\n";message+="• prods: "+initStats.valid_prods.join()+"\n";message+="• valid recs: "+initStats.valid_recs.join()+"\n";message+="• invalid recs: "+initStats.invalid_recs.join()+"\n";message+="• img loads: "+initStats.img_load_suc+" of "+initStats.img_load_att+"\n";initStats.fail_time=(new Date).getTime()-initStats.start_time.getTime();message+="• fail time: "+initStats.fail_time+" ms\n";message+="• pixel density: "+window.devicePixelRatio+"\n";message+="• init vars:\n";for(var prop in initvars){message+="  - "+prop+": "+initvars[prop]+"\n"}}logic.utils.log(message)}function start(){if(fontLoadStats&&fontLoadStats.count<fontLoadStats.target){logic.utils.log(">> Check Font WAIT: "+fontLoadStats.count+" of "+fontLoadStats.target+" loaded.");fontLoadStats.wait=true;return}else{fontLoadStats=null}exportRoot.visible=true;if(status=="video"){video=logic.utils.createVideoPlacement(initvars[logic.CONSTANTS.VIDEO_TAG],stageWidth,stageHeight,false);video.id="liquidAdVideo";video.onError=onVideoError;video.onLoaded=onVideoLoaded;video.onComplete=onVideoComplete;video.init();return}logic.tracking.logEvent(logic.CONSTANTS.EVENT_OK,{});for(var index=1;index<=logic.tree.getNumImages();index++){var rec=recList[nextRecIndex()];var assets=logic.tree.getAssetByName("image"+index);if(!assets)assets=[];if(initvars[logic.CONSTANTS.DYN_VIDEO])assets=assets.concat(logic.tree.getAssetByName("video"+index));for(var i=0;i<assets.length;i++){var container=assets[i];logic.tree.populate(index,rec);logic.touch.product(container)}mapAssetsToRec(productMap,index,rec);onProductImpression(rec)}logic.tree.setStaticText();logic.tree.setSalePriceOption();if(initvars[logic.CONSTANTS.THEME_COLOR_OVERRIDE]!==undefined){logic.tree.setThemeColor(initvars[logic.CONSTANTS.THEME_COLOR_OVERRIDE])}var revealPause=WebFontConfig.adroll?400:10;setTimeout(logic.preloader.deactivate,revealPause);startTime=(new Date).getTime();if(logic.utils.getBool(initvars[logic.CONSTANTS.AUTO_SCROLL])==true&&logic.tree.getNumImages()>1&&recList.length>1&&initvars.type!=logic.CONSTANTS.TYPE_DYNAMIC_TWA&&logic.datamodel.getMaxRecs()>=logic.datamodel.getMinRecs()){timer=logic.utils.getTimer(onAnimationTimer,PAUSE_TIME*1e3);exportRoot.dispatchEvent(new logic.createJS.Event("onPauseTimerStart"))}else{var animTimer=logic.utils.getTimer(onAnimationTimerComplete,ANIM_LIMIT*1e3);if(recList.length==1){if(logic.tree.getAssetByName("next"))logic.tree.getAssetByName("next")[0].visible=false;if(logic.tree.getAssetByName("previous"))logic.tree.getAssetByName("previous")[0].visible=false}}exportRoot.dispatchEvent(new logic.createJS.Event("onDisplayStart"))}function onTransitionComplete(){var tempMap={};var numImages=logic.tree.getNumImages();for(var index=1;index<=numImages;index++){var swapRec=index<numImages?productMap["image"+(index+1)]:recList[nextRecIndex()];logic.tree.populate(index,swapRec);mapAssetsToRec(tempMap,index,swapRec);onProductImpression(swapRec)}productMap=tempMap;exportRoot.dispatchEvent(new logic.createJS.Event("onTransitionComplete"))}function transitionToRecIndex(goto_index){var tempMap={};var numImages=logic.tree.getNumImages();recIndex=goto_index-1;for(var index=1;index<=numImages;index++){var rec=recList[nextRecIndex()];logic.tree.populate(index,rec);mapAssetsToRec(tempMap,index,rec);onProductImpression(rec)}productMap=tempMap}function onTimelineChange(evt){var timeline=evt.currentTarget;var currentFrame=timeline.position;var totalFrames=timeline.duration;if(currentFrame==totalFrames-1){onTransitionComplete();exportRoot.gotoAndStop(0);if(status!="stopped"&&logic.utils.getBool(initvars[logic.CONSTANTS.AUTO_SCROLL])==true){timer=logic.utils.getTimer(onAnimationTimer,PAUSE_TIME*1e3);exportRoot.dispatchEvent(new logic.createJS.Event("onPauseTimerStart"))}}}function waitForTransitionOk(func){var checkTransitionOk=function(){var isOk=true;if(logic.datamodel.imgLoadComplete()==false){var target=Math.abs((recIndex+logic.tree.getNumImages())%recList.length);var index=recIndex>=0?recIndex:0;while(index<=target){if(recList[index].areAllImagesLoaded()==false){isOk=false;logic.utils.log(">> Check Image WAIT: "+recList[index].id);break}index++;if(index==recList.length){isOk=false;break}}}return isOk};if(checkTransitionOk()==false){var onLoadTimer=function(){if(checkTransitionOk()==true){window.clearInterval(transTimer);transTimer=null;func()}};var transTimer=setInterval(onLoadTimer,150)}else{func()}}function onAnimationTimer(){if(timer&&timer.stop){timer.stop();timer=null}if(status=="stopped")return;var now=new Date;if(now.getTime()-startTime<ANIM_LIMIT*1e3){waitForTransitionOk(function(){exportRoot.dispatchEvent(new logic.createJS.Event("onPauseTimerComplete"));transition("forward")})}else{onAnimationTimerComplete()}}function onAnimationTimerComplete(){exportRoot.dispatchEvent(new logic.createJS.Event("onAnimationTimerComplete"));var experiment=logic.datamodel.getExperiment();if(experiment&&experiment.hasOwnProperty("params")&&experiment.params.hasOwnProperty(logic.CONSTANTS.ANIMATION_END_INDEX)){transitionToRecIndex(parseInt(experiment.params[logic.CONSTANTS.ANIMATION_END_INDEX]))}stopAnimation()}function nextRecIndex(){recIndex=Math.abs((recIndex+1)%recList.length);return recIndex}function mapAssetsToRec(map,idx,rec){map["image"+idx]=map["button"+idx]=map["text"+idx]=rec}function next(){transition("forward")}function previous(){for(var index=logic.tree.getNumImages();index>1;index--){var rec=productMap["image"+(index-1)];logic.tree.populate(index,rec);mapAssetsToRec(productMap,index,rec)}var lastRec=productMap["image1"];var lastIndex=recList.indexOf(lastRec)-1;if(lastIndex==-1)lastIndex=recList.length-1;rec=recList[lastIndex];logic.tree.populate(1,rec);mapAssetsToRec(productMap,1,rec);transition("back")}function engagement(act){if(act=="next"||act=="previous"){act=="next"?next():previous();if(timer!=null){timer.stop();timer=null;stopAnimation()}}exportRoot.dispatchEvent(new logic.createJS.Event("onEngagement"));logic.tracking.logEvent(logic.CONSTANTS.EVENT_ENGAGEMENT,{action:act})}function transition(dir){if(dir=="forward"){exportRoot.play()}else{exportRoot.timeline.removeEventListener("change",onTimelineChange);exportRoot.gotoAndStop(exportRoot.timeline.duration-1);exportRoot.addEventListener("tick",reverse)}exportRoot.dispatchEvent(new logic.createJS.Event("onTransitionStart"))}function reverse(evt){exportRoot.gotoAndStop(exportRoot.timeline.position-1);if(exportRoot.timeline.position==0){exportRoot.removeEventListener("tick",reverse);exportRoot.timeline.addEventListener("change",onTimelineChange);exportRoot.dispatchEvent(new logic.createJS.Event("onTransitionComplete"))}}function stopAnimation(){status="stopped";exportRoot.dispatchEvent(new logic.createJS.Event("onAnimationComplete"));logic.utils.log(">> Animation stopped.")}function getRecTracking(rec){var track={pid:rec.id,src:rec.source,pos:recList.indexOf(rec)+1,algo_data:{}};for(var key in rec.data){if(rec.data.hasOwnProperty(key)){if(key.charAt(0)=="_"){track.algo_data[key.substr(1)]=rec.getRawData(key)}}}if(initvars[logic.CONSTANTS.TRACK_DATA]!==undefined){track.field_data={};var fields=initvars[logic.CONSTANTS.TRACK_DATA].split(",");for(var i=0;i<fields.length;i++){var data=rec.getRawData(fields[i]);if(data)track.field_data[fields[i]]=data}}if(rec.getAction()!="")track.action=rec.getAction();track.price_normalized=rec.getRawData("price_normalized");track.locale=rec.getRawData("locale");track.product_date=rec.getRawData("product_date");track.pghash=rec.getRawData("pghash");return track}function onProductImpression(rec){logic.tracking.logEvent(logic.CONSTANTS.EVENT_IMPRESSION,getRecTracking(rec))}return AdRollLiquidAds.app={init:function(){if(window.Raven){Raven.config("https://24abae72615b4964b0128f599eabce22@app.getsentry.com/53552",{release:logic.CONSTANTS.getVersion(),tags:{demo:logic.utils.isDemo(),debug:logic.utils.isDebug(),eid:logic.utils.getEID()},ignoreErrors:logic.CONSTANTS.SENTRY_IGNORE_ERRS}).install()}status="init";isMobile=logic.utils.isMobile();if(initvars[logic.CONSTANTS.INIT_LATENCY]!=undefined)INIT_TIMEOUT=parseInt(initvars[logic.CONSTANTS.INIT_LATENCY]);if(initvars[logic.CONSTANTS.TRANSITION_TIME]!=undefined)PAUSE_TIME=parseInt(initvars[logic.CONSTANTS.TRANSITION_TIME]);if(initvars[logic.CONSTANTS.FONT_URL]!=undefined)logic.CONSTANTS.ADROLL_FONT_CSS=initvars[logic.CONSTANTS.FONT_URL];attachCreative();if(initvars.type==logic.CONSTANTS.TYPE_DYNAMIC_TWA){logic.harness.init()}if(logic.tree.getNumImages()>0){var onInitTimer=function(){var stats=logic.datamodel.getInitLoadStats();if(stats&&stats.valid_recs.length>0){if(timer.numResets()==0){logic.utils.log(">> Resetting init timer ... ");timer.setDelay(2e3);timer.reset();return}}timer.stop();timer=null;fail(logic.CONSTANTS.FAIL_LATENCY,"ERROR: Init timer ran out.")};timer=logic.utils.getTimer(onInitTimer,INIT_TIMEOUT*1e3);if(initvars[logic.CONSTANTS.RETINA_BG]&&logic.utils.isRetina()){initvars[logic.CONSTANTS.BG_TAG]=initvars[logic.CONSTANTS.RETINA_BG]}if(!initvars[logic.CONSTANTS.BG_TAG])initvars[logic.CONSTANTS.BG_TAG]="white";initvars.isTemplatedDynamicAd=typeof initvars.template_id=="string"&&initvars.template_id.indexOf("twa")==0;if(logic.utils.isSafari5()){fail(logic.CONSTANTS.FAIL_UNSUPPORTED,"ERROR: Cannot load on Safari 5.")}else if(initvars[logic.CONSTANTS.BG_TAG].indexOf("/")!=-1&&!initvars.isTemplatedDynamicAd){logic.utils.loadImage(initvars[logic.CONSTANTS.BG_TAG],function(img){var cont=logic.tree.getAssetByName("bkgrd");var scale=Math.min(cont.nominalBounds.width/img.width,cont.nominalBounds.height/img.height);if(scale!=1)cont.scaleX=cont.scaleY=scale;cont.image=img;onBkgrdResolved()},function(xhr){fail(logic.CONSTANTS.FAIL_LOAD_CREATIVE,"ERROR: Could not load background image.")})}else{if(initvars.isTemplatedDynamicAd){initvars[logic.CONSTANTS.BG_TAG]="#FFFFFF"}exportRoot.stage.canvas.style.background=initvars[logic.CONSTANTS.BG_TAG];onBkgrdResolved()}}else{fail(logic.CONSTANTS.FAIL_LOAD_CREATIVE,"ERROR: Could not display creative")}},startDisplay:function(){if(status=="failed"){logic.utils.log(">> ERROR: Init timer ran out before all content was successfully loaded!");return}if(status!="init"){logic.utils.log(">> STATUS: Ad already running when startDisplay() called again.");return}if(initvars[logic.CONSTANTS.PRELOAD_LATENCY]!==undefined){var latency=parseFloat(initvars[logic.CONSTANTS.PRELOAD_LATENCY])*1e3;var diff=(new Date).getTime()-timer.getStartTime();if(diff<latency){var onPreloadTimer=function(){window.clearInterval(preloadTimer);preloadTimer=null;logic.app.startDisplay()};if(timer)timer.stop();var preloadTimer=setInterval(onPreloadTimer,latency-diff+10);return}}if(timer&&timer.stop){timer.stop();timer=null}recList=logic.datamodel.getRecList();productMap={};recIndex=-1;status=initvars[logic.CONSTANTS.VIDEO_TAG]&&logic.tree.getAssetByName("video")&&!isMobile?"video":"running";waitForTransitionOk(start)},onProductSelect:function(name){var rec=productMap[name];if(!rec){logic.app.onStageSelect(null);return}logic.utils.log(">>> PRODUCT:: "+name+": "+rec.id);logic.app.navigate(logic.utils.getDestinationUrl(rec.getProductUrl(),rec.clientId));var tracking=getRecTracking(rec);tracking.coords=logic.touch.getClickPos();tracking.click_origin="product";logic.tracking.logEvent(logic.CONSTANTS.EVENT_CLICK,tracking)},navigate:function(url){if(!url)url=initvars.clickTAG;window.open(url,"_blank")},onStageSelect:function(loc,src){var url=loc||null;var id=null;var tracking={};if(initvars[logic.CONSTANTS.STAGE_CLICK]!==undefined){url=initvars[logic.CONSTANTS.STAGE_CLICK];if(initvars[logic.CONSTANTS.STAGE_CLICK].toLowerCase()==="clicktag"){url=null}}else if(status=="video"){src="video"}else if(productMap&&url==null&&src!="logo"){var rec=productMap["image1"];if(rec){url=rec.getProductUrl();id=rec.clientId;tracking=getRecTracking(rec)}}var consoleId=rec?rec.id:id;logic.utils.log(">>> STAGE: "+consoleId);logic.app.navigate(logic.utils.getDestinationUrl(url,id));tracking.coords=logic.touch.getClickPos();tracking.click_origin=src?src:"stage";logic.tracking.logEvent(logic.CONSTANTS.EVENT_CLICK,tracking)},onNavClick:function(act){switch(act){case"action":logic.app.onStageSelect(initvars[logic.CONSTANTS.CTA_URL],"action");break;case"next":case"previous":engagement(act);break;case"flyover":var url=initvars[logic.CONSTANTS.FLYOVER_CLICK]||null;logic.app.onStageSelect(url,"flyover");break;default:engagement(act);if(!initvars[logic.CONSTANTS.ADD_NAV])return;var navArray=initvars[logic.CONSTANTS.ADD_NAV].split(",");for(var i=0;i<navArray.length;i++){var pair=navArray[i];var instance=pair.substring(0,pair.indexOf(":"));var url=pair.substring(pair.indexOf(":")+1);if(instance==act){logic.app.onStageSelect(decodeURIComponent(logic.utils.decode_html(url)),act);break}}}},onFail:function(code,message){fail(code,message)},pauseAnimation:function(){if(timer&&status=="running"){timer.pause()}exportRoot.stop()},resumeAnimation:function(){if(timer&&status=="running"){timer.resume()}if(exportRoot.timeline.position>0){exportRoot.play()}},stopAnimation:function(){if(status=="running"){stopAnimation()}},onPageMenuSelect:function(delta){var numImgs=logic.tree.getNumImages();recIndex=recList.indexOf(productMap["image"+(numImgs-1)])+delta;if(recIndex>=recList.length)recIndex=recIndex-recList.length;if(recIndex<0)recIndex=recList.length-recIndex;var rec=recList[recIndex];logic.tree.populate(numImgs,rec);mapAssetsToRec(productMap,numImgs,rec);next();if(timer!=null){timer.stop();timer=null;stopAnimation()}},isStopped:function(){return status=="stopped"},isMobile:function(){return isMobile},isFailed:function(){return status=="failed"},getRoot:function(){return exportRoot},getStage:function(){return exportRoot.stage},getStageDimensions:function(){return{width:stageWidth,height:stageHeight}},getPauseTime:function(){return PAUSE_TIME},getRecByContainer:function(cont){var key=logic.utils.getAssetIndex(cont.name)!=-1?cont.name:cont.name+logic.utils.getParentIndex(cont);return productMap[key]},getFocusedRecIndex:function(){return recList.indexOf(productMap["image1"])}}})();
//# sourceMappingURL=https://s.adroll.com/liquidads/html5/lib/armature.js.map