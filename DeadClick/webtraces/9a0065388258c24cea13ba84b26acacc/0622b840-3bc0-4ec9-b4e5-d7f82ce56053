/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(c){c.pkg("s7sdk.image");if(c.browser.name==="ie"&&c.browser.version.major<"11"){c.Util.require("s7sdk.image.rgn.View")}else{c.Util.require("s7sdk.image.View")}c.Util.require("s7sdk.common.IS");c.Util.require("s7sdk.common.IconEffect");c.Util.require("s7sdk.common.ItemDesc");c.Util.require("s7sdk.event.InputController2");if(!c.image.ZoomViewControl){c.image.ZoomViewControl=function(d){arguments.callee.superclass.apply(this,[d,c.image.ZoomViewControl.NS,d.constructor,c.image.ZoomView.RESTRICTED_STYLES])};c.image.ZoomViewControl.NS="s7sdk.image.ZoomViewControl";c.image.ZoomViewControl.prototype.getCurrentAsset=function(){return this.component.getAsset()};c.image.ZoomViewControl.prototype.setCurrentAsset=function(d){this.component.setAsset(d)}}c.Class.inherits(c.image.ZoomViewControl.NS,"s7sdk.ControlComponent");if(!c.image.ZoomView){c.image.ZoomView=function ZoomView(e,h,g){var j=!!arguments[3];c.Logger.log(c.Logger.CONFIG,"s7sdk.image.ZoomView constructor - container: %0, settings: %1 , compId: %2",e,h,g);arguments.callee.superclass.apply(this,[g,e,"div","s7zoomview",h,!j]);g=(typeof g=="string"&&g.length)?g:"ZoomView_"+c.Util.createUniqueId();this.id=(c.Util.isNull(g)?"":g);this.createElement();this.container=this.getParent();if(this.container.tagName=="DIV"&&(!this.container.style.position||this.container.style.position=="static")){this.container.style.position="relative"}this.preloadIdx=null;if(this.enableHD.enable.toLowerCase()=="always"){this.enableHD.maxHdPixels=-1}else{if(this.enableHD.enable.toLowerCase()=="never"){this.enableHD.maxHdPixels=0}else{if(this.enableHD.enable.toLowerCase()=="limit"){if(NaN==this.enableHD.maxHdPixels){this.enableHD.maxHdPixels=2250000}else{this.enableHD.maxHdPixels=this.enableHD.maxHdPixels*this.enableHD.maxHdPixels}}else{this.enableHD.maxHdPixels=2250000}}}this.view=null;if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}this.compId=(c.Util.isNull(g)?"":g);this.locale=this.getParam("locale","");this.imageModifier=c.MediaSetParser.parseAssetForSetReq(this.asset).mod;this.wid=this.stagesize.width;this.hei=this.stagesize.height;if(this.wid==0||this.hei==0){this.wid=this.size.width;this.hei=this.size.height}if(this.wid==0||this.hei==0){this.wid=parseInt(c.Util.css.getCss("s7zoomview","width",this.compId,null,this.container));this.hei=parseInt(c.Util.css.getCss("s7zoomview","height",this.compId,null,this.container));if(!c.Util.isNumber(this.wid)||!c.Util.isNumber(this.hei)||this.wid<=0||this.hei<=0){if("clientHeight" in this.container&&"clientWidth" in this.container){this.wid=this.container.clientWidth;this.hei=this.container.clientHeight}if(this.wid==0||this.hei==0){this.wid=400;this.hei=400}}}this.devicePixelRatio=c.Util.adjustDevicePixelRatio(this.enableHD.maxHdPixels,this.hei,this.wid);this.outWidth=this.wid*this.devicePixelRatio;this.outHeight=this.hei*this.devicePixelRatio;this.item=null;this.timerSetItemDelayed=null;this.clickToZoom=0;if((/reset/i).test(this.singleclick)){this.clickToZoom|=c.Enum.CLICK_STATE.CLICK_TO_RESET}if((/zoom/i).test(this.singleclick)){this.clickToZoom|=c.Enum.CLICK_STATE.CLICK_TO_ZOOM}if((/reset/i).test(this.doubleclick)){this.clickToZoom|=c.Enum.CLICK_STATE.DOUBLE_CLICK_TO_RESET}if((/zoom/i).test(this.doubleclick)){this.clickToZoom|=c.Enum.CLICK_STATE.DOUBLE_CLICK_TO_ZOOM}var i=this.serverUrl+"/"+c.MediaSetParser.parseAssetForSetReq(this.asset).req;if(c.Util.isNonEmptyString(this.locale)){i+="&locale="+this.locale}this.mediaSet=null;this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";if(this.frametransition.transition=="slide"||this.frametransition.transition=="fade"){this.prevFrame={};this.obj.style.overflow="hidden";this.spacing=this.frametransition.transition=="fade"?0:this.frametransition.spacing*this.wid;this.container3=c.Util.createObj(null,"div",null,null);this.container3.style.zIndex=0;this.container3.style.position="absolute";this.container3.style.left=-this.getSwipeAreaWidth()+"px";this.container3.style.width=3*this.getSwipeAreaWidth()+"px";this.container3.style.height=this.hei+"px";this.tempDisplay=new c.ViewWrapper(this,1,1,0,this.hei,0,this.spacing,900);this.displ=new c.ViewWrapper(this,this.outWidth,this.outHeight,this.wid,this.hei,1,this.spacing,910);this.addIE78overlay();this.displayElement=this.displ.displayElement;this.left=new c.ViewWrapper(this,this.outWidth,this.outHeight,this.wid,this.hei,0,this.spacing,900);this.right=new c.ViewWrapper(this,this.outWidth,this.outHeight,this.wid,this.hei,2,this.spacing,920);this.container3.appendChild(this.tempDisplay.obj);this.container3.appendChild(this.left.obj);this.container3.appendChild(this.displ.obj);this.container3.appendChild(this.right.obj);this.obj.appendChild(this.container3);this.initialSlide=false;this.view=null}else{this.container3=c.Util.createObj(null,"div",null,null);this.container3.style.zIndex=0;this.container3.style.position="absolute";this.container3.style.left=0+"px";this.container3.style.width=this.wid+"px";this.container3.style.height=this.hei+"px";this.spacing=0;this.tempDisplay=new c.ViewWrapper(this,1,1,0,this.hei,0,this.spacing,900);this.displ=new c.ViewWrapper(this,this.outWidth,this.outHeight,this.wid,this.hei,0,this.spacing,910);this.addIE78overlay();this.displayElement=this.displ.displayElement;this.container3.appendChild(this.tempDisplay.obj);this.container3.appendChild(this.displ.obj);this.obj.appendChild(this.container3)}this.moved=false;this.displayElement.s7gesture=new c.Gesture();this.attachToContainer();this.displayElement.onselectstart=function(){return false};this.iconEffectObj=new c.IconEffect(this,this.iconEffect.enabled,this.iconEffect.count,this.iconEffect.fade,this.iconEffect.autoHide);var f=this;if(!(this.frametransition.transition=="none")){this.iconEffectObj.iconEffectDiv_.style.zIndex=1000}this.iconEffectVisible=true;this.handler=new c.event.InputController2(this.obj);this.handler.startTouchCallback=function(l,k,n){if(f.view){f.dragStarted=false;f.startX=k;f.startY=n;f.detectEventOwner=true;f.componentOwnsEvent=true;f.startScrollX=window.scrollX;f.startScrollY=window.scrollY;var m=f.view.state;f.isStartLeft=!(m&16);f.isStartRight=!(m&32)}};this.handler.singleTapCallback=function(l,k,m){if(f.swipeController.isAnimationInProgress()){return}k-=c.Util.getObjPos(f.obj).x;m-=c.Util.getObjPos(f.obj).y;if(f.view){if(f.clickToZoom&c.Enum.CLICK_STATE.CLICK_TO_ZOOM){if(f.clickToZoom&c.Enum.CLICK_STATE.CLICK_TO_RESET){if(f.view.state&1){f.view.zoomClick(k,m,l.shiftKey)}else{f.view.zoomReset()}}else{f.view.zoomClick(k,m,l.shiftKey)}}else{if(f.view.clickToZoom&c.Enum.CLICK_STATE.CLICK_TO_RESET){f.view.zoomReset()}}}c.Event.dispatch(f.obj,c.Event.CLICK,false)};this.handler.doubleTapCallback=function(l,k,m){if(f.swipeController.isAnimationInProgress()){return}k-=c.Util.getObjPos(f.obj).x;m-=c.Util.getObjPos(f.obj).y;if(f.view){if(f.clickToZoom&c.Enum.CLICK_STATE.DOUBLE_CLICK_TO_ZOOM){if(f.clickToZoom&c.Enum.CLICK_STATE.DOUBLE_CLICK_TO_RESET){if(f.view.state&1){f.view.zoomClick(k,m,l.shiftKey)}else{f.view.zoomReset()}}else{f.view.zoomClick(k,m,l.shiftKey)}}else{if(f.clickToZoom&c.Enum.CLICK_STATE.DOUBLE_CLICK_TO_RESET){f.view.zoomReset()}}}};this.handler.swipeCallback=function(k){if(f.view){if(!(f.state&4)&&f.swipe){if(f.componentOwnsEvent){f.swipeController.animate(k);f.dragStarted=false}}else{if(f.dragStarted){f.swipeController.animate(k);f.dragStarted=false}else{f.view.inPinch=false;f.view.inPan=false;f.view.doPan(0,0,false);f.invalidate();var l=new c.event.UserEvent(c.event.UserEvent.PAN,[],true);c.Event.dispatch(f.obj,l,false)}}f.setInPan(false)}};this.handler.dragCallback=function(l,p,m,o,n){if(f.detectEventOwner&&(f.startScrollX!=window.scrollX||f.startScrollY!=window.scrollY)){f.componentOwnsEvent=false;f.detectEventOwner=false}if(f.view){if(!(f.state&4)&&f.swipe){if(f.detectEventOwner){var s=Math.abs(f.startX-p);var r=Math.abs(f.startY-m);if(s>0||r>0){f.componentOwnsEvent=s>r;if((f.leftEdge&&(f.startX-p)<0)||(this.rightEdge&&(f.startX-p)>0)){f.componentOwnsEvent=false}}else{return}}if(f.componentOwnsEvent){f.detectEventOwner=false;l.preventDefault();f.swipeController.processDrag(l,o,n)}}else{var k=f.view.state;var q=Math.abs(o)>Math.abs(n);if((!(k&128)&&n<=0&&!q)||(!(k&64)&&n>=0&&!q)){if(f.detectEventOwner){f.componentOwnsEvent=false;f.detectEventOwner=false}}else{if(f.detectEventOwner){if(f.isStartLeft){if(!(k&16)){if(o>0&&q){if(f.swipe==1){f.dragStarted=true}}else{f.isStartLeft=false}}}if(f.isStartRight){if(!(k&32)){if(o<0&&q){if(f.swipe==1){f.dragStarted=true}}else{f.isStartRight=false}}}}if(f.componentOwnsEvent){if(f.dragStarted){f.detectEventOwner=false;l.preventDefault();f.swipeController.processDrag(l,o,n)}else{if(!f.isStartLeft&&!f.isStartRight){f.detectEventOwner=false;l.preventDefault();f.view.inPan=true;f.view.doPan(o,n,true);f.setInPan(true)}}}}}}};this.handler.endDragCallback=function(n,k,p,m,l){if(f.view){if(!(f.state&4)&&f.swipe){f.swipeController.processEndDrag(n,k,p,m,l);f.dragStarted=false}else{f.view.inPinch=false;f.view.inPan=false;if(f.dragStarted){f.swipeController.processEndDrag(n,k,p,m,l)}else{f.view.doPan(0,0,false);f.invalidate();var o=new c.event.UserEvent(c.event.UserEvent.PAN,[],true);c.Event.dispatch(f.obj,o,false)}f.setInPan(false);f.dragStarted=false}}};this.handler.pinchCallback=function(l,k,n,m){if(f.view){k-=c.Util.getObjPos(f.obj).x;n-=c.Util.getObjPos(f.obj).y;f.view.inPinch=true;f.view.pinchZoom(k,n,m,f.view.viewToImage)}};this.handler.endPinchCallback=function(l,k,n,m){if(f.view){if(f.dragStarted||f.componentOwnsEvent){f.swipeController.processEndDrag(l,k,n)}f.view.inPinch=false;f.view.inPan=false;c.Logger.log(c.Logger.FINEST,"s7sdk.image.ZoomView.endPinchCallback - invalidate");f.view.invalidate(false);f.invalidate();if(f.userEventScale!=f.lastScale){f.userEventScale=f.lastScale;userEvent=new c.event.UserEvent(c.event.UserEvent.ZOOM,[f.lastScale],true);c.Event.dispatch(f.obj,userEvent,false)}}};this.swipeController=new c.event.SwipeController(this.frametransition.duration,this.getSwipeAreaWidth(),this.hei,this.swipe);this.swipeController.onStep=function(k){if(!f.moved&&f.frametransition.transition!="none"){f.moved=true;f.dispatchTransitionEvent(c.event.FrameEvent.NOTF_FRAME_TRANSITION_START)}if(f.frametransition.transition=="slide"){f.forceDraw("left",f.getSwipeAreaWidth()*(k-1)+"px")}else{if(f.frametransition.transition=="fade"){if(k!=0){if(k>0){if(f.left.obj.style.left!=(f.getSwipeAreaWidth()+"px")){f.left.obj.style.left=f.getSwipeAreaWidth()+"px";f.right.obj.style.left=2*f.getSwipeAreaWidth()+"px"}f.setOpacity(f.left.displayElement,Math.abs(k))}else{if(f.right.obj.style.left!=(f.getSwipeAreaWidth()+"px")){f.left.obj.style.left="0px";f.right.obj.style.left=f.getSwipeAreaWidth()+"px"}f.setOpacity(f.right.displayElement,Math.abs(k))}}else{if(f.left.obj.style.left!=(f.getSwipeAreaWidth()+"px")){f.left.obj.style.left=f.getSwipeAreaWidth()+"px";f.right.obj.style.left=2*f.getSwipeAreaWidth()+"px"}f.setOpacity(f.left.displayElement,0);f.setOpacity(f.right.displayElement,0)}f.setOpacity(f.displ.displayElement,1-Math.abs(k))}else{}}};this.swipeController.onStart=function(){if(f.frametransition.transition=="fade"){if(c.browser.device.name=="android"&&c.browser.device.version=="4"){f.container3.style.display="none";var k=f.container3.offsetWidth;f.container3.style.display="block"}}};this.swipeController.onStop=function(k){if(k==0){f.dispatchTransitionEvent(c.event.FrameEvent.NOTF_FRAME_TRANSITION_END)}else{f.animationStop(k)}f.moved=false};if(c.browser.name==="ie"&&c.browser.version.minor<=8){var d=f.handler;this.handlerOverlay=new c.event.InputController2(this.iconEffectObj);this.handlerOverlay.singleTapCallback=function(l,k,m){d.singleTapCallback(l,k,m)};this.handlerOverlay.doubleTapCallback=function(l,k,m){d.doubleTapCallback(l,k,m)};this.handlerOverlay.flickCallback=function(k){d.flickCallback(k)};this.handlerOverlay.swipeCallback=function(n,k,o,m,l){d.swipeCallback(n,k,o)};this.handlerOverlay.endSwipeCallback=function(n,k,o,m,l){d.endSwipeCallback(n,k,o)};this.handlerOverlay.pinchCallback=function(l,k,n,m){d.pinchCallback(l,k,n)};this.handlerOverlay.endPinchCallback=function(l,k,n,m){d.endPinchCallback(l,k,n)}}this.iconEffectVisibility={show:function(){f.iconEffectVisible=true;f.checkIconEffect()},hide:function(){f.iconEffectVisible=false;f.checkIconEffect()}};this.viewIsReadySent=false;this.hiresIsReadySent=false;if(this.asset&&this.asset.length>0){this.isReq=new c.IS(this.serverUrl,this.asset);this.currentAsset=this.asset;this.isReq.getHttpReq(i,function(l,k){c.image.ZoomView.prototype.loadRequest.apply(k,[l])},null,this)}if(!j){return new c.image.ZoomViewControl(this)}else{return this}};c.Class.inherits("s7sdk.image.ZoomView","s7sdk.UIComponent");c.image.ZoomView.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},asset:{params:["asset"],defaults:[""],parseParams:false},iscommand:{params:["value"],defaults:[""],parseParams:false},stagesize:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true},size:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true},zoomStep:{params:["step","limit"],defaults:[1,1],ranges:["0:","0.1:"]},rgn:{params:["x","y","w","h"],defaults:[0,0,0,0]},rgnN:{params:["x","y","w","h"],defaults:[0,0,0,0]},transition:{params:["time","easing"],defaults:[0.5,0],ranges:["0:","0:5"]},singleclick:{params:["singleclick"],defaults:["none"],ranges:[["none","zoom","reset","zoomReset"]]},doubleclick:{params:["doubleclick"],defaults:["zoomReset"],ranges:[["none","zoom","reset","zoomReset"]]},reset:{params:["reset"],defaults:[true]},frametransition:{params:["transition","duration","spacing"],ranges:[["none","fade","slide"],"0:","0:1"],defaults:["none",0.3,0]},enableHD:{params:["enable","maxHdPixels"],defaults:["limit",1500],ranges:[["always","never","limit"],"1:"]},iconEffect:{params:["enabled","count","fade","autoHide"],defaults:[true,1,0.3,3],ranges:[,"-1:","0:","0:"]},elasticZoom:{params:["elasticzoom"],defaults:[0],ranges:["0.0:1.0"],deprecated:true},swipe:{params:["swipe"],defaults:[true]},fmt:{params:["fmt"],defaults:["jpg"],ranges:[["jpg","jpeg","png","png-alpha","gif","gif-alpha"]]}};c.image.ZoomView.RESTRICTED_STYLES={s7zoomview:["width","height"],"s7zoomview s7iconeffect":["width","height"]};c.image.ZoomView.prototype.setCSS=function(f,e,d){if(this.isRestrictedCSSProperty(c.image.ZoomView.RESTRICTED_STYLES,e)){throw new Error("You cannot set "+f+" : "+e+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[f,e,d])}};c.image.ZoomView.prototype.setModifier=function(d){throw new Error("Trying to use setModifier on the Core class (ZoomView) is unsupported! Please refer to SDK documentation on using setModifier.")};c.image.ZoomView.prototype.disposeView=function(){if(this.timerSetItemDelayed){clearTimeout(this.timerSetItemDelayed);this.timerSetItemDelayed=null}if(this.swipeController){this.swipeController.dispose();this.swipeController=null}if(this.handler){this.handler.detach(this.obj)}if(this.handlerOverlay&&this.iconEffectObj){this.handlerOverlay.detach(this.iconEffectObj)}if(this.view){this.view.detach();this.view.unload(8);this.view.viewParent=null}if(this.left){if(this.left.view){this.left.view.detach();this.left.view.unload(8)}this.left.dispose();delete this.left}if(this.right){if(this.right.view){this.right.view.detach();this.right.view.unload(8)}this.right.dispose();delete this.right}if(this.displ){if(this.displ.view){this.displ.view.detach();this.displ.view.unload(8)}this.displ.dispose();delete this.displ}if(this.tempDisplay){if(this.tempDisplay.view){this.tempDisplay.view.detach();this.tempDisplay.view.unload(8)}this.tempDisplay.dispose();delete this.tempDisplay}this.displayElement=null;delete this.iconEffectVisibility};c.image.ZoomView.prototype.dispatchTransitionEvent=function(f){var e=this.getIndexFromItem(this.item);var d=new c.event.FrameEvent(f,this.item,e,false);c.Event.dispatch(this.obj,d,false)};c.image.ZoomView.prototype.cleanUp=function(){this.disposeView();if(this.iconEffectObj){this.iconEffectObj.dispose();this.iconEffectObj=null}this.prevFrame=null;this.onReadyToDislpay=null;if(this.container3){this.container3.parentNode.removeChild(this.container3)}c.Util.removeTags(this.obj);this.obj.style.cssText=""};c.image.ZoomView.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};c.image.ZoomView.prototype.addIE78overlay=function(){if(c.browser.name==="ie"&&c.browser.version.minor<=8){var d=document.createElement("div");d.className="s7zoomview";d.style.position="absolute";d.style.top="0px";d.style.left="0px";d.style.width=this.wid+"px";d.style.height=this.hei+"px";d.style.backgroundColor="rgb(0,0,0)";d.style.filter="alpha(opacity =0)";d.style.zIndex=915;this.ovrl=d;this.displ.obj.appendChild(d)}};c.image.ZoomView.prototype.addEventListener=function(f,e,d){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.addEventListener - type: %0, handler: %1, useCapture: %2",f,e.toString().substring(0,e.toString().indexOf("(")),d);this.superproto.addEventListener.apply(this,[f,e,d])};c.image.ZoomView.prototype.sendStatusEvent=function(d){if(d.viewReady){if(!this.hiresIsReadySent){var e=new c.event.StatusEvent(c.event.StatusEvent.NOTF_HIGHRES_VIEW_READY,true);c.Event.dispatch(this.obj,e,false);this.hiresIsReadySent=true}}if(!d.viewReady){if(!this.viewIsReadySent){var e=new c.event.StatusEvent(c.event.StatusEvent.NOTF_VIEW_READY,true);c.Event.dispatch(this.obj,e,false);this.viewIsReadySent=true}d.viewReady=true}};c.image.ZoomView.prototype.setItemDelayed=function(){var d=this.delayed;this.delayed=null;this.setItem(d)};c.image.ZoomView.prototype.setItem=function(p){if(this.swipeController){if(this.delayed){this.delayed=p;return}if(this.swipeController.isAnimationInProgress()){this.delayed=p;var j=this;this.timerSetItemDelayed=setTimeout(function(){j.setItemDelayed()},50);return}}c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.setItem - item: %0",p);if(this.isReq){this.isReq.cancelHttpReq()}if(p instanceof c.ItemDesc==false){throw new Error("Item must be a descendant of ItemDesc!")}this.currentAsset=p;if(p.parent==null){throw new Error("ItemDesc must be part of a parent set!")}if(!(this.frametransition.transition=="none")){var d=false;var g=false;this.msFrame=-1;if(this.mediaSet==null||this.item==null){g=false}else{g=this.compareSet(this.mediaSet,p.parent,["name","items.length"]);if(g){var m=this.mediaSet.items;var n=p.parent.items;if(m.length==n.length){for(var h=0;h<m.length;h++){var k=this.compareSet(m[h],n[h],["name","version"]);if(!k){g=k;break}}}}d=this.compareSet(this.item,p,["name","version"]);this.msFrame=this.getIndexFromItem(this.item)}if(g&&d){return}this.mediaSet=p.parent;this.viewIsReadySent=false;this.hiresIsReadySent=false;var f=this.setSwipeCapability(p);if(this.view){this.initialSlide=true;this.createViewExt(this.item,this.msFrame>f?this.left:this.right)}else{this.initialSlide=false;this.createView(this.item);var o=Math.min(Math.max(0,f-1),this.mediaSet.items.length-1);var l=Math.min(Math.max(0,f+1),this.mediaSet.items.length-1);if(f==(this.mediaSet.items.length-1)){this.createViewExt(this.mediaSet.items[o],this.left)}else{if(f==0){this.createViewExt(this.mediaSet.items[l],this.right)}else{this.createViewExt(this.mediaSet.items[o],this.left);this.createViewExt(this.mediaSet.items[l],this.right)}}}}else{this.mediaSet=p.parent;this.viewIsReadySent=false;this.hiresIsReadySent=false;this.setSwipeCapability(p);this.createView(this.item)}if(c.browser.device.name=="desktop"){c.Util.css.setCSSAttributeSelector(this.obj,"cursortype","zoomin")}var e=new c.event.StatusEvent(c.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);c.Event.dispatch(this.obj,e,false)};c.image.ZoomView.prototype.setSwipeCapability=function(e){this.item=e;var d=this.getIndexFromItem(this.item);if(this.swipe==0){this.leftEdge=this.rightEdge=true;this.swipeController.setSwipeCapability(true,true)}else{this.leftEdge=d==0;this.rightEdge=d==this.mediaSet.items.length-1;this.swipeController.setSwipeCapability(this.leftEdge,this.rightEdge)}return d};c.image.ZoomView.prototype.compareSet=function(l,g,i){this.getVal=function(n,m){if(m.length==0){return n}var o=m.shift();var j=n[o];return this.getVal(j,m)};for(var f=0;f<i.length;f++){var k=i[f];var e=k.split(".");var h=this.getVal(l,e);e=k.split(".");var d=this.getVal(g,e);if(h!=d){return false}}return true};c.image.ZoomView.prototype.doInitialSlide=function(){if(!this.initialSlide||!this.view){return}this.initialSlide=false;var d=this.getIndexFromItem(this.item);this.preloadIdx=Math.min(Math.max(0,d+1),this.mediaSet.items.length-1);this.swipeController.animate(this.msFrame>d?"left":"right")};c.image.ZoomView.prototype.loadRequest=function(d){this.mediaSet=c.MediaSetParser.parse(d.set,this.imageModifier);if(this.mediaSet.items.length>0&&this.mediaSet.items[0] instanceof c.ItemDesc){if(!(this.frametransition.transition=="none")&&this.mediaSet.items.length>1){this.createViewExt(this.mediaSet.items[1],this.right)}this.setSwipeCapability(this.mediaSet.items[0]);this.createView(this.item);var e=new c.event.StatusEvent(c.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);c.Event.dispatch(this.obj,e,false)}else{throw new Error("Set response did not contain valid items! Set may be empty.")}};c.image.ZoomView.prototype.createViewExt=function(g,d){if(d.view){d.view.unload(1|8)}var e=new c.Rectangle(0,0,g.width,g.height);var h=g.name;function f(j,i,k){j+=((j.indexOf("?")==-1)?"?":"&")+i;j+=(typeof k=="undefined")?"":"="+k;return j}if(this.iscommand!=null&&this.iscommand.length>0){h=f(h,this.iscommand)}if(c.Util.isNonEmptyString(this.locale)){h=f(h,"locale",this.locale)}if(c.Util.isNonEmptyString(g.version)){h=f(h,"id",g.version)}d.view=this.createViewElement(this.serverUrl+h,e.width,e.height,this.outWidth,this.outHeight,this.devicePixelRatio,this.zoomStep.step,this.zoomStep.limit,this.transition.time,this.transition.easing,null,this.elasticZoom,this.clickToZoom,this.fmt,0,true);d.view.viewParent=d;if(this.devicePixelRatio!=d.view.devicePixelRatio){this.adjustDevicePixelRatio()}d.view.attach(d);if(d.view.resetImageLoaded){d.onReadyToDislpay()}};c.image.ZoomView.prototype.createViewElement=function(g,k,t,d,j,s,p,u,v,q,f,m,h,e,l,o,i,r){var n;if(c.browser.name==="ie"&&c.browser.version.major<"11"){n=new c.rgn.View(g,k,t,d,j,s,p,u,v,q,f,m,h,e,l,o)}else{n=new c.View(g,k,t,d,j,s,p,u,v,q,f,m,h,e,l,o)}return n};c.image.ZoomView.prototype.adjustDevicePixelRatio=function(){this.devicePixelRatio=1;this.swipeController.resize(this.getSwipeAreaWidth(),this.hei);this.outWidth=this.wid;this.outHeight=this.hei;this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";this.displ.resize(this.outWidth,this.outHeight,this.wid,this.hei,this.devicePixelRatio);if(this.ovrl){this.ovrl.style.width=this.wid+"px";this.ovrl.style.height=this.hei+"px"}if(!(this.frametransition.transition=="none")){this.container3.style.left=-this.getSwipeAreaWidth()+"px";this.container3.style.width=3*this.getSwipeAreaWidth()+"px";this.container3.style.height=this.hei+"px";this.left.resize(this.outWidth,this.outHeight,this.wid,this.hei,this.devicePixelRatio);this.right.resize(this.outWidth,this.outHeight,this.wid,this.hei,this.devicePixelRatio)}else{this.container3.style.left=0+"px";this.container3.style.width=this.wid+"px";this.container3.style.height=this.hei+"px"}if(c.browser.device.name=="android"&&c.browser.device.version=="4"){var d=this.container3.offsetWidth}if(this.iconEffectObj.enabled){this.iconEffectObj.centerOverlay(this.wid,this.hei)}if(this.view){this.view.devicePixelRatio=this.devicePixelRatio;this.view.resize(this.wid,this.hei);this.view.invalidate(true)}};c.image.ZoomView.prototype.createView=function(k){var h=null;if(this.view){if(!this.reset){h=this.view.getViewPort()}this.view.unload(1|8)}var l=new c.Rectangle(this.rgnN.x,this.rgnN.y,this.rgnN.w,this.rgnN.h);if(!l.isEmpty()){h=l;this.rgnN.x=this.rgnN.y=this.rgnN.w=this.rgnN.h=0}var e=new c.Rectangle(this.rgn.x/k.width,this.rgn.y/k.height,this.rgn.w/k.width,this.rgn.h/k.height);if(!e.isEmpty()){h=e;this.rgn.x=this.rgn.y=this.rgn.w=this.rgn.h=0}var g=new c.Rectangle(0,0,k.width,k.height);var f=k.name;function i(n,m,o){n+=((n.indexOf("?")==-1)?"?":"&")+m;n+=(typeof o=="undefined")?"":"="+o;return n}if(this.iscommand!=null&&this.iscommand.length>0){f=i(f,this.iscommand)}if(c.Util.isNonEmptyString(this.locale)){f=i(f,"locale",this.locale)}if(c.Util.isNonEmptyString(k.version)){f=i(f,"id",k.version)}this.view=this.createViewElement(this.serverUrl+f,g.width,g.height,this.outWidth,this.outHeight,this.devicePixelRatio,this.zoomStep.step,this.zoomStep.limit,this.transition.time,this.transition.easing,h,this.elasticZoom,this.clickToZoom,this.fmt,0,true);this.view.viewParent=this;if(this.devicePixelRatio!=this.view.devicePixelRatio){this.adjustDevicePixelRatio()}if(this.container){this.view.attach(this)}this.viewStateChange(this.view.state);this.settings.trackLoad(this);var j=this.getIndexFromItem(k);var d=new c.AssetEvent(c.event.AssetEvent.ASSET_CHANGED,k,j,true);if(!this.delayed){this.dispatchEvent(d)}};c.image.ZoomView.prototype.getIndexFromItem=function(g){if(this.mediaSet==null){throw new Error("Cannot get index of item because media-set is does not exist!")}var f=-1;var e=this.mediaSet.items;for(var d=0;d<e.length;d++){if(g&&e[d].name==g.name){f=d;break}}return f};c.image.ZoomView.prototype.setAsset=function(d){if(typeof d!="string"){throw new Error("Asset name must be represented by a string!")}c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.setAsset - asset: %0",d);if(d==""){return}var g=this.asset;this.currentAsset=d;this.asset=unescape(d);this.mediaSet=null;this.viewIsReadySent=false;this.hiresIsReadySent=false;var e=this.serverUrl+"/"+c.MediaSetParser.parseAssetForSetReq(this.asset).req;if(c.Util.isNonEmptyString(this.locale)){e+="&locale="+this.locale}if(this.isReq){this.isReq.cancelHttpReq()}this.isReq=new c.IS(this.serverUrl,this.asset);this.isReq.getHttpReq(e,function(i,h){c.image.ZoomView.prototype.loadRequest.apply(h,[i])},null,this);if(g!=this.asset&&g!=null){var f=new c.event.UserEvent(c.event.UserEvent.SWAP,[0,this.asset],true);c.Event.dispatch(this.obj,f,false)}};c.image.ZoomView.prototype.getAsset=function(){return(this.asset?this.asset:this.mediaSet.name)};c.image.ZoomView.prototype.zoomIn=function(){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.zoomIn");if(this.view){this.view.zoomIn()}};c.image.ZoomView.prototype.zoomOut=function(){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.zoomOut");if(this.view){this.view.zoomOut()}};c.image.ZoomView.prototype.zoomReset=function(){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.zoomReset");if(this.view){this.view.zoomReset()}};c.image.ZoomView.prototype.zoomNPan=function(e,d){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.zoomNPan - dx: %0, dy: %1",e,d);if(this.view){this.view.doNPan(e,d)}};c.image.ZoomView.prototype.zoomNRgn=function(d){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.zoomNRgn - rgn: %0",d);if(this.view){this.view.zoomNRgn(d)}};c.image.ZoomView.prototype.zoomRgn=function(d){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.zoomRgn - rgn: %0",d);if(this.view){this.view.zoomRgn(d)}};c.image.ZoomView.prototype.viewInvalidate=function(j){var g=new c.Rectangle(Math.round(j.x*this.view.imageWidth),Math.round(j.y*this.view.imageHeight),Math.round(j.width*this.view.imageWidth),Math.round(j.height*this.view.imageHeight));c.Event.dispatch(this.obj,new c.event.ZoomRgnEvent(c.event.ZoomRgnEvent.NOTF_ZOOM_NRGN,j),false);c.Event.dispatch(this.obj,new c.event.ZoomRgnEvent(c.event.ZoomRgnEvent.NOTF_ZOOM_RGN,g),false);if(!this.lastViewPort||this.lastViewPort.isEmpty()||j.equals(this.lastViewPort)){this.lastViewPort=j;return}var e=this.imagePixelsToViewPoint(g.topLeft());var d=this.imagePixelsToViewPoint(g.bottomRight());var h=(d.y-e.y)/(j.height*this.view.imageHeight);h=Math.round((h+0.00005)*10000)/100;if(h!=this.lastScale){if(!this.view.inTransition){}this.lastScale=h}else{var i=this.imagePixelsToViewPoint(new c.Point2D(Math.round(this.lastViewPort.x*this.view.imageWidth),Math.round(this.lastViewPort.y*this.view.imageHeight)));var l=Math.round(i.x-e.x);var k=Math.round(i.y-e.y);if(l!=0||k!=0){var f=new c.event.ZoomPanEvent(c.event.ZoomPanEvent.NOTF_ZOOM_NPAN,this.lastViewPort.x-j.x,this.lastViewPort.y-j.y);c.Event.dispatch(this.obj,f,false);f=new c.event.ZoomPanEvent(c.event.ZoomPanEvent.NOTF_ZOOM_PAN,l,k);c.Event.dispatch(this.obj,f,false)}}this.lastViewPort=j};c.image.ZoomView.prototype.viewTransitionStop=function(){var d=new c.event.UserEvent(c.event.UserEvent.ZOOM,[this.lastScale],true);c.Event.dispatch(this.obj,d,false)};c.image.ZoomView.prototype.setInPan=function(d){if(this.state&4){if(this.inPan!=(d&&(this.state&4))){this.inPan=d&&(this.state&4);this.cursorChange(this.view.state)}}else{if(this.frametransition.transition=="slide"){this.inPan=d;this.cursorChange(this.view.state|(d?2048:0))}}};c.image.ZoomView.prototype.cursorChange=function(g){if(c.browser.device.name!="desktop"){return}var e=["default","zoomin","reset","drag","slide"];var d=g==0?0:(this.inPan?((g&2048)?4:3):(g&8?1:2));if(this.prevCur==d){return}this.prevCur=d;c.Util.css.setCSSAttributeSelector(this.obj,"cursortype",e[d]);var f=this.obj.offsetWidth};c.image.ZoomView.prototype.viewStateChange=function(d){var e=this.state!=d;this.state=d;this.cursorChange(d);if(e){this.dispatchEvent(new c.event.CapabilityStateEvent(c.event.CapabilityStateEvent.NOTF_ZOOM_CAPABILITY_STATE,new c.ZoomCapabilityState(this.state)))}this.checkIconEffect()};c.image.ZoomView.prototype.checkIconEffect=function(){if(this.iconEffectObj&&this.iconEffectObj.enabled){if(!this.iconEffectVisible||(this.state&4)||(this.state==0)){this.iconEffectObj.hide()}else{if(this.iconEffectVisible){this.iconEffectObj.show(this.wid,this.hei)}}}};c.image.ZoomView.prototype.getWidth=function(){return this.wid};c.image.ZoomView.prototype.getHeight=function(){return this.hei};c.image.ZoomView.prototype.resize=function(f,d){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.resize - width: %0, height: %1",f,d);if(f==this.wid&&d==this.hei){return}this.wid=f;this.hei=d;this.swipeController.resize(this.getSwipeAreaWidth(),d);this.devicePixelRatio=c.Util.adjustDevicePixelRatio(this.enableHD.maxHdPixels,this.hei,this.wid);if(this.view){this.view.devicePixelRatio=this.devicePixelRatio}this.outWidth=this.wid*this.devicePixelRatio;this.outHeight=this.hei*this.devicePixelRatio;this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";this.displ.resize(this.outWidth,this.outHeight,f,d,this.devicePixelRatio);if(this.ovrl){this.ovrl.style.width=this.wid+"px";this.ovrl.style.height=this.hei+"px"}if(!this.displ.view&&this.view){this.view.resize(f*this.devicePixelRatio,d*this.devicePixelRatio);this.view.draw()}if(!(this.frametransition.transition=="none")){this.container3.style.left=-this.getSwipeAreaWidth()+"px";this.container3.style.width=3*this.getSwipeAreaWidth()+"px";this.container3.style.height=this.hei+"px";this.left.resize(this.outWidth,this.outHeight,f,d,this.devicePixelRatio);if(this.left.displayElement.view){this.left.displayElement.view.resize(f*this.devicePixelRatio,d*this.devicePixelRatio);this.left.displayElement.view.draw()}this.right.resize(this.outWidth,this.outHeight,f,d,this.devicePixelRatio);if(this.right.displayElement.view){this.right.displayElement.view.resize(f*this.devicePixelRatio,d*this.devicePixelRatio);this.right.displayElement.view.draw()}}else{this.container3.style.left=0+"px";this.container3.style.width=this.wid+"px";this.container3.style.height=this.hei+"px"}if(c.browser.device.name=="android"&&c.browser.device.version=="4"){var e=this.container3.offsetWidth}if(this.iconEffectObj.enabled){this.iconEffectObj.centerOverlay(f,d)}this.dispatchEvent(new c.event.ResizeEvent(c.event.ResizeEvent.COMPONENT_RESIZE,f,d,false));c.UIComponent.prototype.resize.apply(this,[f,d])};c.image.ZoomView.prototype.forceDraw=function(e,f){this.container3.style[e]=f;if(c.browser.device.name=="android"&&c.browser.device.version=="4"){this.container3.style.display="none";var d=this.container3.offsetWidth;this.container3.style.display="block"}};c.image.ZoomView.prototype.setOpacity=function(e,d){if(c.browser.name=="ie"){if((c.browser.version.minor>5.5)&&(c.browser.version.minor<=8)&&(document.body.filters)){e.style.filter="alpha(opacity ="+(d*100)+")"}else{e.style.opacity=d}}else{e.style.opacity=d}};c.image.ZoomView.prototype.animationStop=function(g){var e;var f;e=this.getIndexFromItem(this.item);if(this.preloadIdx!=null){f=this.preloadIdx;this.preloadIdx=null;if(g==1){this.finalizeReplace(this.right,this.left,f,true)}else{this.finalizeReplace(this.left,this.right,f,false)}var d=Math.min(Math.max(0,e-1),this.mediaSet.items.length-1);this.createViewExt(this.mediaSet.items[d],this.left);this.forceDraw("left",-this.getSwipeAreaWidth()+"px");this.checkAssetChanged(e);return}f=Math.min(Math.max(0,e+(g==1?-2:2)),this.mediaSet.items.length-1);e=Math.min(Math.max(0,e+(g==1?-1:1)),this.mediaSet.items.length-1);if(this.frametransition.transition=="none"){this.prevFrame=this.item;this.selectItemByIndex(e);this.checkAssetChanged(e);return}if(this.frametransition.transition=="fade"){this.left.obj.style.left="0px";this.right.obj.style.left=2*this.getSwipeAreaWidth()+"px";this.setOpacity(this.displ.displayElement,1);this.setOpacity(this.left.displayElement,0);this.setOpacity(this.right.displayElement,0)}this.replaceFrame(true,e,f);this.forceDraw("left",-this.getSwipeAreaWidth()+"px");this.checkAssetChanged(e)};c.image.ZoomView.prototype.checkAssetChanged=function(d){if(typeof(d)!="undefined"){var f=this.mediaSet.items[d];if(this.prevFrame.idx!=d||this.prevFrame.setname!=f.parent.name){this.prevFrame.idx=d;this.prevFrame.setname=f.parent.name;var e=new c.AssetEvent(c.event.AssetEvent.ASSET_CHANGED,f,d,true);if(!this.delayed){this.dispatchEvent(e)}}}};c.image.ZoomView.prototype.replaceFrame=function(d,e,f){if(d){if(e<f||f==(this.mediaSet.items.length-1)){this.finalizeReplace(this.left,this.right,f)}else{this.finalizeReplace(this.right,this.left,f)}}this.setSwipeCapability(this.mediaSet.items[e])};c.image.ZoomView.prototype.finalizeReplace=function(d,f,g,e){if(!this.view){return}this.view.detach();if(d.view){d.view.detach();d.view.unload(1|8)}d.view=this.view;d.view.viewParent=d;d.view.attach(d);if(d.view.state&4){d.view.zoomReset()}else{d.view.draw()}f.view.detach();this.view=f.view;this.view.viewParent=this;this.view.attach(this);this.view.draw();this.viewStateChange(this.view.state);f.view=null;this.createViewExt(this.mediaSet.items[g],e?d:f);if(this.frametransition.transition=="fade"){this.setOpacity(this.displ.displayElement,1);this.right.changePosition(false);this.left.changePosition(false)}};c.image.ZoomView.prototype.selectItemByIndex=function(d){if(this.mediaSet&&d>=0&&d<this.mediaSet.items.length){this.setItem(this.mediaSet.items[d])}else{throw new Error("Invalid index or media-set!")}};c.image.ZoomView.prototype.invalidate=function(){};c.image.ZoomView.prototype.imagePixelsToViewPoint=function(e){if(this.view==null){return new c.Point2D(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}var d=this.view.imagePixelsToViewPoint(e);var g=new c.Point2D(0,0);d.x=d.x+g.x;d.y=d.y+g.y;var f=new c.Point2D(e.x-g.x,e.y-g.y);return d};c.image.ZoomView.prototype.viewPointToImagePixels=function(d){if(this.view==null){return new c.Point2D(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}var f=new c.Point2D(0,0);var e=new c.Point2D(d.x-f.x,d.y-f.y);return this.view.viewPointToImagePixels(e)};c.image.ZoomView.prototype.getCapabilityState=function(){c.Logger.log(c.Logger.FINE,"s7sdk.image.ZoomView.getCapabilityState");return new c.ZoomCapabilityState(this.state)};c.image.ZoomView.prototype.getSwipeAreaWidth=function(){return this.wid+this.spacing};c.image.ZoomView.prototype.getCurrentAsset=function(){return typeof this.currentAsset=="undefined"?null:this.currentAsset};c.image.ZoomView.prototype.setCurrentAsset=function(d){this.viewIsReadySent=true;this.hiresIsReadySent=true;if(typeof(d)=="string"){this.setAsset(d)}else{this.setItem(d)}};c.ZoomView=c.image.ZoomView;(function b(){var f=c.Util.css.createCssRuleText;var e=c.Util.css.createCssImgUrlText;var d=f(".s7zoomview",{width:"400px",height:"400px",position:"absolute","background-color":"#FFFFFF","user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","text-align":"left"})+f(".s7zoomview img",{width:"auto","max-width":"none !important","max-height":"none !important"})+f(".s7zoomview[cursortype='default']",{cursor:"default"})+f(".s7zoomview[cursortype='zoomin']",{cursor:"default"})+f(".s7zoomview[cursortype='reset']",{cursor:"default"})+f(".s7zoomview[cursortype='drag']",{cursor:"default"})+f(".s7zoomview[cursortype='slide']",{cursor:"default"})+f(".s7zoomview .s7iconeffect",{width:"120px",height:"120px","-webkit-transform":"translateZ(0px)","background-repeat":"no-repeat","background-position":"center"})+f(".s7zoomview .s7iconeffect[media-type='standard']",{"background-image":e("doubletapicon.png")})+f(".s7zoomview .s7iconeffect[media-type='multitouch']",{"background-image":e("zoomicon.png")});c.Util.css.addDefaultCSS(d,"ZoomView")})()}if(!c.ViewWrapper){c.ViewWrapper=function a(j,e,i,d,g,f,l,k){this.parentObj=j;this.leftPos=f;this.spacing=l;this.w=d;this.obj=c.Util.createObj(null,"div",null,null);this.obj.style.zIndex=k;if(c.browser.name==="ie"&&c.browser.version.major<"11"){this.displayElement=c.rgn.View.createDisplay()}else{this.displayElement=c.View.createDisplay()}this.displayElement.width=e;this.displayElement.height=i;this.displayElement.style.position="absolute";this.obj.style.position="absolute";this.displayElement.style.width=this.obj.style.width=d+"px";this.displayElement.style.height=this.obj.style.height=g+"px";this.obj.style.left=f*(d+l)+"px";this.obj.style.width=(d+l)+"px";this.obj.appendChild(this.displayElement);this.loresIsloaded=false};c.ViewWrapper.prototype.changePosition=function(d){this.obj.style.left=(d?1:this.leftPos)*(this.w+this.spacing)+"px"};c.ViewWrapper.prototype.viewStateChange=function(d){};c.ViewWrapper.prototype.viewInvalidate=function(d){};c.ViewWrapper.prototype.onReadyToDislpay=function(){this.loresIsloaded=true;if(this.parentObj&&this.parentObj.doInitialSlide){this.parentObj.doInitialSlide()}};c.ViewWrapper.prototype.resize=function(f,i,e,g,d){this.displayElement.width=f;this.displayElement.height=i;this.displayElement.style.width=this.obj.style.width=e+"px";this.displayElement.style.height=this.obj.style.height=g+"px";this.obj.style.left=this.leftPos*(e+this.spacing)+"px";this.obj.style.width=(e+this.spacing)+"px";this.w=e;if(this.view){this.view.resize(e*d,g*d);this.view.draw()}};c.ViewWrapper.prototype.dispatchEvent=function(d){if(this.parentObj){this.parentObj.dispatchEvent(d)}};c.ViewWrapper.prototype.dispose=function(){this.parentObj=null;c.Util.removeTags(this.obj)};c.ViewWrapper.prototype.sendStatusEvent=function(d){if(d){if(this.parentObj&&this.parentObj.sendStatusEvent){this.parentObj.sendStatusEvent(d)}}}}})(s7getCurrentNameSpace());