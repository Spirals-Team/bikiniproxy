/*!
 * Echo - v10.0.0, 2017-11-22, from git revision 5d4963d2a832541e44f26857c2de18c7286f9c86.
 * Copyright (c) 2017 BBC, all rights reserved.
 * 
 * Copyright (c) 2014 comScore, Inc.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.echo_js=t():e.echo_js=t()}(this,function(){return function(e){function t(n){if(s[n])return s[n].exports;var a=s[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var s={};return t.m=e,t.c=s,t.i=function(e){return e},t.d=function(e,s,n){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=31)}([function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(e,t,s,n){var a={};return a[i.COMSCORE_CUSTOMER_ID]=e,a[i.COMSCORE_SITE]=t,a[i.COMSCORE_HOST]=s,a[i.SSC_HOSTNAME]=n,a}function n(e){return t(o.PUBLIC_SERVICE,e,"sa.bbc.co.uk",".co.uk")}function a(e,s){return t(e,s,"scorecardresearch.com",".com")}var i=s(3),o={PUBLIC_SERVICE:"16060501",GNL:"19293874",WORLD_SERVICE:"19999701",WORLDWIDE_FEATURES:"19774467",STORE_NONCOMMERCIAL:"19774474",STORE_COMMERCIAL:"19774472",AFFILIATES_ACCEPTANCE:"18897612",BRITBOX:"23239715",BRITBOX_ACCEPTANCE:"18897612"},r={};return r.PUBLIC_SERVICE=n("bbc"),r.PUBLIC_SERVICE_STAGE=n("stage"),r.PUBLIC_SERVICE_TEST=n("test"),r.PUBLIC_SERVICE_INT=n("int"),r.PUBLIC_SERVICE_INTRANET=n("intranet"),r.GNL=a(o.GNL,"bbc"),r.GNL_ACCEPTANCE=a(o.AFFILIATES_ACCEPTANCE,"gnl-test"),r.WORLD_SERVICE=a(o.WORLD_SERVICE,"bbc"),r.WORLD_SERVICE_ACCEPTANCE=a(o.AFFILIATES_ACCEPTANCE,"ws-test"),r.WORLDWIDE_FEATURES=a(o.WORLDWIDE_FEATURES,"bbc"),r.WORLDWIDE_FEATURES_ACCEPTANCE=a(o.AFFILIATES_ACCEPTANCE,"features-test"),r.STORE_NONCOMMERCIAL=a(o.STORE_NONCOMMERCIAL,"bbc"),r.STORE_COMMERCIAL=a(o.STORE_COMMERCIAL,"bbc"),r.BRITBOX_ACCEPTANCE=a(o.BRITBOX_ACCEPTANCE,"bbc-global-test"),r.BRITBOX=a(o.BRITBOX,"bbc"),{ApplicationType:{WEB:"web",MOBILE_WEB:"mobile-web",RESPONSIVE:"responsive",MOBILE_APP:"mobile-app",BIGSCREEN_HTML:"bigscreen-html",BIGSCREEN_FLASH:"bigscreen-flash",BIGSCREEN_APP:"bigscreen-app",BIGSCREEN_CAST:"bigscreen-cast",DESKTOP_APP:"desktop-app"},WindowState:{FULL:"full",NORMAL:"norm",MINIMISED:"min",MAXIMISED:"max",PICTUREINPICTURE:"picture-in-picture"},MediaIdType:{VERSION:"version",CLIP:"clip",EPISODE:"episode",SERVICE:"service",VPID:"vpid",NONPIPSCONTENTID:"nonpipscontentid"},AvType:{AUDIO:"audio",VIDEO:"video"},RetrievalType:{STREAM:"stream",DOWNLOAD:"download"},Form:{LONG:"long",SHORT:"short"},PIPsType:{CLIP:"clip",EPISODE:"ep"},MediaConsumptionMode:{ON_DEMAND:"ondemand",LIVE:"live",DOWNLOAD:"download"},EchoScheduleMode:{ON:"on",OFF:"off"},EchoCacheMode:{OFFLINE:"offline",ALL:"all"},ManagedLabels:{EVENT_MASTER_BRAND:"event_master_brand",BBC_SITE:"bbc_site",IPLAYER_STATE:"iplayer_state",STORE_ED_TYPE:"store_ed_type",IPLAYER_AVAIL:"iplayer_avail",STORE_REFERRAL:"store_referral",BBC_HASHED_ID:"bbc_hid"},ReportingProfiles:r,EssError:{STATUS_CODE:"status_code",TIMEOUT:"timeout",JSON:"json",RUNTIME:"runtime_error"}}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(e){var s={};for(var n in e)try{e[n].constructor===Object?s[n]=t(e[n]):s[n]=e[n]}catch(t){s[n]=e[n]}return s}function n(e,s,a){var i=a?e:t(e);for(var o in s)try{s[o].constructor===Object?i[o]=n(i[o],s[o]):i[o]=s[o]}catch(e){i[o]=s[o]}return i}function a(e,t){for(var s in e)if(e.hasOwnProperty(s)&&e[s]===t)return!0;return!1}function i(e,s){for(var a=(s?t(e):e)||{},i=arguments,o=2,r=i.length;o<r;o++)"object"==typeof i[o]?n(a,i[o],!0):a[i[o]]=i[++o];return a}function o(e,t,s){return s?i(e,!0,t,s):i(e,!0,t)}function r(e,t,s){return e||(s?g.warn("AssertionFailed: "+t):g.error("AssertionFailed: "+t)),e}function c(e,t,s){return r(a(e,t),s)}function l(e){if("string"==typeof e)return e=String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}var g=s(2);return{clone:t,combineObjects:n,addKV:o,containsValue:a,extend:i,assert:r,assertContainsValue:c,trim:l}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(e,t){"object"==typeof console&&"function"==typeof console[e]&&console[e](t)}function s(){o=!0}function n(){o=!1}function a(e){o&&t("log",e)}function i(e){if(o)throw new Error("ECHO_DEBUG: "+e)}var o=!1;return{enable:s,disable:n,info:a,warn:a,error:i}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(){"use strict";return{ECHO_ENABLED:"enabled",ECHO_AUTO_START:"auto_start",ECHO_TRACE:"trace",ECHO_DEVICE_ID:"device_id",REPORTING_PROFILE:"reporting_profile",ECHO_CACHE_MODE:"cache_mode",ECHO_NAME:"lib_name",ECHO_VERSION:"lib_version",USE_SSC:"use_ssc",SSC_HOSTNAME:"ssc_hostname",COMSCORE_ENABLED:"comscore.enabled",COMSCORE_HOST:"comscore.host",COMSCORE_SITE:"comscore.site",COMSCORE_KEEPALIVE_INTERVAL:"comscore.keep_alive_interval",COMSCORE_CUSTOMER_ID:"comscore.customer_id",COMSCORE_PUBLISHER_SECRET:"comscore.publisher_secret",TEST_SERVICE_ENABLED:"test.enabled",TEST_SERVICE_URL:"test.url",BARB_ENABLED:"barb.enabled",BARB_SITE_CODE:"barb.site_code",BARB_DEBUG:"barb.debug",USE_ESS:"use_ess",ESS_HOSTNAME:"ess.hostname"}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){e.exports={BBC_APPLICATION_NAME:"app_name",BBC_APPLICATION_TYPE:"app_type",BBC_APPLICATION_VERSION:"app_version",BBC_COUNTER_NAME:"name",BBC_LANGUAGE:"language",DEVICE_ID:"ns_alias",COMSCORE_C1:"c1",COMSCORE_C7:"c7",BBC_MEASUREMENT_LIB_NAME:"ml_name",BBC_MEASUREMENT_LIB_VERSION:"ml_version",ECHO_TRACE:"trace",ECHO_EVENT_NAME:"echo_event",EVENT_TRIGGERED_BY_USER:"ns_st_ui",STREAMSENSE_CUSTOM_EVENT_TYPE:"ns_st_ev",USER_ACTION_TYPE:"action_type",USER_ACTION_NAME:"action_name",PLAYLIST_END:"ns_st_pe",REWIND_FF_RATE:"ffrw_rate",COMSCORE_SITE:"ns_site",COMSCORE_CUSTOMER:"c2",COMSCORE_ENDPOINT:"comscore_endpoint",PLAYER_NAME:"ns_st_mp",PLAYER_VERSION:"ns_st_mv",PLAYER_WINDOW_STATE:"ns_st_ws",PLAYER_VOLUME:"ns_st_vo",PLAYER_POPPED:"bbc_st_pop",PLAYER_SUBTITLED:"bbc_st_sub",PLAYLIST_NAME:"ns_st_pl",PLAYLIST_CLIP_COUNT:"ns_st_cp",PLAYLIST_LENGTH:"ns_st_ca",MEDIA_PID:"ns_st_ci",MEDIA_LENGTH:"ns_st_cl",MEDIA_BITRATE:"ns_st_br",MEDIA_STREAM_TYPE:"ns_st_ty",MEDIA_IS_LIVE:"ns_st_li",MEDIA_EPISODE_ID:"episode_id",MEDIA_CLIP_ID:"clip_id",MEDIA_CLIP_NUMBER:"ns_st_cn",MEDIA_PART_NUMBER:"ns_st_pn",MEDIA_TOTAL_PARTS:"ns_st_tp",MEDIA_MEDIUM:"bbc_st_med",MEDIA_LIVE_OR_ONDEMAND:"bbc_st_lod",MEDIA_FORM:"bbc_st_mf",MEDIA_RETRIEVAL_TYPE:"bbc_st_ret",MEDIA_SCHEDULE_INDICATOR:"bbc_st_sch",MEDIA_CODEC:"bbc_st_co",MEDIA_CDN:"bbc_st_cdn",MEDIA_VERSION_ID:"version_id",MEDIA_SERVICE_ID:"service_id",MEDIA_NON_PIPS_CONTENT_ID:"non_pips_content_id",MEDIA_AMBIGUOUS_ID:"ambig_ci",MEDIA_TIMESTAMP:"bbc_st_live_ts",ESS_SUCCESS:"ess_success",ESS_ERROR:"ess_error",ESS_STATUS_CODE:"ess_status_code",APP_PLATFORM_NAME:"ns_ap_pn",APP_PLATFORM_RUNTIME:"ns_ap_pfm",APP_OS_VERSION:"ns_ap_pfv",APP_DEVICE_NAME:"ns_ap_device",APP_SCREEN_RESOLUTION:"ns_ap_res",APP_LANGUAGE:"ns_ap_lang",ENV_CHAR_SET:"ns_c",ENV_TITLE:"c8",ENV_URL:"c7",ENV_REFERRER:"c9",APP_NAME:"ns_ap_an",APP_VERSION:"ns_ap_ver",NO_COOKIES:"ns_nc",COOKIE_POLICY:"bbc_mc",BBC_ID_LOGGED_IN:"bbc_identity",WEB_SCREEN_RES:"screen_resolution",ESS_ENABLED:"ess_enabled",ESS_ENRICHED:"ess_enriched"}},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(){var e=window.screen||{},t=window.navigator||{},s=window.document||{};this._platformRuntimeEnvironment="html",this._platformOSVersion="5",this._screenResolution=(e.width||"-")+"x"+(e.height||"-"),this._language=t.language||"",this._platformName=t.platform||"",this._charset=s.characterSet||s.defaultCharset||"",this._title=s.title||"",this._url=s.URL||"",this._referrer=s.referrer||"",this._deviceName=null,this._httpGet=null,this._executeCrossDomainGet=null,this._getCookie=null,this._setCookie=null,this._setLocalStorageItem=null,this._getLocalStorageItem=null}var n=s(6),a=s(7),i=s(30);t._defaultHttpGet=i.httpGet,t._defaultGetCookie=a.getCookieValueByName,t.prototype.getPlatformName=function(){return this._platformName},t.prototype.getPlatformRuntimeEnvironment=function(){return this._platformRuntimeEnvironment},t.prototype.getPlatformOSVersion=function(){return this._platformOSVersion},t.prototype.getDeviceName=function(){return this._deviceName},t.prototype.getScreenResolution=function(){return this._screenResolution},t.prototype.getLanguage=function(){return this._language},t.prototype.getHttpGet=function(){return this._httpGet},t.prototype.setExecuteCrossDomainGet=function(e){this._executeCrossDomainGet=e},t.prototype.getExecuteCrossDomainGet=function(){return this._executeCrossDomainGet?this._executeCrossDomainGet:i.executeCrossDomainGet},t.prototype.getCookieGetter=function(){return this._getCookie},t.prototype.getCookieSetter=function(){return this._setCookie},t.prototype.getCharSet=function(){return this._charset},t.prototype.getTitle=function(){return this._title},t.prototype.getURL=function(){return this._url},t.prototype.getProtocol=function(){return 0!==this.getURL().toLowerCase().indexOf("http:",0)?"https:":"http:"},t.prototype.getReferrer=function(){return this._referrer},t.prototype.setSetLocalStorageItem=function(e){this._setLocalStorageItem=e},t.prototype.getSetLocalStorageItem=function(){return this._setLocalStorageItem},t.prototype.setGetLocalStorageItem=function(e){this._getLocalStorageItem=e},t.prototype.getGetLocalStorageItem=function(){return this._getLocalStorageItem},t.prototype.setPlatformName=function(e){return this._platformName=e,this},t.prototype.setPlatform=function(e,t){return this._platformRuntimeEnvironment=e,this._platformOSVersion=t,this},t.prototype.setDeviceName=function(e){return this._deviceName=e,this},t.prototype.setScreenResolution=function(e){return this._screenResolution=e,this},t.prototype.setLanguage=function(e){return this._language=n.cleanLanguage(e),this},t.prototype.setHttpGet=function(e){return this._httpGet=e,this},t.prototype.setCookieGetter=function(e){return this._getCookie=e,this},t.prototype.setCookieSetter=function(e){return this._setCookie=e,this},t.prototype.setCharSet=function(e){return this._charset=e,this},t.prototype.setTitle=function(e){return this._title=e,this},t.prototype.setURL=function(e){return this._url=e,this},t.prototype.setReferrer=function(e){return this._referrer=e,this};var o;t.setOrbCookies=function(e){return o=e,this},t.getOrbCookies=function(){return o},t.getOrbCookiesPolicy=function(){if(o&&"function"==typeof o.readPolicy)return o.readPolicy()};var r,c,l=!1,g=[];return t.setOrbIdCta=function(e){return r=e,this},t.getOrbIdCta=function(e){var t,s=function(e,t){e&&"function"==typeof e&&e(t)};if(void 0!==r)return void s(e,r);if(!1===c)return void s(e);g.push(e);var n=window.require;void 0===c&&n?!(c="function"==typeof n.defined&&n.defined("idcta/idcta-1"))&&n.s&&n.s.contexts&&n.s.contexts._&&n.s.contexts._.config&&n.s.contexts._.config.paths&&n.s.contexts._.config.paths.idcta&&(c=!0):c=!1,c&&!l?(l=!0,window.require(["idcta/idcta-1"],function(e){for(r=e,t=0;t<g.length;g++)g[t]&&"function"==typeof g[t]&&s(g[t],r)})):!1===c&&s(e)},t}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(e){return E.hasOwnProperty(e)?E[e]:S.CUSTOM}function n(e){return e&&e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/(^_+)|(_+$)/g,"")}function a(e){var t=n(e);return _.assert(e===t,'Label key can only contain: [a-z0-9_], and no consecutive "_"s or "_" at the begining or end, got "'+e+'". This will be sent as "'+t+'"',!0),t}function i(e){return n(e)}function o(e){return e&&e.toLowerCase().replace(/(^\s+)|(\s+$)/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-+)|(-+$)/g,"")}function r(e){return e&&e.replace(/(^\s+)|(\s+$)/g,"").replace(/\|/g,"!")}function c(e){var t=e&&e.toLowerCase().replace(/[^a-z0-9\.]+/g,"_").replace(/\.+/g,".").replace(/(^_+)|(_+$)/g,"")||"no.name.page";return e!==t&&(null!==e&&"string"==typeof e&&0!==e.replace(/ */,"").length||p.error("Countername must be a non-empty string"),e&&-1!==e.search(/-/)?p.warn('Submitted countername ("'+e+'") contains at least one "-". Dashes are not permitted but, for legacy reasons, "-" and "_" are equivalent in DAx. Echo converts dashes to underscores, so the countername will be sent as "'+t+'"'):p.warn('countername may only contain: [a-z0-9._], got "'+e+'". This will be cleaned up and sent as "'+t+'"')),-1===t.search(/\.page$/)&&(t+=".page"),t}function l(e,s){var n="",a=s,l=t(e);if(l===S.COUNTERNAME&&(s=c(s)),"number"==typeof s||"boolean"==typeof s)return s.toString();if("string"!=typeof s)return void p.error("Label must have number, boolean or string value");switch(l){case S.EVENT_MASTER_BRAND:n='Label value can only contain [0-9a-z], and no consecutive "_"s and no "_"s or whitespace at the start or end.',a=i(s);break;case S.STRICT:n='Strict Label values can only contain [ 0-9a-z-], and no consecutive "-"s and no "-"s or whitespace at the start or end.',a=o(s);break;case S.NO_CLEANSING:break;default:n="Custom Label value cannot contain whitespace at start or end or pipes (|).",a=r(s)}return n+='Got "'+s+'", will be replaced with "'+a+'"',_.assert(s===a,n,!0),a}function g(e){if("number"==typeof e||"boolean"==typeof e)return e.toString();var t=e&&e.replace(/(^\s*)|(\s*$)/g,"").replace(/[^0-9a-zA-Z._]+/g,"-").replace(/(^-)|(-$)/g,"")||"";return _.assert(e===t,'Language label value can only contain [0-9a-zA-Z._-], and no consecutive "-"s and no - at the start or end. Got "'+e+'", will be replaced with "'+t+'"',!0),t}function u(e){var t,s={};for(var n in e)t=a(n),s[t]=l(t,e[n]);return s}var _=s(1),p=s(2),d=s(0),S=s(28),f=["player_name","ns_st_ws","bbc_site","app_type","app_name","bbc_store_pf","bbc_store_ed","bbc_store_fr","bbc_store_src"],E={name:S.COUNTERNAME};E[d.ManagedLabels.EVENT_MASTER_BRAND]=S.EVENT_MASTER_BRAND;for(var b=0;b<f.length;b++)E[f[b]]=S.STRICT;return{cleanCounterName:c,cleanLabelKey:a,cleanLabelValue:l,cleanLanguage:g,cleanLabels:u}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(){"use strict";return{getCookieValueByName:function(e,t){var s=t||window,n=e+"=",a=s.document,i={};if(void 0===a||"string"!=typeof a.cookie)return null;i=a.cookie.split(";");for(var o=0,r=i.length;o<r;o++){var c=i[o];if(" "===c.charAt(0)&&(c=c.substring(1,c.length)),0===c.indexOf(n))return c.substring(n.length,c.length)}return null}}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){e.exports={NAME:"echo_js",VERSION:"10.0.0"}},function(e,t,s){var n;void 0!==(n=function(e){"use strict";var t=s(1),n=function(e,t){this.idType=e,this.validValueRegex=/^[a-z0-9A-Z_-]+$/,this.value=null,this.isSet=!1,this.isValid=!1,this.requiresValidation=t};return n.prototype.getIdType=function(){return this.idType},n.prototype.setValue=function(e){this.isSet=!0,null==e?this.isValid=!1:this.requiresValidation?this.isValid=this._validateValue(e):this.isValid=!0,t.assert(this.isValid,"MediaId: The value for "+this.idType+"Id is invalid",!0),this.value=e},n.prototype.getValue=function(){return this.value},n.prototype.isValueSet=function(){return this.isSet},n.prototype.isValueValid=function(){return this.isValid},n.prototype._validateValue=function(e){return"string"==typeof e&&this.validValueRegex.test(e)},n}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(e){return e===i.AvType.AUDIO||e===i.AvType.VIDEO}function n(e){return e===g.ON_DEMAND||e===g.DOWNLOAD||e===g.LIVE}var a=s(9),i=s(0),o=s(1),r=s(4),c=s(6),l=s(2),g=i.MediaConsumptionMode,u=function(e,s){this.avType=t(e)?e:null,this.consumptionMode=n(s)?s:null,o.assert(this.avType,"Media: Invalid avType: "+this.avType,!0),o.assert(this.consumptionMode,"Media: Invalid consumptionMode: "+this.consumptionMode,!0),this.serviceIdObject=new a(i.MediaIdType.SERVICE,!0),this.versionIdObject=new a(i.MediaIdType.VERSION,!0),this.clipIdObject=new a(i.MediaIdType.CLIP,!0),this.episodeIdObject=new a(i.MediaIdType.EPISODE,!0),this.vpIdObject=new a(i.MediaIdType.VPID,!0),this.nonPipsContentIdObject=new a(i.MediaIdType.NONPIPSCONTENT,!1),this.length=0,this.bufferLength=0,this.supplier=null,this.mediaSet=null,this.transferFormat=null,this.scheduleMode=null,this.bitrate=0,this.codec=null,this.cdn=null,this.essEnrichedData=!1};return u.prototype.isEssEnriched=function(){return!0===this.essEnrichedData},u.prototype.setEssEnriched=function(e){this.essEnrichedData=e},u.prototype.getAvType=function(){return this.avType},u.prototype.getMediaConsumptionMode=function(){return this.consumptionMode},u.prototype.getClone=function(){var e=new u(this.avType,this.consumptionMode);return e.serviceIdObject=this.serviceIdObject,e.versionIdObject=this.versionIdObject,e.clipIdObject=this.clipIdObject,e.episodeIdObject=this.episodeIdObject,e.vpIdObject=this.vpIdObject,e.nonPipsContentIdObject=this.nonPipsContentIdObject,e.bufferLength=this.bufferLength,e.mediaSet=this.mediaSet,e.supplier=this.supplier,e.transferFormat=this.transferFormat,e.length=this.length,e.scheduleMode=this.scheduleMode,e.bitrate=this.bitrate,e.codec=this.codec,e.cdn=this.cdn,e.essEnrichedData=this.essEnrichedData,e},u.prototype.setVersionId=function(e){return this.versionIdObject.setValue(e),this},u.prototype.setClipId=function(e){return this.clipIdObject.setValue(e),this},u.prototype.setServiceId=function(e){return this.serviceIdObject.setValue(e),this},u.prototype.setEpisodeId=function(e){return this.episodeIdObject.setValue(e),this},u.prototype.setVpId=function(e){return this.vpIdObject.setValue(e),this},u.prototype.setNonPipsContentId=function(e){var t=c.cleanLabelValue(r.MEDIA_NON_PIPS_CONTENT_ID,e);return this.nonPipsContentIdObject.setValue(t),this},u.prototype.setSupplier=function(e){if(null!==e){var t=o.trim(e);0!==t.length&&(this.supplier=t)}return this},u.prototype.getSupplier=function(){return this.supplier},u.prototype.setMediaSet=function(e){if(null!=e){var t=o.trim(e);0!==t.length&&(this.mediaSet=t)}return this},u.prototype.getMediaSet=function(){return this.mediaSet},u.prototype.setTransferFormat=function(e){if(null!=e){var t=o.trim(e);0!==t.length&&(this.transferFormat=t)}return this},u.prototype.getTransferFormat=function(){return this.transferFormat},u.prototype.setLength=function(e){return void 0!==e&&null!==e&&(e=Math.floor(e)),(void 0===e||isNaN(e)||!isFinite(e)||e<0)&&(l.warn("Media: length must be an integer of 0 or greater. Echo will report as 0."),e=0),this.length=e,this},u.prototype.setBitrate=function(e){return e&&e>0?this.bitrate=e:l.warn("Invalid media bitrate: "+e),this},u.prototype.setCodec=function(e){return this.codec=c.cleanLabelValue(r.MEDIA_CODEC,e),this},u.prototype.setCDN=function(e){return this.cdn=c.cleanLabelValue(r.MEDIA_CDN,e),this},u.prototype.setScheduleMode=function(e){return e===i.EchoScheduleMode.ON||e===i.EchoScheduleMode.OFF?this.scheduleMode=e:(this.scheduleMode=null,l.warn("Media: Invalid scheduleMode: "+this.scheduleMode)),this},u.prototype.getVersionIdObject=function(){return this.versionIdObject},u.prototype.getClipIdObject=function(){return this.clipIdObject},u.prototype.getServiceIdObject=function(){return this.serviceIdObject},u.prototype.getEpisodeIdObject=function(){return this.episodeIdObject},u.prototype.getVpIdObject=function(){return this.vpIdObject},u.prototype.getNonPipsContentIdObject=function(){return this.nonPipsContentIdObject},u.prototype.getVersionId=function(){return this.versionIdObject.getValue()},u.prototype.getClipId=function(){return this.clipIdObject.getValue()},u.prototype.getServiceId=function(){return this.serviceIdObject.getValue()},u.prototype.getEpisodeId=function(){return this.episodeIdObject.getValue()},u.prototype.getVpId=function(){return this.vpIdObject.getValue()},u.prototype.getNonPipsContentId=function(){return this.nonPipsContentIdObject.getValue()},u.prototype.getLength=function(){return this.length},u.prototype.getScheduleMode=function(){return this.scheduleMode},u.prototype.getBitrate=function(){return this.bitrate},u.prototype.getCDN=function(){return this.cdn},u.prototype.getCodec=function(){return this.codec},u.prototype.getRetrievalType=function(){return null===this.consumptionMode?null:this.consumptionMode===g.DOWNLOAD?i.RetrievalType.DOWNLOAD:i.RetrievalType.STREAM},u.prototype.isOnDemand=function(){return this.consumptionMode===g.ON_DEMAND},u.prototype.isDownload=function(){return this.consumptionMode===g.DOWNLOAD},u.prototype.isLive=function(){return this.consumptionMode===g.LIVE},u.prototype.isVideo=function(){return this.avType===i.AvType.VIDEO},u}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(){"use strict";function e(){this.reset()}return e.prototype.start=function(){!0!==this._isPlaying&&(this._isPlaying=!0,this._startTime=this._getCurrentTime())},e.prototype.reset=function(){this._isPlaying=!1,this._position=0,this._startTime=0},e.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._position+=this._getCurrentTime()-this._startTime,this._startTime=0)},e.prototype.getPosition=function(){var e=this._position;return!0===this._isPlaying&&(e+=this._getCurrentTime()-this._startTime),e},e.prototype._getCurrentTime=function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Date.now()},e}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n,a;n=[s(1),s(2),s(0)],void 0!==(a=function(e,t,s){"use strict";function n(e,t,s){this._schedule=[],this.serviceId=null,this._media=e,this._environment=t,this._echoClient=s,this._fetchData()}return n.prototype.getBroadcast=function(e){var t,s;for(t=0;t<this._schedule.length;t++)if(s=this._schedule[t].published_time,e<s.end&&e>=s.start)return this._schedule[t]},n.essHost="ess.api.bbci.co.uk",n.prototype._fetchData=function(){var e,s,a=this;e=this._environment.getExecuteCrossDomainGet(),s=this._environment.getProtocol();var i=s+n.essHost.replace(/^(\/+)?/,"//")+"/schedules";if(this._media){if(this._media.getServiceId())i+="?serviceId="+encodeURIComponent(this._media.getServiceId());else if(this._media.getVersionId())i+="?versionId="+encodeURIComponent(this._media.getVersionId());else{if(!this._media.getVpId())return void t.info("Unable to determine serviceId, versionId or VpId for schedule");i+="?vpid="+encodeURIComponent(this._media.getVpId())}e(i,{onSuccess:function(e){a._dataSuccessHandler(e)},onError:function(e,t){var s="error";"json"===e?s="json":"object"==typeof e&&"timeout"===e.type&&(s="timeout"),a._dataErrorHandler(s,t)}})}},n.prototype.hasData=function(){return this._schedule.length>0},n.prototype._dataSuccessHandler=function(e){var s,n,a,i,o=[];if(t.info("Cross-domain schedule request success."),e){for(this._echoClient.setEssSuccess(!0),this.serviceId=e.service.id,e.items=e.items||[],s=0;s<e.items.length;s++)a=e.items[s].published_time.start,i=e.items[s].published_time.end,n=e.items[s],n.published_time.start=new Date(a).getTime(),n.published_time.end=new Date(i).getTime(),o.push(n);this._schedule=o}},n.prototype._dataErrorHandler=function(e,n){this._schedule=[],t.error("There was a problem requesting the schedule from ESS: "+e),this._echoClient.setEssSuccess(!1),"json"===e?this._echoClient.setEssError(s.EssError.JSON,n):"timeout"===e?this._echoClient.setEssError(s.EssError.TIMEOUT,n):"error"===e&&void 0!==n?this._echoClient.setEssError(s.EssError.STATUS_CODE,n):this._echoClient.setEssError(s.EssError.RUNTIME,"0")},n}.apply(t,n))&&(e.exports=a)},function(e,t,s){var n,a;n=[s(17)],void 0!==(a=function(e){"use strict";return window&&window.bbccookies&&e.Environment.setOrbCookies(window.bbccookies),e}.apply(t,n))&&(e.exports=a)},function(e,t,s){var n,a;!function(s,i){"use strict";i(s.ns_=s.ns_||{}),n=[],void 0!==(a=function(){return s.ns_}.apply(t,n))&&(e.exports=a)}(this,function(e){"use strict";e.ns_=e;var t=t||{};t.indexOf=function(e,t){var s=-1;return this.forEach(t,function(t,n){t==e&&(s=n)}),s},t.forEach=function(e,t,s){try{if("function"==typeof t)if(s=void 0!==s?s:null,"number"!=typeof e.length||void 0===e[0]){var n=void 0!==e.__proto__;for(var a in e)e.hasOwnProperty(a)&&(!n||n&&void 0===e.__proto__[a])&&"function"!=typeof e[a]&&t.call(s,e[a],a)}else for(var i=0,o=e.length;i<o;i++)t.call(s,e[i],i)}catch(e){}};var t=t||{};t.parseBoolean=function(e,t){return t=t||!1,e?"0"!=e:t},t.parseInteger=function(e,t){return null==e||isNaN(e)?t||0:parseInt(e)},t.parseLong=function(e,t){var s=Number(e);return null==e||isNaN(s)?t||0:s},t.toString=function(e){if(void 0===e)return"undefined";if("string"==typeof e)return e;if(e instanceof Array)return e.join(",");var t="";for(var s in e)e.hasOwnProperty(s)&&(t+=s+":"+e[s]+";");return t||e.toString()};var t=t||{};t.filter=function(e,t){var s={};for(var n in t)t.hasOwnProperty(n)&&e(t[n])&&(s[n]=t[n]);return s},t.extend=function(e){var t,s=arguments.length;e=e||{};for(var n=1;n<s;n++)if(t=arguments[n])for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e};var t=t||{};t.cloneObject=function(e){return null==e||"object"!=typeof e?e:function(){function e(){}function t(t){return"object"==typeof t?(e.prototype=t,new e):t}function s(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function n(){this.copiedObjects=[];var e=this;this.recursiveDeepCopy=function(t){return e.deepCopy(t)},this.depth=0}function a(e,t){var s=new n;return t&&(s.maxDepth=t),s.deepCopy(e)}function i(e){return"undefined"!=typeof window&&window&&window.Node?e instanceof Node:"undefined"!=typeof document&&e===document||"number"==typeof e.nodeType&&e.attributes&&e.childNodes&&e.cloneNode}var o=[];return s.prototype={constructor:s,canCopy:function(){return!1},create:function(e){},populate:function(e,t,s){}},n.prototype={constructor:n,maxDepth:256,cacheResult:function(e,t){this.copiedObjects.push([e,t])},getCachedResult:function(e){for(var t=this.copiedObjects,s=t.length,n=0;n<s;n++)if(t[n][0]===e)return t[n][1]},deepCopy:function(e){if(null===e)return null;if("object"!=typeof e)return e;var t=this.getCachedResult(e);if(t)return t;for(var s=0;s<o.length;s++){var n=o[s];if(n.canCopy(e))return this.applyDeepCopier(n,e)}throw new Error("Unable to clone the following object "+e)},applyDeepCopier:function(e,t){var s=e.create(t);if(this.cacheResult(t,s),++this.depth>this.maxDepth)throw new Error("Maximum recursion depth exceeded.");return e.populate(this.recursiveDeepCopy,t,s),this.depth--,s}},a.DeepCopier=s,a.deepCopiers=o,a.register=function(e){e instanceof s||(e=new s(e)),o.unshift(e)},a.register({canCopy:function(){return!0},create:function(e){return e instanceof e.constructor?t(e.constructor.prototype):{}},populate:function(e,t,s){for(var n in t)t.hasOwnProperty(n)&&(s[n]=e(t[n]));return s}}),a.register({canCopy:function(e){return e instanceof Array},create:function(e){return new e.constructor},populate:function(e,t,s){for(var n=0;n<t.length;n++)s.push(e(t[n]));return s}}),a.register({canCopy:function(e){return e instanceof Date},create:function(e){return new Date(e)}}),a.register({canCopy:function(e){return i(e)},create:function(e){return"undefined"!=typeof document&&e===document?document:e.cloneNode(!1)},populate:function(e,t,s){if("undefined"!=typeof document&&t===document)return document;if(t.childNodes&&t.childNodes.length)for(var n=0;n<t.childNodes.length;n++){var a=e(t.childNodes[n]);s.appendChild(a)}}}),{deepCopy:a}}().deepCopy(e)};var t=t||{};t.getNamespace=function(){return e.ns_||e},t.uid=function(){var e=1;return function(){return+new Date+"_"+e++}}(),t.isEmpty=function(e){return void 0===e||null===e||""===e||e instanceof Array&&0===e.length},t.isNotEmpty=function(e){return!this.isEmpty(e)},t.safeGet=function(e,t){return t=this.exists(t)?t:"",this.exists(e)?e:t},t.isTrue=function(e){return void 0!==e&&("string"==typeof e?"true"===(e=e.toLowerCase())||"1"===e||"on"===e:!!e)},t.regionMatches=function(e,t,s,n,a){if(t<0||n<0||t+a>e.length||n+a>s.length)return!1;for(;--a>=0;){if(e.charAt(t++)!=s.charAt(n++))return!1}return!0},t.exists=function(e){return void 0!==e&&null!=e},function(){var e=[],s=!1,n=!0,a=1e3;t.onSystemClockJump=function(t,i){e.push(t),s||(s=!0,a=i||a,n=+new Date,setInterval(function(){var t=n+a,s=+new Date;n=s;var i=s-t;if(Math.abs(i)>a)for(var o=0;o<e.length;++o)e[o](i>0)},a))}}();var t=t||{};t.hasPageVisibilityAPISupport=function(){if("undefined"==typeof document)return!1;var e=!1;return void 0!==document.hidden?e=!0:void 0!==document.mozHidden?e=!0:void 0!==document.msHidden?e=!0:void 0!==document.webkitHidden&&(e=!0),function(){return e}}(),t.getPageVisibilityAPI=function(){if("undefined"==typeof document)return null;var e,t,s;void 0!==document.hidden?(e="hidden",t="visibilitychange",s="visibilityState"):void 0!==document.mozHidden?(e="mozHidden",t="mozvisibilitychange",s="mozVisibilityState"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange",s="msVisibilityState"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange",s="webkitVisibilityState");var n={hidden:e,visibilityChange:t,state:s};return function(){return n}}(),t.isTabInBackground=function(){if("undefined"==typeof document)return null;var e=t.getPageVisibilityAPI();return function(){return document[e.hidden]}}(),t.getBrowserName=function(){if(!navigator)return"";var e,t,s=navigator.userAgent||"",n=navigator.appName||"";return-1!=(t=s.indexOf("Opera"))||-1!=(t=s.indexOf("OPR/"))?n="Opera":-1!=(t=s.indexOf("Android"))?n="Android":-1!=(t=s.indexOf("Chrome"))?n="Chrome":-1!=(t=s.indexOf("Safari"))?n="Safari":-1!=(t=s.indexOf("Firefox"))?n="Firefox":-1!=(t=s.indexOf("IEMobile"))?n="Internet Explorer Mobile":"Microsoft Internet Explorer"==n||"Netscape"==n?n="Internet Explorer":(e=s.lastIndexOf(" ")+1)<(t=s.lastIndexOf("/"))?(n=s.substring(e,t),n.toLowerCase()==n.toUpperCase()&&(n=navigator.appName)):n="unknown",n},t.getBrowserFullVersion=function(){if(!navigator)return"";var e,t,s,n,a=navigator.userAgent||"",i=navigator.appName||"",o=navigator.appVersion?""+parseFloat(navigator.appVersion):"";return-1!=(t=a.indexOf("Opera"))?(o=a.substring(t+6),-1!=(t=a.indexOf("Version"))&&(o=a.substring(t+8))):-1!=(t=a.indexOf("OPR/"))?o=a.substring(t+4):-1!=(t=a.indexOf("Android"))?o=a.substring(t+11):-1!=(t=a.indexOf("Chrome"))?o=a.substring(t+7):-1!=(t=a.indexOf("Safari"))?(o=a.substring(t+7),-1!=(t=a.indexOf("Version"))&&(o=a.substring(t+8))):-1!=(t=a.indexOf("Firefox"))?o=a.substring(t+8):"Microsoft Internet Explorer"==i?(n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=n.exec(a)&&(o=parseFloat(RegExp.$1))):"Netscape"==i?(n=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!=n.exec(a)&&(o=parseFloat(RegExp.$1))):o=a.lastIndexOf(" ")+1<(t=a.lastIndexOf("/"))?a.substring(t+1):"unknown",o=o.toString(),-1!=(s=o.indexOf(";"))&&(o=o.substring(0,s)),-1!=(s=o.indexOf(" "))&&(o=o.substring(0,s)),-1!=(s=o.indexOf(")"))&&(o=o.substring(0,s)),e=parseInt(""+o,10),isNaN(e)&&(o=""+parseFloat(navigator.appVersion)),o},t.browserAcceptsLargeURLs=function(){return"undefined"==typeof window||(window.ActiveXObject,!0)},t.isBrowser=function(){return"undefined"!=typeof window&&"undefined"!=typeof document},t.isWebSecure=function(){return"undefined"!=typeof document&&null!=document&&"s"===document.location.href.charAt(4)};var s=function(){return function(e,t){function s(t){t=t||[];var s=[o,+new Date];return e&&s.push(e),t=Array.prototype.slice.call(t),s=s.concat(t)}function n(e){var s,n,a;if("boolean"==typeof t||!t)return!!t;if(a=e.join(" "),t instanceof Array&&t.length>0){for(s=0;s<t.length;++s)if((n=t[s])instanceof RegExp&&n.test(a))return!0;return!1}if("object"==typeof t){var i=!1;if(t.hide instanceof Array)for(s=0;s<t.hide.length;++s)if((n=t.hide[s])instanceof RegExp&&n.test(a)){i=!0;break}if(t.show instanceof Array)for(s=0;s<t.show.length;++s)if((n=t.show[s])instanceof RegExp&&n.test(a))return!0;return!i&&!t.show}return!0}function a(e){var s=r.length;(s>1e4||t&&t.max&&s>t.max)&&(r=r.slice(-Math.floor(t.max/2)),r.push("Previous logs: "+s)),r.push(e)}var i=this,o="comScore",r=[];i.log=function(){var e=s(arguments);a(e),"undefined"!=typeof console&&"function"==typeof console.log&&n(e)&&console.log.apply(console,e)},i.warn=function(){var e=s(arguments);a(e),"undefined"!=typeof console&&"function"==typeof console.warn&&n(e)&&console.warn.apply(console,e)},i.error=function(){var e=s(arguments);a(e),"undefined"!=typeof console&&"function"==typeof console.error&&n(e)&&console.error.apply(console,e)},i.apiCall=function(e){for(var t=["API call to:",e],s=1;s<arguments.length;++s)t.push("arg"+s+":",arguments[s]);this.log.apply(this,t)},i.infoLog=function(){var e=["Trace log:"];e.push.apply(e,Array.prototype.slice.call(arguments)),this.log.apply(this,e)},i.deprecation=function(e,t){var s=["Deprecated API:",e,"is deprecated and will be eventually removed."];t&&s.push("Use",t,"instead."),this.warn.apply(this,s)},i.getLogHistory=function(){return r}}}();return e.StreamingAnalytics=e.StreamingAnalytics||function(){var e=function(){var e="cs_";return function(){var s="undefined"!=typeof localStorage?localStorage:null;t.extend(this,{get:function(t){return s&&s.getItem(e+t)},set:function(t,n){s&&s.setItem(e+t,n)},has:function(t){return s&&s.getItem(e+t)},remove:function(t){s&&s.removeItem(e+t)},clear:function(){for(var t=0;s&&t<s.length;++t){var n=s.key(t);n.substr(0,e.length)===e&&s.removeItem(n)}}})}}(),n=function(e,t){if("undefined"==typeof Image)return void("function"==typeof setTimeout?t&&setTimeout(t,0):t&&t());var s=new Image;s.onload=function(){t&&t(200),s=null},s.onerror=function(){t&&t(),s=null},s.src=e},a=function(e,t,s){"function"==typeof setTimeout?s&&setTimeout(function(){s(200)},0):s&&s(200)},i=function(){return{dir:function(){return null},append:function(e,t,s){},write:function(e,t,s){},deleteFile:function(){return!1},read:function(){return null}}}(),o=function(){return{PLATFORM:"generic",httpGet:n,httpPost:a,Storage:e,IO:i,onDataFetch:function(e){e()},getCrossPublisherId:function(){return null},getAppName:function(){return r.UNKNOWN_VALUE},getAppVersion:function(){return r.UNKNOWN_VALUE},getVisitorId:function(){return+new Date+~~(1e3*Math.random())},getVisitorIdSuffix:function(){return"72"},getDeviceModel:function(){return r.UNKNOWN_VALUE},getPlatformVersion:function(){return r.UNKNOWN_VALUE},getPlatformName:function(){return"js"},getRuntimeName:function(){return r.UNKNOWN_VALUE},getRuntimeVersion:function(){return r.UNKNOWN_VALUE},getDisplayResolution:function(){return r.UNKNOWN_RESOLUTION},getApplicationResolution:function(){return r.UNKNOWN_RESOLUTION},getLanguage:function(){return r.UNKNOWN_VALUE},getPackageName:function(){return null},isConnectionAvailable:function(){return!0},isCompatible:function(){return!0},autoSelect:function(){},setPlatformAPI:function(){},isCrossPublisherIdChanged:function(){return!1},setTimeout:function(e,t){return setTimeout(e,t)},clearTimeout:function(e){return clearTimeout(e)},getDeviceArchitecture:function(){return r.UNKNOWN_VALUE},getConnectionType:function(){return r.UNKNOWN_VALUE},getDeviceJailBrokenFlag:function(){return r.UNKNOWN_VALUE},isConnectionSecure:function(){return!1},processMeasurementLabels:function(){}}}(),r={UNKNOWN_VALUE:"unknown",UNKNOWN_RESOLUTION:"0x0"};t.jsonObjectToStringDictionary=function(e){var t={};for(var s in e){var n=e[s];t[s]=null===n||void 0===n?n:e[s]+""}return t},t.getKeys=function(e,t){var s,n=[];for(s in e)t&&!t.test(s)||!e.hasOwnProperty(s)||(n[n.length]=s);return n},t.fixEventTime=function(e){if(e.ns_ts)return parseInt(e.ns_ts);var t=+new Date;return e.ns_ts=t+"",t},t.isBrowser=function(){return"undefined"!=typeof window&&"undefined"!=typeof document},t.addNewPlaybackInterval=function(e,s,n,a){var i={};if(!(n>=s))return t.cloneObject(e);if(i.start=s,i.end=n,0==e.length)return e.push(i),t.cloneObject(e);var o;for(o=0;o<e.length;o++)if(i.start>=e[o].start&&i.end<=e[o].end)return t.cloneObject(e);var r,c=!1;for(r=0;r<e.length;r++)if(r+1===e.length&&i.start>=e[r].start||i.start>=e[r].start&&i.start<e[r+1].start){e.splice(r+1,0,i),c=!0;break}c||e.splice(0,0,i);var l=[e[0]];for(o=1;o<e.length;o++)l[l.length-1].end+a<e[o].start?l.push(e[o]):l[l.length-1].end<e[o].end&&(l[l.length-1].end=e[o].end);return t.cloneObject(l)},t.stateToString=function(e){var t=R.InternalStates;for(var s in t)if(t.hasOwnProperty(s)&&t[s]==e)return s};var c=function(){var e=["play","pause","pause-on-buffering","end","buffer","buffer-stop","keep-alive","hb","custom","load","start","skstart","adskip","cta","error","trans","drmfa","drmap","drmde","bitrt","playrt","volume","window","audio","video","subs","cdn"];return{PLAY:0,PAUSE:1,PAUSE_ON_BUFFERING:2,END:3,BUFFER:4,BUFFER_STOP:5,KEEPALIVE:6,HEARTBEAT:7,CUSTOM:8,LOAD:9,ENGAGE:10,SEEK_START:11,AD_SKIP:12,CTA:13,ERROR:14,TRANSFER:15,DRM_FAILED:16,DRM_APPROVED:17,DRM_DENIED:18,BIT_RATE:19,PLAYBACK_RATE:20,VOLUME:21,WINDOW_STATE:22,AUDIO:23,VIDEO:24,SUBS:25,CDN:26,toString:function(t){return e[t]}}}(),l=function(){return{IDLE:0,PLAYBACK_NOT_STARTED:1,PLAYING:2,PAUSED:3,BUFFERING_BEFORE_PLAYBACK:4,BUFFERING_DURING_PLAYBACK:5,BUFFERING_DURING_SEEKING:6,BUFFERING_DURING_PAUSE:7,SEEKING_BEFORE_PLAYBACK:8,SEEKING_DURING_PLAYBACK:9,SEEKING_DURING_BUFFERING:10,SEEKING_DURING_PAUSE:11,PAUSED_DURING_BUFFERING:12}}(),g=function(){var e=["c","s","r"];return{SINGLE_CLIP:0,SEGMENTED:1,REDUCED:2,toString:function(t){return e[t]}}}(),u={STREAMINGANALYTICS_VERSION:"6.0.0.161201",MODEL_VERSION:"5.7",LOG_NAMESPACE:"STA",DEFAULT_PLAYERNAME:"js_api",DEFAULT_HEARTBEAT_INTERVAL:[{playingtime:6e4,interval:1e4},{playingtime:null,interval:6e4}],DEFAULT_KEEP_ALIVE_INTERVAL:12e5,DEFAULT_PAUSED_ON_BUFFERING_INTERVAL:500,C1_VALUE:"19",C10_VALUE:"js",NS_AP_C12M_VALUE:"1",NS_NC_VALUE:"1",PAGE_NAME_LABEL:"name",RESTRICTED_URL_LENGTH_LIMIT:2048,URL_LENGTH_LIMIT:4096,THROTTLING_DELAY:500,INTERVAL_MERGE_TOLERANCE:500,SYSTEM_CLOCK_JUMP_DETECTION_DEFAULT_INTERVAL:1e3,SYSTEM_CLOCK_JUMP_DETECTION_MINIMUM_INTERVAL:500,STANDARD_METADATA_LABELS:["ns_st_st","ns_st_ci","ns_st_pr","ns_st_sn","ns_st_en","ns_st_ep","ns_st_ty","ns_st_ct","ns_st_li","ns_st_ad","ns_st_bn","ns_st_tb","ns_st_an","ns_st_ta","ns_st_pu","c3","c4","c6"],LABELS_ORDER:["c1","c2","ca2","cb2","cc2","cd2","ns_site","ca_ns_site","cb_ns_site","cc_ns_site","cd_ns_site","ns_vsite","ca_ns_vsite","cb_ns_vsite","cc_ns_vsite","cd_ns_vsite","ns_alias","ca_ns_alias","cb_ns_alias","cc_ns_alias","cd_ns_alias","ns_ap_an","ca_ns_ap_an","cb_ns_ap_an","cc_ns_ap_an","cd_ns_ap_an","ns_ap_pn","ns_ap_pv","c12","ca12","cb12","cc12","cd12","ns_ak","ns_ap_hw","name","ns_ap_ni","ns_ap_ec","ns_ap_ev","ns_ap_device","ns_ap_id","ns_ap_csf","ns_ap_bi","ns_ap_pfm","ns_ap_pfv","ns_ap_ver","ca_ns_ap_ver","cb_ns_ap_ver","cc_ns_ap_ver","cd_ns_ap_ver","ns_ap_sv","ns_ap_cv","ns_ap_smv","ns_type","ca_ns_type","cb_ns_type","cc_ns_type","cd_ns_type","ns_radio","ns_nc","cs_partner","cs_xcid","cs_impid","ns_ap_ui","ca_ns_ap_ui","cb_ns_ap_ui","cc_ns_ap_ui","cd_ns_ap_ui","ns_ap_gs","ns_st_sv","ns_st_pv","ns_st_smv","ns_st_it","ns_st_id","ns_st_ec","ns_st_sp","ns_st_sc","ns_st_psq","ns_st_asq","ns_st_sq","ns_st_ppc","ns_st_apc","ns_st_spc","ns_st_cn","ns_st_ev","ns_st_po","ns_st_cl","ns_st_el","ns_st_sl","ns_st_pb","ns_st_hc","ns_st_mp","ca_ns_st_mp","cb_ns_st_mp","cc_ns_st_mp","cd_ns_st_mp","ns_st_mv","ca_ns_st_mv","cb_ns_st_mv","cc_ns_st_mv","cd_ns_st_mv","ns_st_pn","ns_st_tp","ns_st_ad","ns_st_li","ns_st_ci","ns_st_si","ns_st_pt","ns_st_dpt","ns_st_ipt","ns_st_et","ns_st_det","ns_st_upc","ns_st_dupc","ns_st_iupc","ns_st_upa","ns_st_dupa","ns_st_iupa","ns_st_lpc","ns_st_dlpc","ns_st_lpa","ns_st_dlpa","ns_st_pa","ns_st_ie","ns_ap_jb","ns_ap_et","ns_ap_res","ns_ap_sd","ns_ap_po","ns_ap_ot","ns_ap_c12m","cs_c12u","ca_cs_c12u","cb_cs_c12u","cc_cs_c12u","cd_cs_c12u","ns_ap_install","ns_ap_updated","ns_ap_lastrun","ns_ap_cs","ns_ap_runs","ns_ap_usage","ns_ap_fg","ns_ap_ft","ns_ap_dft","ns_ap_bt","ns_ap_dbt","ns_ap_dit","ns_ap_as","ns_ap_das","ns_ap_it","ns_ap_uc","ns_ap_aus","ns_ap_daus","ns_ap_us","ns_ap_dus","ns_ap_ut","ns_ap_oc","ns_ap_uxc","ns_ap_uxs","ns_ap_lang","ns_ap_ar","ns_ap_miss","ns_ts","ns_ap_cfg","ns_st_ca","ns_st_cp","ns_st_er","ca_ns_st_er","cb_ns_st_er","cc_ns_st_er","cd_ns_st_er","ns_st_pe","ns_st_ui","ca_ns_st_ui","cb_ns_st_ui","cc_ns_st_ui","cd_ns_st_ui","ns_st_bc","ns_st_dbc","ns_st_bt","ns_st_dbt","ns_st_bp","ns_st_lt","ns_st_skc","ns_st_dskc","ns_st_ska","ns_st_dska","ns_st_skd","ns_st_skt","ns_st_dskt","ns_st_pc","ns_st_dpc","ns_st_pp","ns_st_br","ns_st_pbr","ns_st_rt","ns_st_prt","ns_st_ub","ns_st_vo","ns_st_pvo","ns_st_ws","ns_st_pws","ns_st_ki","ns_st_rp","ns_st_bn","ns_st_tb","ns_st_an","ns_st_ta","ns_st_pl","ns_st_pr","ns_st_sn","ns_st_en","ns_st_ep","ns_st_sr","ns_st_ty","ns_st_ct","ns_st_cs","ns_st_ge","ns_st_st","ns_st_stc","ns_st_ce","ns_st_ia","ns_st_dt","ns_st_ddt","ns_st_tdt","ns_st_tm","ns_st_dtm","ns_st_ttm","ns_st_de","ns_st_pu","ns_st_ti","ns_st_cu","ns_st_fee","ns_st_ft","ns_st_at","ns_st_pat","ns_st_vt","ns_st_pvt","ns_st_tt","ns_st_ptt","ns_st_cdn","ns_st_pcdn","ns_st_ami","ns_st_amt","ns_st_ams","ns_ap_i1","ns_ap_i2","ns_ap_i3","ns_ap_i4","ns_ap_i5","ns_ap_i6","ns_ap_referrer","ns_clid","ns_campaign","ns_source","ns_mchannel","ns_linkname","ns_fee","gclid","utm_campaign","utm_source","utm_medium","utm_term","utm_content","ns_ecommerce","ns_ec_sv","ns_client_id","ns_order_id","ns_ec_cur","ns_orderline_id","ns_orderlines","ns_prod_id","ns_qty","ns_prod_price","ns_prod_grp","ns_brand","ns_shop","ns_category","category","ns_c","ns_search_term","ns_search_result","ns_m_exp","ns_m_chs","c3","ca3","cb3","cc3","cd3","c4","ca4","cb4","cc4","cd4","c5","ca5","cb5","cc5","cd5","c6","ca6","cb6","cc6","cd6","c10","c11","c13","c14","c15","c16","c7","c8","c9","ns_ap_er","ns_st_amc"]},_=function(){function e(){var e,s,n,a,i,o,c,l,g,_,p,d,S,f,E,b,h,P,y,A,m,v,k,I,C,T,L,N,O,D,R,B,M,U,w,V,F,G,x,K,H,Y,j,W,q,$,z,J,X,Z=this,Q=u.INTERVAL_MERGE_TOLERANCE;t.extend(this,{getHash:function(){return e},setHash:function(t){e=t},setPlaybackIntervalMergeTolerance:function(e){Q=e},getPlaybackIntervalMergeTolerance:function(){return Q},setInternalLabel:function(e,t){a[e]=t},getInternalLabel:function(e){return a[e]},hasInternalLabel:function(e){return null!=a[e]},setLabels:function(e){e&&t.extend(i,e)},getLabels:function(){return i},setLabel:function(e,t){i[e]=t},getLabel:function(e){return i[e]},hasLabel:function(e){return e in i},getClipNumber:function(){return parseInt(Z.getInternalLabel("ns_st_cn"))},setClipNumber:function(e){Z.setInternalLabel("ns_st_cn",e+"")},getPartNumber:function(){return Z.hasLabel("ns_st_pn")?parseInt(Z.getLabel("ns_st_pn")):parseInt(Z.getInternalLabel("ns_st_pn"))},createLabels:function(e,s){var o=e||{},r=t.isEmpty(o.ns_st_pt)?Z.getPlaybackTime():parseInt(o.ns_st_pt);o.ns_st_pt=r+(isNaN(l)?0:s-l)+"",o.ns_st_dpt=r+(isNaN(l)?0:s-l)-_+"",o.ns_st_ipt=r+(isNaN(l)?0:s-l)-p+"";var c=t.isEmpty(o.ns_st_et)?Z.getElapsedTime():parseInt(o.ns_st_et);o.ns_st_et=c+(isNaN(f)?0:s-f)+"",o.ns_st_det=c+(isNaN(f)?0:s-f)-E+"";var g=t.isEmpty(o.ns_st_bt)?Z.getBufferingTime():parseInt(o.ns_st_bt);o.ns_st_bt=g+"",o.ns_st_dbt=g+(isNaN(L)?0:s-L)-N+"";for(var u,d=parseInt(o.ns_st_po),S=t.addNewPlaybackInterval(t.cloneObject(Z.getSegmentPlaybackIntervals()),y,d,Q),b=t.addNewPlaybackInterval(t.cloneObject(Z.getAssetPlaybackIntervals()),y,d,Q),h=0,P=0,T=0;T<S.length;T++)u=Math.abs(S[T].end-S[T].start),h+=u,u>P&&(P=u);var O=0,R=0;for(T=0,u;T<b.length;T++)u=Math.abs(b[T].end-b[T].start),O+=u,u>R&&(R=u);o.ns_st_upc=h+"",o.ns_st_dupc=h-A+"",o.ns_st_iupc=h-m+"",o.ns_st_iupc=h>m?h-m+"":"0",o.ns_st_lpc=P+"",o.ns_st_dlpc=P-v+"",o.ns_st_upa=O+"",o.ns_st_dupa=O-k+"",o.ns_st_iupa=O>I?O-I+"":"0",o.ns_st_lpa=R+"",o.ns_st_dlpa=R-C+"";var B=t.isEmpty(o.ns_st_pc)?Z.getPauses():parseInt(o.ns_st_pc);o.ns_st_pc=B+"",o.ns_st_dpc=B-Y+"";var M=t.isEmpty(o.ns_st_skc)?Z.getSeeks():parseInt(o.ns_st_skc);o.ns_st_skc=M+"",o.ns_st_dskc=M-W+"";var w=t.isEmpty(o.ns_st_bc)?Z.getBuffers():parseInt(o.ns_st_bc);o.ns_st_bc=w+"",o.ns_st_dbc=w-D+"";var V=t.isEmpty(o.ns_st_skt)?Z.getSeekingTime():parseInt(o.ns_st_skt);o.ns_st_skt=V+"",o.ns_st_dskt=V-U+"";var F=t.isEmpty(o.ns_st_ska)?Z.getSeekingAmount():parseInt(o.ns_st_ska);return o.ns_st_ska=F+"",o.ns_st_dska=F-G+"",n&&(o.ns_st_spc=q+"",o.ns_st_apc=$+"",o.ns_st_sq=z+"",o.ns_st_asq=J+""),o.ns_st_sc=n||0!=X?X+"":"1",t.extend(o,a,i),o},updateDeltaLabels:function(e){_=parseInt(e.ns_st_pt),E=parseInt(e.ns_st_et),N=parseInt(e.ns_st_bt),A=parseInt(e.ns_st_upc),v=parseInt(e.ns_st_lpc),k=parseInt(e.ns_st_upa),C=parseInt(e.ns_st_lpa),Y=parseInt(e.ns_st_pc),W=parseInt(e.ns_st_skc),D=parseInt(e.ns_st_bc),U=parseInt(e.ns_st_skt),G=parseInt(e.ns_st_ska),Z.setSeekingDirection(0)},updateIndependentLabels:function(e){p=parseInt(e.ns_st_pt),m=parseInt(e.ns_st_upc),I=parseInt(e.ns_st_upa)},getVideoTrack:function(){return Z.getInternalLabel("ns_st_vt")},setVideoTrack:function(e){Z.setInternalLabel("ns_st_vt",e+"")},getAudioTrack:function(){return Z.getInternalLabel("ns_st_at")},setAudioTrack:function(e){Z.setInternalLabel("ns_st_at",e+"")},getSubtitleTrack:function(){return Z.getInternalLabel("ns_st_tt")},setSubtitleTrack:function(e){Z.setInternalLabel("ns_st_tt",e+"")},getCDN:function(){return Z.getInternalLabel("ns_st_cdn")},setCDN:function(e){Z.setInternalLabel("ns_st_cdn",e+"")},getSegmentPlaybackIntervals:function(){return h},setAssetPlaybackIntervals:function(e){h=e},getAssetPlaybackIntervals:function(){return P},incrementPauses:function(){H++},incrementSeeks:function(){j++},incrementPlayCounter:function(){z++},getPlayCounter:function(){return z},getBufferingTime:function(){return T},setBufferingTime:function(e){T=e},addBufferingTime:function(e){if(!isNaN(L)){var t=Z.getBufferingTime();t+=e-L,Z.setBufferingTime(t),L=NaN}},setPlaybackStartPosition:function(e){y=parseInt(e)},getPlaybackStartPosition:function(){return y},addInterval:function(e){isNaN(y)||isNaN(e)||(h=t.addNewPlaybackInterval(h,y,e,Q),P=t.addNewPlaybackInterval(P,y,e,Q),y=NaN)},getElapsedTime:function(){return S},setElapsedTime:function(e){S=e},addElapsedTime:function(e){if(!isNaN(f)){var t=Z.getElapsedTime();t+=e-f,Z.setElapsedTime(t),f=NaN}},getElapsedTimestamp:function(){return f},setElapsedTimestamp:function(e){f=e},addPlaybackTime:function(e){if(!isNaN(l)){var t=Z.getPlaybackTime();t+=e-l,Z.setPlaybackTime(t),l=NaN}},getPlaybackTime:function(){return c},getExpectedPlaybackPosition:function(e){return isNaN(l)?d:d+(e-l)},setPlaybackTimeOffset:function(e){d=e},getPlaybackTimeOffset:function(){return d},setPlaybackTime:function(e){c=e},getPlaybackTimestamp:function(){return l},setPlaybackTimestamp:function(e){l=e},setPreviousPlaybackTime:function(e){_=e},setPreviousPlaybackTimestamp:function(e){g=e},getBufferingTimestamp:function(){return L},setBufferingTimestamp:function(e){L=e},getPauses:function(){return H},setPauses:function(e){H=e},getSeeks:function(){return j},setSeeks:function(e){j=e},setSeeking:function(e){R=e},isSeeking:function(){return R},setCollectingSeekingTime:function(e){V=e},isCollectingSeekingTime:function(){return V},setAssetStarted:function(e){s=e},isAssetStarted:function(){return s},setPlaybackStarted:function(e){n=e},isPlaybackStarted:function(){return n},setSeekingTimestamp:function(e){B=e},getSeekingTimestamp:function(){return B},addSeekingTime:function(e){if(!isNaN(B)){var t=Z.getSeekingTime();t+=e-B,Z.setSeekingTime(t),B=NaN}},getSeekingTime:function(){return M},setSeekingTime:function(e){M=e},setSeekingTimeBeforeEnd:function(e){x=e},getSeekingTimeBeforeEnd:function(){return x},setSeekStartPosition:function(e){w=e},getSeekStartPosition:function(){return w},setSeekingAmount:function(e){F=e},getSeekingAmount:function(){return F},addSeekingAmount:function(e){var t=Z.getSeekingAmount();t+=Math.abs(e-w),Z.setSeekingAmount(t);var s;w==e?s=0:w>e?s=-1:w<e&&(s=1),Z.setSeekingDirection(s),w=0},getSeekingDirection:function(){return parseInt(Z.getInternalLabel("ns_st_skd"))},setSeekingDirection:function(e){Z.setInternalLabel("ns_st_skd",e+"")},resetAssetLifecycleLabels:function(){c=0,_=0,p=0,T=0,N=0,O=0,D=0,H=0,Y=0,z=0,P=[],k=0,I=0,C=0,S=0,E=0,M=0,U=0,F=0,G=0,j=0,W=0},incrementSegmentPlaybackCounter:function(){q++},incrementAssetLoadCounter:function(){X++},incrementAssetPlaybackCounter:function(){$++},getPreviousUniquePlaybackInterval:function(){return A},setPreviousUniquePlaybackInterval:function(e){A=e},getPreviousEventIndependentUniquePlaybackInterval:function(){return m},setPreviousEventIndependentUniquePlaybackInterval:function(e){m=e},setPreviousLongestPlaybackInterval:function(e){v=e},getPreviousLongestPlaybackInterval:function(){return v},resetAssetPlaybackIntervals:function(){P=[],k=0,I=0,C=0},setSegmentPlaybackCounter:function(e){q=e},setAssetLoadCounter:function(e){X=e},setAssetPlaybackCounter:function(e){$=e},setLowestPartNumberPlayed:function(e){b=e},getSegmentPlaybackCounter:function(){return q},getAssetLoadCounter:function(){return X},getAssetPlaybackCounter:function(){return $},getLowestPartNumberPlayed:function(){return b},getBuffers:function(){return O},incrementBufferCount:function(){O++},getPreviousBufferingTime:function(){return N},setPlaySequenceCounter:function(e){J=e},incrementPlaySequenceCounter:function(){J++},getPlaySequenceCounter:function(){return J},isPlaybackSessionLooping:function(){return K},setPlaybackSessionLooping:function(e){K=e},enableAutoCalculatePositions:function(e){o=!!e},isAutoCalculatePositionsEnabled:function(){return o}}),function(){a={},a.ns_st_cl="0",a.ns_st_pn="1",a.ns_st_tp="0",a.ns_st_cn="1",a.ns_st_skd="0",a.ns_st_ci="0",a.c3="*null",a.c4="*null",a.c6="*null",a.ns_st_st="*null",a.ns_st_pu="*null",a.ns_st_pr="*null",a.ns_st_ep="*null",a.ns_st_sn="*null",a.ns_st_en="*null",a.ns_st_ct="*null",i={},n=!1,s=!1,e=r.UNKNOWN_VALUE,o=!0,c=0,l=NaN,d=0,_=0,g=NaN,S=0,f=NaN,b=0,E=0,p=0,y=NaN,h=[],P=[],A=0,m=0,v=0,k=0,I=0,C=0,T=0,L=NaN,N=0,O=0,D=0,R=!1,B=NaN,V=!1,w=0,x=0,M=0,U=0,F=0,G=0,H=0,Y=0,j=0,W=0,q=0,$=0,z=0,J=0,X=0,K=!1}()}return e.resetAsset=function(e,t,s){for(var n=e.getLabels(),a={},i=0;s&&i<s.length;++i)n.hasOwnProperty(s[i])&&(a[s[i]]=n[s[i]]);t.setLabels(a),t.setPlaybackIntervalMergeTolerance(e.getPlaybackIntervalMergeTolerance())},e}(),p=function(){function e(e){var s,n,a,i,o,r,g,p,d,S,f,E,b,h,P,y,A=this;t.extend(this,{resetAsset:function(){var e=s;s=new _,_.resetAsset(e,s)},hashExists:function(e){return null!=p[e]},storeHash:function(e){p[e]={}},removeHash:function(e){delete p[e]},storeAssetPlaybackCounters:function(){for(var e in p)if(p.hasOwnProperty(e)&&p[e].clipNumber===s.getClipNumber()){t.extend(p[e],{segmentPlaybackCounter:s.getSegmentPlaybackCounter(),assetLoadCounter:s.getAssetLoadCounter(),assetPlaybackCounter:s.getAssetPlaybackCounter(),lowestPartNumberPlayed:s.getLowestPartNumberPlayed(),seeking:s.isSeeking(),seekingTimeBeforeEnd:s.getSeekingTimeBeforeEnd(),seekingStartPosition:s.getSeekStartPosition(),segmentPlaybackIntervals:s.getSegmentPlaybackIntervals(),videoTrack:s.getVideoTrack(),audioTrack:s.getAudioTrack(),subtitleTrack:s.getSubtitleTrack(),cdn:s.getCDN(),playSequenceCounter:s.getPlaySequenceCounter(),previousUniquePlaybackInterval:s.getPreviousUniquePlaybackInterval(),previousEventIndependentUniquePlaybackInterval:s.getPreviousEventIndependentUniquePlaybackInterval(),previousLongestPlaybackInterval:s.getPreviousLongestPlaybackInterval()});break}},getStoredAssetRegisters:function(e){return p[e]},getClipNumber:function(e){return p[e].clipNumber},getMaxClipNumber:function(){return d},storeClipNumber:function(e,t){p[e].clipNumber=t,t>d&&(d=t)},setLabels:function(e){null!=e&&t.extend(r,e)},getLabels:function(){return r},setLabel:function(e,t){var s={};s[e]=t,A.setLabels(s)},getLabel:function(e){return r[e]},getAsset:function(){return s},addInternalErrorFlag:function(e){for(var t=0;t<y.length;++t)if(y[t]==e)return;y.push(e)},createLabels:function(n,a){var c=n||{},l=t.isEmpty(c.ns_st_pa)?A.getPlaybackTime():parseInt(c.ns_st_pa);return c.ns_st_pa=l+(isNaN(i)?0:a-i)+"",c.ns_st_pp=b+"",c.ns_st_sp=h+"",c.ns_st_bp=P+"",S||(c.ns_st_pb=null!=c.ns_st_pb?c.ns_st_pb:"1"),s.isPlaybackStarted()&&(c.ns_st_ppc=f+"",c.ns_st_psq=E+""),y.length>0&&(c.ns_st_ie=(c.ns_st_ie?c.ns_st_ie+";":"")+y.join(";")),t.extend(c,o,r),e.getPlaybackSession().getAsset().createLabels(c,a),c},incrementPlayCounter:function(){h++},incrementPauses:function(){b++},addPlaybackTime:function(e){if(!isNaN(i)){var t=A.getPlaybackTime();t+=e-i,A.setPlaybackTime(t),i=NaN}},addBufferingTime:function(e){if(!isNaN(n)){var t=A.getBufferingTime();t+=e-n,A.setBufferingTime(t),n=NaN}},getBufferingTime:function(){return P},setBufferingTime:function(e){P=e},getPlaybackTime:function(){return a},setBufferingTimestamp:function(e){n=e},getBufferingTimestamp:function(){return n},setPlaybackTime:function(e){a=e},setPlaybackTimestamp:function(e){i=e},getPlaybackTimestamp:function(){return i},getPauses:function(){return b},setPauses:function(e){b=e},isPlaybackSessionStarted:function(){return g},setPlaybackSessionStarted:function(e){g=e},getPlaybackCounter:function(){return f},incrementPlaybackCounter:function(){f++},setFirstEventSent:function(e){S=e},setPlaySequenceCounter:function(e){E=e},incrementPlaySequenceCounter:function(){E++},getPlaybackSessionID:function(){return o.ns_st_id},setAsset:function(s,n){e.getLogging().apiCall("setAsset",s,n),s=t.jsonObjectToStringDictionary(s);var a=e.getStateMachine().getCurrentState();if(a!=l.IDLE){e.getLogging().infoLog("Ending the current Clip. It was in state:",t.stateToString(a));var i={};e.getStaCore().newEvent(c.END,t.fixEventTime(i),i)}var o="",r=0;if(null!=s.ns_st_cn)o=s.ns_st_cn;else for(var g=0;g<u.STANDARD_METADATA_LABELS.length;g++)s[u.STANDARD_METADATA_LABELS[g]]&&(o+=u.STANDARD_METADATA_LABELS[g]+":"+s[u.STANDARD_METADATA_LABELS[g]]+";");var _=A,p=_.getAsset();p.isAssetStarted()?(_.hashExists(p.getHash())||(_.storeHash(p.getHash()),_.storeClipNumber(p.getHash(),p.getClipNumber())),_.storeAssetPlaybackCounters(),r=_.hashExists(o)?_.getClipNumber(o):t.exists(s.ns_st_cn)?parseInt(s.ns_st_cn):_.getMaxClipNumber()+1):r=_.hashExists(o)?_.getClipNumber(o):p.getClipNumber(),_.resetAsset(),p=_.getAsset(),p.setHash(o),p.setClipNumber(r),p.setLabels(s);var d=_.getStoredAssetRegisters(o);d&&(p.setAssetStarted(!0),p.setSegmentPlaybackCounter(d.segmentPlaybackCounter),p.setAssetLoadCounter(d.assetLoadCounter),p.setAssetPlaybackCounter(d.assetPlaybackCounter),p.setLowestPartNumberPlayed(d.lowestPartNumberPlayed),p.setSeeking(d.seeking),p.setSeekingTimeBeforeEnd(d.seekingTimeBeforeEnd),p.setSeekStartPosition(d.seekingStartPosition),p.setAssetPlaybackIntervals(d.segmentPlaybackIntervals),d.videoTrack&&p.setVideoTrack(d.videoTrack),d.audioTrack&&p.setAudioTrack(d.audioTrack),d.subtitleTrack&&p.setSubtitleTrack(d.subtitleTrack),d.cdn&&p.setCDN(d.cdn),p.setPlaySequenceCounter(d.playSequenceCounter),p.setPreviousUniquePlaybackInterval(d.previousUniquePlaybackInterval),p.setPreviousEventIndependentUniquePlaybackInterval(d.previousEventIndependentUniquePlaybackInterval),p.setPreviousLongestPlaybackInterval(d.previousLongestPlaybackInterval)),p.incrementAssetLoadCounter(),p.isAssetStarted()&&n&&_.incrementPlayCounter(),n&&(_.setPlaySequenceCounter(0),p.setPlaybackSessionLooping(!0)),!t.exists(s.ns_st_tp)&&t.exists(s.ns_st_ad)&&t.isNotEmpty(s.ns_st_ad)&&"0"!==s.ns_st_ad&&p.setInternalLabel("ns_st_tp","1")}}),function(){s=new _,o={},o.ns_st_id=+new Date+"",r={},n=NaN,a=0,i=NaN,p={},d=0,g=!1,S=!1,f=0,b=0,E=0,h=1,P=0,y=[]}()}return e.resetPlaybackSession=function(e,t,s){for(var n=t.getAsset(),a=t.getLabels(),i={},o=0;s&&o<s.length;o++)a.hasOwnProperty(s[o])&&(i[s[o]]=a[s[o]]);e.getPlaybackSession().setLabels(i),_.resetAsset(n,e.getPlaybackSession().getAsset(),s)},e}(),d=function(){return function(e){function s(s){a=t.extend({},s);var n=e.getStaCore().getLiveEndpointURL();if(e.getAppCore()){if(e.getStaCore().isProperlyInitialized()){var i=e.getStaCore().getExports().et;if("function"==typeof e.getAppCore().getMeasurementDispatcher){var o=e.getAppCore().getMeasurementDispatcher();o.send(i.HIDDEN,s,n)}else{var r=e.getStaCore().getExports().am,c=r.newApplicationMeasurement(e.getAppCore(),i.HIDDEN,s,n);e.getAppCore().getQueue().offer(c)}}}else n&&e.getStaCore().getPlatformAPI().httpGet(e.getStaCore().prepareUrl(n,s))}var n,a,i=this,o=[];t.extend(this,{newEvent:function(e){for(var t=0;t<o.length;++t)o[t](e.eventLabels);s(e.eventLabels),e.eventType!=c.HEARTBEAT&&i.incrementEventCounter()},addMeasurementListener:function(e){"function"==typeof e&&o.push(e)},removeMeasurementListener:function(e){for(var t=NaN,s=0;s<o.length;++s)if(o[s]==e){t=s;break}isNaN(t)||o.splice(t,1)},getEventCounter:function(){return n},incrementEventCounter:function(){n++},setEventCounter:function(e){n=e},getMeasurementSnapshot:function(){return a}}),function(){n=1}()}}(),S=function(){return function(e){function s(){o++;var s={},n=t.fixEventTime(s);s.ns_st_hc=e.getHeartbeat().getCount()+"";var a=e.getStaCore().createLabels(c.HEARTBEAT,s,n);e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a),i=0,r.resume()}function n(){null!=a&&(e.getStaCore().getPlatformAPI().clearTimeout(a),a=null)}var a,i,o,r=this,l=u.DEFAULT_HEARTBEAT_INTERVAL;t.extend(this,{getCount:function(){return o},setIntervals:function(e){l=e},getInterval:function(e){var t=0;if(null!=l)for(var s=0;s<l.length;s++){var n=l[s],a=n.playingtime;if(!a||e<a){t=n.interval;break}}return t},getIntervals:function(){return l},resume:function(){n();var t=r.getInterval(e.getPlaybackSession().getAsset().getPlaybackTime()+(+new Date-e.getPlaybackSession().getAsset().getPlaybackTimestamp()));if(t>0){var o=i>0?i:t;a=e.getStaCore().getPlatformAPI().setTimeout(s,o)}i=0},pause:function(){n();var t=r.getInterval(e.getPlaybackSession().getAsset().getPlaybackTime()+(+new Date-e.getPlaybackSession().getAsset().getPlaybackTimestamp()));i=t-(e.getPlaybackSession().getAsset().getPlaybackTime()+(+new Date-e.getPlaybackSession().getAsset().getPlaybackTimestamp()))%t}}),function(){i=0,o=0}()}}(),f=function(){return function(e){function s(){var s={},n=t.fixEventTime(s);e.getStaCore().newPseudoEvent(c.KEEPALIVE,n,s),i.start()}function n(){null!=a&&(e.getStaCore().getPlatformAPI().clearTimeout(a),a=null)}var a,i=this,o=u.DEFAULT_KEEP_ALIVE_INTERVAL;t.extend(i,{start:function(){n(),a=e.getStaCore().getPlatformAPI().setTimeout(s,o)},stop:n,setInterval:function(e){o=e},getInterval:function(){return o}})}}(),E=function(){return function(e){var s,n,a,i=this;t.extend(i,{eventTypeToState:function(e){if(a==l.IDLE){if(e==c.PLAY)return l.PLAYING;if(e==c.SEEK_START)return l.SEEKING_BEFORE_PLAYBACK;if(e==c.BUFFER)return l.BUFFERING_BEFORE_PLAYBACK}else if(a==l.PLAYBACK_NOT_STARTED){if(e==c.PLAY)return l.PLAYING;if(e==c.SEEK_START)return l.SEEKING_BEFORE_PLAYBACK;if(e==c.BUFFER)return l.BUFFERING_BEFORE_PLAYBACK;if(e==c.END||e==c.AD_SKIP)return l.IDLE}else if(a==l.PLAYING){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.BUFFER)return l.BUFFERING_DURING_PLAYBACK;if(e==c.PAUSE)return l.PAUSED;if(e==c.SEEK_START)return l.SEEKING_DURING_PLAYBACK}else if(a==l.PAUSED){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.BUFFER)return l.BUFFERING_DURING_PAUSE;if(e==c.PLAY)return l.PLAYING;if(e==c.SEEK_START)return l.SEEKING_DURING_PAUSE}else if(a==l.BUFFERING_BEFORE_PLAYBACK){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.PAUSE||e==c.BUFFER_STOP)return l.PLAYBACK_NOT_STARTED;if(e==c.PLAY)return l.PLAYING;if(e==c.SEEK_START)return l.SEEKING_BEFORE_PLAYBACK}else if(a==l.BUFFERING_DURING_PLAYBACK){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.PLAY||e==c.BUFFER_STOP)return l.PLAYING;if(e==c.PAUSE_ON_BUFFERING)return l.PAUSED_DURING_BUFFERING;if(e==c.SEEK_START)return l.SEEKING_DURING_BUFFERING;if(e==c.PAUSE)return l.PAUSED}else if(a==l.BUFFERING_DURING_SEEKING){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.PLAY)return l.PLAYING;if(e==c.BUFFER_STOP)return l.SEEKING_DURING_PLAYBACK;if(e==c.PAUSE)return l.PAUSED}else if(a==l.BUFFERING_DURING_PAUSE){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.PLAY)return l.PLAYING;if(e==c.SEEK_START)return l.SEEKING_DURING_PAUSE;if(e==c.BUFFER_STOP||e==c.PAUSE)return l.PAUSED}else if(a==l.SEEKING_BEFORE_PLAYBACK){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.PAUSE)return l.PLAYBACK_NOT_STARTED;if(e==c.PLAY)return l.PLAYING;if(e==c.BUFFER)return l.BUFFERING_BEFORE_PLAYBACK}else if(a==l.SEEKING_DURING_PLAYBACK){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.PLAY)return l.PLAYING;if(e==c.PAUSE)return l.PAUSED;if(e==c.BUFFER)return l.BUFFERING_DURING_SEEKING}else if(a==l.SEEKING_DURING_BUFFERING){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.PLAY)return l.PLAYING;if(e==c.PAUSE||e==c.BUFFER_STOP)return l.PAUSED;if(e==c.BUFFER)return l.BUFFERING_DURING_SEEKING}else if(a==l.SEEKING_DURING_PAUSE){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.PLAY)return l.PLAYING;if(e==c.PAUSE||e==c.BUFFER_STOP)return l.PAUSED;if(e==c.BUFFER)return l.BUFFERING_DURING_PAUSE}else if(a==l.PAUSED_DURING_BUFFERING){if(e==c.END||e==c.AD_SKIP)return l.IDLE;if(e==c.SEEK_START)return l.SEEKING_DURING_BUFFERING;if(e==c.PAUSE)return l.PAUSED;if(e==c.PLAY||e==c.BUFFER_STOP)return l.PLAYING}return null},getCurrentState:function(){return a},newEvent:function(e,t){var o=i.eventTypeToState(e);a!=o&&(n=a,a=o,s=t)},getPreviousState:function(){return n},getLastStateChangeTimestamp:function(){return s}}),function(){a=l.IDLE,n=null,s=NaN}()}}(),b=function(){return function(e){var s=this;t.extend(s,{onSeekStartWhenPausedOrBufferingDuringPause:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().getAsset().isSeeking()?e.getPlaybackSession().getAsset().isCollectingSeekingTime()||(e.getPlaybackSession().getAsset().setSeekingTimestamp(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0)):e.getPlaybackSession().getAsset().incrementSeeks(),e.getPlaybackSession().getAsset().isSeeking()||(e.getPlaybackSession().getAsset().setSeeking(!0),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0),e.getPlaybackSession().getAsset().setSeekStartPosition(n),e.getPlaybackSession().getAsset().setSeekingTimestamp(t)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onBufferWhenSeekingOrPaused:function(t,s){e.getPlaybackSession().setBufferingTimestamp(t),e.getPlaybackSession().getAsset().setBufferingTimestamp(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onPlayWhenSeekingDuringBufferingOrSeekingDuringPause:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)},onBufferStopWhenBufferingDuringSeekingOrBufferingDuringPause:function(t,s){e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onPauseWhenSeekingDuringPlaybackOrSeekingDuringPause:function(t,s){e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onEndOrAdSkipWhenSeekingDuringBufferingOrSeekingDuringPause:function(s,n){e.getStaCore().resetHeartbeat(),e.getKeepAlive().stop(),e.getPlaybackSession().getAsset().addElapsedTime(s);var a=e.getStaCore().createLabels(c.END,n,s);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().storeAssetPlaybackCounters(),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onBufferStopWhenSeekingDuringBufferingOrSeekingDuringPause:function(t,s){e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onBufferStopOrOnPlayWhenBufferingDuringPlayback:function(t,s){var n=parseInt(s.ns_st_po);e.getStaCore().stopPausedOnBufferingTimer(),e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getHeartbeat().resume(),e.getKeepAlive().start()}})}}(),h=function(){return function(e){var s=this;t.extend(s,{onEndOrAdSkip:function(s,n){e.getPlaybackSession().addBufferingTime(s),e.getPlaybackSession().getAsset().addBufferingTime(s),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onBufferStop:function(t,s){e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1))},onSeekStart:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().isSeeking()?e.getPlaybackSession().getAsset().isCollectingSeekingTime()||(e.getPlaybackSession().getAsset().setSeekingTimestamp(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0)):e.getPlaybackSession().getAsset().incrementSeeks(),e.getPlaybackSession().getAsset().isSeeking()||(e.getPlaybackSession().getAsset().setSeeking(!0),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0),e.getPlaybackSession().getAsset().setSeekStartPosition(n),e.getPlaybackSession().getAsset().setSeekingTimestamp(t))},onPause:function(t,s){e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1))},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().getAsset().setPlaybackStarted(!0),(e.getPlaybackSession().getAsset().isPlaybackSessionLooping()||0==e.getPlaybackSession().getPlaybackCounter())&&(e.getPlaybackSession().incrementPlaybackCounter(),e.getPlaybackSession().getAsset().setPlaybackSessionLooping(!1)),e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().setPlaybackStarted(!0),e.getPlaybackSession().getAsset().incrementSegmentPlaybackCounter(),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),(0==e.getPlaybackSession().getAsset().getLowestPartNumberPlayed()||e.getPlaybackSession().getAsset().getPartNumber()<=e.getPlaybackSession().getAsset().getLowestPartNumberPlayed())&&(e.getPlaybackSession().getAsset().setLowestPartNumberPlayed(e.getPlaybackSession().getAsset().getPartNumber()),e.getPlaybackSession().getAsset().incrementAssetPlaybackCounter(),e.getPlaybackSession().getAsset().setPlaySequenceCounter(0),e.getPlaybackSession().getAsset().resetAssetPlaybackIntervals()),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getStaCore().isLoadingTimeSent()||(s.ns_st_lt=e.getStaCore().getLoadTimeOffset()+t-e.getStaCore().getInitTimestamp()+"",e.getStaCore().setLoadingTimeSent(!0)),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),P=function(){return function(e){var s=this;t.extend(s,{onEndAndSkip:function(s,n){e.getStaCore().resetHeartbeat(),e.getKeepAlive().stop(),e.getPlaybackSession().addBufferingTime(s),e.getPlaybackSession().getAsset().addBufferingTime(s),e.getPlaybackSession().getAsset().addElapsedTime(s);var a=e.getStaCore().createLabels(c.END,n,s);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().storeAssetPlaybackCounters(),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onPause:function(t,s){e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),y=function(){return function(e){var s=this;t.extend(s,{onPauseOnBuffering:function(t,s){parseInt(s.ns_st_po),e.getStaCore().stopPausedOnBufferingTimer(),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().incrementPauses(),e.getPlaybackSession().getAsset().incrementPauses();var n=e.getStaCore().createLabels(c.PAUSE,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(n.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(n.eventLabels),e.getEventManager().newEvent(n),e.getPlaybackSession().setBufferingTimestamp(t),e.getPlaybackSession().getAsset().setBufferingTimestamp(t)},onEndOrAdSkip:function(s,n){parseInt(n.ns_st_po),e.getStaCore().stopPausedOnBufferingTimer(),e.getStaCore().resetHeartbeat(),e.getKeepAlive().stop(),e.getPlaybackSession().addBufferingTime(s),e.getPlaybackSession().getAsset().addBufferingTime(s),e.getPlaybackSession().getAsset().addElapsedTime(s);var a=e.getStaCore().createLabels(c.END,n,s);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onSeekStart:function(t,s){var n=parseInt(s.ns_st_po);e.getStaCore().stopPausedOnBufferingTimer(),e.getHeartbeat().pause(),e.getKeepAlive().stop(),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().incrementSeeks(),e.getPlaybackSession().getAsset().setSeeking(!0),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0),e.getPlaybackSession().getAsset().setSeekStartPosition(n),e.getPlaybackSession().getAsset().setSeekingTimestamp(t),e.getPlaybackSession().incrementPauses(),e.getPlaybackSession().getAsset().incrementPauses();var a=e.getStaCore().createLabels(c.PAUSE,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)},onPause:function(t,s){parseInt(s.ns_st_po),e.getStaCore().stopPausedOnBufferingTimer(),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().incrementPauses(),e.getPlaybackSession().getAsset().incrementPauses();var n=e.getStaCore().createLabels(c.PAUSE,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(n.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(n.eventLabels),e.getEventManager().newEvent(n)}})}}(),A=function(){return function(e){var s=this;t.extend(s,{onEndOrAdSkip:function(s,n){e.getStaCore().resetHeartbeat(),e.getKeepAlive().stop(),e.getStaCore().stopPausedOnBufferingTimer(),e.getPlaybackSession().addBufferingTime(s),e.getPlaybackSession().getAsset().addBufferingTime(s),e.getPlaybackSession().getAsset().addElapsedTime(s);var a=e.getStaCore().createLabels(c.END,n,s);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().storeAssetPlaybackCounters(),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onPause:function(t,s){e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().incrementPauses(),e.getPlaybackSession().getAsset().incrementPauses(),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),m=function(){return function(e){var s=this;t.extend(s,{onBuffer:function(t,s){e.getPlaybackSession().setPlaybackSessionStarted(!0),e.getPlaybackSession().getAsset().setAssetStarted(!0),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().setSeekingTime(e.getPlaybackSession().getAsset().getSeekingTimeBeforeEnd()),e.getPlaybackSession().setBufferingTimestamp(t),e.getPlaybackSession().getAsset().setBufferingTimestamp(t)},onSeekStart:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().setPlaybackSessionStarted(!0),e.getPlaybackSession().getAsset().setAssetStarted(!0),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().setSeekingTime(e.getPlaybackSession().getAsset().getSeekingTimeBeforeEnd()),e.getPlaybackSession().getAsset().incrementSeeks(),e.getPlaybackSession().getAsset().setSeeking(!0),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0),e.getPlaybackSession().getAsset().setSeekStartPosition(n),e.getPlaybackSession().getAsset().setSeekingTimestamp(t)},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().setPlaybackSessionStarted(!0),e.getPlaybackSession().getAsset().setAssetStarted(!0),(e.getPlaybackSession().getAsset().isPlaybackSessionLooping()||0==e.getPlaybackSession().getPlaybackCounter())&&(e.getPlaybackSession().incrementPlaybackCounter(),e.getPlaybackSession().getAsset().setPlaybackSessionLooping(!1)),e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().setSeekingTime(e.getPlaybackSession().getAsset().getSeekingTimeBeforeEnd()),e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().setPlaybackStarted(!0),e.getPlaybackSession().getAsset().incrementSegmentPlaybackCounter(),(0==e.getPlaybackSession().getAsset().getLowestPartNumberPlayed()||e.getPlaybackSession().getAsset().getPartNumber()<=e.getPlaybackSession().getAsset().getLowestPartNumberPlayed())&&(e.getPlaybackSession().getAsset().setLowestPartNumberPlayed(e.getPlaybackSession().getAsset().getPartNumber()),e.getPlaybackSession().getAsset().incrementAssetPlaybackCounter(),e.getPlaybackSession().getAsset().setPlaySequenceCounter(0),e.getPlaybackSession().getAsset().resetAssetPlaybackIntervals()),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getStaCore().isLoadingTimeSent()||(s.ns_st_lt=e.getStaCore().getLoadTimeOffset()+t-e.getStaCore().getInitTimestamp()+"",e.getStaCore().setLoadingTimeSent(!0)),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),v=function(){return function(e){var s=this;t.extend(s,{onEndOrAdSkip:function(s,n){e.getStaCore().resetHeartbeat(),e.getKeepAlive().stop(),e.getPlaybackSession().getAsset().addElapsedTime(s);var a=e.getStaCore().createLabels(c.END,n,s);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().storeAssetPlaybackCounters(),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),k=function(){return function(e){var s=this;t.extend(s,{onEndOrAdSkip:function(s,n){e.getStaCore().resetHeartbeat(),e.getKeepAlive().stop(),e.getPlaybackSession().addBufferingTime(s),e.getPlaybackSession().getAsset().addBufferingTime(s),e.getPlaybackSession().getAsset().addElapsedTime(s),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1));var a=e.getStaCore().createLabels(c.END,n,s);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onBufferStop:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)},onSeekStart:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().isSeeking()?e.getPlaybackSession().getAsset().isCollectingSeekingTime()||(e.getPlaybackSession().getAsset().setSeekingTimestamp(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0)):e.getPlaybackSession().getAsset().incrementSeeks(),e.getPlaybackSession().getAsset().isSeeking()||(e.getPlaybackSession().getAsset().setSeeking(!0),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0),e.getPlaybackSession().getAsset().setSeekStartPosition(n),e.getPlaybackSession().getAsset().setSeekingTimestamp(t)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onPause:function(t,s){e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().addBufferingTime(t),e.getPlaybackSession().getAsset().addBufferingTime(t),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),I=function(){return function(e){var s=this;t.extend(s,{onEndOrAdSkip:function(s,n){e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().storeAssetPlaybackCounters(),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onSeekStart:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().getAsset().isSeeking()?e.getPlaybackSession().getAsset().setSeekingTimestamp(t):e.getPlaybackSession().getAsset().incrementSeeks(),e.getPlaybackSession().getAsset().isSeeking()||(e.getPlaybackSession().getAsset().setSeeking(!0),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0),e.getPlaybackSession().getAsset().setSeekStartPosition(n),e.getPlaybackSession().getAsset().setSeekingTimestamp(t))},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().setPlaybackSessionStarted(!0),(e.getPlaybackSession().getAsset().isPlaybackSessionLooping()||0==e.getPlaybackSession().getPlaybackCounter())&&(e.getPlaybackSession().incrementPlaybackCounter(),e.getPlaybackSession().getAsset().setPlaybackSessionLooping(!1)),e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().setPlaybackStarted(!0),e.getPlaybackSession().getAsset().incrementSegmentPlaybackCounter(),(0==e.getPlaybackSession().getAsset().getLowestPartNumberPlayed()||e.getPlaybackSession().getAsset().getPartNumber()<=e.getPlaybackSession().getAsset().getLowestPartNumberPlayed())&&(e.getPlaybackSession().getAsset().setLowestPartNumberPlayed(e.getPlaybackSession().getAsset().getPartNumber()),e.getPlaybackSession().getAsset().incrementAssetPlaybackCounter(),e.getPlaybackSession().getAsset().setPlaySequenceCounter(0),e.getPlaybackSession().getAsset().resetAssetPlaybackIntervals()),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getStaCore().isLoadingTimeSent()||(s.ns_st_lt=e.getStaCore().getLoadTimeOffset()+t-e.getStaCore().getInitTimestamp()+"",e.getStaCore().setLoadingTimeSent(!0)),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)},onBuffer:function(){e.getPlaybackSession().setBufferingTimestamp(eventTimestamp),e.getPlaybackSession().getAsset().setBufferingTimestamp(eventTimestamp)}})}}(),C=function(){return function(e){var s=this;t.extend(s,{onEndOrAdSkip:function(s,n){var a=parseInt(n.ns_st_po);e.getStaCore().resetHeartbeat(),e.getKeepAlive().stop(),e.getPlaybackSession().addPlaybackTime(s),e.getPlaybackSession().getAsset().addPlaybackTime(s),e.getPlaybackSession().getAsset().addElapsedTime(s),e.getPlaybackSession().getAsset().addInterval(a);var i=e.getStaCore().createLabels(c.END,n,s);e.getPlaybackSession().getAsset().updateDeltaLabels(i.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(i.eventLabels),e.getEventManager().newEvent(i),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onBuffer:function(t,s){var n=parseInt(s.ns_st_po);e.getHeartbeat().pause(),e.getKeepAlive().stop(),e.getPlaybackSession().addPlaybackTime(t),e.getPlaybackSession().getAsset().addPlaybackTime(t),e.getPlaybackSession().getAsset().addInterval(n),e.getStaCore().isPauseOnBufferingEnabled()&&e.getStaCore().startPausedOnBufferingTimer(t,s),e.getPlaybackSession().getAsset().incrementBufferCount(),e.getPlaybackSession().setBufferingTimestamp(t),e.getPlaybackSession().getAsset().setBufferingTimestamp(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)},onSeekStart:function(t,s){var n=parseInt(s.ns_st_po);e.getHeartbeat().pause(),e.getKeepAlive().stop(),e.getPlaybackSession().addPlaybackTime(t),e.getPlaybackSession().getAsset().addPlaybackTime(t),e.getPlaybackSession().getAsset().addInterval(n),e.getPlaybackSession().getAsset().incrementSeeks(),e.getPlaybackSession().getAsset().setSeeking(!0),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!0),e.getPlaybackSession().getAsset().setSeekStartPosition(n),e.getPlaybackSession().getAsset().setSeekingTimestamp(t),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().incrementPauses(),e.getPlaybackSession().getAsset().incrementPauses();var a=e.getStaCore().createLabels(c.PAUSE,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)},onPause:function(t,s){var n=parseInt(s.ns_st_po);e.getHeartbeat().pause(),e.getKeepAlive().stop(),e.getPlaybackSession().addPlaybackTime(t),e.getPlaybackSession().getAsset().addPlaybackTime(t),e.getPlaybackSession().getAsset().addInterval(n),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().incrementPauses(),e.getPlaybackSession().getAsset().incrementPauses();var a=e.getStaCore().createLabels(c.PAUSE,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),T=function(){return function(e){var s=this;t.extend(s,{onEndOrAdSkip:function(s,n){e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().storeAssetPlaybackCounters(),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onPause:function(t,s){e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1))},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),(e.getPlaybackSession().getAsset().isPlaybackSessionLooping()||0==e.getPlaybackSession().getPlaybackCounter())&&(e.getPlaybackSession().incrementPlaybackCounter(),e.getPlaybackSession().getAsset().setPlaybackSessionLooping(!1)),e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().getAsset().setPlaybackStarted(!0),e.getPlaybackSession().getAsset().incrementSegmentPlaybackCounter(),(0==e.getPlaybackSession().getAsset().getLowestPartNumberPlayed()||e.getPlaybackSession().getAsset().getPartNumber()<=e.getPlaybackSession().getAsset().getLowestPartNumberPlayed())&&(e.getPlaybackSession().getAsset().setLowestPartNumberPlayed(e.getPlaybackSession().getAsset().getPartNumber()),e.getPlaybackSession().getAsset().incrementAssetPlaybackCounter(),e.getPlaybackSession().getAsset().setPlaySequenceCounter(0),e.getPlaybackSession().getAsset().resetAssetPlaybackIntervals()),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getStaCore().isLoadingTimeSent()||(s.ns_st_lt=e.getStaCore().getLoadTimeOffset()+t-e.getStaCore().getInitTimestamp()+"",e.getStaCore().setLoadingTimeSent(!0)),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),L=function(){return function(e){var s=this;t.extend(s,{onPause:function(t,s){e.getPlaybackSession().incrementPauses(),e.getPlaybackSession().getAsset().incrementPauses(),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t)}})}}(),N=function(){return function(e){var s=this;t.extend(s,{onEndOrAdSkip:function(s,n){parseInt(n.ns_st_po),e.getStaCore().resetHeartbeat(),e.getKeepAlive().stop(),e.getPlaybackSession().getAsset().addElapsedTime(s);var a=e.getStaCore().createLabels(c.END,n,s);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a),e.getPlaybackSession().getAsset().isSeeking()&&e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().setSeekingTimeBeforeEnd(s-e.getPlaybackSession().getAsset().getSeekingTimestamp()),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().storeAssetPlaybackCounters(),e.getPlaybackSession().getAsset().resetAssetLifecycleLabels(),e.getPlaybackSession().getAsset().setPlaybackStarted(!1),n.hasOwnProperty("ns_st_pe")&&t.parseBoolean(n.ns_st_pe,!1)&&e.getStaCore().resetPlaybackSession()},onPlay:function(t,s){var n=parseInt(s.ns_st_po);e.getPlaybackSession().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlaySequenceCounter(),e.getPlaybackSession().getAsset().incrementPlayCounter(),e.getPlaybackSession().getAsset().isSeeking()&&(e.getPlaybackSession().getAsset().isCollectingSeekingTime()&&(e.getPlaybackSession().getAsset().addSeekingTime(t),e.getPlaybackSession().getAsset().setCollectingSeekingTime(!1)),e.getPlaybackSession().getAsset().addSeekingAmount(n),e.getPlaybackSession().getAsset().setSeeking(!1)),e.getPlaybackSession().getAsset().addElapsedTime(t),e.getPlaybackSession().getAsset().setElapsedTimestamp(t),e.getPlaybackSession().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackTimestamp(t),e.getPlaybackSession().getAsset().setPlaybackStartPosition(n),e.getStaCore().isLoadingTimeSent()||(s.ns_st_lt=e.getStaCore().getLoadTimeOffset()+t-e.getStaCore().getInitTimestamp()+"",e.getStaCore().setLoadingTimeSent(!0)),e.getHeartbeat().resume(),e.getKeepAlive().start();var a=e.getStaCore().createLabels(c.PLAY,s,t);e.getPlaybackSession().getAsset().updateDeltaLabels(a.eventLabels),e.getPlaybackSession().getAsset().updateIndependentLabels(a.eventLabels),e.getEventManager().newEvent(a)}})}}(),O=function(){return function(e){function n(e){var t=_.getStateMachine().getCurrentState();if(t==l.IDLE||t==l.PLAYBACK_NOT_STARTED||t==l.BUFFERING_BEFORE_PLAYBACK||t==l.SEEKING_BEFORE_PLAYBACK){if(e==c.PLAY)return!0}else if(t==l.PLAYING){if(e==c.END||e==c.AD_SKIP||e==c.SEEK_START||e==c.PAUSE)return!0}else if(t==l.PAUSED||t==l.BUFFERING_DURING_PAUSE||t==l.SEEKING_DURING_PLAYBACK||t==l.SEEKING_DURING_BUFFERING||t==l.SEEKING_DURING_PAUSE){if(e==c.END||e==c.AD_SKIP||e==c.PLAY)return!0}else if(t==l.BUFFERING_DURING_PLAYBACK){if(e==c.PAUSE_ON_BUFFERING||e==c.END||e==c.AD_SKIP||e==c.SEEK_START||e==c.PAUSE||e==c.PLAY)return!0}else if(t==l.BUFFERING_DURING_SEEKING){if(e==c.END||e==c.AD_SKIP||e==c.PAUSE||e==c.PLAY)return!0}else if(t==l.PAUSED_DURING_BUFFERING&&(e==c.END||e==c.AD_SKIP||e==c.BUFFER_STOP||e==c.PLAY))return!0;return!1}function a(e,t,s){var a=_.getStateMachine().getCurrentState();e==c.AD_SKIP&&!s.hasOwnProperty("ns_st_ui")&&n(e)?s.ns_st_ui="skip":e==c.SEEK_START&&!s.hasOwnProperty("ns_st_ui")&&n(e)&&(s.ns_st_ui="seek"),a==l.IDLE?e==c.BUFFER?O.onBuffer(t,s):e==c.SEEK_START?O.onSeekStart(t,s):e==c.PLAY&&O.onPlay(t,s):a==l.PLAYBACK_NOT_STARTED?e==c.END||e==c.AD_SKIP?B.onEndOrAdSkip(t,s):e==c.SEEK_START?B.onSeekStart(t,s):e==c.PLAY?B.onPlay(t,s):e==c.BUFFER&&B.onBuffer(t,s):a==l.PLAYING?e==c.END||e==c.AD_SKIP?M.onEndOrAdSkip(t,s):e==c.BUFFER?M.onBuffer(t,s):e==c.SEEK_START?M.onSeekStart(t,s):e==c.PAUSE&&M.onPause(t,s):a==l.PAUSED?e==c.END||e==c.AD_SKIP?R.onEndOrAdSkip(t,s):e==c.PLAY?R.onPlay(t,s):e==c.BUFFER?Y.onBufferWhenSeekingOrPaused(t,s):e==c.SEEK_START&&Y.onSeekStartWhenPausedOrBufferingDuringPause(t,s):a==l.BUFFERING_BEFORE_PLAYBACK?e==c.END||e==c.AD_SKIP?U.onEndOrAdSkip(t,s):e==c.BUFFER_STOP?U.onBufferStop(t,s):e==c.SEEK_START?U.onSeekStart(t,s):e==c.PAUSE?U.onPause(t,s):e==c.PLAY&&U.onPlay(t,s):a==l.BUFFERING_DURING_PLAYBACK?e==c.PAUSE_ON_BUFFERING?w.onPauseOnBuffering(t,s):e==c.BUFFER_STOP?Y.onBufferStopOrOnPlayWhenBufferingDuringPlayback(t,s):e==c.END||e==c.AD_SKIP?w.onEndOrAdSkip(t,s):e==c.SEEK_START?w.onSeekStart(t,s):e==c.PAUSE?w.onPause(t,s):e==c.PLAY&&Y.onBufferStopOrOnPlayWhenBufferingDuringPlayback(t,s):a==l.BUFFERING_DURING_SEEKING?e==c.END||e==c.AD_SKIP?V.onEndOrAdSkip(t,s):e==c.PAUSE?V.onPause(t,s):e==c.PLAY?V.onPlay(t,s):e==c.BUFFER_STOP&&Y.onBufferStopWhenBufferingDuringSeekingOrBufferingDuringPause(t,s):a==l.BUFFERING_DURING_PAUSE?e==c.END||e==c.AD_SKIP?F.onEndAndSkip(t,s):e==c.PAUSE?F.onPause(t,s):e==c.PLAY?F.onPlay(t,s):e==c.SEEK_START?Y.onSeekStartWhenPausedOrBufferingDuringPause(t,s):e==c.BUFFER_STOP&&Y.onBufferStopWhenBufferingDuringSeekingOrBufferingDuringPause(t,s):a==l.SEEKING_BEFORE_PLAYBACK?e==c.END||e==c.AD_SKIP?x.onEndOrAdSkip(t,s):e==c.PAUSE?x.onPause(t,s):e==c.PLAY?x.onPlay(t,s):e==c.BUFFER&&Y.onBufferWhenSeekingOrPaused(t,s):a==l.SEEKING_DURING_PLAYBACK?e==c.END||e==c.AD_SKIP?H.onEndOrAdSkip(t,s):e==c.PLAY?H.onPlay(t,s):e==c.BUFFER?Y.onBufferWhenSeekingOrPaused(t,s):e==c.PAUSE&&Y.onPauseWhenSeekingDuringPlaybackOrSeekingDuringPause(t,s):a==l.SEEKING_DURING_BUFFERING?e==c.PAUSE?K.onPause(t,s):e==c.BUFFER?Y.onBufferWhenSeekingOrPaused(t,s):e==c.PLAY?Y.onPlayWhenSeekingDuringBufferingOrSeekingDuringPause(t,s):e==c.END||e==c.AD_SKIP?Y.onEndOrAdSkipWhenSeekingDuringBufferingOrSeekingDuringPause(t,s):e==c.BUFFER_STOP&&Y.onBufferStopWhenSeekingDuringBufferingOrSeekingDuringPause(t,s):a==l.PAUSED_DURING_BUFFERING?e==c.END||e==c.AD_SKIP?G.onEndOrAdSkip(t,s):e==c.BUFFER_STOP?G.onBufferStop(t,s):e==c.SEEK_START?G.onSeekStart(t,s):e==c.PAUSE?G.onPause(t,s):e==c.PLAY&&G.onPlay(t,s):a==l.SEEKING_DURING_PAUSE&&(e==c.BUFFER?Y.onBufferWhenSeekingOrPaused(t,s):e==c.PLAY?Y.onPlayWhenSeekingDuringBufferingOrSeekingDuringPause(t,s):e==c.PAUSE?Y.onPauseWhenSeekingDuringPlaybackOrSeekingDuringPause(t,s):e==c.END||e==c.AD_SKIP?Y.onEndOrAdSkipWhenSeekingDuringBufferingOrSeekingDuringPause(t,s):e==c.BUFFER_STOP&&Y.onBufferStopWhenSeekingDuringBufferingOrSeekingDuringPause(t,s)),n(e)&&_.getPlaybackSession().setFirstEventSent(!0)}function i(e,s){for(var n,a=le.encodeURIComponent||escape,i=[],o=u.LABELS_ORDER,r=e.split("?"),c=r[0],l=r[1],g=l.split("&"),_=0,p=g.length;_<p;_++){var d=g[_].split("="),S=unescape(d[0]),f=unescape(d[1]);S&&(s[S]=f)}for(var E={},b=0,h=o.length;b<h;b++){var P=o[b];if(s.hasOwnProperty(P)){var y=s[P];void 0!==y&&null!=y&&(E[P]=!0,i.push(a(P)+"="+a(s[P])))}}for(var A in s)if(s.hasOwnProperty(A)){if(E[A])continue;var m=s[A];void 0!==m&&null!=m&&i.push(a(A)+"="+a(s[A]))}n=c+"?"+i.join("&"),n=n+(n.indexOf("&c8=")<0?"&c8="+a(ge.title):"")+(n.indexOf("&c7=")<0?"&c7="+a(ge.URL):"")+(n.indexOf("&c9=")<0?"&c9="+a(ge.referrer):"");var v=t.browserAcceptsLargeURLs()?u.URL_LENGTH_LIMIT:u.RESTRICTED_URL_LENGTH_LIMIT;if(n.length>v&&n.indexOf("&")>0){var k=n.substr(0,v-8).lastIndexOf("&");n=(n.substring(0,k)+"&ns_cut="+a(n.substring(k+1))).substr(0,v)}return n}var _,O,R,B,M,U,w,V,F,G,x,K,H,Y,j,W,q,$,z,J,X,Z,Q,ee,te,se,ne=this,ae={},ie=u.DEFAULT_PAUSED_ON_BUFFERING_INTERVAL,oe=u.THROTTLING_DELAY,re={},ce=!1;t.extend(ne,{getConfiguration:function(){return e||{}},enableSystemClockJumpsDetection:function(e){(e<u.SYSTEM_CLOCK_JUMP_DETECTION_MINIMUM_INTERVAL||!e)&&(e=u.SYSTEM_CLOCK_JUMP_DETECTION_DEFAULT_INTERVAL),t.onSystemClockJump(function(e){se=e,ce=!0},e)},createLabels:function(e,s,n){var a=!1;if(e==c.HEARTBEAT){var i=isNaN($)?q:$;$=n,(n<i||ce)&&(a=!0,ce=!1,n<i?(_.getPlaybackSession().addInternalErrorFlag("1"),_.getLogging().infoLog("System clock jump detected","to the far past")):se?(_.getPlaybackSession().addInternalErrorFlag("3"),_.getLogging().infoLog("System clock jump detected","to the future")):(_.getPlaybackSession().addInternalErrorFlag("2"),_.getLogging().infoLog("System clock jump detected","to the near past")),n=i)}var o={};if("undefined"!=typeof document){var r=document;o.c7=r.URL,o.c8=r.title,o.c9=r.referrer}return o.ns_ts=+new Date+"",o.ns_st_ev=c.toString(e),o.ns_st_mp=u.DEFAULT_PLAYERNAME,o.ns_st_mv=u.STREAMINGANALYTICS_VERSION,o.ns_st_ub="0",o.ns_st_br="0",o.ns_st_pn="1",o.ns_st_tp="0",o.ns_st_it=g.toString(g.SINGLE_CLIP),o.ns_st_sv=u.STREAMINGANALYTICS_VERSION,o.ns_st_smv=u.MODEL_VERSION,o.ns_type="hidden",o.ns_st_ec=_.getEventManager().getEventCounter()+"",o.ns_st_ki=_.getKeepAlive().getInterval()+"",_.getPlaybackSession().getAsset().isAutoCalculatePositionsEnabled()?o.ns_st_po=_.getPlaybackSession().getAsset().getExpectedPlaybackPosition(n)+"":o.ns_st_po=te+"",te=parseInt(o.ns_st_po),t.extend(o,ne.getLabels()),_.getPlaybackSession().createLabels(o,n),t.extend(o,s),a&&(_.getPlaybackSession().setPlaybackTimestamp($-parseInt(o.ns_st_pt)),_.getPlaybackSession().getAsset().setPlaybackTimestamp($-parseInt(o.ns_st_pt)),_.getPlaybackSession().getAsset().setElapsedTimestamp($-parseInt(o.ns_st_et)),_.getStateMachine().getCurrentState()==l.BUFFERING_DURING_PLAYBACK&&_.getPlaybackSession().getAsset().setBufferingTimestamp($-parseInt(o.ns_st_bp))),{eventType:e,eventLabels:o}},newEvent:function(e,s,n,i){ne.stopDelayedTransitionTimer();var o=_.getStateMachine().getCurrentState(),r=_.getStateMachine().eventTypeToState(e);if(null==r||r==o)return void _.getLogging().infoLog("Ignored event:",c.toString(e),"during state",t.stateToString(o),n);if(ne.isThrottlingEnabled()&&(o==l.PLAYING||o==l.PAUSED)&&(r==l.PLAYING||r==l.PAUSED)&&!i){_.getLogging().infoLog("Throttled event:",c.toString(e),"during state",t.stateToString(o),n,ne.getThrottlingDelay(),"ms");var g=function(e,t,n){return function(){ne.newEvent(e,s,n,!0)}}(e,0,n);return void(Z=_.getPlatformAPI().setTimeout(g,ne.getThrottlingDelay()))}var u=isNaN($)?q:$;$=s;var p=!1;(s<u||ce)&&(p=!0,ce=!1,s<u?(_.getPlaybackSession().addInternalErrorFlag("1"),_.getLogging().infoLog("System clock jump detected","to the far past")):se?(_.getPlaybackSession().addInternalErrorFlag("3"),_.getLogging().infoLog("System clock jump detected","to the future")):(_.getPlaybackSession().addInternalErrorFlag("2"),_.getLogging().infoLog("System clock jump detected","to the near past")),s=u),n.ns_st_po||(_.getPlaybackSession().getAsset().isAutoCalculatePositionsEnabled()?_.getStateMachine().getCurrentState()==l.IDLE?n.ns_st_po="0":n.ns_st_po=_.getPlaybackSession().getAsset().getExpectedPlaybackPosition(s)+"":n.ns_st_po=te+""),te=parseInt(n.ns_st_po),_.getPlaybackSession().getAsset().setPlaybackTimeOffset(parseInt(n.ns_st_po)),a(e,s,n);var d=0;isNaN(_.getStateMachine().getLastStateChangeTimestamp())||(d=s-_.getStateMachine().getLastStateChangeTimestamp()),_.getStateMachine().newEvent(e,s),p&&(r!=l.IDLE&&r!=l.PLAYBACK_NOT_STARTED&&r!=l.SEEKING_BEFORE_PLAYBACK&&r!=l.BUFFERING_BEFORE_PLAYBACK&&_.getPlaybackSession().getAsset().setElapsedTimestamp($),r!=l.BUFFERING_BEFORE_PLAYBACK&&r!=l.BUFFERING_DURING_PAUSE&&r!=l.BUFFERING_DURING_PLAYBACK&&r!=l.BUFFERING_DURING_SEEKING&&r!=l.PAUSED_DURING_BUFFERING||(_.getPlaybackSession().setBufferingTimestamp($),_.getPlaybackSession().getAsset().setBufferingTimestamp($)),r!=l.PLAYING&&r!=l.BUFFERING_DURING_PLAYBACK||(_.getPlaybackSession().setPlaybackTimestamp($),_.getPlaybackSession().getAsset().setPlaybackTimestamp($)),r!=l.SEEKING_BEFORE_PLAYBACK&&r!=l.SEEKING_DURING_BUFFERING&&r!=l.SEEKING_DURING_PAUSE&&r!=l.SEEKING_DURING_PLAYBACK&&r!=l.BUFFERING_DURING_SEEKING||_.getPlaybackSession().getAsset().setSeekingTimestamp($)),_.getLogging().log("Transition from",t.stateToString(o),"to",t.stateToString(r),"due to event:",c.toString(e));for(var S=0,f=Q.length;S<f;S++)Q[S](o,r,n,d)},newPseudoEvent:function(e,s,n){if((e==c.LOAD||e==c.ENGAGE)&&_.getStateMachine().getCurrentState()!=l.IDLE)return void _.getLogging().infoLog("Ignored pseudo-event:",c.toString(e),"during state",t.stateToString(_.getStateMachine().getCurrentState()),n);e==c.ERROR&&null==n.ns_st_er&&(n.ns_st_er=r.UNKNOWN_VALUE),e==c.TRANSFER&&null==n.ns_st_rp&&(n.ns_st_rp=r.UNKNOWN_VALUE);var a,i,o,g=!0,u=!1;switch(e){case c.BIT_RATE:a="ns_st_br",i="ns_st_pbr",u=!0;break;case c.PLAYBACK_RATE:a="ns_st_rt",i="ns_st_prt",u=!0;break;case c.VOLUME:a="ns_st_vo",i="ns_st_pvo",u=!0;break;case c.WINDOW_STATE:a="ns_st_ws",i="ns_st_pws",u=!0;break;case c.AUDIO:a="ns_st_at",i="ns_st_pat",u=!1;break;case c.VIDEO:a="ns_st_vt",i="ns_st_pvt",u=!1;break;case c.SUBS:a="ns_st_tt",i="ns_st_ptt",u=!1;break;case c.CDN:a="ns_st_cdn",i="ns_st_pcdn",u=!1;break;default:g=!1}if(g&&n.hasOwnProperty(a)&&(u?(ne.getLabels().hasOwnProperty(a)&&(o=ne.getLabels()[a],n[i]=o),ne.setLabel(a,n[a])):(_.getPlaybackSession().getAsset().hasInternalLabel(a)&&(o=_.getPlaybackSession().getAsset().getInternalLabel(a),n[i]=o),_.getPlaybackSession().getAsset().setInternalLabel(a,n[a]))),g&&_.getStateMachine().getCurrentState()!=l.PLAYING&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_PLAYBACK)return void _.getLogging().infoLog("No measurement send for the pseudo-event:",c.toString(e),"during state",t.stateToString(_.getStateMachine().getCurrentState()),n);var p=isNaN($)?q:$;$=s;var d=!1;(s<p||ce)&&(d=!0,ce=!1,s<p?(_.getPlaybackSession().addInternalErrorFlag("1"),_.getLogging().infoLog("System clock jump detected","to the far past")):se?(_.getPlaybackSession().addInternalErrorFlag("3"),_.getLogging().infoLog("System clock jump detected","to the future")):(_.getPlaybackSession().addInternalErrorFlag("2"),_.getLogging().infoLog("System clock jump detected","to the near past")),s=p),n.ns_st_po||(_.getPlaybackSession().getAsset().isAutoCalculatePositionsEnabled()?n.ns_st_po=_.getPlaybackSession().getAsset().getExpectedPlaybackPosition(s)+"":n.ns_st_po=te+""),te=parseInt(n.ns_st_po),_.getPlaybackSession().getAsset().setPlaybackTimeOffset(parseInt(n.ns_st_po)),_.getStateMachine().getCurrentState()!=l.IDLE&&_.getStateMachine().getCurrentState()!=l.PLAYBACK_NOT_STARTED&&_.getStateMachine().getCurrentState()!=l.SEEKING_BEFORE_PLAYBACK&&_.getStateMachine().getCurrentState()!=l.BUFFERING_BEFORE_PLAYBACK&&(_.getPlaybackSession().getAsset().addElapsedTime(s),_.getPlaybackSession().getAsset().setElapsedTimestamp(s)),_.getStateMachine().getCurrentState()!=l.PLAYING&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_PLAYBACK||(_.getPlaybackSession().addPlaybackTime(s),_.getPlaybackSession().setPlaybackTimestamp(s),_.getPlaybackSession().getAsset().addPlaybackTime(s),_.getPlaybackSession().getAsset().setPlaybackTimestamp(s),_.getPlaybackSession().getAsset().addInterval(parseInt(n.ns_st_po)),_.getPlaybackSession().getAsset().setPlaybackStartPosition(parseInt(n.ns_st_po))),_.getStateMachine().getCurrentState()!=l.BUFFERING_BEFORE_PLAYBACK&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_PAUSE&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_PLAYBACK&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_SEEKING||(_.getPlaybackSession().addBufferingTime(s),_.getPlaybackSession().setBufferingTimestamp(s),_.getPlaybackSession().getAsset().addBufferingTime(s),_.getPlaybackSession().getAsset().setBufferingTimestamp(s));var S=ne.createLabels(e,n,s);_.getPlaybackSession().getAsset().updateDeltaLabels(S.eventLabels),_.getPlaybackSession().getAsset().updateIndependentLabels(S.eventLabels),_.getEventManager().newEvent(S),d&&(_.getStateMachine().getCurrentState()!=l.PLAYING&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_PLAYBACK||(_.getPlaybackSession().setPlaybackTimestamp($),_.getPlaybackSession().getAsset().setPlaybackTimestamp($)),_.getStateMachine().getCurrentState()!=l.IDLE&&_.getStateMachine().getCurrentState()!=l.PLAYBACK_NOT_STARTED&&_.getStateMachine().getCurrentState()!=l.SEEKING_BEFORE_PLAYBACK&&_.getStateMachine().getCurrentState()!=l.BUFFERING_BEFORE_PLAYBACK&&_.getPlaybackSession().getAsset().setElapsedTimestamp($),_.getStateMachine().getCurrentState()!=l.BUFFERING_BEFORE_PLAYBACK&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_PAUSE&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_PLAYBACK&&_.getStateMachine().getCurrentState()!=l.BUFFERING_DURING_SEEKING||(_.getPlaybackSession().setBufferingTimestamp($),_.getPlaybackSession().getAsset().setBufferingTimestamp($)),newState!=l.SEEKING_BEFORE_PLAYBACK&&newState!=l.SEEKING_DURING_BUFFERING&&newState!=l.SEEKING_DURING_PAUSE&&newState!=l.SEEKING_DURING_PLAYBACK&&newState!=l.BUFFERING_DURING_SEEKING||_.getPlaybackSession().getAsset().setSeekingTimestamp($))},getState:function(){return _.getStateMachine().getCurrentState()},addListener:function(e){Q.push(e)},removeListener:function(e){Q.splice(t.indexOf(e,Q),1)},getLabel:function(e){return re[e]},getLabels:function(){return re},setLabel:function(e,t){null==t?delete re[e]:re[e]=t},setLabels:function(e){for(var t in e)e.hasOwnProperty(t)&&ne.setLabel(t,e[t])},getPlatformAPI:function(){return _.getAppCore()?_.getAppCore().getPlatformAPI():o},getExports:function(){return ae},isProperlyInitialized:function(){var e=_.getAppCore().getAppContext(),t=_.getAppCore().getSalt(),s=_.getAppCore().getPixelURL();return e&&s&&t},setThrottlingDelay:function(e){oe=e},getThrottlingDelay:function(){return oe},isThrottlingEnabled:function(){return X},setThrottlingEnabled:function(e){X=e},isLoadingTimeSent:function(){return j},setLoadingTimeSent:function(e){j=e},getLoadTimeOffset:function(){return W},setLoadTimeOffset:function(e){W=e},getInitTimestamp:function(){return q},setPauseOnBufferingInterval:function(e){ie=e},getPauseOnBufferingInterval:function(){return ie},isPauseOnBufferingEnabled:function(){return z},setPauseOnBufferingEnabled:function(e){z=e},startPausedOnBufferingTimer:function(e,s){ne.stopPausedOnBufferingTimer(),J=ne.getPlatformAPI().setTimeout(function(){var e={},n=t.fixEventTime(e),a=parseInt(s.ns_st_po);e.ns_st_po=a+"",ne.newEvent(c.PAUSE_ON_BUFFERING,n,e)},ie)},stopPausedOnBufferingTimer:function(){null!=J&&(ne.getPlatformAPI().clearTimeout(J),J=null)},stopDelayedTransitionTimer:function(){Z&&(ne.getPlatformAPI().clearTimeout(Z),Z=null)},setLiveEndpointURL:function(e){if(null==e||0==e.length)return null;var t=decodeURIComponent||unescape,s=e.indexOf("?");if(s>=0){if(s<e.length-1){for(var n=e.substring(s+1).split("&"),a=0,i=n.length;a<i;a++){var o=n[a],r=o.split("=");2==r.length?ne.setLabel(r[0],t(r[1])):1==r.length&&ne.setLabel(u.PAGE_NAME_LABEL,t(r[0]))}e=e.substring(0,s+1)}}else e+="?";return ee=e},getLiveEndpointURL:function(){return ee||("undefined"!=typeof ns_p&&"string"==typeof ns_p.src?ee=ns_p.src.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):"string"==typeof ns_pixelUrl?ee=ns_pixelUrl.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):null)},getStaSM:function(){return _},resetPlaybackSession:function(e){var t=_.getPlaybackSession();_.setPlaybackSession(new p(_)),p.resetPlaybackSession(_,t,e)},resetHeartbeat:function(){_.getHeartbeat().pause();var e=_.getHeartbeat().getIntervals();_.setHeartbeat(new S(_)),_.getHeartbeat().setIntervals(e)}});var le,ge;t.isBrowser()?(le=window,ge=document):(le={},ge={location:{href:""},title:"",URL:"",referrer:"",cookie:""}),t.extend(ne,{prepareUrl:i}),function(){if(_=new D(ne),t.getNamespace().comScore?(ae=t.getNamespace().comScore.exports,_.setAppCore(ae.c())):_.setAppCore(null),e.publisherId){ne.setLabel("c2",e.publisherId);var n=e.secure;!n&&_.getAppCore()?n=_.getAppCore().isSecure():!n&&t.isBrowser()&&(n=t.isWebSecure());var a=(n?"https://sb":"http://b")+".scorecardresearch.com/p?c1=2";ne.setLiveEndpointURL(a)}e.liveEndpointURL&&ne.setLiveEndpointURL(e.liveEndpointURL),_.setKeepAlive(new f(_)),_.setHeartbeat(new S(_)),_.setEventManager(new d(_)),_.setStateMachine(new E),_.setLogging(new s(u.LOG_NAMESPACE,e.debug)),_.setPlaybackSession(new p(_)),O=new m(_),R=new v(_),B=new I(_),M=new C(_),U=new h(_),w=new y(_),V=new A(_),F=new P(_),G=new k(_),x=new T(_),K=new L(_),H=new N(_),Y=new b(_),j=!1,W=0,q=+new Date,z=!0,X=!1,Q=[],e.systemClockJumpDetection&&ne.enableSystemClockJumpsDetection(parseInt(e.systemClockJumpDetectionInterval))}()}}(),D=function(){return function(e){var s,n,a,i,o,r,c,l=this;t.extend(l,{getAppCore:function(){return s},getStaCore:function(){return e},getEventManager:function(){return n},getStateMachine:function(){return a},getHeartbeat:function(){return i},getKeepAlive:function(){return o},getPlaybackSession:function(){return r},getLogging:function(){return c},setAppCore:function(e){s=e},setKeepAlive:function(e){o=e},setHeartbeat:function(e){i=e},setEventManager:function(e){n=e},setStateMachine:function(e){a=e},setPlaybackSession:function(e){r=e},setLogging:function(e){c=e}})}}(),R=function(){return function(e){function s(e){var s,n;if(s="object"==typeof arguments[1]?arguments[1]:"object"==typeof arguments[2]?arguments[2]:{},n="number"==typeof arguments[1]?arguments[1]:"number"==typeof arguments[2]?arguments[2]:NaN,c.toString(e)){s=t.jsonObjectToStringDictionary(s);var i=t.fixEventTime(s);s.ns_st_po||isNaN(n)||(s.ns_st_po=t.parseInteger(n,0)+""),e==c.PLAY||e==c.PAUSE||e==c.BUFFER||e==c.END||e==c.SEEK_START||e==c.AD_SKIP||e==c.BUFFER_STOP?a.newEvent(e,i,s):a.newPseudoEvent(e,i,s)}}function n(){o&&a.getStaSM().getStateMachine().getCurrentState()!=l.IDLE&&i.notifyEnd()}var a,i=this,o=!0;t.extend(this,{isProperlyInitialized:function(){return a.isProperlyInitialized()},reset:function(e){s(c.END);var t=a;t.getStaSM().getKeepAlive().stop(),t.getStaSM().getHeartbeat().pause(),a=new O(t.getConfiguration()),p.resetPlaybackSession(a.getStaSM(),t.getStaSM().getPlaybackSession(),e)},setPauseOnBufferingInterval:function(e){a.setPauseOnBufferingInterval(e)},getPauseOnBufferingInterval:function(){return a.getPauseOnBufferingInterval()},setKeepAliveInterval:function(e){a.getStaSM().getKeepAlive().setInterval(e)},getKeepAliveInterval:function(){return a.getStaSM().getKeepAlive().getInterval()},setHeartbeatIntervals:function(e){a.getStaSM().getHeartbeat().setIntervals(e)},notifyPlay:function(e,t){a.getStaSM().getLogging().apiCall("notifyPlay",e,t),s(c.PLAY,e,t)},notifyPause:function(e,t){a.getStaSM().getLogging().apiCall("notifyPause",e,t),s(c.PAUSE,e,t)},notifyEnd:function(e,t){a.getStaSM().getLogging().apiCall("notifyEnd",e,t),s(c.END,e,t)},notifyBufferStart:function(e,t){a.getStaSM().getLogging().apiCall("notifyBufferStart",e,t),s(c.BUFFER,e,t)},notifyBufferStop:function(e,t){a.getStaSM().getLogging().apiCall("notifyBufferStop",e,t),s(c.BUFFER_STOP,e,t)},notifyLoad:function(e,t){a.getStaSM().getLogging().apiCall("notifyLoad",e,t),s(c.LOAD,e,t)},notifyEngage:function(e,t){a.getStaSM().getLogging().apiCall("notifyEngage",e,t),s(c.ENGAGE,e,t)},notifySeekStart:function(e,t){a.getStaSM().getLogging().apiCall("notifySeekStart",e,t),s(c.SEEK_START,e,t)},notifySkipAd:function(e,t){a.getStaSM().getLogging().apiCall("notifySkipAd",e,t),s(c.AD_SKIP,e,t)},notifyCallToAction:function(e,t){a.getStaSM().getLogging().apiCall("notifyCallToAction",e,t),s(c.CTA,e,t)},notifyError:function(e,t){a.getStaSM().getLogging().apiCall("notifyError",e,t),s(c.ERROR,e,t)},notifyTransferPlayback:function(e,t){a.getStaSM().getLogging().apiCall("notifyTransferPlayback",e,t),s(c.TRANSFER,e,t)},notifyDrmFail:function(e,t){a.getStaSM().getLogging().apiCall("notifyDrmFail",e,t),s(c.DRM_FAILED,e,t)},notifyDrmApprove:function(e,t){a.getStaSM().getLogging().apiCall("notifyDrmApprove",e,t),s(c.DRM_APPROVED,e,t)},notifyDrmDeny:function(e,t){a.getStaSM().getLogging().apiCall("notifyDrmDeny",e,t),s(c.DRM_DENIED,e,t)},notifyChangeBitrate:function(e,t,n){if(a.getStaSM().getLogging().apiCall("notifyChangeBitrate",e,t,n),null!=e){var i=n||{};i.ns_st_br=e+"",s(c.BIT_RATE,i,t)}},notifyChangePlaybackRate:function(e,t,n){if(a.getStaSM().getLogging().apiCall("notifyChangePlaybackRate",e,t,n),null!=e){var i=n||{};i.ns_st_rt=e+"",s(c.PLAYBACK_RATE,i,t)}},notifyChangeVolume:function(e,t,n){if(a.getStaSM().getLogging().apiCall("notifyChangeVolume",e,t,n),null!=e){var i=n||{};i.ns_st_vo=e+"",s(c.VOLUME,i,t)}},notifyChangeWindowState:function(e,t,n){if(a.getStaSM().getLogging().apiCall("notifyChangeWindowState",e,t,n),null!=e){var i=n||{};i.ns_st_ws=e+"",s(c.WINDOW_STATE,i,t)}},notifyChangeAudioTrack:function(e,t,n){if(a.getStaSM().getLogging().apiCall("notifyChangeAudioTrack",e,t,n),null!=e){var i=n||{};i.ns_st_at=e+"",s(c.AUDIO,i,t)}},notifyChangeVideoTrack:function(e,t,n){if(a.getStaSM().getLogging().apiCall("notifyChangeVideoTrack",e,t,n),null!=e){var i=n||{};i.ns_st_vt=e+"",s(c.VIDEO,i,t)}},notifyChangeSubtitleTrack:function(e,t,n){if(a.getStaSM().getLogging().apiCall("notifyChangeSubtitleTrack",e,t,n),null!=e){var i=n||{};i.ns_st_tt=e+"",s(c.SUBS,i,t)}},notifyChangeCdn:function(e,t,n){if(a.getStaSM().getLogging().apiCall("notifyChangeCdn",e,t,n),null!=e){var i=n||{};i.ns_st_cdn=e+"",s(c.CDN,i,t)}},notifyCustomEvent:function(e,t){a.getStaSM().getLogging().apiCall("notifyCustomEvent",e,t),s(c.CUSTOM,e,t)},getLabels:function(){return a.getLabels()},getState:function(){return a.getStaSM().getStateMachine().getCurrentState()},setLabels:function(e){a.setLabels(e)},getLabel:function(e){return a.getLabel(e)},setLabel:function(e,t){a.setLabel(e,t)},getLoadTimeOffset:function(){return a.getLoadTimeOffset()},setLoadTimeOffset:function(e){a.setLoadTimeOffset(e)},setLiveEndpointURL:function(e){return a.setLiveEndpointURL(e)},getLiveEndpointURL:function(){return a.getLiveEndpointURL()},isPauseOnBufferingEnabled:function(){return a.isPauseOnBufferingEnabled()},setPauseOnBufferingEnabled:function(e){a.setPauseOnBufferingEnabled(e)},isThrottlingEnabled:function(){return a.isThrottlingEnabled()},setThrottlingEnabled:function(e){a.setThrottlingEnabled(e)},setThrottlingDelay:function(e){a.setThrottlingDelay(e)},getThrottlingDelay:function(){return a.getThrottlingDelay()},setPlaybackIntervalMergeTolerance:function(e){a.getStaSM().getPlaybackSession().getAsset().setPlaybackIntervalMergeTolerance(e)},getPlaybackIntervalMergeTolerance:function(){return a.getStaSM().getPlaybackSession().getAsset().getPlaybackIntervalMergeTolerance()},createPlaybackSession:function(e){a.getStaSM().getLogging().apiCall("createPlaybackSession",e),e=t.jsonObjectToStringDictionary(e);var s=a.getStaSM().getStateMachine().getCurrentState();s!=l.IDLE&&(a.getStaSM().getLogging().infoLog("Ending the current Clip. It was in state:",t.stateToString(s)),i.notifyEnd()),a.getStaSM().getPlaybackSession().isPlaybackSessionStarted()&&a.resetPlaybackSession(),a.getStaSM().getPlaybackSession().setLabels(e)},getVersion:function(){return u.STREAMINGANALYTICS_VERSION},addListener:function(e){a.addListener(e)},removeListener:function(e){a.removeListener(e)},addMeasurementListener:function(e){a.getStaSM().getEventManager().addMeasurementListener(e)},removeMeasurementListener:function(e){a.getStaSM().getEventManager().removeMeasurementListener(e)},getPlaybackSession:function(){return a.getStaSM().getPlaybackSession()},setExitEndEventEnabled:function(e){o=e},isExitEndEventEnabled:function(){return o},getPlatformAPI:function(){return a.getPlatformAPI()},_getLogHistory:function(){return a.getStaSM().getLogging().getLogHistory()}}),t.isBrowser()&&(window.addEventListener?(window.addEventListener("beforeunload",n),window.addEventListener("unload",n)):window.attachEvent&&(window.attachEvent("onbeforeunload",n),window.attachEvent("onunload",n))),function(){e=t.extend({},e),a=new O(e),a.getStaSM().getLogging().log("New StreamingAnalytics instance with configuration",e)}()}}();return R.PlayerEvents=c,R.InternalStates=l,R.ImplementationType=g,R.Constants=u,R}(),e.ReducedRequirementsStreamingAnalytics=e.ReducedRequirementsStreamingAnalytics||function(){var n={LongFormOnDemand:"12",ShortFormOnDemand:"11",Live:"13",UserGeneratedLongFormOnDemand:"22",UserGeneratedShortFormOnDemand:"21",UserGeneratedLive:"23",Bumper:"99",Other:"00"},a={LinearOnDemandPreRoll:"11",LinearOnDemandMidRoll:"12",LinearOnDemandPostRoll:"13",LinearLive:"21",BrandedOnDemandPreRoll:"31",BrandedOnDemandMidRoll:"32",BrandedOnDemandPostRoll:"33",BrandedOnDemandContent:"34",BrandedOnDemandLive:"35",Other:"00"},i=e.StreamingAnalytics,o=e.StreamingAnalytics.InternalStates||null,r=e.StreamingAnalytics.ImplementationType||null,c=null!=e.StreamingAnalytics.InternalStates&&null!=e.StreamingAnalytics.ImplementationType,l=e.StreamingAnalytics.Constants,g=function(e){function g(e){for(var t in l.STANDARD_METADATA_LABELS)if(l.STANDARD_METADATA_LABELS.hasOwnProperty(t)&&!u(l.STANDARD_METADATA_LABELS[t],S,e))return!1;return!0}function u(e,s,n){return!!(t.exists(e)&&t.exists(s)&&t.exists(n)&&(s.hasOwnProperty(e)&&n.hasOwnProperty(e)&&s[e]===n[e]||!s.hasOwnProperty(e)&&!n.hasOwnProperty(e)))}function _(e){b.getPlaybackSession().setAsset(e),S=e,b.notifyPlay()}function p(e){var t=e||{};t.ns_st_ad="1",t.ns_st_an=++f+"",b.getPlaybackSession().setAsset(t),b.notifyPlay(),E=!1}function d(e,t){P==h.None&&(P=t),E&&P==t&&g(e)?(b.getPlaybackSession().getAsset().setLabels(e),b.getState()!=o.PLAYING&&b.notifyPlay()):_(e),E=!0,P=t}var S=null,f=0,E=!1,b=null,h={None:0,AudioContent:1,VideoContent:2},P=h.None,y=new s("TTSTA",(e||{}).debug);t.extend(this,{playVideoAdvertisement:function(e,s){if(b){y.apiCall("playVideoAdvertisement",e,s);var n={ns_st_ct:"va"};s?n.ns_st_ct="va"+s:y.warn("Calling 'playVideoAdvertisement' without specifying the media type as a second parameter."),s!=a.LinearLive&&s!=a.BrandedOnDemandLive||(n.ns_st_li="1"),e&&t.extend(n,e),p(n)}},playAudioAdvertisement:function(e,s){if(b){y.apiCall("playAudioAdvertisement",e,s);var n={ns_st_ct:"aa"};s?n.ns_st_ct="aa"+s:y.warn("Calling 'playAudioAdvertisement' without specifying the media type as a second parameter."),s!=a.LinearLive&&s!=a.BrandedOnDemandLive||(n.ns_st_li="1"),e&&t.extend(n,e),p(n)}},playVideoContentPart:function(e,s){if(b){y.apiCall("playVideoContentPart",e,s);var a={ns_st_ct:"vc"};s?a.ns_st_ct="vc"+s:y.warn("Calling 'playVideoContentPart' without specifying the media type as a second parameter."),s!=n.Live&&s!=n.UserGeneratedLive||(a.ns_st_li="1"),e&&t.extend(a,e),d(a,h.VideoContent)}},playAudioContentPart:function(e,s){if(b){y.apiCall("playAudioContentPart",e,s);var a={ns_st_ct:"ac"};s?a.ns_st_ct="ac"+s:y.warn("Calling 'playAudioContentPart' without specifying the media type as a second parameter."),s!=n.Live&&s!=n.UserGeneratedLive||(a.ns_st_li="1"),e&&t.extend(a,e),d(a,h.AudioContent)}},stop:function(){b&&(y.apiCall("stop"),b.notifyPause())}}),function(){c&&(t.exists(e)&&(e.customerC2||e.publisherId)||t.getNamespace().comScore?b=new i(e):y.error("Cannot instantiate StreamingAnalytics","The property publisherId was not provided (or incorrectly provided) in the StreamingAnalytics configuration."),b&&b.setLabel("ns_st_it",r.toString(r.REDUCED)))}()};return g.ContentType=n,g.AdType=a,g}(),e})},function(e,t,s){var n;void 0!==(n=function(){function e(e){function t(e){e&&(V=e)}function s(){return V}function n(e,t,s){if(void 0===w.pageContext&&(w.pageContext=w.defaultPageContext),e){var n=new S(this,e,t,s);return U.push(n),n}}function a(){for(var e=0;e<U.length;++e)try{U[e].stop()}catch(e){r(e)}}function i(e){for(var t=0;t<U.length;++t)try{U[t].update(e)}catch(e){r(e)}}function o(e){for(var t=0;t<U.length;++t)try{U[t].sync(e)}catch(e){r(e)}}function r(e){p("",e)}function c(e,t){return d([[e,t]])}function l(e){return e&&void 0!=e.site?e.site:M}function g(e){}function u(){return void 0===w.pageContext.getWindowLocationURL()?"http://":"https"==w.pageContext.getWindowLocationURL().slice(0,5)?"https://ssl-":"http://"}function _(){if(!this.nlso)try{var e="";if(e=w.pageContext.getLocalStorageItem("i00"))return"&c="+e;var t="0000",s=t+Math.ceil((new Date).getTime()/1e3).toString(16)+(32768|65535*Math.random()).toString(16)+t;w.pageContext.setLocalStorageItem("i00",s)}catch(e){console.log("error"+e)}return""}function p(e,t){var s=u()+l(t)+"."+D+"/j0="+c(e,t)+"?lt="+(new Date).getTime().toString(36)+_();w.pageContext.preloadImage(s),this.debug(s)}function d(e){var t,s,n,a,i,o=/[+&,;=~]/g;switch(typeof e){case"string":return o.test(e)?escape(e).replace(o,function(e){var t=(void 0)[e];return t||e}):escape(e);case"number":return isFinite(e)?e.toString():"null";case"boolean":case"null":return e.toString();case"object":if(!e)return"null";if(t=[],"number"==typeof e.length&&!e.propertyIsEnumerable("length")){for(a=e.length,s=0;s<a;s+=1)t.push(d(e[s])||"null");return","+t.join("+")+";"}for(n in e)"string"==typeof n&&"site"!=n&&(i=d(e[n]))&&t.push(d(n)+"="+i);return","+t.join("+")+";"}return""}function S(e,t,s,n){function a(e){p.length<u.maxstates&&p.push(e)}function i(e){y=[e,e,Math.round((new Date).getTime()/1e3).toString(36)],a(y),v=!0,A=0}function o(){null!=E&&b<E.length&&(f=E[b++],u.debug("switch syncrate to "+f))}function c(e){if(!k){var t=y[1],s=t;try{s=Math.round(S.getPosition(_))}catch(e){}try{if(t==s)return void(A>=0&&++A==u.pausesync&&(v=!0));A>=u.pausesync?i(s):t<s-1?i(s):t>s?i(s):(y[1]=s,y[1]-y[0]>=f&&s-m>=f&&(v=!0,o()),A=0)}catch(e){r=!0,u.error(e)}}}function l(){k||(v=!0,k=!0,g(null))}function g(e){if(v){try{_.width&&(d.sx=_.width),_.videoWidth&&(d.sx=_.videoWidth),_.height&&(d.sy=_.height),_.videoHeight&&(d.sy=_.videoHeight)}catch(e){}void 0!==w.pageContext.getDeviceID&&void 0!==w.pageContext.getDeviceID()&&(d[w.pageContext.getDeviceID().id_name]=w.pageContext.getDeviceID().id_value),d.uid=h,d.pst=p;var t;try{d.dur&&0!=d.dur||(d.dur=S.getDuration(_))}catch(e){}try{t=S.getMeta(_)}catch(e){}d.vt=Math.round((new Date).getTime()/1e3)-P,u.send(t,d),m=y[1]}v=!1}var u,_,p,d,S,f,E,b,h=Math.round(1e10*Math.random()).toString(36),P=Math.round((new Date).getTime()/1e3),y=[0,0,P.toString(36)],A=0,m=0,v=!0,k=!1;u=e,_=t,S=n||u.HTML5Adapter,d=function(e){var t=new Object;for(var s in e)t[s]=e[s];return t}(s),p=new Array,p.push(y),b=0,f=e.syncrate,E=e.getSyncRates(),o(),this.update=c,this.stop=l,this.sync=g}function f(e){return{pl:"HTML 5 Video",pv:"HTML 5",sx:screen.width,sy:screen.height}}function E(e){return Math.round(e.duration)}function b(e){return e.currentTime}function h(e){return{pl:"DEF",pv:version,sx:screen.width,sy:screen.height}}function P(e){return(new Date).getTime()/1e3}function y(e){return 0}function A(e){return{pl:"MSWM",plv:e.versionInfo,sx:screen.width,sy:screen.height}}function m(e){return e.CurrentPosition?e.CurrentPosition:e.currentPosition?e.currentPosition:e.controls&&e.controls.currentPosition?e.controls.currentPosition:e.Controls&&e.Controls.currentPosition?e.Controls.currentPosition:0}function v(e){if(e.currentMedia){if(e.currentMedia.Duration)return e.currentMedia.Duration;if(e.currentMedia.duration)return e.currentMedia.duration}else if(e.CurrentMedia){if(e.CurrentMedia.duration)return e.CurrentMedia.duration;if(e.CurrentMedia.Duration)return e.CurrentMedia.Duration}}function k(e){return{pl:"RV",plv:e.GetVersionInfo(),sx:screen.width,sy:screen.height}}function I(e){return e.GetPosition()/1e3}function C(e){return e.GetLength()/1e3}function T(e,t){localStorage.setItem(e,t)}function L(e){return localStorage.getItem(e)}function N(e){(new Image).src=e}function O(){return document.location.href}this.version="2.0.0";var D="2cnt.net",R=200,B=2e3,M="default",U=new Array;this.namespace="com.kma.springstreams",this.syncrate=20,this.pausesync=6,this.maxstates=50;var w=this;this.pageContext;var V;!function(e){var s;if(e){for(var n in e)n==D&&(s=e[n]);s&&t(s.syncrates)}}(function(){return{"2cnt.net":{syncrates:[3,7,10,10,10,10,10,60]}}}()),e&&(M=e),function(){setInterval(i,R),setInterval(o,B)}(),this.getSyncRates=s,this.track=n,this.unload=a,this.doUpdate=i,this.doSync=o,this.error=r,this.debug=g,this.send=p,this.defaultPageContext={getLocalStorageItem:L,setLocalStorageItem:T,preloadImage:N,getWindowLocationURL:O},this.HTML5Adapter={getMeta:f,getPosition:b,getDuration:E},this.DefaultAdapter={getMeta:h,getPosition:P,getDuration:y},this.WMStreamAdapter={getMeta:A,getPosition:m,getDuration:v},this.RVStreamAdapter={getMeta:k,getPosition:I,getDuration:C}}return e.prototype.setPageContext=function(e){this.pageContext=e},e}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n,a;!function(i,o){n=o,void 0!==(a="function"==typeof n?n.call(t,s,t,e):n)&&(e.exports=a)}(0,function(){function e(e){e=e||{},this.alwaysUseHttps=!0===e.alwaysUseHttps||!1,this.forceBBCHost=!1,this._sscCookieId=void 0,this._s1CookieId=void 0,this._uidCookieId=void 0,".co.uk"===e.forceBBCHost?this.forceBBCHost=".co.uk":".com"===e.forceBBCHost&&(this.forceBBCHost=".com")}var t,s,n,a,i,o,r;return t="ckpf_sscid",s="s1",n="ckpf_uid",a="ssc.api.bbc.co.uk",i="ssc.api.bbc.com",o="b.scorecardresearch.com",r="sb.scorecardresearch.com",e.prototype.getCookie=function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},e.prototype.getLocation=function(){return window.location},e.prototype.getCookieId=function(){var e,t,s,n,o;return t=this.getSSCHostname(),s=this.getLocation(),n=t===a&&-1!==s.hostname.search(/bbc.co.uk$/),o=t===i&&-1!==s.hostname.search(/bbc.com$/),(n||o)&&(null!==(e=this.getSSCCookieId())&&void 0!==e||(n?e=this.getS1CookieId():o&&(e=this.getUidCookieId()))),e},e.prototype.getS1CookieId=function(){return void 0===this._s1CookieValue&&(this._s1CookieValue=this.getCookie(s)),this._s1CookieValue},e.prototype.getUidCookieId=function(){return void 0===this._uidCookieValue&&(this._uidCookieValue=this.getCookie(n)),this._uidCookieValue},e.prototype.getSSCCookieId=function(){return void 0===this._sscCookieValue&&(this._sscCookieValue=this.getCookie(t)),this._sscCookieValue},e.prototype.isValidId=function(e){var t;return t=!1,"string"==typeof e&&-1!==e.search(/^[^(?!<>\s)]+$/)&&(t=!0),t},e.prototype.getAnalyticsLocation=function(e,t){var s,n,a,i,o;return this.getSSCHostname(),n=this.getLocation(),s={sscId:void 0},"string"!=typeof e&&(e=""),void 0!==t&&!1!==this.isValidId(t)||(t=this.getCookieId()),this.alwaysUseHttps||"https:"===n.protocol?s.protocol="https:":s.protocol="http:",i=-1!==e.search(/ns_alias=/),o=this.isValidId(t),s.hostname=i||o?this.getScorecardresearchHostname():this.getSSCHostname(),o&&(""===e?e="?ns_alias="+t:(a=e.search(/\?/)+1,e=[e.slice(0,a),"ns_alias="+t+"&",e.slice(a)].join("")),s.sscId=t),s.search=e,-1!==s.hostname.search(/scorecardresearch.com$/)?s.pathname="/p":s.pathname="/",s.href=s.protocol+"//"+s.hostname+s.pathname+s.search,s},e.prototype.getSSCHostname=function(){var e;return e=this.getLocation(),".com"===this.forceBBCHost||".co.uk"!==this.forceBBCHost&&-1===e.hostname.search(/bbc\.co\.uk$/)?i:a},e.prototype.getScorecardresearchHostname=function(){var e;return e=this.getLocation(),"https:"===e.protocol?r:o},e})},function(e,t,s){var n;void 0!==(n=function(e){"use strict";var t=s(8),n=s(5);return{EchoClient:s(18),Media:s(10),MediaId:s(9),Environment:n,Enums:s(0),ConfigKeys:s(3),Debug:s(2),getImplementationVersion:function(){return t.VERSION}}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(e,s,n,r){var c=this;n=n||{},a.assertContainsValue(o.ApplicationType,s,'appType should be one of Enums.ApplicationType, got "'+s+'"'),this.state={counterNameSet:!1};var l=t.ConfigGenerator.generate(n);this._env=void 0!==r?r:new t.Environment;var d=t.Environment.getOrbCookiesPolicy();d&&!1===d.performance?this._hasOptedOutOfPerformanceReporting=!0:this._hasOptedOutOfPerformanceReporting=!1;var S;l&&"string"==typeof l[i.ECHO_DEVICE_ID]&&(S=a.trim(l[i.ECHO_DEVICE_ID]),S.length>0?(l[i.ECHO_DEVICE_ID]=S,this._deviceId=S):l[i.ECHO_DEVICE_ID]=void 0),l&&l[i.COMSCORE_HOST]===_&&!l[i.ECHO_DEVICE_ID]&&(S=u.getCookieValueByName(p))&&(this._deviceId=S,l[i.ECHO_DEVICE_ID]=S),l&&!1===l[i.ECHO_AUTO_START]?this._autoStart=!1:this._autoStart=!0,this._setConsumers(e,s,l,this._env),l&&l[i.USE_ESS]?this._essEnabled=!0:this._essEnabled=!1,l&&l[i.ESS_HOSTNAME]&&(g.essHost=l[i.ESS_HOSTNAME]),l&&!1===l[i.ECHO_ENABLED]?this._isEnabled=!1:this._isEnabled=!0,this._liveBroker=null,this._onDemandBroker=null,this._bitrate=null,this._codec=null,this._cdn=null,this._suppressingPlayEvent=!1,this._suppressedPlayEventLabels=null,this.addLabel("bbc_id_wait","1"),t.Environment.getOrbIdCta(function(e){c.removeLabel("bbc_id_wait"),e&&"function"==typeof e.getIStatsLabels&&c.addLabels(e.getIStatsLabels())}),l&&l[i.ECHO_CACHE_MODE]&&(this._cacheMode=l[i.ECHO_CACHE_MODE]),this._isEnabled&&this._autoStart&&this.start()}var n=s(2),a=s(1),i=s(3),o=s(0),r=s(26),c=s(27),l=s(4),g=s(12),u=s(7),_="sa.bbc.co.uk",p="ckpf_echo_device_id";return t.prototype.start=function(){this._isEnabled&&!this._hasStarted&&(this._hasStarted=!0,this._delegate("start"))},t.prototype.enable=function(){return this._isEnabled||(this._isEnabled=!0,this._delegate("enable"),this._autoStart&&!this._hasStarted&&this.start()),this},t.prototype.disable=function(){return this._isEnabled&&(this._clearMedia(),this._isEnabled=!1,this._delegate("disable")),this},t.prototype.isEnabled=function(){return this._isEnabled},t.prototype.getComScoreDeviceId=function(){var e;return this.consumers[t.Consumers.COMSCORE]&&(e=this.consumers[t.Consumers.COMSCORE])instanceof t.ComScoreDelegate&&"function"==typeof e.getDeviceId?e.getDeviceId():null},t.prototype.setTraceId=function(e){this._delegate("setTraceId",[e])},t.ConfigGenerator=s(19),t.LabelCleanser=s(6),t.Util=s(1),t.ComScoreDelegate=s(21),t.SpringDelegate=s(25),t.Environment=s(5),t.prototype._eventsEnabled=function(){return this._isEnabled&&this._hasStarted},t.prototype._setConsumers=function(e,s,n,a){this.consumers={};var o=t.LabelCleanser.cleanLabelValue("app_name",e);return!1===this._hasOptedOutOfPerformanceReporting&&(n&&n[i.COMSCORE_ENABLED]&&(this.consumers[t.Consumers.COMSCORE]=new t.ComScoreDelegate(o,s,n,a)),n&&n[i.BARB_ENABLED]&&(this.consumers[t.Consumers.BARB]=new t.SpringDelegate(o,s,n,a))),this},t.prototype._delegate=function(e,t){var s,n;for(s in this.consumers)s&&(n=this.consumers[s],n[e].apply(n,t));return this},t.prototype.addLabels=function(e){return this._delegate("addLabels",[t.LabelCleanser.cleanLabels(e)]),this},t.prototype.addLabel=function(e,t){if("string"!=typeof e)return void n.error("Label key must be a string");if(null===t||void 0===t)return void n.error("Label cannot be null/undefined");var s={};return s[e]=t,this.addLabels(s)},t.prototype.addManagedLabel=function(e,s){return this._delegate("addManagedLabel",[t.LabelCleanser.cleanLabelKey(e),t.LabelCleanser.cleanLabelValue(e,s)]),this},t.prototype.removeLabels=function(e){for(var s=[],n=0,a=e.length;n<a;n++)s.push(t.LabelCleanser.cleanLabelKey(e[n]));return this._delegate("removeLabels",[s]),this},t.prototype.removeLabel=function(e){return this.removeLabels([e])},t.prototype.setLoggedInToBBCId=function(e){return this._delegate("setLoggedInToBBCId",[e]),this},t.prototype.setLoggedOutOfBBCId=function(){return this._delegate("setLoggedOutOfBBCId"),this},t.prototype.setAppVersion=function(e){return this._delegate("setAppVersion",[e]),this},t.prototype.setCounterName=function(e){var s,n,a=t.LabelCleanser.cleanCounterName(e);for(s in this.consumers)s&&(n=this.consumers[s],n.requiresLabelCleansing()?n.setCounterName(a):n.setCounterName(e));return this.state.counterNameSet=!0,this},t.prototype.setContentLanguage=function(e){return this._delegate("setContentLanguage",[e]),this},t.prototype.setCacheMode=function(e){return this._delegate("setCacheMode",[e]),this._cacheMode=e,this},t.prototype.getCacheMode=function(){return this._cacheMode},t.prototype.flushCache=function(){this._isEnabled&&this._delegate("flushCache")},t.prototype.viewEvent=function(e,s){if(this._eventsEnabled()){var n,a,i=t.LabelCleanser.cleanCounterName(e),o=t.LabelCleanser.cleanLabels(s);for(n in this.consumers)n&&(a=this.consumers[n],a.requiresLabelCleansing()?a.viewEvent(i,o):a.viewEvent(e,s));return this.state.counterNameSet=!0,this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this}},t.prototype.userActionEvent=function(e,s,a){if(this._eventsEnabled()){var i=!1;return a&&a.name&&(i=!0,a.name=t.LabelCleanser.cleanCounterName(a.name)),this.state.counterNameSet||i?(this._delegate("userActionEvent",[e,s,t.LabelCleanser.cleanLabels(a)]),this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this):(n.error('userActionEvent: Countername not set. Either pass in a "name" label or send a viewEvent/call setcounterName first'),this)}},t.prototype.errorEvent=function(e,s){if(this._eventsEnabled())return this._delegate("errorEvent",[e,t.LabelCleanser.cleanLabels(s)]),this},t.prototype.setPlayerName=function(e){a.assert("string"==typeof e&&e.length>0,'setPlayerName: name must be string with length, got "'+e+'"');var s,n,i=t.LabelCleanser.cleanLabelValue("player_name",e);for(s in this.consumers)s&&(n=this.consumers[s],n.requiresLabelCleansing()?n.setPlayerName(i):n.setPlayerName(e));return this},t.prototype.setPlayerVersion=function(e){a.assert("string"==typeof e&&e.length>0,'setPlayerVersion: version must be string with length, got "'+e+'"');var s,n,i=t.LabelCleanser.cleanLabelValue("player_version",e);for(s in this.consumers)s&&(n=this.consumers[s],n.requiresLabelCleansing()?n.setPlayerVersion(i):n.setPlayerVersion(e));return this},t.prototype.setPlayerIsPopped=function(e){return a.assert("boolean"==typeof e,'setPlayerIsPopped: isPopped must be boolean, got "'+e+'"'),this._delegate("setPlayerIsPopped",[e]),this},t.prototype.setPlayerWindowState=function(e){return a.assertContainsValue(o.WindowState,e,'The window state must be set as a member of Enums.WindowState, got "'+e+'"'),this._delegate("setPlayerWindowState",[e]),this},t.prototype.setPlayerVolume=function(e){return a.assert(e<=100&&e>=0,"volume must be 0-100, got: "+e),e<=100&&e>=0&&this._delegate("setPlayerVolume",[e]),this},t.prototype.setPlayerIsSubtitled=function(e){return a.assert("boolean"==typeof e,'setPlayerIsSubtitled: isSubtitled must be a boolean, got "'+e+'"'),this._delegate("setPlayerIsSubtitled",[e]),this},t.prototype.setPlayerDelegate=function(e){e=e||{};var t,s,n,i=["getTimestamp","getPosition"],o=!1;for(s=0;s<i.length;s++)t=i[s],n=e.hasOwnProperty(t)&&"function"==typeof e[t],a.assert(n,'The player delegate must implement "'+t+'"'),n||(o=!0);return o||(this._playerDelegate=e),this},t.prototype.setMedia=function(e){if(this._eventsEnabled()){this._clearMedia();var t=e.getClone();if(!this.state.counterNameSet)return void n.error("setMedia: Must have a countername set or view event sent first");this.media=t,this.addLabel(l.ESS_ENABLED,this._essEnabled?"true":"false");var s=o.MediaConsumptionMode.LIVE;this.media.getMediaConsumptionMode()===s?this._initLiveBroker():this._initOnDemandBroker(),this._delegate("setMedia",[this.media])}},t.prototype.liveMediaUpdate=function(e,t,s){this._eventsEnabled()&&this._avEventsEnabled()&&e&&(this._suppressingPlayEvent=!1,e.setBitrate(this._bitrate||this.media.getBitrate()),e.setCodec(this._codec||this.media.getCodec()),e.setCDN(this._cdn||this.media.getCDN()),this.media=e,this._delegate("liveMediaUpdate",[e,t,s]))},t.prototype.setMediaLength=function(e){return this.media?this.media.isOnDemand()?"number"!=typeof(e=this._cleanPosition(e))?(n.error("setMediaLength: Length must be a positive number"),this):(this._delegate("setMediaLength",[e]),this.media.setLength(e),this):(n.error("setMediaLength: Length should be set to zero prior to passing the media object to Echo for live media"),this):(n.error("setMediaLength: Must call setMedia first"),this)},t.prototype.setMediaBitrate=function(e){return a.assert(e>0,'setMediaBitrate: bitrate must be > 0, got "'+e+'"'),this._bitrate=e,this._delegate("setMediaBitrate",[e]),this},t.prototype.setMediaCodec=function(e){return a.assert("string"==typeof e,'setMediaCodec: must be string value, got "'+typeof e+'"'),this._codec=t.LabelCleanser.cleanLabelValue(l.MEDIA_CODEC,e),this._delegate("setMediaCodec",[this._codec]),this},t.prototype.setMediaCDN=function(e){return a.assert("string"==typeof e,'setMediaCDN: must be string value, got "'+typeof e+'"'),this._cdn=t.LabelCleanser.cleanLabelValue(l.MEDIA_CDN,e),this._delegate("setMediaCDN",[this._cdn]),this},t.prototype.setEssSuccess=function(e){this.addLabel(l.ESS_SUCCESS,e?"true":"false")},t.prototype.setEssError=function(e,t){this.addLabel(l.ESS_ERROR,e.toString().toLowerCase()),e.toString()===o.EssError.STATUS_CODE.toString()&&this.addLabel(l.ESS_STATUS_CODE,t),this._delegate("liveEnrichmentFailed")},t.prototype._avEventsEnabled=function(){return a.assert(!!this.media,"setMedia() must be called prior to this method")&&a.assert(!!this._playerDelegate,"setPlayerDelegate not called or not configured correctly")},t.prototype.getLiveBroker=function(){return this._liveBroker},t.prototype._initLiveBroker=function(){this._avEventsEnabled()&&this.media.getMediaConsumptionMode()===o.MediaConsumptionMode.LIVE&&(this._liveBroker=new r(this._playerDelegate,this.media,this,this._env,this._essEnabled),this._delegate("setBroker",[this._liveBroker]))},t.prototype.getOnDemandBroker=function(){return this._onDemandBroker},t.prototype._initOnDemandBroker=function(){this._avEventsEnabled()&&this.media.getMediaConsumptionMode()!==o.MediaConsumptionMode.LIVE&&(this._onDemandBroker=new c(this._playerDelegate,this.media,this),this._delegate("setBroker",[this._onDemandBroker]))},t.prototype._cleanPosition=function(e){return void 0!==e&&null!==e&&(e=Math.floor(e)),(void 0===e||isNaN(e)||!isFinite(e)||e<0)&&(e=0),e},t.prototype.avPlayEvent=function(e,s){if(this._eventsEnabled()&&this._avEventsEnabled()){var n,a;if(n=this.media.isLive(),!n&&this._isPlaying&&this._onDemandBroker&&(a=this._onDemandBroker.getPosition(),(0===this._previousPlayPosition||Math.abs(e-a)>1e4)&&this._delegate("avPauseEvent",[a,{}])),this._isPlaying=!0,n&&this._liveBroker)e=this._liveBroker.getPosition(),this._liveBroker.start();else if(!n&&this._onDemandBroker){if(e=this._cleanPosition(e),this._previousPlayPosition=e,this._positionExceedsMediaLength(e))return;this._onDemandBroker.setPosition(e),this._onDemandBroker.start()}return n&&this.media.isEssEnriched()&&this._suppressingPlayEvent?this._suppressedPlayEventLabels=s:this._delegate("avPlayEvent",[e,t.LabelCleanser.cleanLabels(s)]),this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this}},t.prototype._avNavigationEvent=function(e,s,n,a){this._avEventsEnabled()&&(this._isPlaying=!1,this.media.isLive()?(this._liveBroker&&(this._liveBroker.stop(),s=this._liveBroker.getPosition()),this.media.isEssEnriched()&&!this._suppressingPlayEvent&&(this._suppressingPlayEvent=!0)):this._onDemandBroker&&(s=this._cleanPosition(s),s=this._preventPositionExceedingMediaLength(s),this._onDemandBroker.stop()),"avRewindEvent"===e||"avFastForwardEvent"===e?this._delegate(e,[s,a,t.LabelCleanser.cleanLabels(n)]):this._delegate(e,[s,t.LabelCleanser.cleanLabels(n)]))},t.prototype.avPauseEvent=function(e,t){if(this._eventsEnabled()&&this._avEventsEnabled())return this._avNavigationEvent("avPauseEvent",e,t),this},t.prototype.avBufferEvent=function(e,t){if(this._eventsEnabled()&&this._avEventsEnabled())return this._avNavigationEvent("avBufferEvent",e,t),this},t.prototype.avEndEvent=function(e,t){if(this._eventsEnabled()&&this._avEventsEnabled())return this._avNavigationEvent("avEndEvent",e,t),this.media=null,this},t.prototype.avRewindEvent=function(e,t,s){if(this._eventsEnabled()&&this._avEventsEnabled())return this._avNavigationEvent("avRewindEvent",e,s,t),this},t.prototype.avFastForwardEvent=function(e,t,s){if(this._eventsEnabled()&&this._avEventsEnabled())return this._avNavigationEvent("avFastForwardEvent",e,s,t),this},t.prototype.avSeekEvent=function(e,t){if(this._eventsEnabled()&&this._avEventsEnabled())return this._avNavigationEvent("avSeekEvent",e,t),this},t.prototype.avUserActionEvent=function(e,s,n,a){if(this._eventsEnabled()&&this._avEventsEnabled()){this._liveBroker?n=this._liveBroker.getPosition():(n=this._cleanPosition(n),n=this._preventPositionExceedingMediaLength(n));var i=t.LabelCleanser.cleanLabels(a);return this._delegate("avUserActionEvent",[e,s,n,i]),this}},t.prototype.releaseSuppressedPlay=function(){if(this._eventsEnabled()&&this._avEventsEnabled())return this._suppressingPlayEvent&&(this._suppressingPlayEvent=!1,this.avPlayEvent(this._liveBroker.getPosition(),this._suppressedPlayEventLabels)),this},t.prototype._clearMedia=function(){this.removeLabel(l.MEDIA_TIMESTAMP),this.removeLabel(l.ESS_ENABLED),this.removeLabel(l.ESS_ENRICHED),this.removeLabel(l.ESS_SUCCESS),this.removeLabel(l.ESS_ERROR),this.removeLabel(l.ESS_STATUS_CODE),null!==this.media&&(this.media=null),this._liveBroker instanceof r&&(this._liveBroker.stop(),this._liveBroker=null),this._onDemandBroker instanceof c&&(this._onDemandBroker.stop(),this._onDemandBroker=null),this._isPlaying=void 0,this._previousPlayPosition=void 0},t.prototype._positionExceedsMediaLength=function(e){return!!(this.media&&this.media.length>0&&e>=this.media.length-1e3)},t.prototype._preventPositionExceedingMediaLength=function(e){return this._positionExceedsMediaLength(e)?this.media.length:e},t.Consumers={COMSCORE:1,BARB:2},t}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(e){return"string"==typeof e&&e.length>0}function n(e){return e.match(/[a-zA-Z]+/)}function a(e){return"string"==typeof e&&(e=e.toUpperCase(),d.ReportingProfiles.hasOwnProperty(e))}function i(e){return"string"==typeof e&&(e=e.toUpperCase(),d.EchoCacheMode.hasOwnProperty(e))}function o(e){return i(e[E.ECHO_CACHE_MODE])?S.assert("boolean"==typeof e[E.ECHO_ENABLED],'Config: "enabled" must be boolean, got '+e[E.ECHO_ENABLED])&&S.assert("boolean"==typeof e[E.ECHO_AUTO_START],'Config: "auto_start" must be boolean, got '+e[E.ECHO_AUTO_START])&&S.assert(null===e[E.ECHO_DEVICE_ID]||"string"==typeof e[E.ECHO_DEVICE_ID]&&e[E.ECHO_DEVICE_ID].length,"ECHO.DEVICE_ID must be an non-empty string"):(p.error("Config Error: KEYS.ECHO_CACHE_MODE Invalid cache mode specified"),!1)}function r(e){if(!1===e[E.COMSCORE_ENABLED])return!0;if(!t(e[E.REPORTING_PROFILE])){if(!t(e[E.COMSCORE_HOST]))return p.error("Config Error: Must have config value for COMSCORE_HOST or REPORTING_PROFILE"),!1;if("scorecardresearch.com"!==e[E.COMSCORE_HOST]&&"sa.bbc.co.uk"!==e[E.COMSCORE_HOST])return p.error("Config Error: KEYS.COMSCORE_HOST Should be one of scorecardresearch.com or sa.bbc.co.uk"),!1}return a(e[E.REPORTING_PROFILE])?S.assert("boolean"==typeof e[E.COMSCORE_ENABLED],'ComScore config: "ENABLED" must be boolean'):(p.error("Config Error: KEYS.REPORTING_PROFILE Invalid reporting profile specified"),!1)}function c(e){return!1===e[E.BARB_ENABLED]||(t(e[E.BARB_SITE_CODE])?n(e[E.BARB_SITE_CODE])?"boolean"==typeof e[E.BARB_DEBUG]||(p.error("Config Error: KEYS.BARB_DEBUG must be a boolean"),!1):(p.error("Config Error: KEYS.BARB_SITE_CODE must match [a-zA-Z]"),!1):(p.error("Config Error: KEYS.BARB_SITE_CODE must have a value"),!1))}function l(e){var t=e[E.SSC_HOSTNAME];return"boolean"!=typeof e[E.USE_SSC]?(p.error("Config Error: KEYS.USE_SSC must be boolean"),!1):null===t||".com"===t||".co.uk"===t||(p.error("Config Error: SSC_HOSTNAME must be one of .com, .co.uk or null"),!1)}function g(e){return"string"==typeof e&&(e=e.toUpperCase(),d.ReportingProfiles.hasOwnProperty(e))?d.ReportingProfiles[e]:null}function u(e){return"string"==typeof e&&(e=e.toUpperCase(),d.EchoCacheMode.hasOwnProperty(e))?d.EchoCacheMode[e]:null}function _(e){var t,s;e=e||{},e[E.REPORTING_PROFILE]&&(t=g(e[E.REPORTING_PROFILE])),t||(t=g("PUBLIC_SERVICE")),e[E.ECHO_CACHE_MODE]&&(s=u(e[E.ECHO_CACHE_MODE])),s||(s=u("OFFLINE"));var n=S.extend(b,!0,t,e||{},h);return o(n)&&r(n)&&c(n)&&l(n)?n:null}var p=s(2),d=s(0),S=s(1),f=s(8),E=s(3),b={};b[E.ECHO_ENABLED]=!0,b[E.ECHO_AUTO_START]=!0,b[E.ECHO_DEVICE_ID]=null,b[E.REPORTING_PROFILE]="PUBLIC_SERVICE",b[E.ECHO_CACHE_MODE]="OFFLINE",b[E.COMSCORE_ENABLED]=!0,b[E.COMSCORE_KEEPALIVE_INTERVAL]=2628e3,b[E.BARB_ENABLED]=!1,b[E.BARB_DEBUG]=!1,b[E.BARB_SITE_CODE]="bbcdotcom",b[E.TEST_SERVICE_ENABLED]=!1,b[E.USE_ESS]=!1,b[E.ESS_HOSTNAME]="ess.api.bbci.co.uk",b[E.USE_SSC]=!1,b[E.SSC_HOSTNAME]=null;var h={};return h[E.ECHO_NAME]=f.NAME,h[E.ECHO_VERSION]=f.VERSION,{defaultConfig:b,fixedConfig:h,generate:_}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n,a;n=[s(4)],void 0!==(a=function(e){"use strict";function t(e,t,s){this._persistantLabels={},this._urlParams="",this._cut="",this._httpGet=e,this._eventCount=0,this._isApp=t,this._isScorecardDomain=!0===s,this._hasStarted=!1}return t.IS_ECHO_APP_TAG=!0,t.URL_LIMIT=2048,t.prototype.setPixelURL=function(e){this._url=this._makeBaseUrl(e)},t.prototype.setCustomerC2=function(t){this.setLabel(e.COMSCORE_CUSTOMER,t)},t.prototype.start=function(){this._hasStarted||(this._hasStarted=!0)},t.prototype.setLabel=function(e,t){null===t?this.removeLabel(e):this._persistantLabels[e]=t},t.prototype.removeLabels=function(e){for(var t in e)void 0!==this._persistantLabels[e[t]]&&delete this._persistantLabels[e[t]]},t.prototype.removeLabel=function(e){void 0!==this._persistantLabels[e]&&delete this._persistantLabels[e]},t.prototype.view=function(e){this.send("view",e)},t.prototype.hidden=function(e){this.send("hidden",e)},t.prototype.send=function(e,t,s){var n,a,i=this._persistantLabels,o={};if(this._hasStarted){this._eventCount++;for(a in i)o[a]=i[a];for(a in t)o[a]=t[a];o.ns_type=e,this._isApp&&(o.ns_ap_ev=e,o.ns_ap_ec=this._eventCount),o[this._isApp?"ns_ts":"ns__t"]=+new Date,n=this._createUrl(o),this._httpGet(n,s)}},t.prototype._createUrl=function(t){var s,n=window.encodeURIComponent||escape,a=this._url;this._urlParams="",this._cut="",t.hasOwnProperty("name")&&this._addUrlParam("name",t.name);for(s in t)"name"!==s&&"ns_referrer"!==s&&this._addUrlParam(s,t[s]);return t.hasOwnProperty("ns_referrer")&&this._addUrlParam(this._isScorecardDomain?e.ENV_REFERRER:"ns_referrer",t.ns_referrer),a+=this._urlParams,this._cut.length?a+="ns_cut="+n(this._cut.replace(/&$/,"")):a=a.replace(/&$/,""),a},t.prototype._addUrlParam=function(e,s){var n=window.encodeURIComponent||escape,a=n(e)+"="+n(s)+"&",i=t.URL_LIMIT-8;this._url.length+this._urlParams.length+a.length<i?this._urlParams+=a:this._cut+=a},t.prototype._makeBaseUrl=function(e){for(var t=-1,s=e.charAt(e.length-1),n=0,a=e.length;n<a;n++)"?"===e.charAt(n)&&(t=n);return-1===t?e+="?":"?"!==s&&"&"!==s&&(e+="&"),e},t}.apply(t,n))&&(e.exports=a)},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(){return-1}function n(e){return e+"//"+("https:"===e?"s":"")+"b."+v+"/p?"}function a(e,t){return e+"//"+m+"/"+t+"/s"}function i(e,t,s){return e===v?n(t):a(t,s)}function o(e){return null===e?P:e}function r(e){return null!==e&&e.isValueValid()?e.getValue():P}function c(e){var t=e.getMediaConsumptionMode(),s=e.getServiceIdObject(),n=e.getVersionIdObject(),a=e.getClipIdObject(),i=e.getEpisodeIdObject(),o=e.getVpIdObject(),r=e.getNonPipsContentIdObject();return t===h.MediaConsumptionMode.LIVE&&!0===e.isEssEnriched()&&n.isValueValid()?n:t===h.MediaConsumptionMode.LIVE&&s.isValueValid()?s:r.isValueValid()?r:n.isValueValid()?n:a.isValueValid()?a:i.isValueValid()?i:o.isValueValid()?o:s.isValueValid()?s:null}function l(e){var t=c(e),s=e.getVersionIdObject(),n=e.getEpisodeIdObject(),a=e.getClipIdObject();if(null!==t){var i=t.getIdType();if(e.isLive()){if(i===h.MediaIdType.SERVICE||e.isEssEnriched())return!1}else{if(!(i!==h.MediaIdType.SERVICE||s.isValueSet()||n.isValueSet()||a.isValueSet()))return!0;if(i!==h.MediaIdType.VPID)return!1}}return!0}function g(e){var t={},s=c(e);return t[p.PLAYLIST_NAME]=null===s?P:s.getValue(),t}function u(e){var t={},s=c(e),n=o(e.getAvType()),a=o(e.getLength()),i=o(e.getRetrievalType()),g=e.getBitrate(),u=e.getScheduleMode(),_=e.getCodec(),d=e.getCDN();t[p.MEDIA_PART_NUMBER]=1,t[p.MEDIA_TOTAL_PARTS]=1,t[p.MEDIA_LENGTH]=a,t[p.MEDIA_MEDIUM]=n,t[p.MEDIA_RETRIEVAL_TYPE]=i,null===e.getMediaConsumptionMode()?(t[p.MEDIA_STREAM_TYPE]=P,t[p.MEDIA_LIVE_OR_ONDEMAND]=P):e.isLive()||n!==P?e.isOnDemand()||e.isDownload()?(t[p.MEDIA_STREAM_TYPE]=e.isVideo()?"vod":"aod",t[p.MEDIA_LIVE_OR_ONDEMAND]="on-demand"):(e.isEssEnriched()?t[p.ESS_ENRICHED]="true":(t[p.ESS_ENRICHED]="false",t[p.MEDIA_IS_LIVE]="1"),t[p.MEDIA_STREAM_TYPE]="live",t[p.MEDIA_LIVE_OR_ONDEMAND]="live"):t[p.MEDIA_STREAM_TYPE]=P,g>0&&(t[p.MEDIA_BITRATE]=1e3*g),null!==u&&(t[p.MEDIA_SCHEDULE_INDICATOR]=u),null!==_&&(t[p.MEDIA_CODEC]=_),null!==d&&(t[p.MEDIA_CDN]=d);var S=e.getVersionIdObject(),f=e.getServiceIdObject(),E=e.getClipIdObject(),b=e.getEpisodeIdObject(),h=e.getNonPipsContentIdObject();if(t[p.MEDIA_PID]=r(s),e.isLive()&&!e.getServiceId()&&!1===e.isEssEnriched()&&(e.getVersionId()||e.getVpId())){var y=e.getVersionId()||e.getVpId();t[p.MEDIA_PID]="unverified_"+y}return h.isValueSet()&&(t[p.MEDIA_NON_PIPS_CONTENT_ID]=r(h)),S.isValueSet()&&(t[p.MEDIA_VERSION_ID]=r(S)),f.isValueSet()&&(t[p.MEDIA_SERVICE_ID]=r(f)),E.isValueSet()&&(t[p.MEDIA_CLIP_ID]=r(E)),b.isValueSet()&&(t[p.MEDIA_EPISODE_ID]=r(b)),l(e)&&(t[p.MEDIA_AMBIGUOUS_ID]="1"),t}function _(e,t,s,n){var a,o,r,c,l,g,u,S,b,y=s[d.COMSCORE_SITE];this._deviceId=null,this._broker=null,this.media=null,this.SSPlayerEvent=_.StreamSense.PlayerEvents,this.SSPlayerState=_.StreamSense.InternalStates,this._clips=[],this._isEnabled=!0,this._hasStartedAppTag=!1,this._hasCreatedAsset=!1,this._storedAssetLabels={},l=s[d.COMSCORE_HOST],y=s[d.COMSCORE_SITE],this.useSsc=!0===s[d.USE_SSC]&&"sa.bbc.co.uk"!==l,this._deviceId=s[d.ECHO_DEVICE_ID]||void 0,!0!==this.useSsc||this._deviceId||(u=_._createSscHelper({forceBBCHost:s[d.SSC_HOSTNAME]}),this._deviceId=u.getCookieId()),E.containsValue(h.ApplicationType,t)||(t=P),a=i(l,n.getProtocol(),y),!0!==this.useSsc||this._deviceId||(a=u.getLocation().protocol+"//"+u.getSSCHostname()),!0===s[d.TEST_SERVICE_ENABLED]&&(r=a,a=s[d.TEST_SERVICE_URL]+"/comscore",this._isUsingComscoreOTTLibrary&&(o=s[d.TEST_SERVICE_URL]+"/offline")),this._isApp=!E.containsValue(k,t),g=n.getHttpGet(),c=l===v,this._isUsingComscoreOTTLibrary=!(!_.AppTag||!_.AppTag.ns_),this._isUsingComscoreOTTLibrary?(this.appTag=_.AppTag.ns_.comScore,this.appTag.setPlatformAPI(_.AppTag.ns_.PlatformAPIs.html5),g&&(this.appTag.getPlatformAPI().httpGet=g),this.appTag.setPublisherSecret(s[d.COMSCORE_PUBLISHER_SECRET]),this.appTag.setAppContext()):this.appTag=new _.AppTag(g||f._defaultHttpGet,this._isApp,c),this.ss=new _.StreamSense.ns_.StreamingAnalytics({liveEndpointURL:a,systemClockJumpDetection:!0}),g&&(this.ss.getPlatformAPI().httpGet=g),c&&(this.appTag.setCustomerC2(s[d.COMSCORE_CUSTOMER_ID]),this.ss.setLabel(p.COMSCORE_CUSTOMER,s[d.COMSCORE_CUSTOMER_ID]),this.addLabel(p.COMSCORE_C1,"2"),this.addLabel(p.COMSCORE_SITE,y)),this.appTag.setPixelURL(a),this._deviceId?this.addLabel(p.DEVICE_ID,this._deviceId):this.useSsc||"sa.bbc.co.uk"!==l||(this._deviceId=A.getCookieValueByName("s1")),!0===s[d.TEST_SERVICE_ENABLED]&&(this.addLabel(p.COMSCORE_ENDPOINT,r),this._isUsingComscoreOTTLibrary&&this.appTag.setOfflineURL(o)),this.addLabel(p.BBC_APPLICATION_NAME,e),this.addLabel(p.BBC_APPLICATION_TYPE,t),this.setCacheMode(s[d.ECHO_CACHE_MODE]),this.addLabel(p.BBC_MEASUREMENT_LIB_NAME,s[d.ECHO_NAME]),this.addLabel(p.BBC_MEASUREMENT_LIB_VERSION,s[d.ECHO_VERSION]),this.ss&&this.ss.setKeepAliveInterval&&s[d.COMSCORE_KEEPALIVE_INTERVAL]&&this.ss.setKeepAliveInterval(s[d.COMSCORE_KEEPALIVE_INTERVAL]),this._isApp?(this._isUsingComscoreOTTLibrary?this.appTag.setAppName(e):this.addLabel(p.APP_NAME,e),this.addLabel(p.APP_PLATFORM_NAME,n.getPlatformName()),this.addLabel(p.APP_PLATFORM_RUNTIME,n.getPlatformRuntimeEnvironment()),this.addLabel(p.APP_OS_VERSION,n.getPlatformOSVersion()),this.addLabel(p.APP_DEVICE_NAME,n.getDeviceName()),this.addLabel(p.APP_SCREEN_RESOLUTION,n.getScreenResolution()),this.addLabel(p.APP_LANGUAGE,n.getLanguage())):this.addLabel(p.WEB_SCREEN_RES,n.getScreenResolution()),this.addLabel(p.ENV_CHAR_SET,n.getCharSet()),this.addLabel(p.ENV_TITLE,n.getTitle()),this.addLabel(p.ENV_REFERRER,n.getReferrer()),-1===n.getURL().indexOf("file:",0)&&this.addLabel(p.ENV_URL,n.getURL()),s[d.ECHO_TRACE]&&this.setTraceId(s[d.ECHO_TRACE]),S=f.getOrbCookiesPolicy(),S&&(b="ad"+(S.ads?"1":"0")+"ps"+(S.personalisation?"1":"0")+"pf"+(S.performance?"1":"0"),this.addLabel(p.COOKIE_POLICY,b),S.performance||this.addLabel(p.NO_COOKIES,"1")),this.addLabel(h.ManagedLabels.BBC_SITE,P),this._mediaIsLive=null,s&&!1===s[d.ECHO_ENABLED]?this._isEnabled=!1:this._isEnabled=!0}var p=s(4),d=s(3),S=s(22),f=s(5),E=s(1),b=s(29),h=s(0),P="invalid-data",y=s(16),A=s(7),m="sa.bbc.co.uk/bbc",v="scorecardresearch.com",k=[h.ApplicationType.WEB,h.ApplicationType.MOBILE_WEB,h.ApplicationType.RESPONSIVE],I=[p.NO_COOKIES],C=["ns_st_pr","ns_st_sn","ns_st_en","ns_st_ep","ns_st_ty","ns_st_ct","ns_st_st","ns_st_pu"];_.prototype.start=function(){this._isEnabled&&!this._hasStartedAppTag&&(this.appTag.start(),this._hasStartedAppTag=!0)},_.prototype.enable=function(){this._isEnabled||(this._isEnabled=!0)},_.prototype.disable=function(){this._isEnabled&&(this.clearMedia(),this._isEnabled=!1)},_.prototype.getDeviceId=function(){return this._deviceId},_.prototype._buildStreamSenseClip=function(e){var t,s=u(e),n=s[p.MEDIA_PID];for(t=0;t<this._clips.length;t++)if(this._clips[t][p.MEDIA_PID]===n)return this._clips[t];return s[p.MEDIA_CLIP_NUMBER]=this._clips.length+1,this._clips.push(s),s},_.prototype.setTraceId=function(e){this.addLabel(d.ECHO_TRACE,e)},_._createSscHelper=function(e){return new y(e||{})},_.StreamSense=s(14),_.AppTag=s(20);var T="<"+I.join("><")+">";return _.prototype._isExcludedLabel=function(e){return!0===this.useSsc&&!!T.match(new RegExp("<"+e+">"))},_.prototype.addLabels=function(e){if("object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&this.addLabel(t,e[t])},_.prototype.addLabel=function(e,t){!0!==this._isExcludedLabel(e)&&(this.appTag.setLabel(e,t),C.indexOf(e)>-1?this._hasCreatedAsset?this.ss.getPlaybackSession().getAsset().setLabel(e,t):this._storedAssetLabels[e]=t:this.ss.setLabel(e,t))},_.prototype.addManagedLabel=function(e,t){var s=b.isValidManagedLabel(e,t),n=s?t:P;for(var a in h.ManagedLabels)h.ManagedLabels[a]===e&&this.addLabel(e,n)},_.prototype.removeLabels=function(e){for(var t=0,s=e.length;t<s;t++)this.removeLabel(e[t])},_.prototype.removeLabel=function(e){this.appTag.setLabel(e,null),C.indexOf(e)>-1?this._hasCreatedAsset?this.ss.getPlaybackSession().getAsset().setLabel(e,null):delete this._storedAssetLabels[e]:this.ss.setLabel(e,null)},_.prototype.setLoggedInToBBCId=function(e){this.addLabel(p.BBC_ID_LOGGED_IN,"1"),e&&e.length>0?this.addManagedLabel(h.ManagedLabels.BBC_HASHED_ID,e):this.removeLabel(h.ManagedLabels.BBC_HASHED_ID)},_.prototype.setLoggedOutOfBBCId=function(){this.removeLabels([p.BBC_ID_LOGGED_IN,h.ManagedLabels.BBC_HASHED_ID])},_.prototype.setAppVersion=function(e){"function"==typeof this.appTag.setAppVersion?this.appTag.setAppVersion(e):e&&this._isApp?this.addLabel(p.BBC_APPLICATION_VERSION,e.toString()):e&&this.addLabel(p.APP_VERSION,e.toString())},_.prototype.setCounterName=function(e){this._isEnabled&&this.addLabel(p.BBC_COUNTER_NAME,e)},_.prototype.setContentLanguage=function(e){this.addLabel(p.BBC_LANGUAGE,e)},_.prototype.setCacheMode=function(e){if(this._isUsingComscoreOTTLibrary&&e!==this._cacheMode){switch(e){case h.EchoCacheMode.ALL:this.appTag.allowLiveTransmission(this.appTag.TransmissionMode.NEVER),this.appTag.allowOfflineTransmission(this.appTag.TransmissionMode.NEVER);break;case h.EchoCacheMode.OFFLINE:this.appTag.allowLiveTransmission(this.appTag.TransmissionMode.DEFAULT),this.appTag.allowOfflineTransmission(this.appTag.TransmissionMode.DEFAULT)}this._cacheMode=e}},_.prototype.flushCache=function(){this._isUsingComscoreOTTLibrary&&this.appTag.flushCache()},_.prototype.viewEvent=function(e,t){if(this._eventsEnabled()){this.addLabel(p.BBC_COUNTER_NAME,e);var s=E.extend(t,!0,p.ECHO_EVENT_NAME,"view");s.name=e,this.appTag.view(s)}},_.prototype.errorEvent=t,_.prototype.userActionEvent=function(e,t,s){if(this._eventsEnabled()){var n=E.extend(s,!0,p.USER_ACTION_TYPE,e,p.USER_ACTION_NAME,t,p.ECHO_EVENT_NAME,"userAct");this.appTag.hidden(n)}},_.prototype.setPlayerName=function(e){this.addLabel(p.PLAYER_NAME,e)},_.prototype.setPlayerVersion=function(e){this.addLabel(p.PLAYER_VERSION,e)},_.prototype.setPlayerIsPopped=function(e){this.ss.setLabel(p.PLAYER_POPPED,e?1:0)},_.prototype.setPlayerWindowState=function(e){this.ss.setLabel(p.PLAYER_WINDOW_STATE,e)},_.prototype.setPlayerVolume=function(e){this.ss.setLabel(p.PLAYER_VOLUME,e)},_.prototype.setPlayerIsSubtitled=function(e){this.ss.setLabel(p.PLAYER_SUBTITLED,e?1:0)},_.prototype.setBroker=function(e){return this._broker=e,this},_.prototype.setMedia=function(e){if(this._eventsEnabled()&&(this.clearMedia(),e)){this.media=e;var t=this._buildStreamSenseClip(this.media),s=g(this.media);this._mediaIsLive=!e.isOnDemand(),this.ss.createPlaybackSession(s),this.ss.getPlaybackSession()&&(this.ss.getPlaybackSession().setAsset(t),this._hasCreatedAsset=!0,this.ss.getPlaybackSession().getAsset().setLabels(this._storedAssetLabels))}},_.prototype.liveMediaUpdate=function(e,t,s){E.assert("number"==typeof t,"newPosition must be a number"),E.assert("number"==typeof s,"oldPosition must be a number"),this.media=e;var n=this._buildStreamSenseClip(e);this.ss.notifyEnd(s),this.ss.getPlaybackSession().setAsset(n),this.ss.getPlaybackSession().getAsset().setLabels(this._storedAssetLabels),this.ss.notifyPlay(t)},_.prototype.liveEnrichmentFailed=t,_.prototype.setMediaLength=function(e){this._eventsEnabled()&&null!=this.media&&((!e||e<0)&&(e=0),this.ss.getPlaybackSession().getAsset().setLabel(p.MEDIA_LENGTH,e))},_.prototype.setMediaBitrate=function(e){this._eventsEnabled()&&e>0&&null!==this.media&&(e*=1e3,this.ss.getPlaybackSession().getAsset().setLabel(p.MEDIA_BITRATE,e))},_.prototype.setMediaCodec=function(e){this._eventsEnabled()&&this.ss.getPlaybackSession().getAsset().setLabel(p.MEDIA_CODEC,e)},_.prototype.setMediaCDN=function(e){this._eventsEnabled()&&this.ss.getPlaybackSession().getAsset().setLabel(p.MEDIA_CDN,e)},_.prototype.avPlayEvent=function(e,t){if(this._eventsEnabled()){var s=E.extend(t,!0,p.ECHO_EVENT_NAME,"avPlay");this.media.isLive()&&!1===this.media.isEssEnriched()&&(e=0),this.ss.notifyPlay(s,e)}},_.prototype.avPauseEvent=function(e,t){if(this._eventsEnabled()){var s=E.extend(t,!0,p.ECHO_EVENT_NAME,"avPause"),n=this.media.isLive();n&&!1===this.media.isEssEnriched()?e=0:!n&&this._broker&&0===e&&(e=this._broker.getCurrentIntervalMaxPosition()),this.ss.notifyPause(s,e)}},_.prototype.avBufferEvent=function(e,t){this._eventsEnabled()&&(this.media.isLive()&&!1===this.media.isEssEnriched()&&(e=0),this.ss.notifyBufferStart(e))},_.prototype.avEndEvent=function(e,t){if(this._eventsEnabled()){var s=E.extend(t,!0,p.ECHO_EVENT_NAME,"avEnd",p.PLAYLIST_END,1);this.media.isLive()&&!1===this.media.isEssEnriched()&&(e=0),this.ss.notifyEnd(e,s),this.clearMedia()}},_.prototype.avRewindEvent=function(e,t,s){if(this._eventsEnabled()){var n=E.extend(s,!0,p.ECHO_EVENT_NAME,"avRW",p.EVENT_TRIGGERED_BY_USER,"rewind",p.REWIND_FF_RATE,t);this.media.isLive()&&!1===this.media.isEssEnriched()&&(e=0),this.ss.notifyPause(e,n)}},_.prototype.avFastForwardEvent=function(e,t,s){if(this._eventsEnabled()){var n=E.extend(s,!0,p.ECHO_EVENT_NAME,"avFF",p.EVENT_TRIGGERED_BY_USER,"fastforward",p.REWIND_FF_RATE,t);this.media.isLive()&&!1===this.media.isEssEnriched()&&(e=0),this.ss.notifyPause(n,e)}},_.prototype.avSeekEvent=function(e,t){if(this._eventsEnabled()){var s=E.extend(t,!0,p.ECHO_EVENT_NAME,"avSeek",p.EVENT_TRIGGERED_BY_USER,"seek");this.media.isLive()&&!1===this.media.isEssEnriched()&&(e=0),this.ss.notifyPause(e,s)}},_.prototype.avUserActionEvent=function(e,t,s,n){if(this._eventsEnabled()){var a=E.extend(n,!0,p.ECHO_EVENT_NAME,"avUserAct",p.STREAMSENSE_CUSTOM_EVENT_TYPE,e,p.USER_ACTION_TYPE,e,p.USER_ACTION_NAME,t);this.media.isLive()&&!1===this.media.isEssEnriched()&&(s=0),this.ss.notifyCustomEvent(s,a)}},_.prototype.clearMedia=function(){this._eventsEnabled()&&(this._clips=[],this._hasCreatedAsset=!1,null!==this.media&&(this.ss.getState()===S.PLAYING&&this.avEndEvent(0),this.media=null))},_.prototype.requiresLabelCleansing=function(){return!0},_.prototype._eventsEnabled=function(){return this._isEnabled&&this._hasStartedAppTag},_}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){e.exports={IDLE:0,PLAYBACK_NOT_STARTED:1,PLAYING:2,PAUSED:3,BUFFERING_BEFORE_PLAYBACK:4,BUFFERING_DURING_PLAYBACK:5,BUFFERING_DURING_SEEKING:6,BUFFERING_DURING_PAUSE:7,SEEKING_BEFORE_PLAYBACK:8,SEEKING_DURING_PLAYBACK:9,SEEKING_DURING_BUFFERING:10,SEEKING_DURING_PAUSE:11,PAUSED_DURING_BUFFERING:12}},function(e,t,s){e.exports={STREAM:"stream",PID:"cq",WIDTH:"sx",HEIGHT:"sy",PLAYER_DESC:"pl",PLAYER_VERSION:"plv"}},function(e,t,s){var n;void 0!==(n=function(){"use strict";function e(e,t){this.namespace=e,this.env=t}return e.prototype.preloadImage=function(e){return this.env.getHttpGet()(e)},e.prototype.getLocalStorageItem=function(e){return this.env.getGetLocalStorageItem()(e)},e.prototype.setLocalStorageItem=function(e,t){return this.env.getSetLocalStorageItem()(e,t)},e.prototype.getWindowLocationURL=function(){return this.env.getURL()},e}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(){return-1}function n(e,t,s,n){this._sensors=null,this._broker=null,this._media=null,this._meta={},this._stream=null,this._env=n,this._siteCode=s[i.BARB_SITE_CODE],this._debug=s[i.BARB_DEBUG],this._traceId=null,this._isPlaying=!1,this._isEssEnabled=!1,this._isEnabled=!0,this._hasStarted=!1,s[i.ECHO_TRACE]&&this.setTraceId(s[i.ECHO_TRACE]),s[i.USE_ESS]&&(this._isEssEnabled=!0),s&&!1===s[i.ECHO_ENABLED]?this._isEnabled=!1:this._isEnabled=!0}var a=s(23),i=s(3),o=s(2),r=s(0),c=s(24);return n.prototype.start=function(){this._hasStarted||(this._hasStarted=!0)},n.prototype.enable=function(){this._isEnabled||(this._isEnabled=!0)},n.prototype.disable=function(){this._isEnabled&&(this._isEnabled=!1,this.clearMedia())},n.prototype.setTraceId=function(e){this._traceId=e},n.SpringStreams=s(15),n.prototype.addLabels=t,n.prototype.addLabel=t,n.prototype.addManagedLabel=t,n.prototype.removeLabels=t,n.prototype.removeLabel=t,n.prototype.setLoggedInToBBCId=t,n.prototype.setLoggedOutOfBBCId=t,n.prototype.setAppVersion=t,n.prototype.setCounterName=t,n.prototype.setContentLanguage=t,n.prototype.setCacheMode=t,n.prototype.flushCache=t,n.prototype.setESSEnabled=t,n.prototype.viewEvent=t,n.prototype.errorEvent=t,n.prototype.userActionEvent=t,n.prototype.setPlayerName=function(e){this._meta[a.PLAYER_DESC]=e},n.prototype.setPlayerVersion=function(e){this._meta[a.PLAYER_VERSION]=e},n.prototype.setPlayerIsPopped=t,n.prototype.setPlayerWindowState=t,n.prototype.setPlayerVolume=t,n.prototype.setPlayerIsSubtitled=t,n.prototype.setBroker=function(e){return this._broker=e,this},n.prototype.setMedia=function(e){this._eventsEnabled()&&(this.clearMedia(),this._media=e.getClone())},n.prototype.setMediaLength=function(e){this._media.setLength(e)},n.prototype.setMediaBitrate=t,n.prototype.setMediaCodec=t,n.prototype.setMediaCDN=t,n.prototype.liveMediaUpdate=function(e){this._media=e.getClone(),this._isPlaying&&this._startTracking()},n.prototype.liveEnrichmentFailed=function(){this._media.getServiceId()||this._media.setServiceId("no-service-id-found"),this._isPlaying&&this._startTracking()},n.prototype.avPlayEvent=function(e,t){this._eventsEnabled()&&this.isValidMedia()&&this._broker&&(this._initSensors(),this._isPlaying=!0,this._media.isLive()&&!this._media.getServiceId()?this._isEssEnabled&&(this._media.getVersionId()||this._media.getVpId())||(this._media.setServiceId("invalid-data"),this._startTracking()):this._startTracking())},n.prototype._initSensors=function(){if(null===this._sensors){if(this._sensors=new n.SpringStreams(this._siteCode),null!==this._env.getSetLocalStorageItem()&&null!==this._env.getGetLocalStorageItem()&&null!==this._env.getHttpGet()){o.info("Using custom PageContext for BARB");var e=new c("com.kma.springstreams",this._env);this._sensors.setPageContext(e)}this._debug&&(this._sensors.debug=function(e){o.info("Spring DEBUG: "+e)})}},n.prototype._startTracking=function(){if(null===this._stream){var e=this._getAttributes(),t=e[a.PID]||" ";this._stream=this._sensors.track(t,e,this._getAdaptor())}},n.prototype._getMostPrecedentIdObject=function(){var e=this._media.getVersionIdObject(),t=this._media.getEpisodeIdObject(),s=this._media.getClipIdObject(),n=this._media.getVpIdObject(),a=this._media.getServiceIdObject();return e.isValueValid()?e:t.isValueValid()?t:s.isValueValid()?s:n.isValueValid()?n:a.isValueValid()?a:null},n.prototype._getAttributes=function(){var e=this._media,t={};if(this._traceId&&(t[i.ECHO_TRACE]=this._traceId),!e.isLive()){var s=this._getMostPrecedentIdObject();null!==s&&(t[a.PID]=s.getValue())}return e.isOnDemand()?t[a.STREAM]="od":e.isDownload()?t[a.STREAM]="dwn":e.isLive()&&e.getServiceIdObject().isValueValid()&&(t[a.STREAM]="live/"+e.getServiceId()),t},n.prototype._getAdaptor=function(){var e,t=this;return e=this._media.isLive()?function(){return t._broker.getTimestamp()}:function(){return t._broker.getPosition()},{getMeta:function(e){return t._meta},getDuration:function(e){var s=0;return t._media.isLive()||(s=Math.floor(t._media.getLength()/1e3)),s},getPosition:function(t){return Math.floor(e()/1e3)}}},n.prototype._eventsEnabled=function(){return this._isEnabled&&this._hasStarted},n.prototype.avPauseEvent=function(){},n.prototype.avBufferEvent=function(){},n.prototype.avEndEvent=function(){this._eventsEnabled()&&(this._isPlaying=!1,this.isValidMedia()&&this.clearMedia())},n.prototype.avRewindEvent=function(){},n.prototype.avFastForwardEvent=function(){},n.prototype.avSeekEvent=function(){},n.prototype.avUserActionEvent=t,n.prototype.clearMedia=function(){this.isValidMedia()&&(this._stream&&this._stream.stop(),this._stream=null,this._media=null)},n.prototype.isValidMedia=function(){return null!==this._media&&this._media.avType===r.AvType.VIDEO},n.prototype.isValidLiveMedia=function(){return this.isValidMedia()&&this._media.isLive()},n.prototype.requiresLabelCleansing=function(){return!0},n}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n,a;n=[s(11),s(4),s(12),s(10)],void 0!==(a=function(e,t,s,n){"use strict";function a(t,n,a,o,r){this._playerDelegate=t,this._playhead=new e,this._isStarted=!1,this._interval=null,this._echoClient=a,this._broadcast=i,this._playerDelegateTimestamp=0,this._previousPosition=0,this._playingTime=0,this._media=n,this._environment=o,this._essEnabled=r,this._hb3NotSentYet=!0,this._hb5NotSentYet=!0,this._isRecievingPlayerTimestamp=!1,this._updateTime=0,this._essEnabled&&(this._schedule=new s(n,o,a))}var i="no-broadcast";return a.prototype.start=function(){var e=this;this._isStarted||(this._interval=setInterval(function(){e._update()},1e3),this._isStarted=!0,this._isRecievingPlayerTimestamp||this._playhead.start())},a.prototype.stop=function(){clearInterval(this._interval),this._playhead.stop(),this._isStarted=!1},a.prototype._update=function(){var e,s=parseInt(this._playerDelegate.getTimestamp(),10),n=!1,a=!1,i=!1,o=this.getTimestamp(),r=new Date;r=r.getTime();var c=r-this._updateTime;this._updateTime=r,"number"==typeof s&&s>0&&(a=!0,this._isRecievingPlayerTimestamp=!0,this._playerDelegateTimestamp!==s&&(n=!0,this._echoClient.addLabel(t.MEDIA_TIMESTAMP,s)),e=s-o,a&&(0===this._playerDelegateTimestamp||e<0-c-1500||e>c+1500)&&(i=!0,this._playerDelegateTimestamp=s,this._playingTime+=this._playhead.getPosition(),this._restartPlayhead(),o=this.getTimestamp())),i||(0!==this._playerDelegateTimestamp&&!n||this._isRecievingPlayerTimestamp&&!a?this._playhead.stop():this._playhead.start()),this._updateSchedule(o)?(this._playingTime=0,this._playerDelegateTimestamp=s,this._restartPlayhead(),this._hb3NotSentYet=!0,this._hb5NotSentYet=!0):n&&this._echoClient.releaseSuppressedPlay(),this._updateHeartbeats(),this._previousPosition=this.getPosition()},a.prototype._updateSchedule=function(e){var t,s,a,o,r=!1;return this._essEnabled&&this._schedule.hasData()&&e>0&&(t=this._schedule.getBroadcast(e),o=new n(this._media.getAvType(),this._media.getMediaConsumptionMode()),o.setServiceId(this._schedule.serviceId),t||this._broadcast===i?!t||this._broadcast!==i&&t.version.id===this._broadcast.version.id||(this._broadcast=t,s=t.published_time,a=s.end-s.start,o.setEssEnriched(!0),o.setVersionId(t.version.id),o.setLength(a),t.episode&&t.episode.id&&o.setEpisodeId(t.episode.id),this._updateMedia(o),r=!0):(this._broadcast=i,this._updateMedia(o),r=!0)),r},a.prototype._updateHeartbeats=function(){var e,t;this._broadcast!==i&&(this._hb3NotSentYet||this._hb5NotSentYet)&&(e=this._playingTime+this._playhead.getPosition(),t=this.getPosition(),e>=3e3&&this._hb3NotSentYet&&(this._echoClient.avUserActionEvent("echo_hb","echo_hb_3",t),this._hb3NotSentYet=!1),e>=5e3&&this._hb5NotSentYet&&(this._echoClient.avUserActionEvent("echo_hb","echo_hb_5",t),this._hb5NotSentYet=!1))},a.prototype._updateMedia=function(e){var t=this.getPosition();this._echoClient.liveMediaUpdate(e,t,this._previousPosition),this._previousPosition=t},a.prototype._restartPlayhead=function(){this._playhead.reset(),this._playhead.start()},a.prototype.getPosition=function(){return this._broadcast&&this._broadcast!==i?this._playerDelegateTimestamp-this._broadcast.published_time.start+this._playhead.getPosition():this._playhead.getPosition()},a.prototype.getTimestamp=function(){return this._playerDelegateTimestamp+this._playhead.getPosition()},a}.apply(t,n))&&(e.exports=a)},function(e,t,s){var n,a;n=[s(11)],void 0!==(a=function(e){"use strict";function t(t,s,n){this._playerDelegate=t,this._media=s,this._echoClient=n,this._playhead=new e,this._isStarted=!1,this._interval=null,this._playerDelegatePosition=0,this._playingTime=0,this._currentIntervalMaxPosition=0,this._hb3NotSentYet=!0,this._hb5NotSentYet=!0}return t.prototype.setPlayhead=function(e){this._playhead=e},t.prototype.start=function(){var e=this;this._isStarted||(this._interval=setInterval(function(){e._update()},1e3),this._isStarted=!0,this._playhead.start())},t.prototype.stop=function(){clearInterval(this._interval),this._playhead.stop(),this._isStarted=!1},t.prototype.setPosition=function(e){"number"==typeof e&&e>=0&&!this.arePositionsWithinTolerance(this.getPosition(),e)&&(this._playerDelegatePosition=e,this._playingTime+=this._playhead.getPosition(),this._restartPlayhead(),this._currentIntervalMaxPosition=e)},t.prototype.getCurrentIntervalMaxPosition=function(){return this._currentIntervalMaxPosition},t.prototype._update=function(){var e=parseInt(this._playerDelegate.getPosition(),10),t=this.getPosition(),s=this._playingTime+this._playhead.getPosition();"number"==typeof e&&e!==this._playerDelegatePosition&&e>0&&(0!==this._playerDelegatePosition&&this.arePositionsWithinTolerance(e,t)||(this._playerDelegatePosition=e,t=this._playerDelegatePosition,this._restartPlayhead())),t>this._currentIntervalMaxPosition&&(this._currentIntervalMaxPosition=t),s>=3e3&&this._hb3NotSentYet&&(this._echoClient.avUserActionEvent("echo_hb","echo_hb_3",t),this._hb3NotSentYet=!1),s>=5e3&&this._hb5NotSentYet&&(this._echoClient.avUserActionEvent("echo_hb","echo_hb_5",t),this._hb5NotSentYet=!1),this._media.length>0&&t>=this._media.length&&this._echoClient.avPauseEvent(this._media.length,{echo_pause_at_media_length:1})},t.prototype._restartPlayhead=function(){this._playhead.reset(),this._playhead.start()},t.prototype.getPosition=function(){var e=this._playhead.getPosition();return this._playerDelegatePosition+e},t.prototype.getTimestamp=function(){return 0},t.prototype.arePositionsWithinTolerance=function(e,t){var s=e-t;return s>=-1500&&s<=1500},t}.apply(t,n))&&(e.exports=a)},function(e,t,s){e.exports={STRICT:"strict",COUNTERNAME:"countername",EVENT_MASTER_BRAND:"event_master_brand",NO_CLEANSING:"no_cleansing",CUSTOM:"custom"}},function(e,t,s){var n;void 0!==(n=function(e){"use strict";function t(e,t){switch(e){case n.ManagedLabels.IPLAYER_STATE:if("purchased"!==t&&"free"!==t)return!1;break;case n.ManagedLabels.STORE_ED_TYPE:if("archive"!==t&&"standard"!==t)return!1;break;case n.ManagedLabels.IPLAYER_AVAIL:if("avail"!==t&&"unavail"!==t&&"soon"!==t)return!1;break;case n.ManagedLabels.STORE_REFERRAL:if("iplayer"!==t&&"store"!==t)return!1;break;case n.ManagedLabels.BBC_HASHED_ID:if("string"!=typeof t||0===a.trim(t).length)return!1}return!0}var n=s(0),a=s(1);return{isValidManagedLabel:t}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){var n;void 0!==(n=function(){"use strict";function e(e,t){var s=new Image;"function"==typeof t&&(s.onload=function(){t()}),s.src=e}function t(e,t){var n,a,i;a=!1,i=!1;var o=function(e,s){t.onError&&t.onError(e,s)},r=function(){var e;if(t.onSuccess){try{e=window.JSON.parse(n.responseText)}catch(e){o("json")}"object"==typeof e&&setTimeout(function(){t.onSuccess(e)})}};if(window.JSON&&window.JSON.parse&&void 0!==window.XMLHttpRequest&&"withCredentials"in(n=new XMLHttpRequest)&&(i=!0),!i)return void o();try{n.open("GET",e,!0),n.onload=function(){(void 0===n.status||n.status<400)&&null!==n.responseText?r():o(n.responseText,n.status)},n.onerror=function(e){o(e)},n.timeout=s,n.ontimeout=function(e){o(e)}}catch(e){!function(e){a||o(e)}(e)}try{n.send(null)}catch(e){!function(){a=!0,n.onload=n.onerror=n.onreadystatechange=null,n.abort()}(),o(e)}}var s=1e4;return{httpGet:e,executeCrossDomainGet:t}}.call(t,s,t,e))&&(e.exports=n)},function(e,t,s){e.exports=s(13)}])});