/*
		GNU General Public License version 2 or later; see LICENSE.txt
 @author      JoomVita - http://www.joomvita.com
*/
(function(){tinymce.create("tinymce.plugins.VitabookEmoticonsPlugin",{init:function(a,b){var c=this;var d=a.dom;a.addCommand("mceVitabookEmoticons",function(){a.windowManager.open({file:b+"/dialog.htm",width:200,height:75,inline:1},{plugin_url:b})});a.addButton("vitabookemoticons",{title:"Vitabook Emoticons",cmd:"mceVitabookEmoticons",image:b+"/img/vitabookemoticons.png"});if(tinyMCE.isIE&&!tinyMCE.isIE9)return;a.onKeyDown.add(function(a,d){if(d.keyCode==13)return c.handleEnter(a,b)});a.onKeyUp.add(function(a,d){if(d.keyCode==32)return c.handleSpacebar(a,b)})},handleSpacebar:function(a,b){this.parseCurrentLine(a,0,"",b)},handleEnter:function(a,b){this.parseCurrentLine(a,-1,"",b)},parseCurrentLine:function(a,b,c,d){function C(b){i=a.selection.getBookmark();a.selection.setRng(e);tinyMCE.execCommand("mceInsertContent",false,'<img src="'+b+'" alt="" border="0" class="smiley" />');a.selection.moveToBookmark(i)}var e,f,g,h,i,j,k,l,m;d=d+"/img/smilies/";e=a.selection.getRng().cloneRange();if(e.startOffset<2){l=e.endContainer.previousSibling;if(l==null){if(e.endContainer.firstChild==null||e.endContainer.firstChild.nextSibling==null)return;l=e.endContainer.firstChild.nextSibling}m=l.length;e.setStart(l,m);e.setEnd(l,m);if(e.endOffset<2)return;f=e.endOffset;h=l}else{h=e.endContainer;if(h.nodeType!=3&&h.firstChild){while(h.nodeType!=3&&h.firstChild)h=h.firstChild;e.setStart(h,0);e.setEnd(h,h.nodeValue.length)}if(e.endOffset==1)f=2;else f=e.endOffset-1-b}g=f;do{e.setStart(h,f-2);e.setEnd(h,f-1);f-=1}while(e.toString()!=" "&&e.toString()!=""&&e.toString().charCodeAt(0)!=160&&f-2>=0&&e.toString()!=c);if(e.toString()==c||e.toString().charCodeAt(0)==160){e.setStart(h,f);e.setEnd(h,g);f+=1}else if(e.startOffset==0){e.setStart(h,0);e.setEnd(h,g)}else{e.setStart(h,f);e.setEnd(h,g)}j=e.toString();k=j.match(/^(:-?\)|:-?\(|:-?P|;-?\)|:-?D|:-?8|:zzz|:-?@|:roll|:eek|:sigh|:-?\?|;-?\(|:-?x)$/i);if(k){var n=/:-?\)/i;var o=/:-?\(/i;var p=/:-?P/i;var q=/;-?\)/i;var r=/:-?D/i;var s=/:-?8/;var t=/:zzz/;var u=/:-?@/;var v=/:roll/;var w=/:eek/;var x=/:sigh/;var y=/:-?\?/;var z=/;-?\(/;var A=/:-?x/;if(n.test(k[1])){var B=d+"sm_smile.gif";C(B)}else if(o.test(k[1])){var B=d+"sm_mad.gif";C(B)}else if(p.test(k[1])){var B=d+"sm_razz.gif";C(B)}else if(q.test(k[1])){var B=d+"sm_wink.gif";C(B)}else if(r.test(k[1])){var B=d+"sm_biggrin.gif";C(B)}else if(s.test(k[1])){var B=d+"sm_cool.gif";C(B)}else if(t.test(k[1])){var B=d+"sm_sleep.gif";C(B)}else if(u.test(k[1])){var B=d+"sm_upset.gif";C(B)}else if(v.test(k[1])){var B=d+"sm_rolleyes.gif";C(B)}else if(w.test(k[1])){var B=d+"sm_bigeek.gif";C(B)}else if(x.test(k[1])){var B=d+"sm_sigh.gif";C(B)}else if(y.test(k[1])){var B=d+"sm_confused.gif";C(B)}else if(z.test(k[1])){var B=d+"sm_cry.gif";C(B)}else if(A.test(k[1])){var B=d+"sm_dead.gif";C(B)}}},getInfo:function(){return{longname:"Vitabook Emoticons Plugin",author:"JoomVita",authorurl:"http://www.joomvita.com",infourl:"http://www.joomvita.com",version:"1.0"}}});tinymce.PluginManager.add("vitabookemoticons",tinymce.plugins.VitabookEmoticonsPlugin)})()