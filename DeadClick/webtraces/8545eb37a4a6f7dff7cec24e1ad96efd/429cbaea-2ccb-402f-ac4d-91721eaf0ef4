/* on-1.0 2018-1-4 14:41:16 */ 
(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Acpm = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Cookie=require("./Cookie"),CookieValue_1=require("./CookieValue"),Authentification=function(){function e(e){this._access=Access.FULL,this._authURL="https://auth.audience.acpm.fr/",this._endpoint="https://collecte.audience.acpm.fr/m/web/",this._serial=e}return e.prototype.getAccess=function(){return this._access},e.prototype.getEndpoint=function(){return this._endpoint},e.prototype.authenticate=function(){var e=this;return new Promise(function(t,s){var o=Cookie.getSerial("measure",e._serial);o?(e._access=o.access,e._endpoint=o.host,t("cookie")):e.requestValue(t,s)})},e.prototype.requestValue=function(e,t){var s=new XMLHttpRequest;s.timeout=2e3,s.open("GET",this._authURL+this._serial);var o=this;s.onload=function(){200===s.status?o.parseResponse(s.responseText):401===s.status&&(o._access=Access.DENIED),o.cacheResponse(),e("status code "+s.status)},s.ontimeout=function(t){e("Timeout")},s.onerror=function(t){e("Error")},s.send()},e.prototype.parseResponse=function(e){var t=e.split("|");t[0]=t[0].split("=")[1],t[1]=t[1].split("=")[1],this._access=t[0],this._endpoint=t[1]},e.prototype.cacheResponse=function(){var e=new CookieValue_1.CookieValue(this._endpoint,this._access);Cookie.write("measure",this._serial,e,15)},e}();exports.Authentification=Authentification;var Access;!function(e){e.FULL="full",e.DENIED="denied",e.RESTRICTED="restricted"}(Access=exports.Access||(exports.Access={}));

},{"./Cookie":2,"./CookieValue":4}],2:[function(require,module,exports){
"use strict";function read(e){var o=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie);return o?o[1]:null}function write(e,o,r,i){var t=JSON.parse(read(e));i||(i=15),null===t&&(t=new CookieContainer_1.CookieContainer(i)),t.mapResponseAuth[o]=r;var n=new Date;n.setTime(n.getTime()+1*i*60*1e3);var a="; expires="+n.toUTCString();document.cookie=e+"="+JSON.stringify(t)+a+"; path=/"}function remove(e){write(e,"",null,-1)}function getSerial(e,o){var r=JSON.parse(read(e));if(r){var i=r.mapResponseAuth[o];if(isCookieValueValid(i,r.contentLifetime))return i}return null}function isCookieValueValid(e,o){return void 0!==e&&Date.now()-e.creationDate<=60*o*1e3}Object.defineProperty(exports,"__esModule",{value:!0});var CookieContainer_1=require("./CookieContainer");exports.read=read,exports.write=write,exports.remove=remove,exports.getSerial=getSerial,exports.isCookieValueValid=isCookieValueValid;

},{"./CookieContainer":3}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CookieContainer=function(){return function(e){this.contentLifetime=e,this.mapResponseAuth={}}}();exports.CookieContainer=CookieContainer;

},{}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CookieValue=function(){return function(e,t){this.host=e,this.access=t,this.creationDate=Date.now()}}();exports.CookieValue=CookieValue;

},{}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Authentification_1=require("./Authentification"),Authentification_2=require("./Authentification"),Tag=function(){function t(t){this._version="1.0.0",this._tagName="on-ts",t&&(this._serial=t,this._authentification=new Authentification_1.Authentification(this._serial))}return Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!0}),t.prototype.send=function(){var t=this;this._authentification.authenticate().then(function(e){t.sendRequest(e)}).catch(function(e){t.sendRequest(e)})},t.prototype.sendRequest=function(t){var e=Math.round(1e9*Math.random());if(Authentification_2.Access.FULL===this._authentification.getAccess()){var i=this._authentification.getEndpoint()+this._serial+"?n="+e+"&tn="+this._tagName+"&v="+this._version;document.createElement("img").src=i}},t}();exports.Tag=Tag;

},{"./Authentification":1}]},{},[5])(5)
});
