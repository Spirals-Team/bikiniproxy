/***************************************
* @preserve
* ForeSee Web SDK: Storage Frame
* Built September 01, 17 07:16:44
* Code version: 19.5.0
* Template version: 19.5.0
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("fs.utils.js")],function(t,s,e){e.preventUnloadFlag=!0;var i=function(t,s){this.br=t,this.useAlt=t.isIE||"Safari"==t.browser.name||!t.supportsLocalStorage,this._bidID=1,this._id=s,this._stgLimit=900,this._trnsInterval=25,this.altBits=[],this._localSets=[],this.channelOpen=new e.FSEvent};i.prototype.init=function(){if(this.useAlt){var t=e.getRootDomain();this._stg={};var i=new Date;i.setTime(i.getTime()+31536e6);var r={path:"/",domain:t,secure:!1,encode:!0,expires:i.toUTCString()};this._ck=new e.Cookie(r),this._ck.kill("fsr.STORAGE")}this._transportTimer=setInterval(s.proxy(function(){var t;this._ck?(this._ck.set("_fsuid",this._id),t=this._ck.get("_fruid")):(localStorage.setItem("_fsuid",this._id),t=localStorage.getItem("_fruid")),t==this._id&&this._finishInit()},this),5*this._trnsInterval)},i.prototype._finishInit=function(){var t,e=!1;clearInterval(this._transportTimer),this._ck?this._transportTimer=setInterval(s.proxy(function(){if(this.altBits.length>0){!this._ck.get("fsmsgrec")&&e||(e=!0,this._ck.kill("fsmsgrec"),t=JSON.stringify(this.altBits.shift()),this._ck.set("fsmsg",t))}},this),this._trnsInterval):this.br.supportsLocalStorage&&(this._transportTimer=setInterval(s.proxy(function(){for(;this._localSets.length>0;){var t=this._localSets.pop();this.br.supportsLocalStorage&&localStorage.setItem("__fsFr__"+t.key,t.val)}},this),150)),this.channelOpen.fire()},i.prototype.set=function(t,i,r){"string"!=typeof i&&(i=JSON.stringify({v:i,x:r})),this._localSets.push({key:t,val:i,exp:r}),this._ck&&this.channelOpen.subscribe(s.proxy(function(){this._stg[t]=i;for(var s=e.Compress.compress(i,encodeURIComponent),r="_"+Math.round(9999999*Math.random());s.length>0;)this.altBits.push({id:this._bidID++,t:r,k:t,d:s.substr(0,Math.min(this._stgLimit,s.length)),f:s.length<=this._stgLimit}),s=s.substr(Math.min(this._stgLimit,s.length))},this),!0,!0)},i.prototype.get=function(t){var s;return this._ck&&(s=this._ck.get(t)),!s&&this.br.supportsLocalStorage&&(s=localStorage.getItem(t)),s},i.prototype.kill=function(t){this._ck&&this._ck.kill(t),this.br.supportsLocalStorage&&localStorage.removeItem(t)};var r=function(t){this.br=t,this.securityError=new e.FSEvent,this.securityError.subscribe(s.proxy(function(){this._postMessage("securityerror",{})},this),!0),this.messageReceived=new e.FSEvent,e.Bind(window,"message",s.proxy(function(t){this._onMessage(t)},this),"*"),this._postMessage("ready",{});var i=!1;setInterval(s.proxy(function(){this._postMessage("ready",{}),i||document.cookie.toString().indexOf("fsIce=broke")>-1&&(i=!0,this._postMessage("trackerready",1))},this),250)};r.prototype._onMessage=function(t){var s,i,r,n,o;try{if(s=JSON.parse(t.data),o=s.method,i=s.params,void 0===o||void 0===i)return}catch(t){return}switch(r=i.skipencode,n=i.contenttype,o){case"broadcast":i&&i.key&&i.value&&this.messageReceived.fire(i.key,i.value,i.x);break;case"ajax":new e.AjaxTransport({url:i.url,method:i.method,skipEncode:r,contentType:n,success:function(t,s){return function(t){s._postMessage("ajaxreturn",{params:i,res:t,success:!0})}}(0,this),failure:function(t,s){return function(t){s._postMessage("ajaxreturn",{params:i,success:!1,res:t})}}(0,this),data:i.data}).send()}},r.prototype._postMessage=function(t,s){var e=JSON.stringify({src:"fsframe",method:t,params:s});window.parent.postMessage(e,"*")},s.winReady(function(){var t=new e.Browser;t.ready.subscribe(function(){var e=s.getParam("uid"),n=new r(t),o=new i(t,e);n.messageReceived.subscribe(s.proxy(o.set,o),!1,!1),o.init()},!0,!0)})});