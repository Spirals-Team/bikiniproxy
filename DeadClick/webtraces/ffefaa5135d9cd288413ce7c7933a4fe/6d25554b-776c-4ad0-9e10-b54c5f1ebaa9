/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.set");b.Util.require("s7sdk.common.IS");b.Util.require("s7sdk.common.ScrollableDiv");b.Util.require("s7sdk.common.Thumb");b.Util.require("s7sdk.utils.SwatchesParser");b.Util.require("s7sdk.common.ItemDesc");b.Util.require("s7sdk.common.Geometry");b.Util.require("s7sdk.common.Button");b.Util.require("s7sdk.event.Event");if(!b.set.SwatchesControl){b.set.SwatchesControl=function(c){arguments.callee.superclass.apply(this,[c,b.set.SwatchesControl.NS,c.constructor,b.set.Swatches.RESTRICTED_STYLES])};b.set.SwatchesControl.NS="s7sdk.set.SwatchesControl"}b.Class.inherits(b.set.SwatchesControl.NS,"s7sdk.ControlComponent");if(!b.set.Swatches){b.set.Swatches=function Swatches(e,g,n){b.Logger.log(b.Logger.CONFIG,"s7sdk.set.Swatches constructor - container: %0, settings: %1 , compId: %2",e,g,n);var l=!!arguments[3];n=(typeof n=="string"&&n.length)?n:"Swatches_"+b.Util.createUniqueId();arguments.callee.superclass.apply(this,[n,e,"div","s7swatches",g]);this.splitFrames={orientation:false};this.container=this.getParent();this.imageModifier=b.MediaSetParser.parseAssetForSetReq(this.asset).mod;if(this.size.width==0||this.size.height==0){this.size.width=parseInt(b.Util.css.getCss("s7swatches","width",this.id,null,this.container));this.size.height=parseInt(b.Util.css.getCss("s7swatches","height",this.id,null,this.container));if(!b.Util.isNumber(this.size.width)||!b.Util.isNumber(this.size.height)||this.size.width<=0||this.size.height<=0){this.size.width=500;this.size.height=250}}if(this.tmbSize.width==0||this.tmbSize.height==0){this.tmbSize.width=parseInt(b.Util.css.getCss("s7thumb","width",this.id,"s7swatches",this.container));this.tmbSize.height=parseInt(b.Util.css.getCss("s7thumb","height",this.id,"s7swatches",this.container));if(!b.Util.isNumber(this.tmbSize.width)||!b.Util.isNumber(this.tmbSize.height)||this.tmbSize.width<=0||this.tmbSize.height<=0){this.tmbSize.width=75;this.tmbSize.height=75}}if(typeof this.getParam("cellspacing")!="undefined"&&(this.getParam("cellspacing")!="")){}else{var f=0;var c=0;var j=0;var d=0;var m=["margin-left","margin-right"];var k=["margin-top","margin-bottom"];for(var h=0;h<m.length;h++){j=parseInt(b.Util.css.getCss("s7thumbcell",m[h],this.id,"s7swatches",this.container));if(b.Util.isNumber(j)){f+=j}}for(var h=0;h<k.length;h++){d=parseInt(b.Util.css.getCss("s7thumbcell",k[h],this.id,"s7swatches",this.container));if(b.Util.isNumber(d)){c+=d}}f=isNaN(f)?0:f;c=isNaN(c)?0:c;this.cellSpacing.horizontalSpacing=f;this.cellSpacing.verticalSpacing=c}this.BTN_LEFT_SIDE="leftSide";this.BTN_RIGHT_SIDE="rightSide";this.BTN_TOP_SIDE="topSide";this.BTN_BOTTOM_SIDE="bottomSide";this.SCROLL_BUTTON_TAP="tap";this.SCROLL_BUTTON_HOLD="hold";this.mediaSet_=null;this.totalWidth_=this.size.width;this.totalHeight_=this.size.height;this.currentPage_=new b.Point2D(0,0);this.rollover=false;this.buttonBehavior_=this.pageMode?this.SCROLL_BUTTON_TAP:"tap";this.scrollVelocity_=600;this.delay_=1;this.showSwatches_=true;this.leftButton_=null;this.rightButton_=null;this.upButton_=null;this.downButton_=null;this.maxTmbWid_=this.tmbSize.width;this.maxTmbHei_=this.tmbSize.height;this.buttonSize_=Math.max.apply(null,[["s7scrollleftbutton","width"],["s7scrollrightbutton","width"],["s7scrollupbutton","height"],["s7scrolldownbutton","height"]].map(function(i){return parseInt(b.Util.css.getCss(i[0],i[1],this.id,"s7swatches",this.container))},this))||0;this.fitCols_=NaN;this.fitRows_=NaN;this.assetName_=null;this.isReq_=null;this.swatches_=[];this.filteredSet_=[];this.swatchGroup_=null;this.scrollParentDiv_=null;this.swatchGroupRect_=null;this.currentSwatch_=null;this.itemIndex_=-1;this.locale=this.getParam("locale","");this.dir=this.direction=="auto"?this.locale=="ja":this.direction!="left";this.interval=this.getParam("interval",20);this.createElement();this.attachToContainer();this.setAsset(this.asset);this.viewReady=false;this.preloadInProgress=false;this.delay=50;this.queue=new Array();this.timer=setInterval(b.Util.wrapContext(this.onProcess,this),this.delay);this.displaySwatchTimer=null;if(!l){return new b.set.SwatchesControl(this)}else{return this}};b.Class.inherits("s7sdk.set.Swatches","s7sdk.UIComponent");b.set.Swatches.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},asset:{params:["imageSet"],defaults:[""],parseParams:false},aemmode:{params:["value"],defaults:[false],ranges:[[true,false]]},iscommand:{params:["value"],defaults:[""],parseParams:false},maxloadradius:{params:["value"],defaults:[1],ranges:["-1:"]},tmbSize:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true},tmbLayout:{params:["cols","rows"],defaults:[0,2],ranges:["0:","0:"]},cellSpacing:{params:["horizontalSpacing","verticalSpacing"],defaults:[10,10],ranges:["0:","0:"],deprecated:true},textPos:{params:["textpos"],defaults:["bottom"],ranges:[["bottom","top","left","right","tooltip","none"]]},resizable:{params:["enabled"],defaults:[false]},pageMode:{params:["enabled"],defaults:[false]},enableScrollButtons:{params:["enabled"],defaults:[true]},scrollStep:{params:["hStep","vStep"],defaults:[3,3],ranges:["1:","1:"]},enableDragging:{params:["enabled","overdragvalue"],defaults:[true,0.5],ranges:[,"0:1"]},buttonSnapMode:{params:["mode"],defaults:["snapout"],ranges:[["snapin","snapout","overlay"]]},partialSwatches:{params:["enabled"],defaults:[false]},orientation:{params:["rowMajor"],defaults:[false]},direction:{params:["direction"],defaults:["auto"],ranges:[["auto","left","right"]]},align:{params:["horizontal","vertical"],defaults:["center","center"],ranges:[["left","center","right"],["top","center","bottom"]]},fmt:{params:["fmt"],defaults:["jpg"],ranges:[["jpg","jpeg","png","png-alpha","gif","gif-alpha"]]},size:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true}};b.set.Swatches.RESTRICTED_STYLES={s7swatches:["width","height"],"s7swatches s7thumb":["width","height"],"s7swatches s7scrollleftbutton":["width","height"],"s7swatches s7scrollrightbutton":["width","height"],"s7swatches s7scrollupbutton":["width","height"],"s7swatches s7scrolldownbutton":["width","height"],"s7swatches s7thumbcell":["margin-left","margin-right","margin-top","margin-bottom","margin"],"s7swatches s7label":["font-family","font-size","font-style"]};b.set.Swatches.prototype.setCSS=function(e,d,c){if(this.isRestrictedCSSProperty(b.set.Swatches.RESTRICTED_STYLES,d)){throw new Error("You cannot set "+e+" : "+d+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[e,d,c])}};b.set.Swatches.prototype.setModifier=function(c){throw new Error("Trying to use setModifier on the Core class (Swatches) is unsupported! Please refer to SDK documentation on using setModifier.")};b.set.Swatches.prototype.setAsset=function(e){if(typeof e!="string"){throw new Error("Asset name must be represented by a string!")}b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.setAsset - assetName: %0",e);if(e==""){return}this.currentAsset=e;var c=unescape(e);if(this.assetName_!=null&&c!=this.assetName_){var d=new b.event.UserEvent(b.event.UserEvent.SWAP,[0,e],true);b.Event.dispatch(this.obj,d,false)}this.itemIndex_=-1;this.filteredSet_=[];this.assetName_=c;this.loadAsset()};b.set.Swatches.prototype.getAsset=function(){return(this.assetName_?this.assetName_:this.mediaSet_.name)};b.set.Swatches.prototype.getContainer=function(){return this.getParent()};b.set.Swatches.prototype.build=function(){var e=this.getCurrentPage();this.filteredSet_=this.splitFrames.orientation?this.filteredSet_P:this.filteredSet_L;if(this.scrollParentDiv_!=null){if(this.swatchGroup_){this.swatchGroup_.dispose()}this.obj.removeChild(this.scrollParentDiv_);this.scrollParentDiv_=null;this.swatchGroup_=null}d(this.leftButton_);d(this.rightButton_);d(this.upButton_);d(this.downButton_);function d(f){if(f&&f.obj&&f.obj.parentNode){f.obj.parentNode.removeChild(f.obj)}}this.attachToContainer();if(this.filteredSet_&&this.filteredSet_.length){this.initSwatches();this.layoutSwatches();this.obj.insertBefore(this.scrollParentDiv_,this.obj.firstChild);if(this.currentSwatch_){this.selectSwatch(this.itemIndex_,true);if(this.swatches_[this.itemIndex_]!=null&&this.swatchGroup_){this.applySwatchSelection(this.swatches_[this.itemIndex_],true,null,true)}}var c=this.getCurrentPage();if(e&&c&&(e.x!=c.x||e.y!=c.y)){this.dispatchEvent(new b.event.SwatchEvent(b.event.SwatchEvent.SWATCH_PAGE_CHANGE,this.getCurrentPage(),false))}}};b.set.Swatches.prototype.getObjRect=function(d){var c=d.getBoundingClientRect();c=new b.Rectangle(c.left,c.top,d.offsetWidth,d.offsetHeight);return c};b.set.Swatches.prototype.getNextToLoad=function(){if(!this.toLoad||this.toLoad.length==0){return}if(!this.swatchGroup_){return}var k=new Array();for(var g=0;g<this.toLoad.length;g++){var m=this.toLoad[g];if(!(this.swatches_[m].isLoading||this.swatches_[m].isComlete)){k.push(m)}}this.toLoad=k;var l=this.getObjRect(this.swatchGroup_.div);var h=this.getObjRect(this.scrollParentDiv_);h.x=h.x-l.x;h.y=h.y-l.y;this.checkForload=function(){for(var q=0;q<this.toLoad.length;q++){var p=this.toLoad[q];if(this.swatchesPositions[p]&&this.swatchesPositions[p].rect){var o=h.intersection(this.swatchesPositions[p].rect);if(o.width==0||o.height==0||this.swatches_[p].isLoading||this.swatches_[p].isComlete){continue}return this.swatches_[p]}}return null};this.allVisisbleLoaded=function(){for(var q=0;q<this.toLoad.length;q++){var p=this.toLoad[q];if(this.swatchesPositions[p]&&this.swatchesPositions[p].rect){var o=h.intersection(this.swatchesPositions[p].rect);if(o.width==0||o.height==0){continue}if(!this.swatches_[p].isComlete){return false}}}return true};var n=this.checkForload();if(n){return n}if(!this.viewReady&&this.allVisisbleLoaded()){this.viewReady=true;var e=new b.event.StatusEvent(b.event.StatusEvent.NOTF_VIEW_READY,true);b.Event.dispatch(this.obj,e,false)}var j=this.maxloadradius==0?0:(Math.ceil(this.maxloadradius)-0.5);if(j==0){return null}var c=(this.maxTmbWid_+this.cellSpacing.horizontalSpacing)*j;var f=(this.maxTmbHei_+this.cellSpacing.verticalSpacing)*j;h.x-=c;h.width+=2*c;h.y-=f;h.height+=2*f;var d=this.checkForload();return d};b.set.Swatches.prototype.onProcess=function(){var e=new Array();for(var d=0;d<3;d++){var f=this.queue[d];if(f!=null&&!f.isComlete){e.push(f)}else{var f=this.getNextToLoad();if(f){f.loadImage();e.push(f)}}}this.queue=e;if(this.maxloadradius!=0){this.preloadComplete=function(){for(var g=0;g<this.swatches_.length;g++){if(this.swatches_[g].isLoading){return false}}return true};if(!this.preloadComplete()){if(!this.preloadInProgress){var c=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_START,true);b.Event.dispatch(this.obj,c,false)}this.preloadInProgress=true}else{if(this.preloadInProgress){this.preloadInProgress=false;var c=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);b.Event.dispatch(this.obj,c,false)}}}};b.set.Swatches.prototype.cleanUp=function(){if(this.isReq_){this.isReq_.cancelHttpReq();this.isReq_=null}if(this.timer){clearInterval(this.timer);this.timer=null}if(this.displaySwatchTimer){clearTimeout(this.displaySwatchTimer);this.displaySwatchTimer=null}this.swatches_=[];this.currentSwatch_=null;this.toLoad=[];this.itemIndex_=-1;this.filteredSet_=[];if(this.scrollParentDiv_!=null){if(this.swatchGroup_){this.swatchGroup_.dispose()}this.obj.removeChild(this.scrollParentDiv_);this.scrollParentDiv_=null;this.swatchGroup_=null}c(this.leftButton_);c(this.rightButton_);c(this.upButton_);c(this.downButton_);function c(d){if(d&&d.getObj()&&d.getObj().parentNode){d.getObj().parentNode.removeChild(d.getObj())}}this.obj.style.cssText=""};b.set.Swatches.prototype.dispose=function(){this.cleanUp();if(this.obj!=null&&this.obj.parentNode!=null){this.obj.parentNode.removeChild(this.obj)}};b.set.Swatches.prototype.setMediaSet=function(f,e){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.setMediaSet - mediaSet: %0, type: %1",f,e);e=(typeof e=="number")?e:0;this.cleanUp();this.obj.setWidth(this.size.width);this.obj.setHeight(this.size.height);this.obj.style.position="absolute";this.timer=setInterval(b.Util.wrapContext(this.onProcess,this),this.delay);this.itemIndex_=-1;this.assetName_=null;var c=f;if(!(f instanceof b.OrientationSetDesc)){c=new b.OrientationSetDesc(c,null)}this.mediaSet_=c;this.currentAsset=c;this.filteredSet_L=b.SwatchesParser.filterSet(c.landscape,e,this.showSwatches_);this.filteredSet_P=b.SwatchesParser.filterSet(c.portrait,e,this.showSwatches_);this.build();var d=new b.event.StatusEvent(b.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);b.Event.dispatch(this.obj,d,false)};b.set.Swatches.prototype.getIndexFromItem=function(f){if(this.mediaSet_==null){throw new Error("Cannot get index of item because media-set is does not exist!")}var e=-1;var d=this.filteredSet_;for(var c=0;c<d.length;c++){if(d[c].name==f.name){e=c;break}}return e};b.set.Swatches.prototype.applyItem=function(d){var c=this.getIndexFromItem(d);if(c<0){throw new Error("Cannot apply item because it does not exist in set!")}this.selectSwatch(c)};b.set.Swatches.prototype.loadAsset=function(){b.Logger.log(b.Logger.INFO,"s7sdk.set.Swatches.loadAsset");var c=this.serverUrl+"/"+b.MediaSetParser.parseAssetForSetReq(this.assetName_).req;if(b.Util.isNonEmptyString(this.locale)){c+="&locale="+this.locale}if(this.isReq){this.isReq.cancelHttpReq()}this.isReq_=new b.IS(this.serverUrl,this.assetName_);this.isReq_.getHttpReq(c,function(e,d){b.set.Swatches.prototype.setRequestComplete.apply(d,[e])},function(e,d){b.set.Swatches.prototype.setRequestError.apply(d,[e])},this)};b.set.Swatches.prototype.setRequestComplete=function(d){var c=d.set;if(c==null){return}var e=b.MediaSetParser.parse(c,this.imageModifier,this.aemmode,this.dir);this.updateLandscapeLabels(e," - ");this.setMediaSet(e)};b.set.Swatches.prototype.updateLandscapeLabels=function(d,g){var f=d.items;var e=d.type!==b.ItemDescType.ECAT_SET;g=g?g:" : ";for(var h=0;h<f.length;h++){var j=f[h];var c=j.label;var k=undefined;if(j.images){if(j.images[0].label){c=j.images[0].label}if(j.images[1]&&j.images[1].label){k=j.images[1].label}}j.label=c;if(j.np||e){if(!j.label){j.label=k?k:""}}else{if(j.label){j.label+=k?g+k:""}else{j.label=k?k:""}}if(!j.label){j.label=""}}};b.set.Swatches.prototype.setRequestError=function(c){b.Logger.log(b.Logger.WARNING,"s7sdk.set.Swatches.setRequestError - response: %0",c)};b.set.Swatches.prototype.initSwatches=function(){var g;var f;var d;this.swatches_=[];this.toLoad=new Array();for(var e=0,c=0;e<this.filteredSet_.length;e++){g=this.filteredSet_[e];f=g.swatch;d=new b.Thumb(this.obj,this.serverUrl,this.iscommand,f,this.tmbSize.width,this.tmbSize.height,this.fmt,-1,0,undefined,this.textPos,this.cl,this.locale,undefined,undefined,this.maxloadradius>=0,g.type);this.maxTmbWid_=(d.getWidth()<this.maxTmbWid_)?this.maxTmbWid_:d.getWidth();this.maxTmbHei_=(d.getHeight()<this.maxTmbHei_)?this.maxTmbHei_:d.getHeight();this.swatches_[f.frame]=d;if(g.type!=b.ItemDescType.EMPTY){this.toLoad[c]=e;c+=1}d.div.style.margin=0+"px"}};b.set.Swatches.prototype.resize=function(d,c){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.resize - width: %0, height: %1",d,c);this.totalWidth_=d;this.totalHeight_=c;this.size.width=d;this.size.height=c;this.obj.setWidth(this.totalWidth_);this.obj.setHeight(this.totalHeight_);this.isResized=true;this.build();this.isResized=false;b.UIComponent.prototype.resize.apply(this,[d,c])};b.set.Swatches.prototype.layoutSwatches=function(){var c=(!this.resizable&&this.enableScrollButtons&&this.buttonSnapMode!="overlay"&&this.buttonSize_)?this.buttonSize_:0;if(this.size.width!=0){var l=Math.floor((this.size.width-this.cellSpacing.horizontalSpacing)/(this.maxTmbWid_+this.cellSpacing.horizontalSpacing));if(this.tmbLayout.cols!=0&&this.tmbLayout.cols<=l){l=this.tmbLayout.cols}}else{l=this.tmbLayout.cols}if(this.size.height!=0){var h=Math.floor((this.size.height-this.cellSpacing.verticalSpacing)/(this.maxTmbHei_+this.cellSpacing.verticalSpacing));if(this.tmbLayout.rows!=0&&this.tmbLayout.rows<=h){h=this.tmbLayout.rows}}else{h=this.tmbLayout.rows}this.fitCols_=l;this.fitRows_=(h==0)?1:h;while(l*h<this.swatches_.length&&(this.tmbLayout.cols==0||this.tmbLayout.rows==0||l<this.tmbLayout.cols||h<this.tmbLayout.rows)){if(this.orientation==0){if(this.tmbLayout.cols==0||l<this.tmbLayout.cols){l++}if(h==0||(h*l<this.swatches_.length&&(this.tmbLayout.rows==0||h<this.tmbLayout.rows))){h++}}else{if(this.tmbLayout.rows==0||h<this.tmbLayout.rows){h++}if(l==0||(h*l<this.swatches_.length&&(this.tmbLayout.cols==0||l<this.tmbLayout.cols))){l++}}}if(l>this.fitCols_){this.fitCols_=Math.floor((this.size.width-this.cellSpacing.horizontalSpacing-2*c)/(this.maxTmbWid_+this.cellSpacing.horizontalSpacing))}if(h>this.fitRows_){this.fitRows_=Math.floor((this.size.height-this.cellSpacing.verticalSpacing-2*c)/(this.maxTmbHei_+this.cellSpacing.verticalSpacing))}if(!this.resizable&&(this.fitCols_<=0||this.fitRows_<=0)){b.Logger.log(b.Logger.WARNING,"s7sdk.set.Swatches.layoutSwatches - Cannot fit any swatches into the given area: width %0 height %1",this.size.width,this.size.height);this.createScrollParentDiv(0,0)}var E=NaN;var B=NaN;var u=0;var o=0;var A=0;var z=0;var x=NaN;var q;this.swatchGroup_=new b.ScrollableDiv(this,this.enableDragging.enabled,new b.Point2D(this.fitCols_*(this.cellSpacing.horizontalSpacing+this.maxTmbWid_),this.fitRows_*(this.cellSpacing.verticalSpacing+this.maxTmbHei_)),this.interval,this.pageHandler,this.enableDragging.overdragvalue,this.pageMode);var e=[];for(var x=0;x<this.swatches_.length&&x<l*h;x++){if(this.orientation==0){E=Math.floor(x/l);B=x%l;e[x]={col:B,row:E}}else{B=Math.floor(x/h);E=x%h;e[x]={col:B,row:E}}u=(u<E)?E:u;o=(o<B)?B:o}u++;o++;if(this.pageMode){var y=Math.ceil(o/this.fitCols_);var D=Math.ceil(u/this.fitRows_);e=[];if(this.orientation==0){for(var w=0;w<y;w++){for(var x=0;x<D;x++){var C=(w+x*y)*(this.fitRows_*this.fitCols_);for(var v=0;v<this.fitCols_;v++){for(var s=0;s<this.fitRows_;s++){var n=v+s*this.fitCols_+C;e[n]={col:v+w*this.fitCols_,row:(this.dir?this.fitRows_-1-s:s)+(this.dir?D-1-x:x)*this.fitRows_}}}}}}else{for(var w=0;w<D;w++){for(var x=0;x<y;x++){var C=(w+x*D)*(this.fitRows_*this.fitCols_);for(var v=0;v<this.fitRows_;v++){for(var s=0;s<this.fitCols_;s++){var n=v+s*this.fitRows_+C;e[n]={col:s+x*this.fitCols_,row:(this.dir?this.fitRows_-1-v:v)+(this.dir?D-1-w:w)*this.fitRows_}}}}}}if(this.dir){var f=new Array();for(var w=0;w<e.length;w++){f[e.length-1-w]=e[w]}e=f}}else{if(this.dir){for(var x=0;x<this.swatches_.length&&x<l*h;x++){e[x].col=o-1-e[x].col}}}for(var x=0;x<this.swatches_.length&&x<l*h;x++){q=this.swatches_[x];q.x=this.cellSpacing.horizontalSpacing/2+e[x].col*(this.maxTmbWid_+this.cellSpacing.horizontalSpacing);if(this.textPos==b.Thumb.TEXT_LEFT){q.x+=this.maxTmbWid_-q.getWidth()}q.y=this.cellSpacing.verticalSpacing/2+e[x].row*(this.maxTmbHei_+this.cellSpacing.verticalSpacing);if(this.textPos==b.Thumb.TEXT_TOP){q.y+=this.maxTmbHei_-q.getHeight()}this.swatchGroup_.div.appendChild(q.div);q.div.style.position="absolute";q.updatePosition();if(q.item.owner.type!=b.ItemDescType.EMPTY){function t(i,j){b.Event.addDOMListener(j.div,"mouseup",function(k){i.onSwatchClicked(k,j)},true);b.Event.addDOMListener(j.div,"touchend",function(k){i.onSwatchClicked(k,j)},true)}t(this,q)}if(A<q.x){A=q.x}if(z<q.y){z=q.y}e[x].rect=new b.Rectangle(q.x,q.y,this.maxTmbWid_,this.maxTmbHei_)}this.swatchesPositions=e;if(this.pageMode){this.swatchGroup_.xNotch=this.fitCols_*(this.cellSpacing.horizontalSpacing+this.maxTmbWid_);this.swatchGroup_.yNotch=this.fitRows_*(this.cellSpacing.verticalSpacing+this.maxTmbHei_);this.scrollStep.hStep=this.fitCols_;this.scrollStep.vStep=this.fitRows_}else{if(!this.partialSwatches){this.swatchGroup_.xNotch=(this.cellSpacing.horizontalSpacing+this.maxTmbWid_);this.swatchGroup_.yNotch=(this.cellSpacing.verticalSpacing+this.maxTmbHei_)}else{this.swatchGroup_.xNotch=1;this.swatchGroup_.yNotch=1}}var d=this.cellSpacing.horizontalSpacing+o*(this.cellSpacing.horizontalSpacing+this.maxTmbWid_);var g=this.cellSpacing.verticalSpacing+u*(this.cellSpacing.verticalSpacing+this.maxTmbHei_);if(this.pageMode){var r=this.fitCols_*(this.maxTmbWid_+this.cellSpacing.horizontalSpacing);var p=this.fitRows_*(this.maxTmbHei_+this.cellSpacing.verticalSpacing);this.swatchGroup_.setLogicalWidth(Math.ceil(A/r)*r);this.swatchGroup_.setLogicalHeight(Math.ceil(z/p)*p)}else{this.swatchGroup_.setLogicalWidth(A+this.cellSpacing.horizontalSpacing/2+this.maxTmbWid_);this.swatchGroup_.setLogicalHeight(z+this.cellSpacing.verticalSpacing/2+this.maxTmbHei_)}if(this.resizable){this.obj.setWidth(d);this.obj.setHeight(g);this.createScrollParentDiv(d,g);this.scrollParentDiv_.appendChild(this.swatchGroup_.div);this.scrollParentDiv_.setX(0);this.scrollParentDiv_.setY(0)}else{this.swatchGroupRect_=new b.Rectangle(0,0,Math.max(Math.min(this.swatchGroup_.scrollBounds.x,d),0),Math.max(Math.min(this.swatchGroup_.scrollBounds.y,g),0));this.createScrollParentDiv(this.swatchGroupRect_.width,this.swatchGroupRect_.height);this.scrollParentDiv_.appendChild(this.swatchGroup_.div);switch(this.align.horizontal){case"center":this.scrollParentDiv_.setX((this.totalWidth_-this.swatchGroupRect_.width)/2);break;case"right":if(this.swatchGroup_.getLogicalWidth()>this.swatchGroup_.scrollBounds.x&&this.fitCols_){this.scrollParentDiv_.setX((this.totalWidth_-this.swatchGroupRect_.width)-c)}else{this.scrollParentDiv_.setX((this.totalWidth_-this.swatchGroupRect_.width)-0)}break;case"left":if(this.swatchGroup_.getLogicalWidth()>this.swatchGroup_.scrollBounds.x&&this.fitCols_){this.scrollParentDiv_.setX(c)}else{this.scrollParentDiv_.setX(0)}break;default:this.scrollParentDiv_.setX((this.totalWidth_-this.swatchGroupRect_.width)/2)}switch(this.align.vertical){case"center":this.scrollParentDiv_.setY((this.totalHeight_-this.swatchGroupRect_.height)/2);break;case"top":if((this.swatchGroup_.getLogicalHeight()>this.swatchGroup_.scrollBounds.y&&this.fitRows_)&&this.enableScrollButtons){this.scrollParentDiv_.setY(c)}else{this.scrollParentDiv_.setY(0)}break;case"bottom":if((this.swatchGroup_.getLogicalHeight()>this.swatchGroup_.scrollBounds.y&&this.fitRows_)&&this.enableScrollButtons){this.scrollParentDiv_.setY((this.totalHeight_-this.swatchGroupRect_.height)-c)}else{this.scrollParentDiv_.setY((this.totalHeight_-this.swatchGroupRect_.height)-0)}break;default:this.scrollParentDiv_.setY((this.totalHeight_-this.swatchGroupRect_.height)/2)}this.layoutButtons()}this.swatchGroup_.layout();if(this.dir&&!this.resizable){this.swatchGroup_.slideToImmediately(new b.Point2D(this.swatchGroupRect_.width-this.swatchGroup_.getLogicalWidth(),0));this.swatchGroup_.velocityXAdjusted_=true}};b.set.Swatches.prototype.pageHandler=function(){this.dispatchEvent(new b.event.SwatchEvent(b.event.SwatchEvent.SWATCH_PAGE_CHANGE,this.getCurrentPage(),false))};b.set.Swatches.prototype.getCurrentPage=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.getCurrentPage");if(this.swatchGroup_){this.currentPage_=this.swatchGroup_.getCurrentPage()}return this.currentPage_};b.set.Swatches.prototype.setCurrentPage=function(c){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.setCurrentPage - page: %0",c);this.currentPage_=c;if(this.swatchGroup_){this.swatchGroup_.setCurrentPage(c)}};b.set.Swatches.prototype.getPageCount=function(){var c=new b.Point2D();if(this.swatchGroup_){c=this.swatchGroup_.getPageCount()}return c};b.set.Swatches.prototype.onSwatchClicked=function(d,c){if(this.swatchGroup_.getInterpretAsClick()||this.rollOver_){this.itemIndex_=c.item.frame;if(c!=this.currentSwatch_){this.dispatchEvent(new b.event.UserEvent(b.event.UserEvent.SWATCH,[c.item.frame,c.item.label?c.item.label:""],false))}this.applySwatchSelection(c,false,true)}};b.set.Swatches.prototype.displaySwatch=function(j,d,c){var g=0;var e=0;var i=this.swatchGroup_.scrollBounds.x/2;if(d){i=(this.dir)?this.swatchGroup_.scrollBounds.x-this.tmbSize.width:0}var h=d?0:this.swatchGroup_.scrollBounds.y/2;if(j.x>i&&j.x<(this.swatchGroup_.getLogicalWidth()-i)){g=-j.x+i}else{if(j.x>=(this.swatchGroup_.getLogicalWidth()-i)){g=-this.swatchGroup_.getLogicalWidth()+this.swatchGroup_.scrollBounds.x}}if(j.y>h&&j.y<(this.swatchGroup_.getLogicalHeight()-h)){e=-j.y+h}else{if(j.y>=(this.swatchGroup_.getLogicalHeight()-h)){e=-this.swatchGroup_.getLogicalHeight()+this.swatchGroup_.scrollBounds.y}}var k=this;function f(){if(k.swatchGroup_){if(d&&c){k.swatchGroup_.slideToImmediately(new b.Point2D(g,e));k.swatchGroup_.positionOvershootToEdge()}else{k.swatchGroup_.slideTo(new b.Point2D(g,e))}}}this.displaySwatchTimer=setTimeout(f,100)};b.set.Swatches.prototype.applySwatchSelection=function(d,c,g){c=(typeof c!="undefined")?c:false;g=(typeof g!="undefined")?g:false;if(d==this.currentSwatch_){return}if(this.currentSwatch_!=null){this.currentSwatch_.setSelected(false)}this.currentSwatch_=d;this.currentSwatch_.setSelected(true);if(c){this.displaySwatch(d,false)}if(!this.orientationChanged&&!this.isResized){var f=d.item.owner;var e=new b.event.AssetEvent(b.event.AssetEvent.SWATCH_SELECTED_EVENT,f,d.item.frame,false);e.orientation=this.splitFrames.orientation;this.dispatchEvent(e)}this.orientationChanged=false};b.set.Swatches.prototype.addEventListener=function(e,d,c){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.addEventListener - type: %0, handler: %1, useCapture: %2",e,d.toString().substring(0,d.toString().indexOf("(")),c);this.superproto.addEventListener.apply(this,[e,d,c])};b.set.Swatches.prototype.selectSwatch=function(c,d){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.selectSwatch - index: %0, triggerScroll: %1",c,d);if(c==-1){if(this.currentSwatch_!=null){this.currentSwatch_.setSelected(false);this.currentSwatch_=null}}else{d=(typeof d!="undefined")?d:false;this.itemIndex_=c;if(this.swatches_[c]!=null&&this.swatchGroup_){this.applySwatchSelection(this.swatches_[c],d,null)}}};b.set.Swatches.prototype.placeButton=function(d,e,c){var f=new b.Rectangle(0,0,this.buttonSize_,this.buttonSize_);switch(c){case this.BTN_LEFT_SIDE:d.x=e.x;d.y=e.y+(e.height-f.height)/2;break;case this.BTN_RIGHT_SIDE:d.x=e.getRight()-f.width;d.y=e.y+(e.height-f.height)/2;break;case this.BTN_TOP_SIDE:d.x=e.x+(e.width-f.width)/2;d.y=e.y;break;case this.BTN_BOTTOM_SIDE:d.x=e.x+(e.width-f.width)/2;d.y=e.getBottom()-f.height;break}d.x-=f.x;d.y-=f.y;d.getObj().style.position="absolute";d.getObj().style.left=d.x+"px";d.getObj().style.top=d.y+"px"};b.set.Swatches.prototype.layoutButtons=function(){var e;var d=this.scrollParentDiv_.getX();var f=this.scrollParentDiv_.getY();switch(this.buttonSnapMode){default:case"overlay":e=new b.Rectangle(d+5,f+5,this.swatchGroup_.scrollBounds.x-10,this.swatchGroup_.scrollBounds.y-10);break;case"snapin":e=new b.Rectangle(d-this.buttonSize_-2,f-this.buttonSize_-2,this.swatchGroup_.scrollBounds.x+2*this.buttonSize_+4,this.swatchGroup_.scrollBounds.y+2*this.buttonSize_+4);break;case"snapout":e=new b.Rectangle(2,2,this.size.width-4,this.size.height-4);break}if(this.swatchGroup_.getLogicalWidth()>this.swatchGroup_.scrollBounds.x&&this.fitCols_){this.swatchGroup_.scrollX=true;if(this.enableScrollButtons){this.leftButton_=new b.ScrollLeftButton(this.obj.id,this.settings,"leftButton_"+b.Util.createUniqueId(),true);this.rightButton_=new b.ScrollRightButton(this.obj.id,this.settings,"rightButton_"+b.Util.createUniqueId(),true);this.placeButton(this.leftButton_,e,this.BTN_LEFT_SIDE);this.placeButton(this.rightButton_,e,this.BTN_RIGHT_SIDE);var c=this;b.Event.addDOMListener(this.leftButton_,"mouseup",function(g){g=g||window.event;c.buttonClick(g,c.leftButton_)});b.Event.addDOMListener(this.leftButton_,"touchend",function(g){g=g||window.event;c.buttonClick(g,c.leftButton_)});b.Event.addDOMListener(this.rightButton_,"mouseup",function(g){g=g||window.event;c.buttonClick(g,c.rightButton_)});b.Event.addDOMListener(this.rightButton_,"touchend",function(g){g=g||window.event;c.buttonClick(g,c.rightButton_)})}}if(this.swatchGroup_.getLogicalHeight()>this.swatchGroup_.scrollBounds.y&&this.fitRows_){this.swatchGroup_.scrollY=true;if(this.enableScrollButtons){this.upButton_=new b.ScrollUpButton(this.obj.id,this.settings,"upButton_"+b.Util.createUniqueId(),true);this.downButton_=new b.ScrollDownButton(this.obj.id,this.settings,"downButton_"+b.Util.createUniqueId(),true);this.placeButton(this.upButton_,e,this.BTN_TOP_SIDE);this.placeButton(this.downButton_,e,this.BTN_BOTTOM_SIDE);var c=this;b.Event.addDOMListener(this.upButton_,"mouseup",function(g){g=g||window.event;c.buttonClick(g,c.upButton_)});b.Event.addDOMListener(this.upButton_,"touchend",function(g){g=g||window.event;c.buttonClick(g,c.upButton_)});b.Event.addDOMListener(this.downButton_,"mouseup",function(g){g=g||window.event;c.buttonClick(g,c.downButton_)});b.Event.addDOMListener(this.downButton_,"touchend",function(g){g=g||window.event;c.buttonClick(g,c.downButton_)})}}};b.set.Swatches.prototype.buttonClick=function(d,c){if(this.buttonBehavior_==this.SCROLL_BUTTON_HOLD){return}if(!c.getActivated()){return}if(c===this.leftButton_){this.buttonClick_("left")}if(c===this.rightButton_){this.buttonClick_("right")}if(c===this.upButton_){this.buttonClick_("up")}if(c===this.downButton_){this.buttonClick_("down")}};b.set.Swatches.prototype.buttonClick_=function(i){var c=Math.min(this.scrollStep.hStep,this.scrollParentDiv_.getWidth()/(this.cellSpacing.horizontalSpacing+this.maxTmbWid_));var e=Math.min(this.scrollStep.vStep,this.scrollParentDiv_.getHeight()/(this.cellSpacing.verticalSpacing+this.maxTmbHei_));var g=Math.floor(c*(this.cellSpacing.horizontalSpacing+this.maxTmbWid_));var d=Math.floor(e*(this.cellSpacing.verticalSpacing+this.maxTmbHei_));var h=NaN;var f=NaN;if(i==="left"){h=this.swatchGroup_.getScrollDest().x+g}if(i==="right"){h=this.swatchGroup_.getScrollDest().x-g}if(i==="up"){f=this.swatchGroup_.getScrollDest().y+d}if(i==="down"){f=this.swatchGroup_.getScrollDest().y-d}if(!isNaN(h)){if(h>=0){h=0}if(h<=this.swatchGroupRect_.width-this.swatchGroup_.getLogicalWidth()){h=this.swatchGroupRect_.width-this.swatchGroup_.getLogicalWidth()}this.swatchGroup_.slideTo(new b.Point2D(h,this.swatchGroup_.getY()))}if(!isNaN(f)){if(f>=0){f=0}if(f<=this.swatchGroupRect_.height-this.swatchGroup_.getLogicalHeight()){f=this.swatchGroupRect_.height-this.swatchGroup_.getLogicalHeight()}this.swatchGroup_.slideTo(new b.Point2D(this.swatchGroup_.getX(),f))}};b.set.Swatches.prototype.toggleLeftButton=function(c){if(this.leftButton_){c?this.leftButton_.activate():this.leftButton_.deactivate()}};b.set.Swatches.prototype.toggleRightButton=function(c){if(this.rightButton_){c?this.rightButton_.activate():this.rightButton_.deactivate()}};b.set.Swatches.prototype.toggleUpButton=function(c){if(this.upButton_){c?this.upButton_.activate():this.upButton_.deactivate()}};b.set.Swatches.prototype.toggleDownButton=function(c){if(this.downButton_){c?this.downButton_.activate():this.downButton_.deactivate()}};b.set.Swatches.prototype.getWidth=function(){return this.totalWidth_};b.set.Swatches.prototype.getHeight=function(){return this.totalHeight_};b.set.Swatches.prototype.getDiv=function(){return this.obj};b.set.Swatches.prototype.getFrame=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.getFrame");return this.itemIndex_};b.set.Swatches.prototype.createElement=function(){b.UIComponent.prototype.createElement.apply(this,[]);this.obj=this.prepareDiv(this.obj);this.obj.setWidth(this.totalWidth_);this.obj.setHeight(this.totalHeight_);this.obj.className="s7swatches";this.obj.style.position="absolute";b.Event.addDOMListener(this.obj,"click",function(c){c=c||window.event;b.Event.preventDefault(c)},true)};b.set.Swatches.prototype.createScrollParentDiv=function(d,c){if(this.scrollParentDiv_==null){this.scrollParentDiv_=this.prepareDiv();this.scrollParentDiv_.setWidth(d);this.scrollParentDiv_.setHeight(c);this.scrollParentDiv_.style.position="absolute";this.scrollParentDiv_.style.overflow="hidden"}};b.set.Swatches.prototype.prepareDiv=function(c){var d=(c&&typeof c!="undefined")?c:document.createElement("div");d.getX=function(){return d.x_};d.getY=function(){return d.y_};d.setX=function(e){d.x_=e;d.style.left=e+"px"};d.setY=function(e){d.y_=e;d.style.top=e+"px"};d.getWidth=function(){return d.width_};d.getHeight=function(){return d.height_};d.setWidth=function(e){d.width_=e;d.style.width=e+"px"};d.setHeight=function(e){d.height_=e;d.style.height=e+"px"};return d};b.set.Swatches.prototype.hide=function(){b.Util.fade(this.obj,true,0.3,"block")};b.set.Swatches.prototype.show=function(){b.Util.fade(this.obj,false,0.3,"block")};b.set.Swatches.prototype.getCurrentAsset=function(){return typeof this.currentAsset=="undefined"?null:this.currentAsset};b.set.Swatches.prototype.setCurrentAsset=function(c){if(typeof(c)=="string"){this.setAsset(c)}else{this.setMediaSet(c)}};b.set.Swatches.prototype.setPortrait=function(){this.setSplitFrames(true)};b.set.Swatches.prototype.setLandscape=function(){this.setSplitFrames(false)};b.set.Swatches.prototype.setSplitFrames=function(d){if(this.splitFrames.orientation==d){return d}if(this.mediaSet_.portrait==null){this.splitFrames.orientation=false;return false}this.splitFrames.orientation=d;if(this.mediaSet_){this.orientationChanged=true;var c=this.getFrame();this.itemIndex_=d?this.mediaSet_.getPortraitIndex(c):this.mediaSet_.getLandscapeIndex(c);this.build()}return d};b.Swatches=b.set.Swatches;(function a(){var g=b.Util.css.createCssRuleText;var d=b.Util.css.createCssImgUrlText;var e=b.browser&&b.browser.name=="ie"&&b.browser.version.major<=8;var f={display:"block",position:"absolute",top:"0px",left:"0px",width:"20px",height:"20px"};var c=g(".s7swatches",{"background-color":e?"rgb(224, 224, 224)":"rgba(100, 100, 100, 0.2)","z-index":"0","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)",width:"500px",height:"250px"})+g(".s7swatches .s7thumbcell",{margin:"5px"})+g(".s7swatches .s7thumbcell[type='none']",{border:"none !important","background-color":"transparent !important","pointer-events":"none !important"})+g(".s7swatches .s7thumb",{border:"1px solid transparent",width:"75px",height:"75px"})+g(".s7swatches .s7thumb[state='selected']",{border:"1px solid #FFFFFF"})+g(".s7swatches .s7thumb .s7thumboverlay",{width:"100%",height:"100%"})+g(".s7swatches .s7thumb .s7thumboverlay[type='swatchset']",{"background-image":d("asset_type_swatches.png")})+g(".s7swatches .s7thumb .s7thumboverlay[type='spinset']",{"background-image":d("asset_type_spin.png")})+g(".s7swatches .s7thumb .s7thumboverlay[type='video']",{"background-image":d("asset_type_video.png")})+g(".s7swatches .s7label",{"font-family":"Helvetica, sans-serif","font-size":"12px"})+g(".s7swatches .s7scrollleftbutton",f)+g(".s7swatches .s7scrollleftbutton[state='up']",{"background-image":d("scroll_left_up.png")})+g(".s7swatches .s7scrollleftbutton[state='over']",{"background-image":d("scroll_left_over.png")})+g(".s7swatches .s7scrollleftbutton[state='down']",{"background-image":d("scroll_left_down.png")})+g(".s7swatches .s7scrollleftbutton[state='disabled']",{"background-image":d("scroll_left_disabled.png")})+g(".s7swatches .s7scrollrightbutton",f)+g(".s7swatches .s7scrollrightbutton[state='up']",{"background-image":d("scroll_right_up.png")})+g(".s7swatches .s7scrollrightbutton[state='over']",{"background-image":d("scroll_right_over.png")})+g(".s7swatches .s7scrollrightbutton[state='down']",{"background-image":d("scroll_right_down.png")})+g(".s7swatches .s7scrollrightbutton[state='disabled']",{"background-image":d("scroll_right_disabled.png")})+g(".s7swatches .s7scrollupbutton",f)+g(".s7swatches .s7scrollupbutton[state='up']",{"background-image":d("scroll_up_up.png")})+g(".s7swatches .s7scrollupbutton[state='over']",{"background-image":d("scroll_up_over.png")})+g(".s7swatches .s7scrollupbutton[state='down']",{"background-image":d("scroll_up_down.png")})+g(".s7swatches .s7scrollupbutton[state='disabled']",{"background-image":d("scroll_up_disabled.png")})+g(".s7swatches .s7scrolldownbutton",f)+g(".s7swatches .s7scrolldownbutton[state='up']",{"background-image":d("scroll_down_up.png")})+g(".s7swatches .s7scrolldownbutton[state='over']",{"background-image":d("scroll_down_over.png")})+g(".s7swatches .s7scrolldownbutton[state='down']",{"background-image":d("scroll_down_down.png")})+g(".s7swatches .s7scrolldownbutton[state='disabled']",{"background-image":d("scroll_down_disabled.png")});if(b.browser.device.name=="android"&&b.browser.device.version==4){c+=g(".s7swatches",{"-webkit-perspective":"5000"})}b.Util.css.addDefaultCSS(c,"Swatches")})()}})(s7getCurrentNameSpace());