/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(a){a.pkg("s7sdk.common");a.Util.require("s7sdk.common.Geometry");if(!a.ScrollableDiv){a.ScrollableDiv=function(d,h,c,f,g,e,i){this.POSITION_EVENT="positionEvent";this.MAX_MOUSE_DELTA=100;this.BOUNCE_DECEL=10000;this.BOUNCE_RETURN=2;this.DELTA_TO_VELOCITY=32;this.LEFT_EDGE=1;this.RIGHT_EDGE=2;this.TOP_EDGE=4;this.BOTTOM_EDGE=8;this.CLICK_THRESHOLD=2;this.constantScrollVelocity=600;this.scrollX=false;this.scrollY=false;this.xNotch=1;this.yNotch=1;this.scrollBounds=c;this.client_=d;this.pageHandler=null;if(g!=null){this.pageHandler=g}this.pageX_=0;this.pageY_=0;this.currentPosition=new a.Point2D(0,0);this.velocity=new a.Point2D(0,0);this.startPos_=null;this.cursorDelta_=null;this.cursorStartStage_=null;this.currentMousePoint_=null;this.lastMousePoint_=null;this.scrollDest_=new a.Point2D(0,0);this.ptrScrollDestX_=null;this.ptrScrollDestY_=null;this.edgeVector=null;this.kickStart_=null;this.velocityXAdjusted_=false;this.velocityYAdjusted_=false;this.checkEdges_=true;this.mouseIsDown_=false;this.mouseEnabled_=h;this.positionEvents_=false;this.useConstantVelocity_=false;this.interpretAsClick_=false;this.lastTime_=NaN;this.reciprocalFrameRate_=NaN;this.x_=0;this.y_=0;this.width=0;this.height=0;var b=this;this.__onInterval=function(){b.enterFrame()};this.__mouseDown=function(j){b.mouseDown(j)};this.__mouseMove=function(j){b.mouseMove(j)};this.__mouseUp=function(j){b.mouseUp(j)};this.div=document.createElement("div");if(h){a.Event.addDOMListener(this.div,"touchstart",this.__mouseDown,false);a.Event.addDOMListener(this.div,"mousedown",this.__mouseDown,false)}else{this.interpretAsClick_=true}this.overdragvalue=(typeof e!="undefined")?Number(e):1;this.pageMode=(typeof i!="undefined")?Number(i):0;this.refreshLimit_=f/1000;this.intervalId_=setInterval(this.__onInterval,f);this.scrollDir=null;this.preventNative=true};a.ScrollableDiv.PAGE_EVENT="pageEvent";a.ScrollableDiv.prototype.dispose=function(){clearInterval(this.intervalId_);this.intervalId_=null;if(this.div!=null&&this.div.parentNode!=null){this.div.parentNode.removeChild(this.div)}};a.ScrollableDiv.prototype.slideTo=function(b){this.positionOvershootToEdge();this.setScrollDest(b);this.kickStart_=true};a.ScrollableDiv.prototype.slideToImmediately=function(b){this.positionOvershootToEdge();this.setScrollDest(b);this.setX(this.scrollDest_.x);this.setY(this.scrollDest_.y);this.div.style.left=this.getX()+"px";this.div.style.top=this.getY()+"px"};a.ScrollableDiv.prototype.goLeft=function(){this.positionOvershootToEdge();this.velocity.x=this.constantScrollVelocity;this.useConstantVelocity_=true};a.ScrollableDiv.prototype.goRight=function(){this.positionOvershootToEdge();this.velocity.x=-this.constantScrollVelocity;this.useConstantVelocity_=true};a.ScrollableDiv.prototype.goUp=function(){this.positionOvershootToEdge();this.velocity.y=this.constantScrollVelocity;this.useConstantVelocity_=true};a.ScrollableDiv.prototype.goDown=function(){this.positionOvershootToEdge();this.velocity.y=-this.constantScrollVelocity;this.useConstantVelocity_=true};a.ScrollableDiv.prototype.stop=function(){this.scrollDest_=new a.Point2D(this.alignToNextNotch(this.getX(),this.xNotch,this.velocity.x>0),this.alignToNextNotch(this.getY(),this.yNotch,this.velocity.y>0));this.kickStart_=true};a.ScrollableDiv.prototype.getInterpretAsClick=function(){return this.interpretAsClick_};a.ScrollableDiv.prototype.getScrollDest=function(){return this.scrollDest_};a.ScrollableDiv.prototype.setScrollDest=function(c){c.x=this.alignToNearestNotch(c.x,this.xNotch);c.y=this.alignToNearestNotch(c.y,this.yNotch);this.useConstantVelocity_=false;this.scrollDest_=c;var b=this;this.ptrScrollDestX_={};this.ptrScrollDestX_.getValue=function(){return b.scrollDest_.x};this.ptrScrollDestX_.setValue=function(d){b.scrollDest_.x=d};this.ptrScrollDestY_={};this.ptrScrollDestY_.getValue=function(){return b.scrollDest_.y};this.ptrScrollDestY_.setValue=function(d){b.scrollDest_.y=d}};a.ScrollableDiv.prototype.mouseDown=function(d){d=d||window.event;var c=a.Util.getEventPos(d).x;var b=a.Util.getEventPos(d).y;a.Logger.log(a.Logger.FINEST,"s7sdk.ScrollableDiv.mouseDown - screenX: %0, screenY: %1",c,b);this.mouseIsDown_=true;this.interpretAsClick_=true;this.cursorStartStage_=new a.Point2D(c,b);this.startPos_=new a.Point2D(this.getX(),this.getY());this.cursorDelta_=new a.Point2D(0,0);this.currentMousePoint_=this.lastMousePoint_=new a.Point2D(c,b);a.Event.addDOMListener(document,"mousemove",this.__mouseMove,false);a.Event.addDOMListener(document,"mouseup",this.__mouseUp,false);a.Event.addDOMListener(document,"touchmove",this.__mouseMove,false);a.Event.addDOMListener(document,"touchend",this.__mouseUp,false)};a.ScrollableDiv.prototype.mouseMove=function(b){b=b||window.event;var g=a.Util.getEventPos(b).x;var e=a.Util.getEventPos(b).y;this.currentMousePoint_=new a.Point2D(g,e);this.cursorDelta_=this.pointDiff(this.currentMousePoint_,this.lastMousePoint_);var d=null;var j=this.scrollDir;if(Math.abs(this.cursorDelta_.x)>Math.abs(this.cursorDelta_.y)){if(this.cursorDelta_.x<0){this.scrollDir="left"}else{this.scrollDir="right"}}else{if(this.cursorDelta_.y<0){this.scrollDir="down"}else{this.scrollDir="up"}}if(j!=this.scrollDir){d=true}else{d=false}var h=!(this.edgeVector&this.LEFT_EDGE)&&this.scrollX;var i=!(this.edgeVector&this.RIGHT_EDGE)&&this.scrollX;var c=!(this.edgeVector&this.TOP_EDGE)&&this.scrollY;var f=!(this.edgeVector&this.BOTTOM_EDGE)&&this.scrollY;this.preventNative=true;if(((this.scrollDir=="left")&&!i)||((this.scrollDir=="right")&&!h)||((this.scrollDir=="up")&&!c)||((this.scrollDir=="down")&&!f)){this.preventNative=false}if(this.preventNative){a.Event.preventDefault(b)}if(this.cursorDelta_.getLength()>this.CLICK_THRESHOLD){this.interpretAsClick_=false}this.velocityXAdjusted_=false;this.velocityYAdjusted_=false};a.ScrollableDiv.prototype.mouseUp=function(b){b=b||window.event;if(this.preventNative){a.Event.preventDefault(b)}a.Logger.log(a.Logger.FINEST,"s7sdk.ScrollableDiv.mouseUp - velocity: %0, scrollDest: %1",this.velocity.toString(),this.getScrollDest().toString());this.mouseIsDown_=false;a.Event.removeDOMListener(document,"mousemove",this.__mouseMove,false);a.Event.removeDOMListener(document,"mouseup",this.__mouseUp,false);a.Event.removeDOMListener(document,"touchmove",this.__mouseMove,false);a.Event.removeDOMListener(document,"touchend",this.__mouseUp,false);if(this.cursorDelta_.getLength()>this.CLICK_THRESHOLD){this.interpretAsClick_=false}};a.ScrollableDiv.prototype.enterFrame=function(){var d=new Date().getTime();if(isNaN(this.lastTime_)){this.lastTime_=d}this.reciprocalFrameRate_=(d-this.lastTime_)/1000;this.lastTime_=d;if(this.reciprocalFrameRate_>this.refreshLimit_*5){this.reciprocalFrameRate_=this.refreshLimit_}if(this.mouseIsDown_){this.lastMousePoint_=this.currentMousePoint_;if(this.cursorDelta_.x>this.MAX_MOUSE_DELTA){this.cursorDelta_.x=this.MAX_MOUSE_DELTA}if(this.cursorDelta_.x<-this.MAX_MOUSE_DELTA){this.cursorDelta_.x=-this.MAX_MOUSE_DELTA}if(this.cursorDelta_.y>this.MAX_MOUSE_DELTA){this.cursorDelta_.y=this.MAX_MOUSE_DELTA}if(this.cursorDelta_.y<-this.MAX_MOUSE_DELTA){this.cursorDelta_.y=-this.MAX_MOUSE_DELTA}this.velocity.x=this.cursorDelta_.x*this.DELTA_TO_VELOCITY;this.velocity.y=this.cursorDelta_.y*this.DELTA_TO_VELOCITY;this.setScrollDest(new a.Point2D(this.getX()+(this.velocity.x/2),this.getY()+(this.velocity.y/2)));this.kickStart_=true;if(this.scrollX){if(this.client_&&this.mouseEnabled_){var b=1;var e=this.startPos_.x+(this.currentMousePoint_.x-this.cursorStartStage_.x);if((e>0)||(e<this.scrollBounds.x-this.getLogicalWidth())){b=this.overdragvalue}this.setX(this.startPos_.x+(this.currentMousePoint_.x-this.cursorStartStage_.x)*b);this.startPos_.x=this.getX();this.cursorStartStage_.x=this.currentMousePoint_.x}}if(this.scrollY){if(this.client_&&this.mouseEnabled_){var b=1;var c=this.startPos_.y+(this.currentMousePoint_.y-this.cursorStartStage_.y);if((c>0)||(c<this.scrollBounds.y-this.getLogicalHeight())){b=this.overdragvalue}this.setY(this.startPos_.y+(this.currentMousePoint_.y-this.cursorStartStage_.y)*b);this.startPos_.y=this.getY();this.cursorStartStage_.y=this.currentMousePoint_.y}}}else{if(this.scrollX&&(this.velocity.x!=0||this.kickStart_)){this.velocity.x=this.adjustVelocity(this.velocity.x,this.getX(),this.scrollBounds.x,this.getLogicalWidth(),this.ptrScrollDestX_,false);if(!this.velocityXAdjusted_){if(this.pageMode==1){this.ptrScrollDestX_.setValue(this.alignToNextNotch(this.getX(),this.xNotch,this.velocity.x>=0));this.velocityXAdjusted_=true}var e=this.getX()+(this.velocity.x*this.reciprocalFrameRate_);if(e>0){this.velocity.x*=this.overdragvalue;this.ptrScrollDestX_.setValue(0);this.velocityXAdjusted_=true}if(e<this.scrollBounds.x-this.getLogicalWidth()){this.velocity.x*=this.overdragvalue;this.ptrScrollDestX_.setValue(this.alignToNearestNotch(this.scrollBounds.x-this.getLogicalWidth(),this.xNotch));this.velocityXAdjusted_=true}}if(this.velocity.x==0){this.setX(this.scrollDest_.x)}else{this.setX(this.getX()+(this.velocity.x*this.reciprocalFrameRate_))}}if(this.scrollY&&(this.velocity.y!=0||this.kickStart_)){this.velocity.y=this.adjustVelocity(this.velocity.y,this.getY(),this.scrollBounds.y,this.getLogicalHeight(),this.ptrScrollDestY_,true);if(!this.velocityYAdjusted_){if(this.pageMode==1){this.ptrScrollDestY_.setValue(this.alignToNextNotch(this.getY(),this.yNotch,this.velocity.y>=0));this.velocityYAdjusted_=true}var c=this.getY()+(this.velocity.y*this.reciprocalFrameRate_);if(c>0){this.velocity.y*=this.overdragvalue;this.ptrScrollDestY_.setValue(0);this.velocityYAdjusted_=true}if(c<this.scrollBounds.y-this.getLogicalHeight()){this.velocity.y*=this.overdragvalue;this.ptrScrollDestY_.setValue(this.alignToNearestNotch(this.scrollBounds.y-this.getLogicalHeight(),this.yNotch));this.velocityYAdjusted_=true}}if(this.velocity.y==0){this.setY(this.scrollDest_.y)}else{this.setY(this.getY()+(this.velocity.y*this.reciprocalFrameRate_))}}this.kickStart_=false}if(this.positionEvents_&&!this.currentPosition.equals(new a.Point2D(this.getX(),this.getY()))){this.currentPosition=new a.Point2D(this.getX(),this.getY());if(this.client_&&this.client_.positionChanged){this.client_.positionChanged(this.currentPosition)}}if(this.checkEdges_){this.validateEdges();this.checkEdges_=false;this.layout()}};a.ScrollableDiv.prototype.adjustVelocity=function(g,h,e,b,f,c){if(h>5){f.setValue(0);if(g>0){g-=this.BOUNCE_DECEL*this.reciprocalFrameRate_*Math.abs(h)/75}else{g=-this.BOUNCE_RETURN*Math.abs(h)}this.useConstantVelocity_=false}else{if(h<e-b-5){f.setValue(this.alignToNearestNotch(e-b,c?this.yNotch:this.xNotch));if(g<0){g+=this.BOUNCE_DECEL*this.reciprocalFrameRate_*Math.abs(h+b-e)/75}else{g=this.BOUNCE_RETURN*Math.abs(h+b-e)}this.useConstantVelocity_=false}else{if(!this.useConstantVelocity_){g=3*(f.getValue()-h)}var d=Math.abs(g);if(d<2){g=0}}}return g};a.ScrollableDiv.prototype.validateEdges=function(){var f=this.mouseIsDown_||this.useConstantVelocity_?this.getX():this.scrollDest_.x;var d=this.mouseIsDown_||this.useConstantVelocity_?this.getY():this.scrollDest_.y;if(f>=0){this.edgeVector|=this.LEFT_EDGE}else{this.edgeVector&=~this.LEFT_EDGE}if(f<=this.scrollBounds.x-this.getLogicalWidth()){this.edgeVector|=this.RIGHT_EDGE}else{this.edgeVector&=~this.RIGHT_EDGE}if(d>=0){this.edgeVector|=this.TOP_EDGE}else{this.edgeVector&=~this.TOP_EDGE}if(d<=this.scrollBounds.y-this.getLogicalHeight()){this.edgeVector|=this.BOTTOM_EDGE}else{this.edgeVector&=~this.BOTTOM_EDGE}this.processEdgeVector();var e=this.pageMode?((f>=0)?0:Math.round(Math.abs(f)/this.scrollBounds.x)+0):(f>=0)?0:this.getPageIdxForScrollIdx(Math.round(Math.abs(f)/this.xNotch));var c=this.pageMode?((d>=0)?0:Math.round(Math.abs(d)/this.scrollBounds.y)+0):(d>=0)?0:this.getPageIdxForScrollIdy(Math.round(Math.abs(d)/this.yNotch));if(this.pageMode){var b=this.getPageCount();if(((e!=this.pageX_)&&(e<b.x))||((c!=this.pageY_)&&(c<b.y))){this.pageX_=e;this.pageY_=c;if(this.pageHandler!=null){this.pageHandler.apply(this.client_)}}}else{if(e!=this.pageX_||c!=this.pageY_){this.pageX_=e;this.pageY_=c;if(this.pageHandler!=null){this.pageHandler.apply(this.client_)}}}};a.ScrollableDiv.prototype.getPageIdxForScrollIdx=function(b){var d=this.getLogicalWidth()/this.xNotch;var c=this.scrollBounds.x/this.xNotch;if(b==0){return 0}else{if(b>=(d-c)){return this.getPageCountPageXMode0()-1}}return 1+Math.min(Math.round((b-1)/c),Math.floor((d-2)/c)-1)};a.ScrollableDiv.prototype.getPageIdxForScrollIdy=function(b){var d=this.getLogicalHeight()/this.yNotch;var c=this.scrollBounds.y/this.yNotch;if(b==0){return 0}else{if(b>=(d-c)){return this.getPageCountPageYMode0()-1}}return 1+Math.min(Math.round((b-1)/c),Math.floor((d-2)/c)-1)};a.ScrollableDiv.prototype.getPageCountPageXMode0=function(){var c=this.getLogicalWidth()/this.xNotch;var b=this.scrollBounds.x/this.xNotch;return c<=b?1:2+Math.floor((c-2)/b)};a.ScrollableDiv.prototype.getPageCountPageYMode0=function(){var c=this.getLogicalHeight()/this.yNotch;var b=this.scrollBounds.y/this.yNotch;return c<=b?1:2+Math.floor((c-2)/b)};a.ScrollableDiv.prototype.processEdgeVector=function(){if(this.client_){if(this.client_.toggleLeftButton){this.client_.toggleLeftButton(!(this.edgeVector&this.LEFT_EDGE))}if(this.client_.toggleRightButton){this.client_.toggleRightButton(!(this.edgeVector&this.RIGHT_EDGE))}if(this.client_.toggleUpButton){this.client_.toggleUpButton(!(this.edgeVector&this.TOP_EDGE))}if(this.client_.toggleDownButton){this.client_.toggleDownButton(!(this.edgeVector&this.BOTTOM_EDGE))}}};a.ScrollableDiv.prototype.getLogicalWidth=function(){return isNaN(this.logicalWidth_)?this.width:this.logicalWidth_};a.ScrollableDiv.prototype.setLogicalWidth=function(b){this.logicalWidth_=b};a.ScrollableDiv.prototype.setLogicalHeight=function(b){this.logicalHeight_=b};a.ScrollableDiv.prototype.getLogicalHeight=function(){return isNaN(this.logicalHeight_)?this.height:this.logicalHeight_};a.ScrollableDiv.prototype.getPageCount=function(){var b;if(this.pageMode){b=new a.Point2D(this.getLogicalWidth()/this.scrollBounds.x,this.getLogicalHeight()/this.scrollBounds.y);b.x=(this.getLogicalWidth()%this.scrollBounds.x)>this.xNotch/2?Math.ceil(b.x):Math.floor(b.x);b.y=(this.getLogicalHeight()%this.scrollBounds.y)>this.yNotch/2?Math.ceil(b.y):Math.floor(b.y)}else{b=new a.Point2D(this.getPageCountPageXMode0(),this.getPageCountPageYMode0())}return b};a.ScrollableDiv.prototype.getCurrentPage=function(){return new a.Point2D(this.pageX_,this.pageY_)};a.ScrollableDiv.prototype.setCurrentPage=function(d){var c=this.getPageCount();var b=new a.Point2D(Math.min(Math.max(1,d.x),c.x),Math.min(Math.max(1,d.y),c.y));if(this.pageMode){this.slideTo(new a.Point2D((b.x-1)*-this.scrollBounds.x,(b.y-1)*-this.scrollBounds.y))}else{this.slideTo(new a.Point2D(d.x!=1?(b.x-1)*-this.scrollBounds.x:-this.xNotch,d.y!=1?(b.y-1)*-this.scrollBounds.y:-this.yNotch))}};a.ScrollableDiv.prototype.pointDiff=function(c,b){return new a.Point2D(c.x-b.x,c.y-b.y)};a.ScrollableDiv.prototype.alignToNearestNotch=function(d,b){var c=Math.abs(d%b);if(c>b/2){c-=b}return(d>0)?d-c:d+c};a.ScrollableDiv.prototype.alignToNextNotch=function(e,b,c){var d=Math.abs(e%b);if(c){e+=(e>0)?b-d:d}else{e-=(e>0)?d:b-d}return e};a.ScrollableDiv.prototype.positionOvershootToEdge=function(){if(this.getLogicalWidth()>=this.scrollBounds.x){if(this.getX()>0){this.setX(0)}if(this.getX()<this.scrollBounds.x-this.getLogicalWidth()){this.setX(this.scrollBounds.x-this.getLogicalWidth())}}if(this.getLogicalHeight()>=this.scrollBounds.y){if(this.getY()>0){this.setY(0)}if(this.getY()<this.scrollBounds.y-this.getLogicalHeight()){this.setY(this.scrollBounds.y-this.getLogicalHeight())}}};a.ScrollableDiv.prototype.getX=function(){return this.x_};a.ScrollableDiv.prototype.setX=function(b){this.checkEdges_=true;this.x_=b};a.ScrollableDiv.prototype.getY=function(){return this.y_};a.ScrollableDiv.prototype.setY=function(b){this.checkEdges_=true;this.y_=b};a.ScrollableDiv.prototype.layout=function(){this.div.style.position="absolute";this.div.style.width=this.getLogicalWidth()+"px";this.div.style.height=this.getLogicalHeight()+"px";this.div.style.left=this.getX()+"px";this.div.style.top=this.getY()+"px";this.div.style.webkitOverflowScrolling="touch";this.div.style.webkitTransform="translateZ(0px)"}}})(s7getCurrentNameSpace());