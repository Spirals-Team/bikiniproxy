!function(e,t){_pxam=window._pxam||[];var i,r=e("#recentVehicleTemplate").html(),a=e("#savedVehicleTemplate").html(),n=e("#priceAlertTemplate").html(),s=e("#incentivesTemplate").html(),o={notEmpty:/^\s*\S+.*/,currency:/\B(?=(\d{3})+(?!\d))/g,size:/size-(\d*)-(\d*)/,text:/^[a-z ,.'-]+$/i,email:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,password:/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[\w!"#\$%&'\(\)\*\+,-\.\/:;<=>\?@\[\]\^_`\{\|}~\\]{6,}$/},l="<div>Failed to load component, please try again</div>",c=e("#recentVehicleTemplate").length>0?{recentCars:r?_.template(r,null,{variable:"data"}):"",savedCars:a?_.template(a,null,{variable:"data"}):"",priceAlerts:n?_.template(n,null,{variable:"data"}):"",incentives:s?_.template(s,null,{variable:"data"}):""}:{},d={recentCars:{statusType:"RECENTLY_VIEWED",pageSize:"20"},savedCars:{statusType:"SAVED",pageSize:"40"},priceAlerts:{statusType:"NOTIFICATIONS_ENABLED",notificationTypes:"PRICE_CHANGE,NEW_INCENTIVES",notificationStatus:"UNREAD",sortFields:"latestNotifications.PRICE_CHANGE.notifyDate:-1",pageSize:"40"}},f=90,u="drinteraction",m={profile:{},recentCars:[],savedCars:[],priceAlerts:[]},p={navbar:e(".mycars.mycars-integration-navbar").length>0},g=e(".mycars-default .ddc-toolbar"),h=g.find(".mycars"),v=e(".smartbar"),y=h.find(".login").data("key","login"),b=h.find(".recent-cars").data("key","recentCars"),w=h.find(".saved-cars").data("key","savedCars"),C=h.find(".price-alerts").data("key","priceAlerts"),I=h.data("ismobile"),E=e(".digital-retailing-toolbox").length?!0:!1,k=e("[data-digital-retail-summary-label]"),P={vehicleOfInterest:"vehicleOfInterest",trade:"",accessories:"",payment:"",finance:"",prequal:"",reserve:"",protect:"",lifestyle:"",testdrive:""},N=!1,D=h.length>0?window.location.protocol+"//"+h.data("groupdomain"):"",T=h.data("hasgroup")||t.siteSettings.isSecureLoginEnabled&&!t.siteSettings.isDomainSSLEnabled,A=h.data("vdpvehicleid"),O=D.substring(D.indexOf(".")),S=!1,L=!1,R="",U=e("body").hasClass("ie8")||e("body").hasClass("ie9")?"keyup click":"keyup blur click",x=I?h.find(".login").data("login-href"):h.find(".login > a").data("login-href"),V=I?h.find(".login").data("register-href"):h.find(".login > a").data("register-href"),F=I?h.find(".login").data("login-intercept-href"):"",M=""!==F,W=function(){_pxam.push({type:"event",eventType:"user.loaded",userProfileId:m.profile.profileId,universalUserId:m.profile.universalUserId,userType:"DDC"==m.profile.source||"FACEBOOK"==m.profile.source?"registered":"anonymous"})},B=function(e){var t;t=void 0===e?"DDC"==m.profile.source||"FACEBOOK"==m.profile.source?"registered":"anonymous":e,_pxam.push({type:"event",eventType:"user.registered",userProfileId:m.profile.profileId,universalUserId:m.profile.universalUserId,userType:t})},H=function(e,t){var i;i=void 0===t?e.statuses.NOTIFICATIONS_ENABLED?!0:!1:t,_pxam.push({type:"event",eventType:"vehicle.saved",userProfileId:m.profile.profileId,universalUserId:m.profile.universalUserId,userType:"DDC"==m.profile.source||"FACEBOOK"==m.profile.source?"registered":"anonymous",vehicleType:2==e.attributes.condition?"new":"used",make:e.attributes.make,model:e.attributes.model,bodyStyle:e.attributes.bodyStyle,vin:e.attributes.vin,year:e.attributes.year,vehicleId:e.itemUUID,stockNumber:e.attributes.stockNumber,notificationsEnabled:i})},j=function(){var e="mycars",t={expires:365,path:"/"};return function(i,r){for(var a={},n=jQuery.cookie(e)||"",s=n.split(";"),o=0;o<s.length;o++){var l=s[o];if(l){var c=l.split(":");a[c[0]]=c[1]}}if(void 0!==r||i&&"object"==typeof i){void 0!==r?a[i]=r:jQuery.extend(a,i),n="";for(o in a)n+=o+":"+a[o]+";";jQuery.cookie(e,n,t)}return i&&"string"==typeof i?a[i]:a}}(),G=function(t,i,r,a){i=i||"savedVehicleCount: "+m.savedCars.length,r=r||"recentlyViewedCount: "+m.recentCars.length,e(document).trigger("trackEvent",[{widgetName:"mycars-"+t,eventName:i,data:r,noninteraction:a}])},q=function(){var t=b.find(".count").css("background-color"),i=e("#mycars-toolbar").attr("data-color");return function(e,r,a){a?e.addClass("alert-color").animate({backgroundColor:"#"+i},"slow").delay(1e3).queue(function(i){e.removeClass("alert-color").animate({backgroundColor:t},"slow"),i()}).find("div").css({marginTop:"30px"}).animate({marginTop:"0"},"slow","easeOutBounce").html(r||"0"):e.find("div").html(r||"0")}}(),Y=function(t){var i=_.groupBy(m.savedCars,"itemUUID");t.each(function(){var t=e(this),r=i[e(this).data("id")],a=r&&_.has(r[0].statuses,"NOTIFICATIONS_ENABLED");e(this).addClass("hide"),(t.hasClass("mycars-save-btn")&&!r||t.hasClass("mycars-saved-btn")&&r||t.hasClass("mycars-add-alert-btn")&&!a||t.hasClass("mycars-alerts-isset")&&a)&&t.removeClass("hide")})},Q=function(){e(".mycars-favorites").length>0&&window.location.reload(!0)},z=function(){p.navbar&&(e(".mycars > .menu.login").addClass("menu-show"),(m.profile.email||e(".mycars > .menu-has-count").length>0)&&e(".mycars > .menu").addClass("menu-show"))},$=function(){return"https:"!=window.location.protocol&&t.siteSettings.isSecureLoginEnabled&&window.open(t.createSecureDdcDomainRedirect(window.location.href),"_self"),!1},J=function(t){if(I)_.each(t,function(t){Y(e(".mycars-btn")),kt(t)});else{var i=j();_.each(t,function(t){var r=t.data("key"),a=m[r].length;a>0?t.addClass("menu-has-count"):t.removeClass("menu-has-count"),z(),i[r]!=a&&(j(r,a),q(t.find(".count"),a,!0)),t.hasClass("selected")&&kt(t),t==w&&Y(e(".mycars-btn").not(".mycars .mycars-btn"))})}},Z=function(t,i,r,a){var n=window.DDC.getSiteProperty("Tier2Region");return n&&(a=a||{},a.Tier2Region=n),e.ajax({type:"GET",url:"/apis/mycars/v1/profiles"+(r?"/"+r:""),cache:!1,data:a,contentType:"application/json",success:function(e){t(e)},error:i})},K=function(e,t){t=t||function(){},m.profile.profileId?Z(function(i){m[e.data("key")]=i.results,J([e]),t()},function(){m[e.data("key")]=[],J([e]),t()},m.profile.profileId+"/vehicles",d[e.data("key")]):(m[e.data("key")]=[],J([e]),t())},X=function(i){var r=m.profile.email;if(ot(r?!0:!1),N&&t.siteSettings.isSecureLoginEnabled&&"http:"===window.location.protocol&&$(),void 0===t.getUrlParams().referringPage&&Kt(),I?(e("body")[r?"addClass":"removeClass"]("logged-in"),e(".welcome").html(r?t.i18n.getLabel("WELCOME")+" "+r:"")):g[r?"addClass":"removeClass"]("logged-in"),y.find("> a .label").html(r?t.i18n.getLabel("WELCOME")+"<br /> "+r:t.i18n.getLabel("LOG_IN")),p.navbar){y.find("> a .label").html(t.i18n.getLabel(E&&N?"ACCOUNT":r&&N?"LOGGED_IN":"LOG_IN"));var a=y.find(".logout-link").children();y.find(".logout-link").text(t.i18n.getLabel("YOU_ARE_LOGGED_IN_AS")+" "+r+". ").append(a)}v.find(".info")[r?"addClass":"removeClass"]("hide");var n={recent:!1,saved:!1,alerts:!1},s=function(e){n[e]=!0,_.every(n)&&(G("load",null,null,!0),(i||function(){})())};W(),K(b,_.partial(s,"recent")),K(w,_.partial(s,"saved")),K(C,_.partial(s,"alerts")),I&&!L&&(t.getUrlParams().hasOwnProperty("_mycarsTrigger")&&e(window.document).find("."+t.getUrlParams()._mycarsTrigger).not(".hide").trigger("click"),L=!0),e.publish("mycars-loaded")},et=function(e,t){gt("login",{profileId:e},function(e){m.profile=e,X(function(){G("login")})},{401:function(){G("login-unsuccessful","not-registered")}}),(t||function(){})()},tt=function(e,i){t.messageIframe("#myCarsMessageFrame",e,i)},it=function(){tt({action:"setCookie",cookieName:"userProfileId",cookieData:m.profile.profileId,cookieExpireDays:f},D)},rt=function(){tt({action:"setCookie",cookieName:"userId",cookieData:m.profile.universalUserId,domain:O,cookieExpireDays:f},D)},at=function(){tt({action:"setCookie",cookieName:u,cookieData:!0},D)},nt=function(){tt({action:"invalidateCookie",cookieName:"userProfileId",cookieData:"INVALID",cookieExpireDays:f},D),tt({action:"invalidateCookie",cookieName:u,cookieData:"INVALID"},D)},st=function(t){if(t.origin===D){var i=JSON.parse(t.data),r=e.cookie("userId"),a=e.cookie("userProfileId");m.profile.universalUserId=r?r:null,m.profile.profileId=a?a:null,"cookieread"===i.result&&lt(i),"logoutcookie"===i.result&&ct(i,a),"rewritecookie"===i.result&&dt(i),"facebooklogin"===i.result&&ft(i),i.result&&"notfound"!==i.result||ut(i,r,a)}},ot=function(i){N=i,e.publish(N?"mycars-logged-in":"mycars-logged-out"),t.Widgets.MyCars.ORIGIN_API&&t.Widgets.MyCars.ORIGIN_API.sendUserLoginStatusApiUpdate()},lt=function(i){"userProfileId"===i.cookieName&&i.cookieData&&(A?(m.profile.profileId=i.cookieData,S||(et(i.cookieData,function(){St(A)}),S=!0)):S||(et(i.cookieData),S=!0)),"userId"===i.cookieName&&e.cookie("userId",i.cookieData,{path:"/"}),i.cookieName===u&&t.siteSettings.isSecureLoginEnabled&&"http:"===window.location.protocol&&$()},ct=function(t,i){if("userProfileId"===t.cookieName){var r=function(){S||(e.publish("mycars-user-logging-out"),gt("create",{source:"ANONYMOUS"},function(e){m.profile=e,A?(St(A,function(){X()}),T&&m.profile.profileId&&it()):(m.profile.email=null,m.profile.profileId=null,X())}),S=!0)};i?gt("logout",null,function(){r(),Q()}):r()}"userId"===t.cookieName&&pt({},function(e){m.profile.universalUserId=e.id?e.id:null,rt()})},dt=function(e){"userProfileId"===e.cookieName&&m.profile.profileId&&it(),"userId"===e.cookieName&&m.profile.universalUserId&&rt()},ft=function(t){m.profile.email||gt("login",{email:t.fbprofile.email},function(t){m.profile=t,I&&e(".ddc-mobile-slidein-content").find(".active-overlay").removeClass("active-overlay"),X(function(){G("login"),S=!0,rt(),T&&it(),Q()})},{401:function(){G("login-unsuccessful","not-registered"),gt("create",{source:"FACEBOOK",email:t.fbprofile.email,firstName:t.fbprofile.first_name,lastName:t.fbprofile.last_name},function(e){m.profile=e,X(function(){G("register"),S=!0,T&&it(),Q(),B("registered")})})}})},ut=function(e,t,i){"userId"===e.cookieName&&(t||pt({},function(e){m.profile.universalUserId=e.id?e.id:null,rt()})),T&&"userProfileId"===e.cookieName&&(A?i?S||(Z(function(e){m.profile=e.length>0?e[0]:{},St(A,function(){X(function(){it()})})}),S=!0):S||(gt("create",{source:"ANONYMOUS"},function(e){m.profile=e,St(A,function(){X(),it()})}),S=!0):S||(Z(function(e){m.profile=e.length>0?e[0]:{},X()}),S=!0))},mt=function(){Z(function(e){m.profile=e.length>0?e[0]:{},T||(A?m.profile.profileId?St(A,function(){X(function(){rt()}),S=!0}):gt("create",{source:"ANONYMOUS"},function(e){m.profile=e,St(A,function(){X(function(){rt()}),S=!0})}):(X(),S=!0))})},pt=function(t,i,r,a){return e.ajax({type:"POST",url:"/apis/mycars/v1/users"+(a?"/"+a:""),data:JSON.stringify(t),dataType:"json",contentType:"application/json",success:function(e){i(e)},error:function(e){errorHandlers&&errorHandlers[e.status]&&errorHandlers[e.status]()}})},gt=function(i,r,a,n,s){var o=window.DDC.getSiteProperty("Tier2Region"),l="";o&&(l+="?Tier2Region="+o),e.ajax({type:"POST",url:"/apis/mycars/v1/profiles"+(s?"/"+s:"")+l,data:JSON.stringify(r),dataType:"json",contentType:"application/json",beforeSend:function(e){e.setRequestHeader("MyCarsAction",i||"")},success:function(e){a&&a(e)},error:function(e){if(n){if(n[e.status])return void n[e.status]();if(n["*"])return void n["*"]()}t.isLive||"object"!=typeof console||console.log("ERROR: Ajax post returned a status of: "+e.status)}})},ht=function(e){I||(jQuery(window.document).off("click.mycars"),h.add(".smartbar").find("> .selected").not(e).removeClass("selected").removeClass("recently-saved").find(".popup").removeClass("show-confirm"))},vt=function(t,i){i=i||!1;var r=setInterval(function(){var a=e(document.activeElement);!i&&a&&a.is("iframe")?(clearInterval(r),ht()):t.hasClass("selected")?a.is("iframe")||(i=!1):clearInterval(r)},250);e(window.document).on("click.mycars",function(e){!t.is(e.target)&&t.has(e.target).length<1&&(clearInterval(r),ht())})},yt=function(t){var i;i=-1!==t.indexOf("#")?e(t):I?e(".active-overlay ."+t+"-content form"):h.find(".menu.selected ."+t+"-content form");var t="create"==t?"register":t,r=!0,a=i.find("[type=submit]");a.addClass("disabled").attr("disabled",!0),i.find("input[type=text], input[type=email], input[type=password]").each(function(){var i=e(this),a=i.val().replace(/^\s+|\s+$/g,""),n=o.text;switch(i.attr("type")){case"email":n=o.email;break;case"password":n=-1!==t.indexOf("login")?o.notEmpty:o.password}(!a||a==i.attr("placeholder")||n&&!n.test(a))&&(r=!1)}),r&&a.removeClass("disabled").attr("disabled",!1)},bt=function(t){t=t||!1,I||(!N&&x?It("login"):(ht(y),vt(y,t),y.addClass("selected"),e(".mycars-form").find("input:first").focus()))},wt=function(e,i){if(e=e||""){var r=_.omit(t.getUrlParams(e),i);return e.split("?")[0]+t.urlize(r)}return e},Ct=function(e,i){var r,a=window.location.pathname+wt(window.location.search,"referringPage");return r="register"==e?V:I?F:x,i&&(a=t.addUrlParam(a,"_mycarsTrigger",i)),t.createSecureDdcDomainRedirect(r,"referringPage="+encodeURIComponent(a))},It=function(e){window.open(Ct(e),"_self")},Et=function(){I||(ht(y),vt(y),y.addClass("selected"),e(".mycars-form").find("input:first").focus())},kt=function(i){var r=i.find(".popup"),a=r.find(".mycars-list"),n=i.data("key"),s=m[n];if(I)i==w&&(a=e("#savedTab .mycars-mobile-list"),e("#savedTab .empty-content")[s.length>0?"addClass":"removeClass"]("hide")),i==C&&(a=e("#alertsTab .mycars-mobile-list"),e("#alertsTab .empty-content")[s.length>0?"addClass":"removeClass"]("hide"));else if("priceAlerts"==n&&!N&&V)return It("register"),!1;ht(i),p.navbar?r.css("right","0")[s.length>0?"removeClass":"addClass"]("empty-list"):r.css("left",Math.min(e(window).width()-(i.offset().left+r.width()+10),0)+"px")[s.length>0?"removeClass":"addClass"]("empty-list"),a.find("> li").remove(),a.append(_.reduce(s,function(e,i){null!=t.Widgets.fieldFormatterFlags&&null!=t.Widgets.fieldFormatterFlags.mycars&&(i.attributes.title=i.attributes.make==t.Widgets.fieldFormatterFlags.mycarsCompliantTitleFranchise?t.Widgets.fieldFormatter.title(i.attributes,t.Widgets.fieldFormatterFlags.mycarsCompliantTitlePattern):t.Widgets.fieldFormatter.title(i.attributes,t.Widgets.fieldFormatterFlags.mycars));var r=i.attributes,a={vdpHref:"/404.html"!=r.detailsURL?r.detailsURL+"?mycarsr=vdp-"+n:"#",price:"0"!=r.displayPrice?t.format.currency(Math.floor(r.displayPrice),0):"0"!=r.internetPrice?t.format.currency(Math.floor(r.internetPrice),0):"",time:new Date(i.statuses[d[n].statusType].statusDate).toJSON(),miles:(r.odometer||"").toString().replace(o.currency,",")};if("priceAlerts"==n&&i.latestNotifications.PRICE_CHANGE){var s=i.latestNotifications.PRICE_CHANGE,l=s.oldPrice-s.newPrice;_.extend(a,{saved:t.format.currency(Math.floor(Math.abs(l)),0),priceDiff:l,priceChangeId:s.id,time:new Date(s.notifyDate).toJSON()})}if("priceAlerts"==n&&i.latestNotifications.NEW_INCENTIVES){var f=i.latestNotifications.NEW_INCENTIVES;return _.extend(a,{incentiveId:f.id,time:new Date(f.notifyDate).toJSON()}),e+c.incentives({item:i,computed:a})}return f?void 0:e+c[n]({item:i,computed:a})},"")),a.find("> li").first().addClass("mycars-first-row"),a.find(".timeago").timeago(),a.find(".mycars-btn, .mycars-btn-no-toggle").each(function(){var t=e(this).closest(".mycars-vehicle").data("id");if(e(this).attr("data-id",t),e(this).attr("href").match(/vehicleId=/)){var i=e(this).attr("href").split("&");i[1]="vehicleId="+t,e(this).attr("href",i.join("&"))}}),Y(a.find(".mycars-btn")),vt(i),i.addClass("selected"),"priceAlerts"==n&&e(document).trigger("modulesRefresh")},Pt=function(e,t){var i=e.val().replace(/^\s+|\s+$/g,"");return!i||i==e.attr("placeholder")||t&&!t.test(i)?(e.addClass("input-error"),null):(e.removeClass("input-error"),i)},Nt=function(i,r){i.preventDefault();var a=I&&!x?e("#ddc-slidein-panel-mycars-slidein-panel").find(".mycars-form.login-form"):e(this);r&&"eprice"===r&&(a=e(".eprice-form .login-form"));var n=Pt(a.find('input[name="contact.email"]'),o.email),s=null,l=a.find('input[name="contact.password"]'),c=l.val();if(l.length>0&&(s=c),null!==n){var d={email:n};s&&(d={email:n,password:s}),a.find(".error-text").html(""),a.find(".input-error").removeClass("input-error"),gt("login",d,function(t){m.profile=t,X(function(){G("login"),rt(),T&&it(),Q(),(x||M)&&_t(),r&&"eprice"===r&&xt()}),I&&e(".ddc-mobile-slidein-content").find(".active-overlay").removeClass("active-overlay")},{401:function(){G("login-unsuccessful","not-registered"),a.find(".error-text").html(l.length>0?t.i18n.getLabel("THE_EMAIL_OR_PASSWORD_YOU_ENTERED_IS_INCORRECT"):n+" "+t.i18n.getLabel("IS_NOT_REGISTERED"))}})}else G("login-unsuccessful","validation error"),a.find(".error-text").html(t.i18n.getLabel("PLEASE_FIX_HIGHLIGHTED_FIELDS"))},_t=function(){var e=t.getUrlParams().referringPage;window.open(e||"/","_self")},Dt=function(i,r){i.preventDefault();var a=r,n=Pt(a.find('input[name="contact.email"]'),o.email),s=e(".page-bd").find(".reset-message .content, #password-reset-request"),l=a.parent().find(".register-sales, .forgot-password-form"),c="password-reset-request"==r.attr("id")?s:l,d=c.length,f=function(){c.fadeOut(function(){--d>0&&e(t.i18n.getMessage("PASSWORD_RESET_REQUEST_VERBIAGE")).hide().insertBefore(a).fadeIn()})};null!==n?gt("request-password-reset",{email:n},function(e){f(),m.profile=e}):G("password-reset-unsuccessful","validation error")},Tt=function(t,i,r,a){var n,s=e(t).find(i).first(),l=e(t).find(i).first().data("container"),c=s.parents(".inventory-lead-instant-eprice").length>0;n=s.parents(".mycars-mobile").length>0?e(".mycars-mobile .section-register"):c?s.closest("form").parent().parent():e(s.parents(".popup").length>0?l:".page-bd");var d=n.find(i).first().val(),f=n.find(t+" "+r),u=e('input[name="contact.passwordConfirm"]:focus'),m=f.val(),p=e(t).find(a),g=/[A-Z]/,h=/[a-z]/,v=/[0-9]/,y=d?Pt(s,o.password):void 0,b=function(){if(d===m&&""!==d&&y){if(d==m&&y)return yt("register"),f.removeClass("input-error"),!0}else if(p.addClass("disabled").attr("disabled",!0),u.length&&""!==m&&f.addClass("input-error"),""!==m&&y)return f.addClass("input-error"),!1},w=e(".character-requirements"),C=e(".uppercase-requirements"),I=e(".lowercase-requirements"),E=e(".numerical-requirements"),k=e(".match-requirements"),P="complete text-success";w.removeClass(P),C.removeClass(P),I.removeClass(P),E.removeClass(P),k.removeClass(P),d.length>=6&&w.addClass(P),g.test(d)&&C.addClass(P),h.test(d)&&I.addClass(P),v.test(d)&&E.addClass(P),b()&&k.addClass(P)},At=function(){var t=e(".page-bd"),i=".login-password-reset form",r=e(i),a=r.find(".ui-button-submit"),n='input[name="contact.password"]',s='input[name="contact.passwordConfirm"]',l=t.find(".confirm-message"),c=t.find(".invalid-message"),d=t.find(".generic-message"),f=r.closest(".container > .page-bd .ddc-span5, .ddc-page > .page-bd .region.main .yui3-u-3-5, .page-bd > .mobile"),u=function(e){for(var t=window.location.search.substring(1),i=t.split("&"),r=0;r<i.length;r++){var a=i[r].split("=");if(a[0]==e)return a[1]}},p=u("p"),g=u("t"),h=u("e");e(window.document).on(U,n,function(){Tt(i,n,s,a),yt("#password-reset")}),e(window.document).on(U,s,function(){Tt(i,n,s,a),yt("#password-reset")}),a.on("click",function(t){t.preventDefault();var i=Pt(r.find(n),o.password);null!==i?gt("password-reset",{email:h,password:i,profileId:p,passwordResetRequestToken:g},function(t){m.profile=t,G("reset-successful","password reset"),I&&e(".ddc-mobile-slidein-content").find(".active-overlay").removeClass("active-overlay"),f.fadeOut("slow",function(){f.empty().append(l.removeClass("hide")).fadeIn("slow")}),gt("login",{email:h,password:i},function(t){m.profile=t,X(function(){G("login"),rt(),T&&it(),Q()}),I&&e(".ddc-mobile-slidein-content").find(".active-overlay").removeClass("active-overlay")})},{403:function(){G("reset-unsuccessful","invalid token"),f.fadeOut("slow",function(){f.empty().append(c.removeClass("hide")).fadeIn("slow")}),gt("request-password-reset",{email:h},function(e){m.profile=e})},"*":function(){f.fadeOut("slow",function(){f.empty().append(d.removeClass("hide")).fadeIn("slow")})}}):(G("reset-unsuccessful","validation error"),r.find(".mismatch").remove(),r.submit())})},Ot=function(i,r){i.preventDefault();var a=I&&!V?e("#ddc-slidein-panel-mycars-slidein-panel").find(".mycars-form.register-form"):e(this);r&&"eprice"===r&&(a=e(".eprice-form .register-form"));var n=a.find('input[name="contact.firstName"]'),s=a.find('input[name="contact.lastName"]'),l=a.find('input[name="contact.password"]'),c="",d="",f=null,u=Pt(a.find('input[name="contact.email"]'),o.email),p=[c,d,u];n.length>0&&(c=Pt(n),d=Pt(s)),l.length>0&&(f=Pt(a.find('input[name="contact.password"]'),o.password),p=[c,d,u,f]),_.every(p,function(e){return null!==e})?(a.find(".error-text").html(""),a.find(".input-error").removeClass("input-error"),gt("create",{email:u,password:f,firstName:c,lastName:d,source:"DDC"},function(t){a.closest(".popup").addClass("show-confirm").find(".email-text").html(t.email),I&&e(".email-text").html(t.email),w.removeClass("recently-saved"),m.profile=t,X(function(){G("register","submit"),rt(),T&&it(),Q(),B(),V&&_t(),r&&"eprice"===r&&xt()})},{409:function(){G("registration-unsuccessful","already registered"),a.find(".error-text").html(u+" "+t.i18n.getLabel("IS_ALREADY_REGISTERED"))}})):(G("registration-unsuccessful","validation error"),a.find(".error-text").html(t.i18n.getLabel("PLEASE_FIX_HIGHLIGHTED_FIELDS")))},St=function(e,t){gt("upsert",{statuses:{RECENTLY_VIEWED:{statusType:"RECENTLY_VIEWED"}}},t,null,m.profile.profileId+"/vehicles/"+e)},Lt=function(e,t,i){gt("upsert",{statuses:_.extend({SAVED:{statusType:"SAVED"}},t?{NOTIFICATIONS_ENABLED:{statusType:"NOTIFICATIONS_ENABLED"}}:{})},i,null,m.profile.profileId+"/vehicles/"+e)},Rt=function(e){m.profile.profileId?Ut(e,function(){T&&it()}):gt("create",{source:"ANONYMOUS"},function(t){m.profile=t,Ut(e,function(){T&&it()})})},Ut=function(e,t){gt("upsert",{statuses:{EPRICE:{statusType:"EPRICE"}}},t,null,m.profile.profileId+"/vehicles/"+e)},xt=function(){var i=null,r=null;A?(r=A,i=t.userProfileController.sendLeadForm(e(".instantEPriceButton [data-href]").data("href"))):(i=t.currentVLPDialog.instantEpriceUrl,r=t.currentVLPDialog.instantEpriceVehicleId),t.userProfileController.saveInstantEpriceVehicle(null,r),t.toolbar.saveEpriceVehicleStatus(r),t.userProfileController.sendLeadForm(i),e.publish("showInstantEprice.dialog")},Vt=function(e,t,i){var r=_.findWhere(e,{itemUUID:t});r&&(r.statuses=_.omit(r.statuses,i))},Ft=function(e){if(!_.findWhere(m.savedCars,{itemUUID:e})){m.profile.email||w.addClass("recently-saved");var t=function(){},i=function(){var t=_.findWhere(m.savedCars,{itemUUID:e});H(t),Ht(t.itemUUID,t.attributes.numSaves),J([b,w]),G("save-vehicle")};t=_.partial(K,w,i),m.profile.profileId?Lt(e,!!m.profile.email,function(){t(),T&&it()}):gt("create",{source:"ANONYMOUS"},function(i){m.profile=i,Lt(e,!!m.profile.email,function(){t(),T&&it()})})}},Mt=function(t){m.savedCars=_.reject(m.savedCars,function(e){return e.itemUUID==t}),m.priceAlerts=_.reject(m.priceAlerts,function(e){return e.itemUUID==t}),Vt(m.recentCars,t,["SAVED","NOTIFICATIONS_ENABLED"]),w.removeClass("recently-saved"),J([b,w,C]),gt("delete",null,null,null,m.profile.profileId+"/vehicles/"+t+"/statuses/SAVED"),e('[data-uuid="'+t+'"] .mycars-watchers').slideUp("slow",function(){e(this).remove()})},Wt=function(i){if(m.profile.email){var r=_.findWhere(m.savedCars,{itemUUID:i});if(r){r.statuses=_.extend(r.statuses,{NOTIFICATIONS_ENABLED:{statusType:"NOTIFICATIONS_ENABLED",statusDate:(new Date).getTime()}});var a=r.latestNotifications&&r.latestNotifications.PRICE_CHANGE;a&&"UNREAD"==a.status&&(m.priceAlerts.unshift(r),gt(null,{notificationType:"PRICE_CHANGE",status:"UNREAD"},null,null,m.profile.profileId+"/vehicles/"+i+"/notifications/"+a.id)),J([b,w,C]),Lt(i,!0),H(r,!0)}else Ft(i);return G("enable-notifications","enabledNoficationsCount: "+_.filter(m.savedCars,function(e){return _.has(e.statuses,"NOTIFICATIONS_ENABLED")}).length),!0}return Ft(i),I?(t.mobile.slidein.activatePanel("mycars-slidein-panel","right"),e('#mycarsSubnav a[href="#savedTab"]').tab("show"),Gt("#registerPanel")):kt(C),!1},Bt=function(e){m.priceAlerts=_.reject(m.priceAlerts,function(t){return t.itemUUID==e}),Vt(m.recentCars,e,["NOTIFICATIONS_ENABLED"]),Vt(m.savedCars,e,["NOTIFICATIONS_ENABLED"]),J([b,w,C]),gt("delete",null,null,null,m.profile.profileId+"/vehicles/"+e+"/statuses/NOTIFICATIONS_ENABLED");var t=_.findWhere(m.savedCars,{itemUUID:e});return H(t,!1),!0},Ht=function(i,r){var a;e('[data-uuid="'+i+'"] .mycars-watchers').length||r&&t.siteProperties.myCarsRemoveWatchersBanner!==!0&&(I?(a=t.i18n.getLabel("1"==r?"OTHER_HAVE_SAVED_THIS_VEHICLE":"OTHERS_HAVE_SAVED_THIS_VEHICLE"),e("<div class='mycars-watchers'><i class='ddc-icon ddc-icon-mycars-alerts'></i>"+r+" "+a+"</div>").hide().prependTo('[data-uuid="'+i+'"]').fadeIn(1e3)):(a=t.i18n.getLabel("1"==r?"OTHER_HAVE_SAVED_THIS_VEHICLE":"OTHERS_HAVE_SAVED_THIS_VEHICLE"),e("<div class='mycars-watchers'>"+t.i18n.getLabel("YOU_AND")+" "+r+" "+a+"</div>").hide().prependTo('[data-uuid="'+i+'"]').show("slide",{direction:"right"},1e3)))},jt=function(t,i,r){if(r.preventDefault(),!I)if(t.hasClass("selected"))t.removeClass("selected").find(".popup").css("visibility","hidden");else{ht(t),vt(t);var a=t.find(".popup"),n=a.find(".ct"),s=t.attr("class").match(o.size),l=parseInt(s[1]),c=s[2];n.width(l).height(c),a.css("left",Math.min(e(window).width()-(parseInt(t.offset().left)+l+10),0)+"px").css("visibility","visible"),(i||function(){})(n),t.addClass("selected")}},Gt=function(t){var i=e(".active-overlay");i.length>0&&i.removeClass("active-overlay"),e(t).addClass("active-overlay")},qt=function(t,r,a){var n=e(".notify"),r=e(r).children().clone(),s=e(".navbar .ddc-icon-mycars-viewed"),o=a||3500;clearTimeout(i),e(".ddc-document").hasClass("slidein-open-from-right")&&(n=n.filter(".slidein-notify")),t.indexOf("add")>=0?(n.removeClass("mycars-remove-notify").addClass("mycars-notify open"),n.find(".notify-content").html(r),e(r).removeClass("hide"),s.addClass("add-color"),i=setTimeout(function(){Yt()},o)):(n.removeClass("mycars-notify").addClass("mycars-remove-notify open"),n.find(".notify-content").html(e(r)),e(r).removeClass("hide"),s.addClass("remove-color"),i=setTimeout(function(){Yt()},o))},Yt=function(){var t=e(".notify"),i=e(".navbar .ddc-icon-mycars-viewed");t.removeClass("mycars-remove-notify mycars-notify open"),i.removeClass("add-color remove-color"),t.off("click.dr-toolbox")},Qt=function(){t.getUrlParams().mycarsr&&G("engagement","link-"+t.getUrlParams().mycarsr,"flyout-link")},zt=function(i){var r=!1,a=0;if(i)r=Jt(i);else{k.each(function(){var t=e(this).data("digital-retail-summary-label");P[t]=t});for(var i in P)P[i]&&Jt(P[i])&&"vehicleOfInterest"!=P[i]&&a++;r=a>0||r;var n=e(".digital-retailing-toolbox"),s=n.find(".toolbox-content"),o=n.find('[data-show-on-state*="all-complete"]'),l=n.find('[data-show-on-state*="all-progress"]'),c=n.find('[data-show-on-state*="all-start"]'),d=n.find('[data-show-on-state*="logged-in"]'),f=n.find('[data-show-on-state*="logged-out"]'),u=s.find(".digital-retailing-summary-section dt:not(.hide)").length;r&&t.userProfile.vehicleOfInterest&&t.userProfile.vehicleOfInterest.itemUUID?(s.show(),I&&(N?(f.hide(),d.show()):(d.hide(),f.show()),c.hide()),u===a?(l.hide(),o.show()):(o.hide(),l.show())):(s.hide(),I&&(l.hide(),c.show(),N?(f.hide(),d.show()):(d.hide(),f.show())))}I&&e("#ddc-slidein-panel").on("click",'[data-toggle="popover"]',function(){var i=e(this),r=e(".ddc-slidein-panel"),a=r.find("#digital-retailing-disclaimer-panel"),n=a.find("#digital-retailing-disclaimer-content");i.closest("#toolboxTab").length>0&&(t.mobile.slidein.activatePanel("mycars-slidein-panel","right"),n.empty().append(i.data("content")),a.addClass("active-overlay"),a.on("click",".close-panel",function(e){e.preventDefault(),a.removeClass("active-overlay")}))}),I&&r&&!N&&at()},$t=function(e){var i=e.filter("[data-digital-retail-summary-template]");return e.filter("[data-digital-retail-summary-template-alt]").length>0&&t.userProfile.creditApplication&&t.userProfile.creditApplication.referenceNumber&&t.userProfile.preQualification&&!t.userProfile.preQualification.referenceNumber&&(i=e.filter("[data-digital-retail-summary-template-alt]")),i},Jt=function(i){var r,a,n,s,o={interpolate:/\{\{([\s\S]+?)\}\}/g,evaluate:/\{\{(.+?)\}\}/g},l=e(I?".digital-retailing-summary":".mycars-integration-navbar .toolbox-content"),c=l.find(".digital-retailing-vehicle-of-interest"),d=e("#vehicleOfInterestTemplate"),f=null!=t.userProfile.vehicleOfInterest?t.userProfile.vehicleOfInterest.itemUUID:null,u={},m=null,p=!1,g="drUserSession",h=function(){if(t.userProfile.vehicleOfInterest.attributes.internetPrice=t.format.currencyExtended(t.userProfile.vehicleOfInterest.attributes.internetPrice,{showCurrency:!0}),c.html(_.template(d.html(),t.userProfile.vehicleOfInterest)),!I){l.find(".mycars-resume").empty().append(l.find("[data-mycars-dr-resume-link]"));var i=l.find("[data-mycars-dr-resume-link-inline]");i.length&&i.on("click",function(){e.publish("dr-toolbox-open-next-tool"),ht()})}l.find("[data-digital-retail-link]").each(function(){var i=e(this),r=i.attr("href"),a=r.split("?"),n=t.userProfile.vehicleOfInterest.itemUUID;r.indexOf(n)<0&&(a[1]?a[1]+="&itemId="+n:a[1]="itemId="+n,i.attr("href",a.join("?"))),"payment"==i.attr("data-digital-retail-link")&&i.attr("href").indexOf("404.htm")>-1&&i.attr("href",t.userProfile.vehicleOfInterest.attributes.detailsURL+"?toolbox=payment"),"lifestyle"==i.attr("data-digital-retail-link")&&i.attr("href").indexOf("404.htm")>-1&&i.attr("href",t.userProfile.vehicleOfInterest.attributes.detailsURL+"?toolbox=lifestyle"),"testdrive"==i.attr("data-digital-retail-link")&&i.attr("href").indexOf("404.htm")>-1&&i.attr("href",t.userProfile.vehicleOfInterest.attributes.detailsURL+"?toolbox=testdrive")})};if(i){if(r=l.find('[data-digital-retail-summary="'+i+'"]'),"vehicleOfInterest"!=i&&0===r.length)return null;switch(s=r.filter('[data-show-on-state="complete"]'),$checkmark=r.filter('[checkmark-show-on-state="complete"]'),n=r.filter('[data-show-on-state="start"]'),a=$t(r),i){case"vehicleOfInterest":t.userProfile.vehicleOfInterest&&t.userProfile.vehicleOfInterest.itemUUID&&(!t.userProfile.vehicleOfInterest.attributes||!t.userProfile.vehicleOfInterest.attributes.detailsURL||t.userProfile.vehicleOfInterest.attributes.detailsURL.indexOf(t.userProfile.vehicleOfInterest.itemUUID)<0?e.ajax({type:"GET",url:"/detailmin.htm?itemId="+t.userProfile.vehicleOfInterest.itemUUID,dataType:"html",success:function(i){var r=e(i);t.userProfile.vehicleOfInterest.attributes={},t.userProfile.vehicleOfInterest.attributes.title=r.find("a.url").html(),t.userProfile.vehicleOfInterest.attributes.imageUri=r.find("img").attr("src"),t.userProfile.vehicleOfInterest.attributes.detailsURL=r.find("a.url").attr("href"),t.userProfile.vehicleOfInterest.attributes.internetPrice=r.find(".pricing li").html(),sessionStorage.setItem(g,JSON.stringify(t.userProfile)),h()}}):h());break;case"trade":var v;if(t.userProfile.ownedVehicle&&t.userProfile.ownedVehicle.valuations&&t.userProfile.ownedVehicle.valuations.length>0){var y,b=!1,w=t.userProfile.ownedVehicle.valuations[t.userProfile.ownedVehicle.valuations.length-1];v="MoreInfo"==w.thirdPartyAttributes.SACStatus?t.i18n.getLabel("MORE_INFO_NEEDED"):t.format.currencyExtended(w.offer,{showCurrency:!0})||a.attr("data-label-no-value"),w.thirdPartyAttributes.hasOwnProperty("SACStatus")?(y=[t.userProfile.ownedVehicle.year,t.userProfile.ownedVehicle.make,t.userProfile.ownedVehicle.model].join(" "),"MoreInfo"!=w.thirdPartyAttributes.SACStatus&&(b=!0)):y=[t.userProfile.ownedVehicle.year,t.userProfile.ownedVehicle.make,w.thirdPartyAttributes.model,w.thirdPartyAttributes.serie,w.thirdPartyAttributes.style].join(" "),u={vehicleName:y,offer:v,account:{name:t.dataLayer.dealership.dealershipName}};var C=e(".digital-retailing-toolbox .digital-retailing-summary-section").find(".help-text.ddc-icon");if("MoreInfo"==w.thirdPartyAttributes.SACStatus?C.css("display","none"):C.css("display","block"),b){var E=t.i18n.getLabel("APPRAISED_TRADE_IN_VALUE"),k=_.template(t.i18n.getLabel("TRADE_VALUE_DISCLAIMER"),{template:u},o),P="hover",N="left";I?(P="click",N="bottom",e("#tradeSummaryCompleteDisclaimer").append("<h4>"+E+"</h4>"+k)):setTimeout(function(){e(".digital-retailing-toolbox .digital-retailing-summary-section").find(".help-text.ddc-icon").popover({trigger:P,container:".digital-retailing-summary",placement:N,title:E,content:k,html:!0})
},200)}}else t.userProfile.progress&&t.userProfile.progress.SONIC_RTC_TRADE&&(1==t.userProfile.progress.SONIC_RTC_TRADE.state.formdata["trade.optedOut"]||"true"==t.userProfile.progress.SONIC_RTC_TRADE.state.formdata["trade.optedOut"])&&(v=t.i18n.getLabel("OPT_OUT_NO_TRADE_IN"),u={offer:v},setTimeout(function(){e(".digital-retailing-toolbox .digital-retailing-summary-section").find(".help-text.ddc-icon").css("display","none")},200));break;case"accessories":if(t.userProfile.vehicleAccessories&&t.userProfile.vehicleAccessories[f]&&t.userProfile.vehicleAccessories[f].accessories&&t.userProfile.vehicleAccessories[f].accessories.length>0&&t.userProfile.vehicleAccessories[f].accessoriesTotal>0){if(1==t.userProfile.vehicleAccessories[f].accessories.length)var D=t.i18n.getLabel("ACCESSORY_ADDED");else var D=t.i18n.getLabel("ACCESSORIES_ADDED");u={accessoriesTotal:t.format.currencyExtended(t.userProfile.vehicleAccessories[f].accessoriesTotal,{showCurrency:!0}),accessoriesCount:t.userProfile.vehicleAccessories[f].accessories.length+" "+D}}break;case"payment":if(t.userProfile.paymentQuotes&&t.userProfile.paymentQuotes[f]){var T,A=t.userProfile.paymentQuotes[f],O=l.find('[data-digital-retail-summary-label="payment"]').filter("[data-digital-retail-summary-label-template]"),S=l.find('[data-digital-retail-summary-label="payment"] .summary-label'),L=O.text().split("|",2);if(A.errorType)switch(u={title:null,description:null},m=a.html().split("|",3)[2],A.errorType){case"HIGH_BUY_POWER":u.title=t.i18n.getLabel("NONE"),u.description=t.i18n.getLabel("PLAN_TO_PAY_IN_FULL");break;case"LOW_BUY_POWER":u.title=t.i18n.getLabel("PLEASE_CALL"),u.description=t.i18n.getLabel("MORE_INFO_NEEDED");break;case"GENERAL":u.title=t.i18n.getLabel("PLEASE_CALL"),u.description=t.i18n.getLabel("PAYMENT_INFO_UNAVAILABLE_AT_THIS_TIME")}else 1==t.userProfile.paymentQuotes[f].optedOut?(u={optOut:!0},setTimeout(function(){var i=e('dd[data-digital-retail-summary="payment"][data-show-on-state="complete"] span:eq(0)'),r=e('dd[data-digital-retail-summary="payment"][data-show-on-state="complete"] span:eq(1)');i.text(t.i18n.getLabel("NOT_INTERESTED")),r.remove()},200)):u={monthlyPayment:t.format.currencyExtended(A.monthlyPayment,{showCurrency:!0}),downPayment:t.format.currencyExtended(A.downPayment,{showCurrency:!0}),term:A.term,apr:A.apr+"%",dueAtSigning:t.format.currencyExtended(A.dueAtSigning,{showCurrency:!0})},"loan"===A.type?T=0:(T=1,u.annualMiles=t.format.number(A.annualMiles)),m=a.html().split("|",3)[T],I&&(S.find(".digital-retailing-summary-section-label").eq(0).text(L[T]),A&&e("dd.inline-personalize-payment").css("display","none"))}break;case"prequal":t.userProfile.preQualification&&t.userProfile.preQualification.referenceNumber?u={referenceNumber:t.userProfile.preQualification.referenceNumber}:t.userProfile.creditApplication&&t.userProfile.creditApplication.referenceNumber&&(u={referenceNumber:t.userProfile.creditApplication.referenceNumber});break;case"finance":t.userProfile.creditApplication&&t.userProfile.creditApplication.referenceNumber?u={referenceNumber:t.userProfile.creditApplication.referenceNumber}:t.userProfile.creditApplication&&t.userProfile.creditApplication.optedOut&&(setTimeout(function(){var i=e('dd[data-digital-retail-summary="finance"][data-show-on-state="complete"] span:eq(0)'),r=e('dd[data-digital-retail-summary="finance"][data-show-on-state="complete"] span:eq(1)');i.text(t.i18n.getLabel("NOT_INTERESTED")),r.remove()},200),u={optOut:!0});break;case"reserve":t.userProfile.vehicleReservations&&t.userProfile.vehicleReservations[f]&&(u={referenceNumber:t.userProfile.vehicleReservations.id});break;case"protect":t.userProfile.protectionPlan&&(u={complete:!0,protectionStatus:"selected"===t.userProfile.protectionPlan.toLowerCase()?"Selected":"Deferred"});break;case"lifestyle":if(t.userProfile.progress&&t.userProfile.progress.INLINE_DR_MENU){var R=1==t.userProfile.progress.INLINE_DR_MENU.state.isCompleted||1==t.userProfile.progress.INLINE_DR_MENU.state.isOptedOut;u={complete:!0,lifestyleStatus:t.i18n.getLabel(1==t.userProfile.progress.INLINE_DR_MENU.state.isCompleted?"SUBMITTED":"NOT_INTERESTED")},I&&R&&e("dd.inline-lifestyle-menu").css("display","none")}break;case"testdrive":var U=t.userProfile.progress&&t.userProfile.progress.INLINE_DR_TESTDRIVE;if(U){var x=1==t.userProfile.progress.INLINE_DR_TESTDRIVE.state.completed||1==t.userProfile.progress.INLINE_DR_TESTDRIVE.state.optedOut,V=1==t.userProfile.progress.INLINE_DR_TESTDRIVE.state.completed,F=1==t.userProfile.progress.INLINE_DR_TESTDRIVE.state.optedOut;if(V||F){var M="";if(V){var W=t.userProfile.progress.INLINE_DR_TESTDRIVE.state.time,B=new Date(W),H={weekday:"long",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},j=(B.getFullYear(),B.toLocaleDateString("en-US",H).split(",")),G=t.userProfile.progress.INLINE_DR_TESTDRIVE.state.selectedLocationFormattedDDCId||"";M="<span>"+G+" </span><span>"+j[0]+", "+j[1]+" at "+j[2]+"</span>"}F&&(M="<span>"+t.i18n.getLabel("NOT_INTERESTED")+"</span>"),u={complete:!0,testdriveStatus:M}}I&&x&&e("dd.inline-testdrive-menu").css("display","none")}break;default:u={}}_.isEmpty(u)?(s.hide(),$checkmark.hide(),n.show()):(m=m||a.html(),s.html(_.template(m,{template:u},o)).show(),$checkmark.show(),n.hide(),p=!0)}return p},Zt=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},Kt=function(){var t=location.pathname;(Zt(x,t)||Zt(V,t))&&(N?(e(".ua-not-logged-in").toggleClass("hide",!0),e(".ua-logged-in").toggleClass("hide",!1)):(e(".ua-not-logged-in").toggleClass("hide",!1),e(".ua-logged-in").toggleClass("hide",!0)))},Xt=function(i,r){var a=r.find(".mycars-save-btn").attr("class").replace(/\s/g,"."),n=r.find(".mycars-add-alert-btn").attr("class").replace(/\s/g,"."),s=Ct("login",a),o=Ct("login",n),l=Ct("register",a),c=Ct("register",n);t.mobile.slidein.activatePanel("mycars-slidein-panel","right"),"add-alert"==i?e('#mycarsSubnav a[href="#alertsTab"]').tab("show"):e('#mycarsSubnav a[href="#savedTab"]').tab("show"),e("#savedTab .empty-content").toggleClass("hide",!0),e("#savedTab .login-to-proceed").toggleClass("hide",!1),e("#alertsTab .empty-content").toggleClass("hide",!0),e("#alertsTab .login-to-proceed").toggleClass("hide",!1),e("#savedTab").find('a[href="#loginPanel"]').hide().end().find('a[href="#registerPanel"]').hide().end().find(".login-intercept-button-login").attr("href",s).toggleClass("hide",!1).end().find(".login-intercept-button-register").attr("href",l).toggleClass("hide",!1),e("#alertsTab").find('a[href="#loginPanel"]').hide().end().find('a[href="#registerPanel"]').hide().end().find(".login-intercept-button-login").attr("href",o).toggleClass("hide",!1).end().find(".login-intercept-button-register").attr("href",c).toggleClass("hide",!1),e("#ddc-slidein-panel-gutter").addClass("mycars-login-intercept-active"),ei()},t=t||{};t.Widgets=t.Widgets||{},t.Widgets.MyCars=t.Widgets.MyCars||{},t.toolbar={addNotifications:Wt,removeNotifications:Bt,removeVehicle:Mt,saveEpriceVehicleStatus:Rt},t.Widgets.MyCars.isUserLoggedIn=function(){return N},t.Widgets.MyCars.isMobile=I,t.Widgets.MyCars.promptUserLogin=I?Gt:bt;var ei=function(){var t=e(I?".digital-retailing-summary":".mycars-integration-navbar .toolbox-content"),i=t.find("[data-digital-retail-link-inline-payment]"),r=t.find("[data-digital-retail-link-inline-lifestyle]"),a=t.find("[data-digital-retail-link-inline-testdrive]"),n=!1;e("html").hasClass("vdp")&&(n=!0),i.length&&i.on("click",function(t){n&&(t.preventDefault(),e(".ddc-slidein-panel-gutter").click(),e.publish("dr-toolbox-open-calc"))}),r.length&&r.on("click",function(t){n&&(t.preventDefault(),e(".ddc-slidein-panel-gutter").click(),e.publish("dr-toolbox-open-lifestyle"))}),a.length&&a.on("click",function(t){n&&(t.preventDefault(),e(".ddc-slidein-panel-gutter").click(),e.publish("dr-toolbox-open-testdrive"))})};e(document).ready(function(){var i=v.find("> .social");if(z(),window.addEventListener?window.addEventListener("message",st,!1):window.attachEvent&&window.attachEvent("onmessage",st),e(window).load(Qt),e(window).height()<600&&h.find(".popup .bd").css({"max-height":350}),!I){var r=j();_.each([b,w,C],function(e){q(e.find(".count"),r[e.data("key")])})}g.removeClass("hide"),h.length>0&&mt(),y.add(b).add(w).add(C).find("> a").add(".mycars-login").click(function(t){t.preventDefault();var i=e(this).parent();e(this).is(".mycars-login")&&(t.stopPropagation(),i=y),i.hasClass("selected")?ht():(G("engagement","open-"+i.data("key")),i.is(".login")?bt():kt(i))}),y.add(".login-default").find(".login-form").submit(Nt),e(".login-default").find(".login-form fieldset").last().append('<div class="error-text"></div>'),e(".login-register").find(".register-form fieldset").last().append('<div class="error-text"></div>'),y.find(".mycars-form.forgot-password-form").on("submit",function(t){Dt(t,e(this))}),e("#password-reset-request").on("submit",function(t){Dt(t,e(this))}),e(window.document).on(U,"#password-reset-request .email",function(){yt("#password-reset-request")}),h.add(".login-register").find(".register-form").submit(Ot),setTimeout(function(){(!I&&e(".register-form")[0]||e(".password-reset")[0])&&e(".validate-password").find('input[name="contact.password"], input[name="contact.passwordConfirm"]').popover({trigger:"focus",placement:"right",content:t.i18n.getMessage("PASSWORD_REQUIREMENTS_VERBIAGE"),html:!0})},5),e(".login-password-reset")[0]&&At(),e(window.document).on(U,".mycars-form-textfield",function(){var t=e(this).attr("type"),i=e(this).parents(".mycars-form").parents("div").attr("class").replace("-content","");-1!=i.indexOf(" forgot-password")&&(i=i.replace(" forgot-password","")),yt(i),""!==e(this).val()&&e(this).hasClass("password")&&e(this).closest("form").hasClass("login-form")?Pt(e(this),o.notEmpty):""===e(this).val()||e(this).hasClass("password-confirm")||Pt(e(this),o[t])}),e(window.document).on("click",".logout",function(t){t.preventDefault(),h.find("input.mycars-form-textfield").val(""),gt("logout",null,function(){m.profile.email=null,m.profile.profileId=null,e.publish("mycars-user-logging-out"),X(Q)}),T&&nt(),x&&ht()}),e(window.document).on("keydown",function(e){e.keyCode&&27===e.keyCode&&ht()}),y.find(" > a").on("click",function(){e(this).parents(".login").hasClass("selected")&&yt("login")}),h.find(".recent-cars a[href*=#recent-cars], .saved-cars a[href*=#saved-cars], .price-alerts a[href*=#price-alerts], .recent-cars .register-toggle .show-text, .saved-cars .register-toggle .show-text").click(function(){yt("register")}),y.find(".forgot-password-link, .register-link, .login-link").on("click",function(){R=e(this).closest(".mycars-postform-links").siblings("form").find(".email").val()}),h.find(".login-link").click(function(t){G("login-link",e(this).closest(".menu").data("key"));var i=R;i&&y.find(".login-content .email").val(i),yt(e(this).attr("href").replace("#","")),t.preventDefault(),t.stopPropagation(),y.removeClass("show-forgot-password"),y.removeClass("show-register"),bt()}),e(window.document).on(U,"#login input",function(){yt("#login")}),e(window.document).on(U,"#register input",function(){yt("#register")}),y.find(".register-link").click(function(t){G("register-link","login");var i=R;i&&y.find(".register-content .email").val(i),yt(e(this).attr("href").replace("#","")),t.preventDefault(),y.removeClass("show-forgot-password"),y.addClass("show-register")}),e(".mycars-register").on("click",function(e){e.preventDefault(),e.stopPropagation(),G("register-link","info"),y.addClass("show-register"),bt()}),e(window.document).on(U,'.register-form input[name="contact.password"]',function(){var t=e(this).closest(".register-form").attr("id");submitButtonSelector=".mycars-form-btn",e(this).closest("div.eprice-form").hasClass("eprice-form")&&(submitButtonSelector='button[type="submit"]'),Tt("#"+t,'input[name="contact.password"]','input[name="contact.passwordConfirm"]',submitButtonSelector)}),e(window.document).on(U,'.register-form input[name="contact.passwordConfirm"]',function(){var t=e(this).closest(".register-form").attr("id");submitButtonSelector=".mycars-form-btn",e(this).closest("div.eprice-form").hasClass("eprice-form")&&(submitButtonSelector='button[type="submit"]'),Tt("#"+t,'input[name="contact.password"]','input[name="contact.passwordConfirm"]',submitButtonSelector)}),y.find(".forgot-password-link").click(function(t){t.preventDefault(),G("forgot-password-link","forgot-password");var i=R;i&&y.find(".forgot-password-content .email").val(i),yt(e(this).attr("href").replace("#","")),y.removeClass("show-register"),y.addClass("show-forgot-password"),Et();var r=e(".forgot-password-form"),a=r.find(".error-text");a.html(""),r.parent().find(".register-sales, .form-group, input").show(),r.find(".password-reset-heading, .password-reset-body").remove()}),h.on("click",".mycars-save-btn",function(){return Ft(e(this).data("id")),!1}),e(window.document).on("click",".mycars-save-btn",function(){if(I&&M&&!N)Xt("save",e(this).closest(".mycars-buttons"));else if(G("engagement",(e(".vlp").length>0?"vlp":"vdp")+"-save-vehicle"),ht(w),Ft(e(this).data("id")),m.profile.email||kt(w),I){var t=e(this).attr("data-message");qt("add-saved",t)}return!1}),h.on("click",".mycars-saved-btn",function(){return G("remove-vehicle","recentCars"),Mt(e(this).data("id")),!1}),e(window.document).on("click",".mycars-saved-btn",function(){if(G("engagement",(e(".vlp").length>0?"vlp":"vdp")+"-remove-vehicle"),ht(w),Mt(e(this).data("id")),I){var t=e(this).attr("data-message");qt("remove-saved",t)}return!1}),h.on("click",".mycars-add-alert-btn",function(t){Wt(e(this).data("id")),t.preventDefault()}),e(window.document).on("click",".mycars-add-alert-btn",function(){if(I&&M&&!N)Xt("add-alert",e(this).closest(".mycars-buttons"));else if(G("engagement",(e(".vlp").length>0?"vlp":"vdp")+"-enable-notifications"),ht(C),Wt(e(this).data("id")),I){if(!N&&V)return It("register"),!1;if(m.profile.email){var i=e(this).attr("data-message");qt("add-alert",i)}else t.mobile.slidein.activatePanel("mycars-slidein-panel","right"),e('#mycarsSubnav a[href="#savedTab"]').tab("show"),Gt("#registerPanel")}return!1}),e(window.document).on("click",".mycars-unsub-all-price-alerts",function(){return e(".mycars-mobile-list").find(".mycars-alerts-isset").not(".hide").each(function(t,i){if(Bt(e(i).data("id")),I){var r=e(this).attr("data-message");qt("remove-alert",r)}}),!1}),h.on("click",".mycars-alerts-isset",function(){return G("disable-notifications",e(this).closest(".menu").data("key")),Bt(e(this).data("id")),!1}),e(window.document).on("click",".mycars-alerts-isset",function(){if(G("engagement",(e(".vlp").length>0?"vlp":"vdp")+"-disable-notifications"),ht(C),Bt(e(this).data("id")),I){var t=e(this).attr("data-message");qt("remove-alert",t)}return!1}),w.on("click",".remove",function(){return G("remove-vehicle","savedCars"),Mt(e(this).closest(".mycars-vehicle").data("id")),!1}),C.on("click",".remove",function(){G("hide-notification","enabledNoficationsCount: "+_.filter(m.savedCars,function(e){return _.has(e.statuses,"NOTIFICATIONS_ENABLED")}).length);var t=e(this).closest(".mycars-vehicle"),i=t.data("id"),r=t.data("notiftype"),a=t.data("notifid");return m.priceAlerts=_.reject(m.priceAlerts,function(e){return e.latestNotifications[r]&&e.latestNotifications[r].id==a&&e.itemUUID==i}),J([C]),gt(null,{notificationType:r,status:"READ"},null,null,m.profile.profileId+"/vehicles/"+i+"/notifications/"+a),!1}),e(document).on({mouseenter:function(){e(this).removeClass("mycars-action-set").addClass("mycars-action-remove").find(".ui-button-text").html(e(this).attr("label-remove"))},mouseleave:function(){e(this).removeClass("mycars-action-remove").addClass("mycars-action-set").find(".ui-button-text").html(e(this).attr("label-set"))}},".mycars-saved-btn, .mycars-alerts-isset"),h.on("click",".item-compare .checkbox",function(){var t=e(this).closest(".popup");t.find(".item-compare .checkbox:checked").length>1?t.find(".compare-btn").removeClass("disabled"):t.find(".compare-btn").addClass("disabled")}),h.find(".mycars-compare-form").submit(function(){var t=e(this);if(t.find(".compare-btn").hasClass("disabled"))return!1;var i=t.closest(".popup").find(".item-compare .checkbox:checked").map(function(){return e(this).val()}).get().join(",");e.cookie("DDC.inventory-compare.selected",i,{path:"/"}),t.find("input[name=itemIds]").val(i)}),v.find("a").on("click",function(){var r=i.find(".lazy-load");r.size()>0&&(r.removeClass("lazy-load"),e(document).trigger("modulesRefresh",{modules:{ui:t.modules.ui}}))}),v.find("> div").not(".hide-bar").not(i).find("> a").click(function(t){var i=e(this);jt(i.parent(),function(t){t.html()&&t.html()!=l||e.ajax({url:i.attr("href"),success:function(i){t.html("<div>"+i+"</div>"),e(document).trigger("modulesRefresh")},error:function(){t.html(l)},complete:function(){}})},t)}),i.find("> a").click(_.partial(jt,i,function(){i.find(".ui-tabs").tabs("load",0)})),v.find("> .hide-bar > a").click(function(t){t.preventDefault();var i=e(this).closest(".hide-bar"),r=i.hasClass("active");i[r?"removeClass":"addClass"]("active"),g[r?"removeClass":"addClass"]("hideBar"),e("html").hasClass("mycars-toolbar-position-top")||e("html").hasClass("mycars-toolbar-position-top-hidden")?e("html")[r?"removeClass":"addClass"]("mycars-toolbar-position-top-hidden")[r?"addClass":"removeClass"]("mycars-toolbar-position-top"):(e("html").hasClass("mycars-toolbar-position-bottom")||e("html").hasClass("mycars-toolbar-position-bottom-hidden"))&&e("html")[r?"removeClass":"addClass"]("mycars-toolbar-position-bottom-hidden")[r?"addClass":"removeClass"]("mycars-toolbar-position-bottom")}),v.find("> .info .register-link").click(function(){return G("register-link","info"),y.addClass("show-register"),bt(),!1}),v.find("> .info .login-link").click(function(){return G("login-link","info"),y.removeClass("show-register"),bt(),!1}),h.find(".register-toggle").click(function(t){if(t.preventDefault(),!N&&V)It("register");else{var i=e(this);i.hasClass("show-register")?i.removeClass("show-register").closest(".register-wrapper").find(".register-content").slideUp():i.addClass("show-register").closest(".register-wrapper").find(".register-content").slideDown()}}),e(".ua-logged-in .mycars-logout").click(function(){e(".mycars .login .logout").trigger("click"),Kt()}),I&&("mobile"===t.getUrlParams().favorites&&(t.mobile.slidein.activatePanel("mycars-slidein-panel","right"),e('#mycarsSubnav a[href="#savedTab"]').tab("show")),"mobile"===t.getUrlParams().incentives&&e(".accordion.incentive-list").length&&e("html, body").animate({scrollTop:e(".accordion.incentive-list").offset().top-90},500),e(window.document).on("click","#savedTab .mycars-mobile-list .remove",function(){return G("remove-vehicle","savedCars"),Mt(e(this).closest(".mycars-vehicle").data("id")),kt(w),!1}),e(window.document).on("click",".mycars-mobile-list .mycars-list-row",function(t){if(e(t.target).is("a")===!1&&e(t.target).parent().is("a")===!1&&(e(t.target).is("img")===!1||e(t.target).is("img")&&e(t.target).hasClass("remove"))){var i=e(t.target).closest(".mycars-list-row").find(".vehicle-title a").attr("href");""!==i&&void 0!==i&&(window.open(i,"_self"),t.preventDefault())}}),e(window.document).on("click","#alertsTab .mycars-mobile-list .remove",function(){G("hide-notification","enabledNoficationsCount: "+_.filter(m.savedCars,function(e){return _.has(e.statuses,"NOTIFICATIONS_ENABLED")}).length);var t=e(this).closest(".mycars-vehicle"),i=t.data("id"),r=t.data("notiftype"),a=t.data("notifid");return m.priceAlerts=_.reject(m.priceAlerts,function(e){return e.latestNotifications[r]&&e.latestNotifications[r].id==a&&e.itemUUID==i}),J([C]),gt(null,{notificationType:r,status:"READ"},null,null,m.profile.profileId+"/vehicles/"+i+"/notifications/"+a),!1}),e(window.document).on("click",".open-slide-panel",function(t){t.preventDefault();var i=e(this).attr("href");if(!N&&"#registerPanel"==e(this).attr("href")&&V)return It("register"),!1;if(!N&&"#loginPanel"==e(this).attr("href")&&x)return It("login"),!1;if(e("#ddc-slidein-panel-mycars-slidein-panel").find(".forgot-password-link, .register-link, .login-link").on("click",function(){R=e(this).closest(".mycars-postform-links").siblings("form").find(".email").val()}),Gt(i),"#forgotPasswordPanel"==e(this).attr("href")){var r=e(".forgot-password-form"),a=r.find(".error-text");a.html(""),r.parent().find(".register-sales, .form-group, input").show(),r.find(".password-reset-heading, .password-reset-body").remove(),R&&e("#ddc-slidein-panel-mycars-slidein-panel").find(".section-forgot-password").find(".email").val(R)}else"#registerPanel"==e(this).attr("href")?R&&e("#ddc-slidein-panel-mycars-slidein-panel").find(".section-register").find(".email").val(R):"#loginPanel"==e(this).attr("href")&&R&&e("#ddc-slidein-panel-mycars-slidein-panel").find(".section-login").find(".email").val(R)}),e(window.document).on("click",".mycars-postform-links .forgot-password-link, .mycars-postform-links .register-link, .mycars-postform-links .login-link",function(){"#loginPanel"==e(this).attr("href")?yt("login"):"#registerPanel"==e(this).attr("href")?yt("register"):"#forgotPasswordPanel"==e(this).attr("href")&&yt("login")}),e(window.document).on("click",".section-saved .choose .open-slide-panel",function(){"#loginPanel"==e(this).attr("href")?yt("login"):"#registerPanel"==e(this).attr("href")&&yt("register")}),e(window.document).on("click",".close-panel",function(t){t.preventDefault(),e(this).parent().parent().removeClass("active-overlay")}),e(window.document).on("submit",".mycars-form.register-form",function(e){e.preventDefault(),Ot(e)}),e(window.document).on("submit",".mycars-form.login-form",function(e){e.preventDefault(),Nt(e)}),e(window.document).on("click","[data-digital-retail-link-inline-payment]",ei),e(window.document).on("click","[data-digital-retail-link-inline-lifestyle]",ei),e(window.document).on("click","[data-digital-retail-link-inline-testdrive]",ei),e(window.document).on("submit",".mycars-form.forgot-password-form",function(t){t.preventDefault(),Dt(t,e(this))}),e(window.document).on("click","#ddc-slidein-panel-mycars-slidein-panel .close-slidein, #ddc-slidein-panel-mycars-slidein-panel .panel-gutter",function(t){t.preventDefault(),e(this).parent().find(".active-overlay").removeClass("active-overlay")}),e(window.document).on("click",".btn-mycars",function(){e('#mycarsSubnav a[href="#savedTab"]').tab("show"),e(window.document).on("click","#ddc-slidein-panel-mycars-slidein-panel :submit",function(t){t.preventDefault();var i=e(this);i.parents("div").hasClass("section-login")&&Nt(t),i.parents("div").hasClass("section-register")&&Ot(t)})}),e(window.document).on("click",".ddc-icon-mycars-viewed.ddc-nav-icon",function(){location.href.indexOf("_autofill")>0&&setTimeout(function(){e("#ddc-slidein-panel-mycars-slidein-panel").find(".login-link").click(),e("#ddc-slidein-panel-mycars-slidein-panel").find(".section-login").find(".email").val("ddcsupport@email.com"),e("#ddc-slidein-panel-mycars-slidein-panel").find(".section-login").find(".password").val("Un1k1tty"),e(window.document).find(".login-form").click(function(e){e.preventDefault(),Nt(e)})},4e3,setTimeout(function(){e('#mycarsSubnav a[href="#toolboxTab"]').tab("show")},2e3,function(){t.mobile.slidein.activatePanel("mycars-slidein-panel","right")}()))})),e(window.document).on("submit",".eprice-form .login-form",function(e){e.preventDefault(),Nt(e,"eprice")}),e(window.document).on("submit",".eprice-form .register-form",function(e){e.preventDefault(),Ot(e,"eprice")}),function(){e("html").addClass("mycars-logged-out"),e.subscribe("mycars-logged-in",function(){e("html").removeClass("mycars-logged-out"),e("html").addClass("mycars-logged-in")}),e.subscribe("mycars-user-logging-out",function(){e("html").removeClass("mycars-logged-in"),e("html").addClass("mycars-logged-out")})}(),e.subscribe("dr-trade-complete dr-accessories-complete dr-payment-complete dr-finance-complete dr-prequal-complete dr-reserve-complete dr-protect-complete dr-lifestyle-complete dr-testdrive-complete",function(){if(I){var i=e("#ddc-mobile-mycars-toolbox");setTimeout(function(){qt("add-toolbox",i,8e3)},1e3),e('#mycarsSubnav a[href="#toolboxTab"]').tab("show"),e(".notify").on("click.dr-toolbox",function(i){i.preventDefault(),Yt(),e(".ddc-document").hasClass("slidein-open-from-right")?t.mobile.slidein.deactivatePanel(function(){t.mobile.slidein.activatePanel("mycars-slidein-panel","right",function(){e('#mycarsSubnav a[href="#toolboxTab"]').tab("show")})}):t.mobile.slidein.activatePanel("mycars-slidein-panel","right")})}zt()}),I&&e.subscribe("dr-payment-reset",function(){t.mobile.slidein.deactivatePanel(),e("#ddc-slidein-panel-payment-calc-slidein").remove(),e('[data-name="calculator.payment.dealertrack"]').trigger("click")}),e.subscribe("userProfile-updated",function(){zt()}),e.subscribe("dr-inline-opted-out",function(){zt()}),e.subscribe("digitalRetailing-updated",function(){t.Widgets.MyCars.ORIGIN_API&&t.Widgets.MyCars.ORIGIN_API.sendUserProfileApiUpdate()})})}(jQuery,window.DDC);