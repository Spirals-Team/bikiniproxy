<!DOCTYPE html>
<html xmlns=http://www.w3.org/1999/xhtml>
<head>
	<meta http-equiv=content-type content="text/html;charset=utf-8" />
	<title>Iframe Cookie Messaging</title>
	<meta name=robots content="noindex, nofollow" />
	<meta http-equiv=Cache-control content=public>
	<style>*{margin:0;padding:0}body{background:transparent;font-size:100%}.fb-connect-btn{display:block;text-decoration:none;text-indent:inherit;text-align:center;border:1px solid #6b86bf;width:99.5%;padding:0;line-height:2em;height:auto;color:#fff;font-size:1em;font-family:arial,serif;text-shadow:0 0 5px #36559f;border-radius:3px 3px 3px 3px;-moz-border-radius:3px 3px 3px 3px;-webkit-border-radius:3px 3px 3px 3px;box-shadow:inset 0 2px 1px rgba(255,255,255,0.15);-moz-box-shadow:inset 0 2px 1px rgba(255,255,255,0.15);-webkit-box-shadow:inset 0 2px 1px rgba(255,255,255,0.15);background-color:#516dac;background-image:linear-gradient(-90deg,#7a8fc5,#3756a0);background-image:-webkit-gradient(linear,50% 0,50% 100%,from(#7a8fc5),to(#3756a0));background-image:-moz-linear-gradient(-90deg,#7a8fc5,#3756a0)}.fb-connect-btn:hover,.fb-connect-btn:active{color:#fff;background-image:linear-gradient(-90deg,#7a8fc5,#1240a0);background-image:-webkit-gradient(linear,50% 0,50% 100%,from(#7a8fc5),to(#1240a0));background-image:-moz-linear-gradient(-90deg,#7a8fc5,#1240a0)}.fb-connect-btn i{float:left;width:1em;text-align:left;line-height:1.9em;padding-left:.5em;font-size:1.1em;color:#fff;text-shadow:0 0 5px rgba(54,85,159,0.15);border-right:1px solid rgba(255,255,255,0.15)}.desktopButton{font-size:125%;width:330px}strong{font-weight:bold}</style>
	<script type=text/javascript>var isSafari=((navigator.userAgent.toLowerCase().indexOf("safari")>-1&&navigator.userAgent.toLowerCase().indexOf("chrome")==-1))?true:false,isIframe=(window.parent!==window.top)?true:false,gup=function(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+b+"=([^&#]*)";var d=new RegExp(a);var c=d.exec(window.location.href);if(c==null){return""}else{return c[1]}},getCookie=function(b){var c,a,e,d=document.cookie.split(";");for(c=0;c<d.length;c++){a=d[c].substr(0,d[c].indexOf("="));e=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(e)}}},getStorage=function(b){var a=localStorage.getItem(b);if(a!==undefined||a!==null){return a}else{return null}};setCookie=function(c,e,f,d){if(f){var b=new Date();b.setTime(b.getTime()+(f*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}if(d!=undefined&&d.length>1){document.cookie=c+"="+e+a+"; path=/;domain="+d+";"}else{document.cookie=c+"="+e+a+"; path=/"}},setStorage=function(a,b){localStorage.setItem(a,b)},processMessage=function(c){if(c.origin.indexOf("facebook")<0){if(c.data){var f={},e,a;e=JSON.parse(c.data);if(isSafari){a=getStorage(e.cookieName)}else{a=getCookie(e.cookieName)}if(e.hasOwnProperty("action")&&e.action.indexOf("getCookie")!==-1){if(e.hasOwnProperty("cookieData")&&!a){if(isSafari){setStorage(e.cookieName,e.cookieData)}else{setCookie(e.cookieName,e.cookieData,e.cookieExpireDays,e.domain)}f={result:"cookiewritten",cookieName:e.cookieName,cookieData:e.cookieData}}else{if(a){if(a.indexOf("INVALID")!==-1){var g=a.split(":");var b=g[1];if(e.cookieData===b){f={result:"logoutcookie",cookieName:e.cookieName,cookieData:a}}else{f={result:"rewritecookie",cookieName:e.cookieName,cookieData:a}}}else{f={result:"cookieread",cookieName:e.cookieName,cookieData:a}}}else{f={result:"notfound",cookieName:e.cookieName,cookieData:a}}}}if(e.hasOwnProperty("action")&&e.action.indexOf("setCookie")!==-1){if(e.hasOwnProperty("cookieData")||"cookieData" in e){if(isSafari){setStorage(e.cookieName,e.cookieData)}else{setCookie(e.cookieName,e.cookieData,e.cookieExpireDays,e.domain)}f={result:"cookiewritten",cookieName:e.cookieName,cookieData:e.cookieData}}}if(e.hasOwnProperty("action")&&e.action.indexOf("invalidateCookie")!==-1){var d="INVALID:"+a;if(isSafari){setStorage("userProfileId",d)}else{setCookie("userProfileId",d,e.cookieExpireDays,e.domain)}f={result:"invalidated",cookieName:"userProfileId",cookieData:d}}c.source.postMessage(JSON.stringify(f),c.origin)}}},doFBlogin=function(){FB.login(checkLoginStatus,{scope:"email"})},checkLoginStatus=function(a){if(a&&a.status=="connected"){FB.api("/me",function(b){returnMessage={result:"facebooklogin",fbprofile:b};if(isIframe){window.parent.postMessage(JSON.stringify(returnMessage),document.referrer)}else{window.top.postMessage(JSON.stringify(returnMessage),document.referrer)}})}else{}},broadcastCookies=function(e){var c=e.length,d={},a;for(var b=0;b<c;b++){if(isSafari){a=getStorage(e[b])}else{a=getCookie(e[b])}if(a){if(a.indexOf("INVALID")!==-1){d={result:"logoutcookie",cookieName:"userProfileId",cookieData:a}}else{d={result:"cookieread",cookieName:e[b],cookieData:a}}}else{d={result:"notfound",cookieName:e[b]}}if(isIframe){window.parent.postMessage(JSON.stringify(d),document.referrer)}else{window.top.postMessage(JSON.stringify(d),document.referrer)}}},timedBroadcast=function(g){var a=50;var f=5000;var d=30000;var e=a;var c=new Date();var b=function(){broadcastCookies([g]);if(new Date()-c<d){e=Math.min(e*2,f);window.setTimeout(b,e)}};window.setTimeout(b,e)};if(window.addEventListener){window.addEventListener("message",processMessage,false)}else{if(window.attachEvent){window.attachEvent("onmessage",processMessage)}}window.onload=function(){timedBroadcast("userId");timedBroadcast("userProfileId");timedBroadcast("drinteraction")};</script>
</head>
<body>
<div id=fb-root></div>
<script>getParam=function(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+b+"=([^&#]*)",d=new RegExp(a),c=d.exec(window.location.href);if(c==null){return""}else{return c[1]}};if(getParam("disableFacebook")!="true"){var appId=gup("fbappid");window.fbAsyncInit=function(){FB._secure=(window.location.protocol=="https:");FB._https=FB._secure;FB.init({appId:appId,channelUrl:"",status:true,cookie:true,xfbml:true})};(function(c){var b,e="facebook-jssdk",a=c.getElementsByTagName("script")[0];if(c.getElementById(e)){return}b=c.createElement("script");b.id=e;b.async=true;b.src="//connect.facebook.net/en_US/all.js";a.parentNode.insertBefore(b,a)}(document))}</script>
<a id=fbBtn class=fb-connect-btn href=# onclick=doFBlogin()>
	<i class=icon-facebook></i><span id=fb-connect-label></span>
</a>
<script type=text/javascript>if(getParam("disableFacebook")!="true"){var fbConnectText=getParam("connectLabel"),isMobile=getParam("_renderer"),fbBtn=document.getElementById("fbBtn");if(isMobile!="mobile"){fbBtn.className=fbBtn.className+" desktopButton"}if(!fbConnectText){fbConnectText="Connect with Facebook"}document.getElementById("fb-connect-label").innerHTML="<strong>"+decodeURIComponent(fbConnectText.replace(/\+/g,"%20"))+"</strong>"};</script>
</body>
</html>